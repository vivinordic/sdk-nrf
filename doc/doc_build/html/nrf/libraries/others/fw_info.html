<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Firmware information &mdash; nRF Connect SDK 2.3.99 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/nordic.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/togglebutton.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/nrf.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/tabs.css" type="text/css" /> 
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="https://www.googletagmanager.com/gtag/js?id=G-ZPVZRKFQJR"></script>
        <script src="../../_static/js/ga-tracker.js"></script>
        <script data-culture="EN" id="CookieConsent" type="text/javascript" src="https://policy.app.cookieinformation.com/uc.js"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../_static/togglebutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/js/theme.js"></script>
<script
  type="text/javascript"
  src="../../_static/js/ncs.js"
></script>
<script src="../../_static/js/bootstrap.bundle.min.js"></script>

    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Hardware ID" href="hw_id.html" />
    <link rel="prev" title="Hardware flash write protection" href="fprotect.html" />
<link
  href="../../_static/css/bootstrap.min.css"
  rel="stylesheet"
/>
<link
  rel="shortcut icon"
  href="../../_static/images/favicon.ico"
/>

</head>

<body class="wy-body-for-nav">
<div class="announcement"></div>
<div class="d-print-none ncs-header">
  <div class="container-xl ncs-header-top">
    <div class="row h-100">
      <div class="d-none d-md-block col-2">
        <div class="bg-white py-4 px-3 ml-2 ncs-header-logo">
          <img
            class="ncs-header-logo"
            src="../../_static/images/nordic-logo.png"
            alt=""
          />
        </div>
      </div>
      <div
        class="col-8 col-md-7 pl-md-4 d-flex align-self-center justify-content-center"
      >
        <form class="w-75" action="../../search.html" method="get">
          <div class="form-group">
            <input
              type="text"
              name="q"
              class="ncs-search-input form-control"
              placeholder="Search all docs..."
            />
          </div>
        </form>
      </div>
      <div class="col-4 col-md-3 d-md-block p-3 text-end">
        <div class="dropdown">
          <button
            class="btn dropdown-toggle ncs-btn-versions"
            type="button"
            id="dropdownMenuButton1"
            data-bs-toggle="dropdown"
            aria-expanded="false"
          >
            <span class="d-none d-md-inline">nRF Connect SDK</span>
            <span id="ncsversion" class="d-inline"></span>
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton"></div>
        </div>
      </div>
    </div>
  </div>
  <div class="ncs-header-nav">
    <div class="container-xl">
      <div class="row">
        <div class="col col-12 d-flex justify-content-center">
          <nav class="navbar navbar-dark navbar-expand-lg p-0">
            <span class="navbar-brand d-block d-lg-none py-2 pl-1"
              >Documentation sets</span
            >
            <button
              class="navbar-toggler"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#navbarNavAltMarkup"
              aria-controls="navbarNavAltMarkup"
              aria-expanded="false"
              aria-label="Toggle navigation"
            >
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
              <ul class="navbar-nav">
                <li class="nav-item active py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../nrf/index.html"
                    >nRF Connect SDK</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../nrfx/index.html"
                    >nrfx</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../nrfxlib/README.html"
                    >nrfxlib</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../zephyr/index.html"
                    >Zephyr Project</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../mcuboot/wrapper.html"
                    >MCUboot</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../tfm/index.html"
                    >Trusted Firmware-M</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../matter/index.html"
                    >Matter</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../kconfig/index.html"
                    >Kconfig Reference</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
              </ul>
            </div>
          </nav>
        </div>
      </div>
    </div>
  </div>
</div>

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> nRF Connect SDK
          </a>
              <div class="version">
                2.3.99
              </div>
<div id="searchbox" role="search">
  <div class="searchformwrapper">
    <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
  </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev_model.html">Development model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../app_dev.html">Application development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ecosystem_integration.html">Ecosystems integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nrf91.html">Working with nRF91 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nrf70.html">Working with nRF70 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nrf53.html">Working with nRF53 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nrf52.html">Working with nRF52 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../protocols.html">Protocols</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../applications.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../samples.html">Samples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../drivers.html">Drivers</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Libraries</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../bin/index.html">Binary libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bluetooth_services/index.html">Bluetooth libraries and services</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bootloader/index.html">Bootloader libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../caf/index.html">Common Application Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="../debug/index.html">Debug libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dfu/index.html">DFU libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gazell/index.html">Gazell libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modem/index.html">Modem libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mpsl/index.html">Multiprotocol Service Layer libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../networking/index.html">Libraries for networking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nfc/index.html">Libraries for NFC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nrf_rpc/index.html">nRF RPC libraries</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Other libraries</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="adp536x.html">adp536x</a></li>
<li class="toctree-l3"><a class="reference internal" href="app_event_manager.html">Application Event Manager</a></li>
<li class="toctree-l3"><a class="reference internal" href="app_event_manager_profiler_tracer.html">Application Event Manager profiler tracer</a></li>
<li class="toctree-l3"><a class="reference internal" href="contin_array.html">Continuous array</a></li>
<li class="toctree-l3"><a class="reference internal" href="data_fifo.html">Data FIFO</a></li>
<li class="toctree-l3"><a class="reference internal" href="date_time.html">Date-Time</a></li>
<li class="toctree-l3"><a class="reference internal" href="dk_buttons_and_leds.html">DK Buttons and LEDs</a></li>
<li class="toctree-l3"><a class="reference internal" href="dm.html">Distance Measurement</a></li>
<li class="toctree-l3"><a class="reference internal" href="ei_wrapper.html">Edge Impulse wrapper</a></li>
<li class="toctree-l3"><a class="reference internal" href="emds.html">Emergency data storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="esb.html">Enhanced ShockBurst</a></li>
<li class="toctree-l3"><a class="reference internal" href="event_manager_proxy.html">Event Manager Proxy</a></li>
<li class="toctree-l3"><a class="reference internal" href="fatal_error.html">Fatal error handler</a></li>
<li class="toctree-l3"><a class="reference internal" href="flash_map_pm.html">Partition Manager flash map</a></li>
<li class="toctree-l3"><a class="reference internal" href="flash_patch.html">Flash patch</a></li>
<li class="toctree-l3"><a class="reference internal" href="fprotect.html">Hardware flash write protection</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Firmware information</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#purpose">Purpose</a></li>
<li class="toctree-l4"><a class="reference internal" href="#information-structure">Information structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="#external-apis">External APIs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#binary-compatibility">Binary compatibility</a></li>
<li class="toctree-l4"><a class="reference internal" href="#usage">Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="#creating-ext-apis">Creating EXT_APIs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#creating-ext-api-requests">Creating EXT_API requests</a></li>
<li class="toctree-l4"><a class="reference internal" href="#api-documentation">API documentation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="hw_id.html">Hardware ID</a></li>
<li class="toctree-l3"><a class="reference internal" href="hw_unique_key.html">Hardware unique key</a></li>
<li class="toctree-l3"><a class="reference internal" href="identity_key.html">Identity key</a></li>
<li class="toctree-l3"><a class="reference internal" href="memfault_ncs.html">Memfault</a></li>
<li class="toctree-l3"><a class="reference internal" href="nrf_profiler.html">nRF Profiler</a></li>
<li class="toctree-l3"><a class="reference internal" href="pcm_mix.html">Pulse Code Modulation audio mixer</a></li>
<li class="toctree-l3"><a class="reference internal" href="pcm_stream_channel_modifier.html">PCM Stream Channel Modifier</a></li>
<li class="toctree-l3"><a class="reference internal" href="qos.html">Quality of Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="ram_pwrdn.html">RAM power-down</a></li>
<li class="toctree-l3"><a class="reference internal" href="sfloat.html">Short float (SFLOAT)</a></li>
<li class="toctree-l3"><a class="reference internal" href="st25r3911b_nfc.html">NFC Reader ST25R3911B</a></li>
<li class="toctree-l3"><a class="reference internal" href="supl_os_client.html">SUPL client and SUPL client OS integration</a></li>
<li class="toctree-l3"><a class="reference internal" href="tone.html">Tone generator</a></li>
<li class="toctree-l3"><a class="reference internal" href="wave_gen.html">Wave generator</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../shell/index.html">Shell libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tfm/index.html">TF-M libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../zigbee/index.html">Libraries for Zigbee</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../scripts.html">Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../known_issues.html">Known issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../software_maturity.html">Software maturity levels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation.html">About this documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">nRF Connect SDK</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Libraries</a></li>
          <li class="breadcrumb-item"><a href="index.html">Other libraries</a></li>
      <li class="breadcrumb-item active">Firmware information</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/libraries/others/fw_info.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="firmware-information">
<span id="doc-fw-info"></span><h1>Firmware information<a class="headerlink" href="#firmware-information" title="Permalink to this heading"></a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#purpose" id="id7">Purpose</a></p></li>
<li><p><a class="reference internal" href="#information-structure" id="id8">Information structure</a></p></li>
<li><p><a class="reference internal" href="#external-apis" id="id9">External APIs</a></p></li>
<li><p><a class="reference internal" href="#binary-compatibility" id="id10">Binary compatibility</a></p></li>
<li><p><a class="reference internal" href="#usage" id="id11">Usage</a></p></li>
<li><p><a class="reference internal" href="#creating-ext-apis" id="id12">Creating EXT_APIs</a></p></li>
<li><p><a class="reference internal" href="#creating-ext-api-requests" id="id13">Creating EXT_API requests</a></p></li>
<li><p><a class="reference internal" href="#api-documentation" id="id14">API documentation</a></p></li>
</ul>
</div>
<p>The firmware information module (<code class="docutils literal notranslate"><span class="pre">fw_info</span></code>) provides externally readable metadata about a firmware image.
This information is located at a specific offset in the image.
In addition, the module provides code to read such information.</p>
<section id="purpose">
<h2><a class="toc-backref" href="#id7">Purpose</a><a class="headerlink" href="#purpose" title="Permalink to this heading"></a></h2>
<p>The purpose of the firmware information is to allow other images such as bootloaders, or infrastructure such as firmware servers, to gain information about the firmware image.</p>
<p>The firmware information structure has a 12-byte magic header and a verified binary layout to ensure that the format is portable and identifiable.
It must be located at one of the following offsets from the start of the image: 0x0, 0x200, 0x400, 0x800, 0x1000.
The reason that the structure is not located at 0x00 is that this can be problematic in some use cases, such as when the vector table must be located at 0x00.</p>
<p>These rules make it simple to retrieve the information by checking for each possible offset (0x0, 0x200, 0x400, 0x800, 0x1000) if the first 12 bytes match the magic value.
If they do, the information can be retrieved according to the definition in <code class="xref c c-struct docutils literal notranslate"><span class="pre">fw_info</span></code>.</p>
</section>
<section id="information-structure">
<h2><a class="toc-backref" href="#id8">Information structure</a><a class="headerlink" href="#information-structure" title="Permalink to this heading"></a></h2>
<p>The information structure contains a minimal set of information that allows other code to reason about the firmware with no other information available.
It includes the following information:</p>
<ul class="simple">
<li><p>The size of the firmware image.</p></li>
<li><p>The single, monotonically increasing version number of the image.</p></li>
<li><p>The address through which to boot into the firmware (the vector table address).
This address is not necessarily the start of the image.</p></li>
<li><p>A value that can be modified in place to invalidate the firmware.
See <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_FW_INFO_VALID_VAL</span></code>.
If this option is set to any other value than <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_FW_INFO_VALID_VAL</span></code> (for example, by the bootloader), the image can quickly be established as invalid.
The bootloader sets this option to 0 when the image fails validation, so that there is no need to perform a costly validation on every boot.
If the firmware is write-protected before being booted by the bootloader, only the bootloader can invalidate it.</p></li>
</ul>
<p>At the end of the information structure, there is a variable-size list containing:</p>
<ul class="simple">
<li><p>External APIs</p></li>
<li><p>External API requests</p></li>
</ul>
</section>
<section id="external-apis">
<span id="doc-fw-info-ext-api"></span><h2><a class="toc-backref" href="#id9">External APIs</a><a class="headerlink" href="#external-apis" title="Permalink to this heading"></a></h2>
<p>The firmware information structure allows for exchange of arbitrary tagged and versioned interfaces called <em>external APIs</em> (EXT_APIs).</p>
<p>An EXT_API structure is a structure consisting of a header followed by arbitrary data.
The header consists of the following information:</p>
<ul class="simple">
<li><p>EXT_API ID (uniquely identifies the EXT_API)</p></li>
<li><p>EXT_API version (single, monotonically increasing version number for the EXT_API with this ID)</p></li>
<li><p>EXT_API flags (32 individual bits for indicating the particulars of the EXT_API)</p></li>
<li><p>EXT_API length (length of the following data)</p></li>
</ul>
<p>The EXT_API structures of the image are placed at the end of the information structure, immediately before its EXT_API requests.</p>
<p>An EXT_API request structure is a structure consisting of a description of the requested EXT_API (in the form of an EXT_API header), plus a few more pieces of data.
The structure also contains the location of a RAM buffer into which a pointer to a matching EXT_API can be placed before booting.
The RAM buffer must not be initialized or otherwise touched when booting the image, to ensure that the value written there before booting is preserved.
The <a class="reference internal" href="#c.EXT_API_REQ" title="EXT_API_REQ"><code class="xref c c-macro docutils literal notranslate"><span class="pre">EXT_API_REQ</span></code></a> helper macro uses the <code class="docutils literal notranslate"><span class="pre">__noinit</span></code> decorator provided by Zephyr to achieve this.</p>
<p>The EXT_API system allows a bootloader to parse the image’s requests and find matches for these requests by parsing its own (the bootloader’s) EXT_APIs or EXT_APIs of other images.
After finding the matches, the bootloader populates the RAM buffers with pointers to the other images’ EXT_APIs.
In this way, the bootloader will be aware of whether all images have access to their dependencies.</p>
<p>Each image can provide multiple EXT_APIs and make multiple requests.
It is also possible for images to search other images directly for matching EXT_APIs, without using EXT_API requests.</p>
<p>Typically, the data of an EXT_API structure contains a function pointer (or a list of function pointers), but it could consist of anything.
The data should be considered read-only though.</p>
</section>
<section id="binary-compatibility">
<h2><a class="toc-backref" href="#id10">Binary compatibility</a><a class="headerlink" href="#binary-compatibility" title="Permalink to this heading"></a></h2>
<p>When exposing an interface between images that have not been compiled and linked together, you must take extra care to ensure binary-compatibility between how the interface is implemented and how it is used.
The data placed into EXT_APIs must always have the same format for a given ID/version/flags combination.</p>
<p>To facilitate this, the <code class="file docutils literal notranslate"><span class="pre">fw_info.h</span></code> file contains a number of static asserts to ensure that the memory mapping of structures is the same every time the code is compiled.
There are a number of things that can change from compilation to compilation, depending on compiler options or just chance interactions with the rest of the code.</p>
<p>Some things to look out for are:</p>
<ul class="simple">
<li><p>Struct padding: The space between members of a struct can be different.</p></li>
<li><p>Flag ordering: When splitting an integer into smaller chunks (with <code class="docutils literal notranslate"><span class="pre">:</span></code>), like flags, the order in which they are mapped to memory can be different.</p></li>
<li><p>Function ABI: The way the function uses registers and stack can be different.</p></li>
<li><p>Size of certain types: The size of chars and enums can differ depending on compiler flags.</p></li>
<li><p>Floating point ABI: The way floating point numbers are processed can be different (hard/soft/softfp).</p></li>
</ul>
</section>
<section id="usage">
<h2><a class="toc-backref" href="#id11">Usage</a><a class="headerlink" href="#usage" title="Permalink to this heading"></a></h2>
<p>To locate and verify firmware information structures, use <code class="xref c c-func docutils literal notranslate"><span class="pre">fw_info_find()</span></code> and <code class="xref c c-func docutils literal notranslate"><span class="pre">fw_info_check()</span></code>, respectively.</p>
<p>To find an EXT_API with a given version and flags, call <code class="xref c c-func docutils literal notranslate"><span class="pre">fw_info_ext_api_find()</span></code>.
This function calls <code class="xref c c-member docutils literal notranslate"><span class="pre">ext_api_in</span></code> under the hood, checks the EXT_API’s version against the allowed range, and checks that it has all the flags set.</p>
<p>To populate an image’s <code class="xref c c-member docutils literal notranslate"><span class="pre">ext_api_in</span></code> (before booting the image), the booting image should call <a class="reference internal" href="#c.fw_info_ext_api_provide" title="fw_info_ext_api_provide"><code class="xref c c-func docutils literal notranslate"><span class="pre">fw_info_ext_api_provide()</span></code></a> with the other image’s firmware information structure.
Note that if the booting (current) firmware image and the booted image’s RAM overlap, <a class="reference internal" href="#c.fw_info_ext_api_provide" title="fw_info_ext_api_provide"><code class="xref c c-func docutils literal notranslate"><span class="pre">fw_info_ext_api_provide()</span></code></a> will corrupt the current firmware’s RAM.
This is ok if it is done immediately before booting the other image, thus after it has performed its last RAM access.</p>
</section>
<section id="creating-ext-apis">
<h2><a class="toc-backref" href="#id12">Creating EXT_APIs</a><a class="headerlink" href="#creating-ext-apis" title="Permalink to this heading"></a></h2>
<p>To create an EXT_API, complete the following steps:</p>
<ol class="arabic">
<li><p>Create Kconfig entries using <code class="file docutils literal notranslate"><span class="pre">Kconfig.template.fw_info_ext_api</span></code>:</p>
<div class="highlight-Kconfig notranslate"><div class="highlight"><pre><span></span>EXT_API<span class="w"> </span><span class="o">=</span><span class="w"> </span>MY
id<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>xBEEF
flags<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
ver<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="k">source</span><span class="w"> </span><span class="s2">&quot;${ZEPHYR_BASE}/../nrf/subsys/fw_info/Kconfig.template.fw_info_ext_api&quot;</span>
</pre></div>
</div>
</li>
<li><p>Declare a new struct type:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">my_ext_api_foo_t</span><span class="p">)(</span><span class="kt">bool</span><span class="w"> </span><span class="n">arg1</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">arg2</span><span class="p">);</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">my_ext_api</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="cm">/* Actual EXT_API/data goes here. */</span>
<span class="w">          </span><span class="n">my_ext_api_foo_t</span><span class="w"> </span><span class="n">my_foo</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
</li>
<li><p>Use the <a class="reference internal" href="#c.EXT_API" title="EXT_API"><code class="xref c c-macro docutils literal notranslate"><span class="pre">EXT_API</span></code></a> macro to initialize the EXT_API struct in an arbitrary location.
<a class="reference internal" href="#c.EXT_API" title="EXT_API"><code class="xref c c-macro docutils literal notranslate"><span class="pre">EXT_API</span></code></a> will automatically include the EXT_API in the list at the end of the firmware information structure.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#ifdef CONFIG_MY_EXT_API_ENABLED</span>
<span class="n">EXT_API</span><span class="p">(</span><span class="n">MY</span><span class="p">,</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">my_ext_api</span><span class="p">,</span><span class="w"> </span><span class="n">my_ext_api</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="cm">/* EXT_API initialization goes here. */</span>
<span class="w">          </span><span class="p">.</span><span class="n">my_foo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">my_foo_impl</span><span class="p">,</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">};</span>
<span class="cp">#endif</span>
</pre></div>
</div>
</li>
<li><p>Enable the EXT_API in Kconfig:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_MY_EXT_API_ENABLED=y
</pre></div>
</div>
</li>
</ol>
</section>
<section id="creating-ext-api-requests">
<h2><a class="toc-backref" href="#id13">Creating EXT_API requests</a><a class="headerlink" href="#creating-ext-api-requests" title="Permalink to this heading"></a></h2>
<p>To create an EXT_API request, complete the following steps:</p>
<ol class="arabic">
<li><p>Assuming that the ID and the Kconfig entries are already created (see <a class="reference internal" href="#creating-ext-apis">Creating EXT_APIs</a>), use the <a class="reference internal" href="#c.EXT_API_REQ" title="EXT_API_REQ"><code class="xref c c-macro docutils literal notranslate"><span class="pre">EXT_API_REQ</span></code></a> macro to create a request structure:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">EXT_API_REQ</span><span class="p">(</span><span class="n">MY</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">my_ext_api</span><span class="p">,</span><span class="w"> </span><span class="n">my</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>Use the EXT_API through the name given to <a class="reference internal" href="#c.EXT_API_REQ" title="EXT_API_REQ"><code class="xref c c-macro docutils literal notranslate"><span class="pre">EXT_API_REQ</span></code></a>:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">my</span><span class="o">-&gt;</span><span class="n">ext_api</span><span class="p">.</span><span class="n">my_foo</span><span class="p">(</span><span class="n">my_arg1</span><span class="p">,</span><span class="w"> </span><span class="n">my_arg2</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>Request the EXT_API in Kconfig:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_MY_EXT_API_REQUIRED=y
</pre></div>
</div>
</li>
</ol>
</section>
<section id="api-documentation">
<h2><a class="toc-backref" href="#id14">API documentation</a><a class="headerlink" href="#api-documentation" title="Permalink to this heading"></a></h2>
<div class="line-block">
<div class="line">Header file: <code class="file docutils literal notranslate"><span class="pre">include/fw_info.h</span></code></div>
<div class="line">Source files: <code class="file docutils literal notranslate"><span class="pre">subsys/fw_info/</span></code></div>
</div>
<dl>
<dt class="sig sig-object cpp">
<span class="target" id="group__fw__info"></span><em><span class="pre">group</span></em> <span class="sig-name descname"><span class="pre">fw_info</span></span></dt>
<dd><div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-defines">Defines</p>
<dl class="c macro">
<dt class="sig sig-object c" id="c.EXT_API">
<span class="target" id="group__fw__info_1ga0149018d3260448bc647c9a3fe55bb84"></span><span class="sig-name descname"><span class="n"><span class="pre">EXT_API</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">ext_api_name</span></span>, <span class="n"><span class="pre">type</span></span>, <span class="n"><span class="pre">name</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.EXT_API" title="Permalink to this definition"></a><br /></dt>
<dd></dd></dl>

<dl class="c macro">
<dt class="sig sig-object c" id="c.EXT_API_REQ">
<span class="target" id="group__fw__info_1gae8a7197716c16b537d6fb822649a4da8"></span><span class="sig-name descname"><span class="n"><span class="pre">EXT_API_REQ</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">name</span></span>, <span class="n"><span class="pre">req</span></span>, <span class="n"><span class="pre">type</span></span>, <span class="n"><span class="pre">var_name</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.EXT_API_REQ" title="Permalink to this definition"></a><br /></dt>
<dd></dd></dl>

<dl class="c macro">
<dt class="sig sig-object c" id="c.FW_INFO_VECTOR_OFFSET">
<span class="target" id="group__fw__info_1ga560b86f362bb7de199d1b64ec0740b8c"></span><span class="sig-name descname"><span class="n"><span class="pre">FW_INFO_VECTOR_OFFSET</span></span></span><a class="headerlink" href="#c.FW_INFO_VECTOR_OFFSET" title="Permalink to this definition"></a><br /></dt>
<dd></dd></dl>

</div>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-functions">Functions</p>
<dl class="c function">
<dt class="sig sig-object c" id="c.fw_info_ext_api_provide">
<span class="target" id="group__fw__info_1ga21f6b55232bf46b901a0f7c99035ccd4"></span><span class="kt"><span class="pre">bool</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">fw_info_ext_api_provide</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">fw_info</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">fwinfo</span></span>, <span class="kt"><span class="pre">bool</span></span><span class="w"> </span><span class="n"><span class="pre">provide</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.fw_info_ext_api_provide" title="Permalink to this definition"></a><br /></dt>
<dd><p>Expose EXT_APIs to another firmware</p>
<p>Populate the other firmware’s <code class="docutils literal notranslate"><span class="pre">ext_api_in</span></code> with EXT_APIs from other images.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This should be called immediately before booting the other firmware since it will likely corrupt the memory of the running firmware.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fwinfo</strong> – <strong>[in]</strong> Pointer to the other firmware’s information structure. </p></li>
<li><p><strong>provide</strong> – <strong>[in]</strong> If true, populate ext_api_in. If false, only check whether requirements can be satisfied.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Whether requirements could be satisfied. </p>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.fw_info_invalidate">
<span class="target" id="group__fw__info_1ga8e6f107ad53cf5b9aefb60e66edfab3b"></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">fw_info_invalidate</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.fw_info_invalidate" title="fw_info"><span class="n"><span class="pre">fw_info</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">fw_info</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.fw_info_invalidate" title="Permalink to this definition"></a><br /></dt>
<dd><p>Invalidate an image by manipulating its fw_info.</p>
<p>Invalidation happens by setting the <code class="docutils literal notranslate"><span class="pre">valid</span></code> value to INVALID_VAL.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This function needs to have<span> <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_NRFX_NVMC</span></code> </span> enabled.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fw_info</strong> – The info structure to invalidate. This memory will be modified directly in flash. </p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>
</dd></dl>

</section>
</section>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="hw_id.html" class="btn btn-neutral float-right" title="Hardware ID" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="fprotect.html" class="btn btn-neutral" title="Hardware flash write protection" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">

<table>
<tr>
<td>
    <p>
        &copy; Copyright 2019-2023, Nordic Semiconductor.
      Last updated on Mar 20, 2023.

    </p>
</td>
<td id="nordiclogo">
  <a href="https://www.nordicsemi.com/"><img src="../../_static/images/nordic-logo.png" border="0"/></a>
</td>
</tr>
</table>
  </div> 


</footer>

<div id="scroll-container">
  <button type="button" id="scroll-btn" class="btn">
    <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="#fff"/></svg>
  </button>
</div>

<script>
  const scrollBtn = document.querySelector("#scroll-btn");

  document.addEventListener("scroll", () => {
    if (window.scrollY > 400) {
          scrollBtn.style.visibility = "visible";
      } else {
          scrollBtn.style.visibility = "hidden";
      }
  });

  scrollBtn.addEventListener("click", () => {
      window.scrollTo({ top: 0, behavior: "smooth" });
  });
</script>
        </div>
      </div>
    </section>
  </div>
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> nRF Connect SDK</span>
       <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      
      <div class="rst-other-version ncs">
        <a href="../../../nrf/index.html">nRF Connect SDK</a>
      </div>
      
      <div class="rst-other-version nrfx">
        <a href="../../../nrfx/index.html">nrfx</a>
      </div>
      
      <div class="rst-other-version nrfxlib">
        <a href="../../../nrfxlib/README.html">nrfxlib</a>
      </div>
      
      <div class="rst-other-version zephyr">
        <a href="../../../zephyr/index.html">Zephyr Project</a>
      </div>
      
      <div class="rst-other-version mcuboot">
        <a href="../../../mcuboot/wrapper.html">MCUboot</a>
      </div>
      
      <div class="rst-other-version tfm">
        <a href="../../../tfm/index.html">Trusted Firmware-M</a>
      </div>
      
      <div class="rst-other-version matter">
        <a href="../../../matter/index.html">Matter</a>
      </div>
      
      <div class="rst-other-version kconfig">
        <a href="../../../kconfig/index.html">Kconfig Reference</a>
      </div>
    </div>
  </div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>