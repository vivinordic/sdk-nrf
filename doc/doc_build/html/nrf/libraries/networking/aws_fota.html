<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AWS FOTA &mdash; nRF Connect SDK 2.3.99 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/nordic.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/togglebutton.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/nrf.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/tabs.css" type="text/css" /> 
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="https://www.googletagmanager.com/gtag/js?id=G-ZPVZRKFQJR"></script>
        <script src="../../_static/js/ga-tracker.js"></script>
        <script data-culture="EN" id="CookieConsent" type="text/javascript" src="https://policy.app.cookieinformation.com/uc.js"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../_static/togglebutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/js/theme.js"></script>
<script
  type="text/javascript"
  src="../../_static/js/ncs.js"
></script>
<script src="../../_static/js/bootstrap.bundle.min.js"></script>

    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="AWS IoT" href="aws_iot.html" />
    <link rel="prev" title="Libraries for networking" href="index.html" />
<link
  href="../../_static/css/bootstrap.min.css"
  rel="stylesheet"
/>
<link
  rel="shortcut icon"
  href="../../_static/images/favicon.ico"
/>

</head>

<body class="wy-body-for-nav">
<div class="announcement"></div>
<div class="d-print-none ncs-header">
  <div class="container-xl ncs-header-top">
    <div class="row h-100">
      <div class="d-none d-md-block col-2">
        <div class="bg-white py-4 px-3 ml-2 ncs-header-logo">
          <img
            class="ncs-header-logo"
            src="../../_static/images/nordic-logo.png"
            alt=""
          />
        </div>
      </div>
      <div
        class="col-8 col-md-7 pl-md-4 d-flex align-self-center justify-content-center"
      >
        <form class="w-75" action="../../search.html" method="get">
          <div class="form-group">
            <input
              type="text"
              name="q"
              class="ncs-search-input form-control"
              placeholder="Search all docs..."
            />
          </div>
        </form>
      </div>
      <div class="col-4 col-md-3 d-md-block p-3 text-end">
        <div class="dropdown">
          <button
            class="btn dropdown-toggle ncs-btn-versions"
            type="button"
            id="dropdownMenuButton1"
            data-bs-toggle="dropdown"
            aria-expanded="false"
          >
            <span class="d-none d-md-inline">nRF Connect SDK</span>
            <span id="ncsversion" class="d-inline"></span>
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton"></div>
        </div>
      </div>
    </div>
  </div>
  <div class="ncs-header-nav">
    <div class="container-xl">
      <div class="row">
        <div class="col col-12 d-flex justify-content-center">
          <nav class="navbar navbar-dark navbar-expand-lg p-0">
            <span class="navbar-brand d-block d-lg-none py-2 pl-1"
              >Documentation sets</span
            >
            <button
              class="navbar-toggler"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#navbarNavAltMarkup"
              aria-controls="navbarNavAltMarkup"
              aria-expanded="false"
              aria-label="Toggle navigation"
            >
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
              <ul class="navbar-nav">
                <li class="nav-item active py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../nrf/index.html"
                    >nRF Connect SDK</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../nrfx/index.html"
                    >nrfx</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../nrfxlib/README.html"
                    >nrfxlib</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../zephyr/index.html"
                    >Zephyr Project</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../mcuboot/wrapper.html"
                    >MCUboot</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../tfm/index.html"
                    >Trusted Firmware-M</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../matter/index.html"
                    >Matter</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../kconfig/index.html"
                    >Kconfig Reference</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
              </ul>
            </div>
          </nav>
        </div>
      </div>
    </div>
  </div>
</div>

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> nRF Connect SDK
          </a>
              <div class="version">
                2.3.99
              </div>
<div id="searchbox" role="search">
  <div class="searchformwrapper">
    <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
  </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev_model.html">Development model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../app_dev.html">Application development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ecosystem_integration.html">Ecosystems integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nrf91.html">Working with nRF91 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nrf70.html">Working with nRF70 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nrf53.html">Working with nRF53 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nrf52.html">Working with nRF52 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../protocols.html">Protocols</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../applications.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../samples.html">Samples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../drivers.html">Drivers</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Libraries</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../bin/index.html">Binary libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bluetooth_services/index.html">Bluetooth libraries and services</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bootloader/index.html">Bootloader libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../caf/index.html">Common Application Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="../debug/index.html">Debug libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dfu/index.html">DFU libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gazell/index.html">Gazell libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modem/index.html">Modem libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mpsl/index.html">Multiprotocol Service Layer libraries</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Libraries for networking</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">AWS FOTA</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#requirements">Requirements</a></li>
<li class="toctree-l4"><a class="reference internal" href="#creating-a-fota-job">Creating a FOTA job</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#implementation">Implementation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#limitations">Limitations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#api-documentation">API documentation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="aws_iot.html">AWS IoT</a></li>
<li class="toctree-l3"><a class="reference internal" href="aws_jobs.html">AWS jobs</a></li>
<li class="toctree-l3"><a class="reference internal" href="azure_fota.html">Azure FOTA</a></li>
<li class="toctree-l3"><a class="reference internal" href="azure_iot_hub.html">Azure IoT Hub</a></li>
<li class="toctree-l3"><a class="reference internal" href="coap_utils.html">CoAP utils</a></li>
<li class="toctree-l3"><a class="reference internal" href="download_client.html">Download client</a></li>
<li class="toctree-l3"><a class="reference internal" href="fota_download.html">FOTA download</a></li>
<li class="toctree-l3"><a class="reference internal" href="ftp_client.html">FTP client</a></li>
<li class="toctree-l3"><a class="reference internal" href="icalendar_parser.html">iCalendar parser</a></li>
<li class="toctree-l3"><a class="reference internal" href="lwm2m_client_utils.html">LwM2M client utils</a></li>
<li class="toctree-l3"><a class="reference internal" href="lwm2m_location_assistance.html">LwM2M location assistance</a></li>
<li class="toctree-l3"><a class="reference internal" href="mqtt_helper.html">MQTT helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="multicell_location.html">Multicell location</a></li>
<li class="toctree-l3"><a class="reference internal" href="nrf_cloud.html">nRF Cloud</a></li>
<li class="toctree-l3"><a class="reference internal" href="nrf_cloud_agps.html">nRF Cloud A-GPS</a></li>
<li class="toctree-l3"><a class="reference internal" href="nrf_cloud_alerts.html">nRF Cloud Alerts</a></li>
<li class="toctree-l3"><a class="reference internal" href="nrf_cloud_location.html">nRF Cloud location</a></li>
<li class="toctree-l3"><a class="reference internal" href="nrf_cloud_pgps.html">nRF Cloud P-GPS</a></li>
<li class="toctree-l3"><a class="reference internal" href="nrf_cloud_rest.html">nRF Cloud REST</a></li>
<li class="toctree-l3"><a class="reference internal" href="rest_client.html">REST client</a></li>
<li class="toctree-l3"><a class="reference internal" href="wifi_credentials.html">Wi-Fi credentials</a></li>
<li class="toctree-l3"><a class="reference internal" href="wifi_mgmt_ext.html">Wi-Fi management extension</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../nfc/index.html">Libraries for NFC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nrf_rpc/index.html">nRF RPC libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../others/index.html">Other libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shell/index.html">Shell libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tfm/index.html">TF-M libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../zigbee/index.html">Libraries for Zigbee</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../scripts.html">Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../known_issues.html">Known issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../software_maturity.html">Software maturity levels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation.html">About this documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">nRF Connect SDK</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Libraries</a></li>
          <li class="breadcrumb-item"><a href="index.html">Libraries for networking</a></li>
      <li class="breadcrumb-item active">AWS FOTA</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/libraries/networking/aws_fota.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="aws-fota">
<span id="lib-aws-fota"></span><h1>AWS FOTA<a class="headerlink" href="#aws-fota" title="Permalink to this heading"></a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#requirements" id="id9">Requirements</a></p></li>
<li><p><a class="reference internal" href="#creating-a-fota-job" id="id10">Creating a FOTA job</a></p>
<ul>
<li><p><a class="reference internal" href="#troubleshooting" id="id11">Troubleshooting</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#configuration" id="id12">Configuration</a></p></li>
<li><p><a class="reference internal" href="#implementation" id="id13">Implementation</a></p>
<ul>
<li><p><a class="reference internal" href="#aws-iot-jobs" id="id14">AWS IoT jobs</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#limitations" id="id15">Limitations</a></p></li>
<li><p><a class="reference internal" href="#api-documentation" id="id16">API documentation</a></p></li>
</ul>
</div>
<p>The Amazon Web Services firmware over-the-air (AWS FOTA) library combines the <a class="reference internal" href="aws_jobs.html#lib-aws-jobs"><span class="std std-ref">AWS jobs</span></a> and <a class="reference internal" href="fota_download.html#lib-fota-download"><span class="std std-ref">FOTA download</span></a> libraries into a library that can perform an over-the-air firmware update using HTTP and MQTT TLS.</p>
<p>It connects to the specified broker using the existing or given certificates and uses <a class="reference external" href="https://www.ietf.org/rfc/rfc5246.txt">TLS</a> for the MQTT connection.
This means that the data sent in each MQTT message is encrypted.</p>
<p>When an update is available, the library receives a notification that contains metadata about the update.
This metadata contains the location of the uploaded firmware image.
The library then uses HTTP to download the firmware image, replacing the current firmware with the downloaded firmware.
After the new firmware image is downloaded, the application must perform a reboot to run the new image and complete the FOTA process.
The library supports the updating of delta images for both the application and modem firmware.</p>
<p>See <a class="reference internal" href="#aws-fota-implementation"><span class="std std-ref">AWS FOTA implementation</span></a> for information about the download procedure, and <a class="reference external" href="https://docs.aws.amazon.com/iot/latest/developerguide/what-is-aws-iot.html">AWS IoT Developer Guide</a> for general information about the Amazon Web Services IoT service.</p>
<section id="requirements">
<h2><a class="toc-backref" href="#id9">Requirements</a><a class="headerlink" href="#requirements" title="Permalink to this heading"></a></h2>
<p>The library requires an <a class="reference external" href="https://aws.amazon.com/iot/">AWS account</a> with access to Simple Storage Service (S3) and the IoT Core service.</p>
</section>
<section id="creating-a-fota-job">
<h2><a class="toc-backref" href="#id10">Creating a FOTA job</a><a class="headerlink" href="#creating-a-fota-job" title="Permalink to this heading"></a></h2>
<ol class="arabic">
<li><p>Go to <a class="reference external" href="https://console.aws.amazon.com/s3/home">AWS S3 console</a> and sign in.</p></li>
<li><p>Click <span class="guilabel">Create bucket</span> and select a name.</p></li>
<li><p>Uncheck <span class="guilabel">Block all public access</span> under the <em>Block Public Access settings for this bucket</em> label.</p></li>
<li><p>Scroll down and click <span class="guilabel">Create bucket</span>.</p></li>
<li><p>Click the newly created bucket, select <span class="guilabel">Permissions</span> and insert the following permissive policy under <em>Bucket Policy</em>:</p>
<pre class="highlight literal-block">{    &quot;Version&quot;: &quot;2012-10-17&quot;,
     &quot;Statement&quot;: [
         {
             &quot;Effect&quot;: &quot;Allow&quot;,
             &quot;Principal&quot;: &quot;*&quot;,
             &quot;Action&quot;: &quot;s3:GetObject&quot;,
             &quot;Resource&quot;: &quot;arn:aws:s3:::<em>bucket_name</em>/*&quot;
         }
      ]
}</pre>
<p>Replace the <em>bucket_name</em> with the name of your bucket.</p>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The policy example is only intended for development environments.
AWS Best Practices recommends that the <strong>principal</strong> is specified in the Bucket Policy to prevent anonymous users access to S3.
For more information, refer to the example policies listed in <a class="reference external" href="https://docs.aws.amazon.com/iot/latest/developerguide/example-iot-policies.html">AWS IoT Core policy examples</a> and <a class="reference external" href="https://docs.aws.amazon.com/iot/latest/developerguide/security-best-practices.html">Security best practices in AWS IoT Core</a>.</p>
</div>
<ol class="arabic">
<li><p>Click <span class="guilabel">Objects</span> to go back to the bucket.</p></li>
<li><p>Click <span class="guilabel">Upload</span> and <span class="guilabel">Add files</span>.</p></li>
<li><p>Select the file <code class="file docutils literal notranslate"><span class="pre">app_update.bin</span></code> (located in the <code class="file docutils literal notranslate"><span class="pre">zephyr</span></code> subfolder of your build directory).</p>
<p>If you want to update the modem firmware, extract the content of a downloaded modem firmware zip and select the desired delta update, for example <code class="file docutils literal notranslate"><span class="pre">mfw_nrf9160_update_from_1.3.1_to_1.3.2</span></code>.
The various modem firmware versions can be found in <a class="reference external" href="https://www.nordicsemi.com/Products/Development-hardware/nRF9160-DK/Download#infotabs">nRF9160 DK Downloads</a>.</p>
</li>
<li><p>Click <span class="guilabel">Upload</span> and then <span class="guilabel">Close</span>.</p></li>
<li><p>Click the uploaded image file <code class="file docutils literal notranslate"><span class="pre">app_update.bin</span></code> and copy the <em>Object URL</em> without the <em>https://</em> prefix and folder path.</p></li>
<li><p>Create a text file (job document) with content as in the snippet, replacing the following data:</p>
<blockquote>
<div><ul class="simple">
<li><p><em>host_url</em> with the <em>Object URL</em> copied in the previous step (for example, <code class="docutils literal notranslate"><span class="pre">examplebucket.s3.eu-central-1.amazonaws.com</span></code>).</p></li>
<li><p><em>file_path</em> with the path and file name (for example, <code class="docutils literal notranslate"><span class="pre">app_update.bin</span></code>).</p></li>
</ul>
</div></blockquote>
<pre class="highlight literal-block">{
  &quot;operation&quot;: &quot;app_fw_update&quot;,
  &quot;fwversion&quot;: &quot;v1.0.2&quot;,
  &quot;size&quot;: 181124,
  &quot;location&quot;: {
    &quot;protocol&quot;: &quot;http:&quot;,
    &quot;host&quot;: &quot;<em>host_url</em>&quot;,
    &quot;path&quot;: &quot;<em>file_path</em>&quot;
   }
}</pre>
<p>See <a class="reference external" href="https://docs.aws.amazon.com/iot/latest/developerguide/iot-jobs.html">AWS IoT Developer Guide: Jobs</a> for more information about AWS jobs.</p>
</li>
<li><p>In the <a class="reference external" href="https://console.aws.amazon.com/s3/home">AWS S3 console</a> Select the bucket, click <span class="guilabel">Upload</span>, and upload your job document.
You must now have two files in your bucket, the uploaded image and the job document.</p></li>
<li><p>Log in to the <a class="reference external" href="https://console.aws.amazon.com/iot/home">AWS IoT console</a>.</p></li>
<li><p>Go to <span class="guilabel">Manage</span> -&gt; <span class="guilabel">Remote actions</span>-&gt; <span class="guilabel">Jobs</span>, and select <span class="guilabel">Create job</span>.</p></li>
<li><p>Click <span class="guilabel">Create custom job</span>, enter a unique job name and select your <em>Thing</em>.</p></li>
<li><p>Click <span class="guilabel">Browse S3</span> and locate the job document.</p></li>
<li><p>Click <span class="guilabel">Next</span>.</p></li>
<li><p>Select <span class="guilabel">Snapshot</span> under <em>Job run type</em></p></li>
<li><p>Click the <span class="guilabel">Submit</span> button.</p></li>
</ol>
<p>After the job has been submitted, the device picks up the job automatically.
This can take several minutes.
In the <a class="reference external" href="https://console.aws.amazon.com/s3/home">AWS S3 console</a> you can check the status of the job to confirm that it is in progress.</p>
<section id="troubleshooting">
<h3><a class="toc-backref" href="#id11">Troubleshooting</a><a class="headerlink" href="#troubleshooting" title="Permalink to this heading"></a></h3>
<dl class="simple">
<dt>ERROR: -NRF_ECONNREFUSED:</dt><dd><p>Error -NRF_ECONNREFUSED (“Connection refused”) indicates an error with the configured certificates.</p>
</dd>
<dt>ERROR: -NRF_EHOSTUNREACH:</dt><dd><p>Error -NRF_EHOSTUNREACH (“Host is unreachable”) indicates that the download URL provided in the job document is wrong.</p>
</dd>
<dt>Content range is not defined:</dt><dd><p>If you host the firmware image on a different server than in an S3 bucket, this error indicates that the Content-Range field is missing in the HTTP GET header.
To fix this problem, configure the host server to provide this field.
Also, confirm that your file is available from the browser without being logged into your AWS account.</p>
</dd>
</dl>
</section>
</section>
<section id="configuration">
<h2><a class="toc-backref" href="#id12">Configuration</a><a class="headerlink" href="#configuration" title="Permalink to this heading"></a></h2>
<p>Configure the following parameters when using this library:</p>
<ul class="simple">
<li><p><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_AWS_FOTA_PAYLOAD_SIZE</span></code></p></li>
<li><p><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_AWS_FOTA_HOSTNAME_MAX_LEN</span></code></p></li>
<li><p><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_AWS_FOTA_FILE_PATH_MAX_LEN</span></code></p></li>
</ul>
</section>
<section id="implementation">
<span id="aws-fota-implementation"></span><h2><a class="toc-backref" href="#id13">Implementation</a><a class="headerlink" href="#implementation" title="Permalink to this heading"></a></h2>
<p>The following sequence diagram shows how a firmware over-the-air update is implemented through the use of <a class="reference external" href="https://docs.aws.amazon.com/iot/latest/developerguide/mqtt.html">AWS IoT MQTT</a>, <a class="reference external" href="https://docs.aws.amazon.com/iot/latest/developerguide/iot-jobs.html">AWS IoT jobs</a>, and <a class="reference external" href="https://docs.aws.amazon.com/s3/index.html">AWS Simple Storage Service (S3)</a>.</p>
<figure class="align-default" id="id8">
<img alt="AWS FOTA sequence diagram for doing FOTA through AWS jobs" src="../../_images/aws_fota_dfu_sequence.svg" /><figcaption>
<p><span class="caption-text">AWS Firmware Over-the-Air</span><a class="headerlink" href="#id8" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Other devices that are connected to the same AWS MQTT broker receive the same messages if the following conditions are met:</p>
<ul class="simple">
<li><p>The other device has valid (but different) certificates that use the same AWS IoT policy as the original device.</p></li>
<li><p>The other device is subscribed to the same MQTT topic as the original device.</p></li>
</ul>
</div>
<section id="aws-iot-jobs">
<h3><a class="toc-backref" href="#id14">AWS IoT jobs</a><a class="headerlink" href="#aws-iot-jobs" title="Permalink to this heading"></a></h3>
<p>The implementation uses a job document like the following (where <em>bucket_name</em> is the name of your bucket and <em>file_name</em> is the name of your file) for passing information from <a class="reference external" href="https://docs.aws.amazon.com/iot/latest/developerguide/iot-jobs.html">AWS IoT jobs</a> to the device:</p>
<pre class="highlight literal-block">{
  &quot;operation&quot;: &quot;app_fw_update&quot;,
  &quot;fwversion&quot;: &quot;v1.0.2&quot;,
  &quot;size&quot;: 181124,
  &quot;location&quot;: {
    &quot;protocol&quot;: &quot;http:&quot;,
    &quot;host&quot;: &quot;<em>bucket_name</em>.amazonaws.com&quot;,
    &quot;path&quot;: &quot;<em>file_name</em>.bin&quot;
   }
}</pre>
<p>The current implementation uses information from the <code class="docutils literal notranslate"><span class="pre">host</span></code> and <code class="docutils literal notranslate"><span class="pre">path</span></code> fields only.</p>
</section>
</section>
<section id="limitations">
<h2><a class="toc-backref" href="#id15">Limitations</a><a class="headerlink" href="#limitations" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p>Currently, the library uses HTTP for downloading the firmware.
To use HTTPS instead, apply the changes described in <a class="reference internal" href="download_client.html#download-client-https"><span class="std std-ref">the HTTPS section of the download client documentation</span></a> to the <a class="reference internal" href="fota_download.html#lib-fota-download"><span class="std std-ref">FOTA download</span></a> library.</p></li>
<li><p>The library requires a Content-Range header to be present in the HTTP response from the server.
This limitation is inherited from the <a class="reference internal" href="download_client.html#lib-download-client"><span class="std std-ref">Download client</span></a> library.</p></li>
</ul>
</section>
<section id="api-documentation">
<h2><a class="toc-backref" href="#id16">API documentation</a><a class="headerlink" href="#api-documentation" title="Permalink to this heading"></a></h2>
<div class="line-block">
<div class="line">Header file: <code class="file docutils literal notranslate"><span class="pre">include/net/aws_fota.h</span></code></div>
<div class="line">Source files: <code class="file docutils literal notranslate"><span class="pre">subsys/net/lib/aws_fota/</span></code></div>
</div>
<dl>
<dt class="sig sig-object cpp">
<span class="target" id="group__aws__fota"></span><em><span class="pre">group</span></em> <span class="sig-name descname"><span class="pre">aws_fota</span></span></dt>
<dd><p>Library for performing FOTA with MQTT and HTTP. </p>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-defines">Defines</p>
<dl class="c macro">
<dt class="sig sig-object c" id="c.AWS_FOTA_EVT_DL_COMPLETE_VAL">
<span class="target" id="group__aws__fota_1ga6f52a7a6f1a1ef80325c53df9c70cd2e"></span><span class="sig-name descname"><span class="n"><span class="pre">AWS_FOTA_EVT_DL_COMPLETE_VAL</span></span></span><a class="headerlink" href="#c.AWS_FOTA_EVT_DL_COMPLETE_VAL" title="Permalink to this definition"></a><br /></dt>
<dd></dd></dl>

</div>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-typedefs">Typedefs</p>
<dl class="c type">
<dt class="sig sig-object c" id="c.aws_fota_callback_t">
<span class="target" id="group__aws__fota_1ga0d9062c79a48da7eeaada60ad2fecfe6"></span><span class="k"><span class="pre">typedef</span></span><span class="w"> </span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">(</span></span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">aws_fota_callback_t</span></span></span><span class="p"><span class="pre">)</span></span><span class="p"><span class="pre">(</span></span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.aws_fota_event" title="aws_fota_event"><span class="n"><span class="pre">aws_fota_event</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">fota_evt</span></span><span class="p"><span class="pre">)</span></span><a class="headerlink" href="#c.aws_fota_callback_t" title="Permalink to this definition"></a><br /></dt>
<dd></dd></dl>

</div>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-enums">Enums</p>
<dl class="c enum">
<dt class="sig sig-object c" id="c.aws_fota_evt_id">
<span class="target" id="group__aws__fota_1ga4bb9f4422a0afdde491fbff5192268f2"></span><span class="k"><span class="pre">enum</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">aws_fota_evt_id</span></span></span><a class="headerlink" href="#c.aws_fota_evt_id" title="Permalink to this definition"></a><br /></dt>
<dd><p><em>Values:</em></p>
<dl class="c enumerator">
<dt class="sig sig-object c" id="c.aws_fota_evt_id.AWS_FOTA_EVT_START">
<span class="target" id="group__aws__fota_1gga4bb9f4422a0afdde491fbff5192268f2a1c51e5d693324bb64806be46fc1ee78d"></span><span class="k"><span class="pre">enumerator</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">AWS_FOTA_EVT_START</span></span></span><a class="headerlink" href="#c.aws_fota_evt_id.AWS_FOTA_EVT_START" title="Permalink to this definition"></a><br /></dt>
<dd><p>AWS FOTA has started </p>
</dd></dl>

<dl class="c enumerator">
<dt class="sig sig-object c" id="c.aws_fota_evt_id.AWS_FOTA_EVT_DONE">
<span class="target" id="group__aws__fota_1gga4bb9f4422a0afdde491fbff5192268f2a77b7621f99dea675ec3c6075f394aa1e"></span><span class="k"><span class="pre">enumerator</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">AWS_FOTA_EVT_DONE</span></span></span><a class="headerlink" href="#c.aws_fota_evt_id.AWS_FOTA_EVT_DONE" title="Permalink to this definition"></a><br /></dt>
<dd><p>AWS FOTA complete and status reported to job document </p>
</dd></dl>

<dl class="c enumerator">
<dt class="sig sig-object c" id="c.aws_fota_evt_id.AWS_FOTA_EVT_ERROR">
<span class="target" id="group__aws__fota_1gga4bb9f4422a0afdde491fbff5192268f2a9b60a771ee0cb0c60daccd0d22f0e711"></span><span class="k"><span class="pre">enumerator</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">AWS_FOTA_EVT_ERROR</span></span></span><a class="headerlink" href="#c.aws_fota_evt_id.AWS_FOTA_EVT_ERROR" title="Permalink to this definition"></a><br /></dt>
<dd><p>AWS FOTA error </p>
</dd></dl>

<dl class="c enumerator">
<dt class="sig sig-object c" id="c.aws_fota_evt_id.AWS_FOTA_EVT_ERASE_PENDING">
<span class="target" id="group__aws__fota_1gga4bb9f4422a0afdde491fbff5192268f2a74c4ff6e691bae197bfccc0cb0755b2a"></span><span class="k"><span class="pre">enumerator</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">AWS_FOTA_EVT_ERASE_PENDING</span></span></span><a class="headerlink" href="#c.aws_fota_evt_id.AWS_FOTA_EVT_ERASE_PENDING" title="Permalink to this definition"></a><br /></dt>
<dd><p>AWS FOTA Erase pending </p>
</dd></dl>

<dl class="c enumerator">
<dt class="sig sig-object c" id="c.aws_fota_evt_id.AWS_FOTA_EVT_ERASE_DONE">
<span class="target" id="group__aws__fota_1gga4bb9f4422a0afdde491fbff5192268f2a26d49a1561516d2ea4e4948bcff3837c"></span><span class="k"><span class="pre">enumerator</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">AWS_FOTA_EVT_ERASE_DONE</span></span></span><a class="headerlink" href="#c.aws_fota_evt_id.AWS_FOTA_EVT_ERASE_DONE" title="Permalink to this definition"></a><br /></dt>
<dd><p>AWS FOTA Erase done </p>
</dd></dl>

<dl class="c enumerator">
<dt class="sig sig-object c" id="c.aws_fota_evt_id.AWS_FOTA_EVT_DL_PROGRESS">
<span class="target" id="group__aws__fota_1gga4bb9f4422a0afdde491fbff5192268f2abe2b358f3ae77a3cf44320260823f55a"></span><span class="k"><span class="pre">enumerator</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">AWS_FOTA_EVT_DL_PROGRESS</span></span></span><a class="headerlink" href="#c.aws_fota_evt_id.AWS_FOTA_EVT_DL_PROGRESS" title="Permalink to this definition"></a><br /></dt>
<dd><p>AWS FOTA download progress </p>
</dd></dl>

</dd></dl>

</div>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-functions">Functions</p>
<dl class="c function">
<dt class="sig sig-object c" id="c.aws_fota_init">
<span class="target" id="group__aws__fota_1ga1a5c24999628fb00e893f934ef1d3ed5"></span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">aws_fota_init</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">mqtt_client</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">client</span></span>, <a class="reference internal" href="#c.aws_fota_callback_t" title="aws_fota_callback_t"><span class="n"><span class="pre">aws_fota_callback_t</span></span></a><span class="w"> </span><span class="n"><span class="pre">evt_handler</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.aws_fota_init" title="Permalink to this definition"></a><br /></dt>
<dd><p>Initialize the AWS Firmware Over the Air library. </p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>client</strong> – Pointer to an initialized MQTT instance. </p></li>
<li><p><strong>evt_handler</strong> – Callback function for events emitted by the aws_fota library.</p></li>
</ul>
</dd>
<dt class="field-even">Return values</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>0</strong> – If successfully initialized. </p></li>
<li><p><strong>-EINVAL</strong> – If any of the input values are invalid. </p></li>
</ul>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>Negative value on error. </p>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.aws_fota_mqtt_evt_handler">
<span class="target" id="group__aws__fota_1ga269f36510e8058c5630cce854498ec16"></span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">aws_fota_mqtt_evt_handler</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">mqtt_client</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">client</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">mqtt_evt</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">evt</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.aws_fota_mqtt_evt_handler" title="Permalink to this definition"></a><br /></dt>
<dd><p>AWS Firmware over the air mqtt event handler. </p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>client</strong> – Pointer to the mqtt_client instance. </p></li>
<li><p><strong>evt</strong> – Pointer to the received mqtt_evt.</p></li>
</ul>
</dd>
<dt class="field-even">Return values</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>0</strong> – If successful and the application can skip handling this event. </p></li>
<li><p><strong>1</strong> – If successful but wants the application to handle the event. </p></li>
</ul>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>A negative value on error. </p>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.aws_fota_get_job_id">
<span class="target" id="group__aws__fota_1ga0eef68dff4dddaf56c42caaa55904bb8"></span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">aws_fota_get_job_id</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">job_id_buf</span></span>, <span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="n"><span class="pre">buf_size</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.aws_fota_get_job_id" title="Permalink to this definition"></a><br /></dt>
<dd><p>Get the null-terminated job id string. </p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>job_id_buf</strong> – Buffer to which the job id will be copied. </p></li>
<li><p><strong>buf_size</strong> – Size of the buffer.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Length of the job id string (not counting the terminating null character) or a negative value on error. </p>
</dd>
</dl>
</dd></dl>

</div>
<dl class="c struct">
<dt class="sig sig-object c" id="c.aws_fota_event_dl">
<span class="target" id="structaws__fota__event__dl"></span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">aws_fota_event_dl</span></span></span><a class="headerlink" href="#c.aws_fota_event_dl" title="Permalink to this definition"></a><br /></dt>
<dd><div class="docutils container">
<em>#include &lt;aws_fota.h&gt;</em></div>
</dd></dl>

<dl class="c struct">
<dt class="sig sig-object c" id="c.aws_fota_event">
<span class="target" id="structaws__fota__event"></span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">aws_fota_event</span></span></span><a class="headerlink" href="#c.aws_fota_event" title="Permalink to this definition"></a><br /></dt>
<dd><div class="docutils container">
<em>#include &lt;aws_fota.h&gt;</em></div>
</dd></dl>

</dd></dl>

</section>
</section>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="aws_iot.html" class="btn btn-neutral float-right" title="AWS IoT" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="Libraries for networking" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">

<table>
<tr>
<td>
    <p>
        &copy; Copyright 2019-2023, Nordic Semiconductor.
      Last updated on Mar 20, 2023.

    </p>
</td>
<td id="nordiclogo">
  <a href="https://www.nordicsemi.com/"><img src="../../_static/images/nordic-logo.png" border="0"/></a>
</td>
</tr>
</table>
  </div> 


</footer>

<div id="scroll-container">
  <button type="button" id="scroll-btn" class="btn">
    <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="#fff"/></svg>
  </button>
</div>

<script>
  const scrollBtn = document.querySelector("#scroll-btn");

  document.addEventListener("scroll", () => {
    if (window.scrollY > 400) {
          scrollBtn.style.visibility = "visible";
      } else {
          scrollBtn.style.visibility = "hidden";
      }
  });

  scrollBtn.addEventListener("click", () => {
      window.scrollTo({ top: 0, behavior: "smooth" });
  });
</script>
        </div>
      </div>
    </section>
  </div>
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> nRF Connect SDK</span>
       <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      
      <div class="rst-other-version ncs">
        <a href="../../../nrf/index.html">nRF Connect SDK</a>
      </div>
      
      <div class="rst-other-version nrfx">
        <a href="../../../nrfx/index.html">nrfx</a>
      </div>
      
      <div class="rst-other-version nrfxlib">
        <a href="../../../nrfxlib/README.html">nrfxlib</a>
      </div>
      
      <div class="rst-other-version zephyr">
        <a href="../../../zephyr/index.html">Zephyr Project</a>
      </div>
      
      <div class="rst-other-version mcuboot">
        <a href="../../../mcuboot/wrapper.html">MCUboot</a>
      </div>
      
      <div class="rst-other-version tfm">
        <a href="../../../tfm/index.html">Trusted Firmware-M</a>
      </div>
      
      <div class="rst-other-version matter">
        <a href="../../../matter/index.html">Matter</a>
      </div>
      
      <div class="rst-other-version kconfig">
        <a href="../../../kconfig/index.html">Kconfig Reference</a>
      </div>
    </div>
  </div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>