<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Scene Server &mdash; nRF Connect SDK 2.3.99 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/nordic.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/togglebutton.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/nrf.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/tabs.css" type="text/css" /> 
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
        <script src="https://www.googletagmanager.com/gtag/js?id=G-ZPVZRKFQJR"></script>
        <script src="../../../_static/js/ga-tracker.js"></script>
        <script data-culture="EN" id="CookieConsent" type="text/javascript" src="https://policy.app.cookieinformation.com/uc.js"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../../_static/togglebutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/js/theme.js"></script>
<script
  type="text/javascript"
  src="../../../_static/js/ncs.js"
></script>
<script src="../../../_static/js/bootstrap.bundle.min.js"></script>

    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Scene Client" href="scene_cli.html" />
    <link rel="prev" title="Scene models" href="scene.html" />
<link
  href="../../../_static/css/bootstrap.min.css"
  rel="stylesheet"
/>
<link
  rel="shortcut icon"
  href="../../../_static/images/favicon.ico"
/>

</head>

<body class="wy-body-for-nav">
<div class="announcement"></div>
<div class="d-print-none ncs-header">
  <div class="container-xl ncs-header-top">
    <div class="row h-100">
      <div class="d-none d-md-block col-2">
        <div class="bg-white py-4 px-3 ml-2 ncs-header-logo">
          <img
            class="ncs-header-logo"
            src="../../../_static/images/nordic-logo.png"
            alt=""
          />
        </div>
      </div>
      <div
        class="col-8 col-md-7 pl-md-4 d-flex align-self-center justify-content-center"
      >
        <form class="w-75" action="../../../search.html" method="get">
          <div class="form-group">
            <input
              type="text"
              name="q"
              class="ncs-search-input form-control"
              placeholder="Search all docs..."
            />
          </div>
        </form>
      </div>
      <div class="col-4 col-md-3 d-md-block p-3 text-end">
        <div class="dropdown">
          <button
            class="btn dropdown-toggle ncs-btn-versions"
            type="button"
            id="dropdownMenuButton1"
            data-bs-toggle="dropdown"
            aria-expanded="false"
          >
            <span class="d-none d-md-inline">nRF Connect SDK</span>
            <span id="ncsversion" class="d-inline"></span>
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton"></div>
        </div>
      </div>
    </div>
  </div>
  <div class="ncs-header-nav">
    <div class="container-xl">
      <div class="row">
        <div class="col col-12 d-flex justify-content-center">
          <nav class="navbar navbar-dark navbar-expand-lg p-0">
            <span class="navbar-brand d-block d-lg-none py-2 pl-1"
              >Documentation sets</span
            >
            <button
              class="navbar-toggler"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#navbarNavAltMarkup"
              aria-controls="navbarNavAltMarkup"
              aria-expanded="false"
              aria-label="Toggle navigation"
            >
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
              <ul class="navbar-nav">
                <li class="nav-item active py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../nrf/index.html"
                    >nRF Connect SDK</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../nrfx/index.html"
                    >nrfx</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../nrfxlib/README.html"
                    >nrfxlib</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../zephyr/index.html"
                    >Zephyr Project</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../mcuboot/wrapper.html"
                    >MCUboot</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../tfm/index.html"
                    >Trusted Firmware-M</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../matter/index.html"
                    >Matter</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../kconfig/index.html"
                    >Kconfig Reference</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
              </ul>
            </div>
          </nav>
        </div>
      </div>
    </div>
  </div>
</div>

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> nRF Connect SDK
          </a>
              <div class="version">
                2.3.99
              </div>
<div id="searchbox" role="search">
  <div class="searchformwrapper">
    <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
  </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev_model.html">Development model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../app_dev.html">Application development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ecosystem_integration.html">Ecosystems integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nrf91.html">Working with nRF91 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nrf70.html">Working with nRF70 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nrf53.html">Working with nRF53 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nrf52.html">Working with nRF52 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../protocols.html">Protocols</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../applications.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../samples.html">Samples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../drivers.html">Drivers</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Libraries</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../bin/index.html">Binary libraries</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Bluetooth libraries and services</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../adv_prov.html">Bluetooth LE advertising providers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../conn_ctx.html">Bluetooth connection context</a></li>
<li class="toctree-l3"><a class="reference internal" href="../enocean.html">Bluetooth EnOcean</a></li>
<li class="toctree-l3"><a class="reference internal" href="../gatt_dm.html">GATT Discovery Manager</a></li>
<li class="toctree-l3"><a class="reference internal" href="../gatt_pool.html">Bluetooth GATT attribute pools</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../mesh.html">Bluetooth mesh profile</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="model_types.html">Bluetooth mesh models overview</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="models.html">Bluetooth mesh models</a></li>
<li class="toctree-l4"><a class="reference internal" href="properties.html">Bluetooth mesh properties</a></li>
<li class="toctree-l4"><a class="reference internal" href="dk_prov.html">Bluetooth mesh provisioning handler for Nordic DKs</a></li>
<li class="toctree-l4"><a class="reference internal" href="sensor.html">Bluetooth mesh sensors</a></li>
<li class="toctree-l4"><a class="reference internal" href="sensor_types.html">Bluetooth mesh sensor types</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../rpc.html">Bluetooth Low Energy Remote Procedure Call</a></li>
<li class="toctree-l3"><a class="reference internal" href="../scan.html">Scanning module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/ams_client.html">Apple Media Service (AMS) Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/ancs_client.html">Apple Notification Center Service (ANCS) Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/bas_client.html">GATT Battery Service (BAS) Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/bms.html">GATT Bond Management Service (BMS)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/cgms.html">GATT Continuous Glucose Monitoring Service (CGMS)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/cts_client.html">GATT Current Time Service (CTS) Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/ddfs.html">Direction and Distance Finding Service (DDFS)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/dfu_smp.html">GATT DFU SMP Service Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/fast_pair.html">Google Fast Pair Service (GFPS)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/gattp.html">Generic Attribute (GATT) Profile</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/hids.html">GATT Human Interface Device (HID) Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/hogp.html">GATT Human Interface Device Service (HIDS) Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/hrs_client.html">GATT Heart Rate Service (HRS) Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/latency.html">GATT Latency Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/latency_client.html">GATT Latency Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/lbs.html">LED Button Service (LBS)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/mds.html">Memfault Diagnostic Service (MDS)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/nsms.html">Nordic Status Message Service (NSMS)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/nus.html">Nordic UART Service (NUS)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/nus_client.html">Nordic UART Service (NUS) Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/rscs.html">Running Speed and Cadence Service (RSCS)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/throughput.html">GATT Throughput Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/wifi_prov.html">Wi-Fi Provisioning Service</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../bootloader/index.html">Bootloader libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../caf/index.html">Common Application Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../debug/index.html">Debug libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dfu/index.html">DFU libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../gazell/index.html">Gazell libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../modem/index.html">Modem libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../mpsl/index.html">Multiprotocol Service Layer libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../networking/index.html">Libraries for networking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nfc/index.html">Libraries for NFC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nrf_rpc/index.html">nRF RPC libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../others/index.html">Other libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../shell/index.html">Shell libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tfm/index.html">TF-M libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../zigbee/index.html">Libraries for Zigbee</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../scripts.html">Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../release_notes.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../known_issues.html">Known issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../software_maturity.html">Software maturity levels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation.html">About this documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">nRF Connect SDK</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Libraries</a></li>
          <li class="breadcrumb-item"><a href="../index.html">Bluetooth libraries and services</a></li>
          <li class="breadcrumb-item"><a href="../mesh.html">Bluetooth mesh profile</a></li>
          <li class="breadcrumb-item"><a href="models.html">Bluetooth mesh models</a></li>
          <li class="breadcrumb-item"><a href="scene.html">Scene models</a></li>
      <li class="breadcrumb-item active">Scene Server</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/libraries/bluetooth_services/mesh/scene_srv.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="scene-server">
<span id="bt-mesh-scene-srv-readme"></span><h1>Scene Server<a class="headerlink" href="#scene-server" title="Permalink to this heading"></a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#operation" id="id7">Operation</a></p>
<ul>
<li><p><a class="reference internal" href="#models-with-scene-data" id="id8">Models with scene data</a></p></li>
<li><p><a class="reference internal" href="#adding-scene-data-for-a-model" id="id9">Adding scene data for a model</a></p></li>
<li><p><a class="reference internal" href="#storing-and-recalling-scene-data" id="id10">Storing and recalling scene data</a></p></li>
<li><p><a class="reference internal" href="#invalidating-scene-data" id="id11">Invalidating scene data</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#states" id="id12">States</a></p></li>
<li><p><a class="reference internal" href="#extended-models" id="id13">Extended models</a></p></li>
<li><p><a class="reference internal" href="#persistent-storage" id="id14">Persistent storage</a></p></li>
<li><p><a class="reference internal" href="#api-documentation" id="id15">API documentation</a></p></li>
</ul>
</div>
<p>The Scene Server model holds a list of scenes, and exposes functionality for storing and recalling the state of these scenes.</p>
<p>The Scene Server model must be instantiated in every node in the network that participates in scenes.
A Scene Server model instance stores the scene data for every model on its own element, and every subsequent element until the next Scene Server.</p>
<p>The Scene Server model adds two model instances in the composition data:</p>
<ul class="simple">
<li><p>Scene Server</p></li>
<li><p>Scene Setup Server</p></li>
</ul>
<p>The two model instances share the states of the Scene Server, but accept different messages.
This allows for a fine-grained control of the access rights for the Scene Server states, as the two model instances can be bound to different application keys.</p>
<ul class="simple">
<li><p>Scene Server provides functionality for listing and recalling stored scenes.</p></li>
<li><p>Scene Setup Server provides functionality for storing and deleting scenes.</p></li>
</ul>
<p>The Scene Setup Server model extends the Scene Server model and the Generic Default Transition Time Server model.
The Generic Default Transition Time Server model shall be present on the same element as the Scene Setup Server model, or on an element with a lower address.</p>
<section id="operation">
<h2><a class="toc-backref" href="#id7">Operation</a><a class="headerlink" href="#operation" title="Permalink to this heading"></a></h2>
<p>The Scene Server stores all scene data persistently using the <span class="xref std std-ref">zephyr:settings_api</span> subsystem.
Every scene is stored as a serialized concatenation of each registered model’s state, and only exists in RAM during storing and loading.</p>
<p>It’s up to the individual model implementation to correctly serialize and deserialize its state from scene data when prompted.</p>
<section id="models-with-scene-data">
<h3><a class="toc-backref" href="#id8">Models with scene data</a><a class="headerlink" href="#models-with-scene-data" title="Permalink to this heading"></a></h3>
<p>The following models will automatically register scene entries:</p>
<ul class="simple">
<li><p><a class="reference internal" href="gen_onoff_srv.html#bt-mesh-onoff-srv-readme"><span class="std std-ref">Generic OnOff Server</span></a></p></li>
<li><p><a class="reference internal" href="gen_lvl_srv.html#bt-mesh-lvl-srv-readme"><span class="std std-ref">Generic Level Server</span></a></p></li>
<li><p><a class="reference internal" href="gen_plvl_srv.html#bt-mesh-plvl-srv-readme"><span class="std std-ref">Generic Power Level Server</span></a></p></li>
<li><p><a class="reference internal" href="gen_ponoff_srv.html#bt-mesh-ponoff-srv-readme"><span class="std std-ref">Generic Power OnOff Server</span></a></p></li>
<li><p><a class="reference internal" href="lightness_srv.html#bt-mesh-lightness-srv-readme"><span class="std std-ref">Light Lightness Server</span></a></p></li>
<li><p><a class="reference internal" href="light_temp_srv.html#bt-mesh-light-temp-srv-readme"><span class="std std-ref">Light CTL Temperature Server</span></a></p></li>
<li><p><a class="reference internal" href="light_xyl_srv.html#bt-mesh-light-xyl-srv-readme"><span class="std std-ref">Light xyL Server</span></a></p></li>
<li><p><a class="reference internal" href="light_hsl_srv.html#bt-mesh-light-hsl-srv-readme"><span class="std std-ref">Light HSL Server</span></a></p></li>
<li><p><a class="reference internal" href="light_hue_srv.html#bt-mesh-light-hue-srv-readme"><span class="std std-ref">Light Hue Server</span></a></p></li>
<li><p><a class="reference internal" href="light_sat_srv.html#bt-mesh-light-sat-srv-readme"><span class="std std-ref">Light Saturation Server</span></a></p></li>
<li><p><a class="reference internal" href="light_ctl_srv.html#bt-mesh-light-ctl-srv-readme"><span class="std std-ref">Light CTL Server</span></a></p></li>
<li><p><a class="reference internal" href="light_ctrl_srv.html#bt-mesh-light-ctrl-srv-readme"><span class="std std-ref">Light Lightness Control Server</span></a></p></li>
</ul>
</section>
<section id="adding-scene-data-for-a-model">
<h3><a class="toc-backref" href="#id9">Adding scene data for a model</a><a class="headerlink" href="#adding-scene-data-for-a-model" title="Permalink to this heading"></a></h3>
<p>Every model that needs to store its state in scenes must register a <a class="reference internal" href="#c.bt_mesh_scene_entry" title="bt_mesh_scene_entry"><code class="xref c c-type docutils literal notranslate"><span class="pre">bt_mesh_scene_entry</span></code></a> structure containing callbacks for storing and recalling the scene data.
The scene entry must be declared using <a class="reference internal" href="#c.BT_MESH_SCENE_ENTRY_SIG" title="BT_MESH_SCENE_ENTRY_SIG"><code class="xref c c-macro docutils literal notranslate"><span class="pre">BT_MESH_SCENE_ENTRY_SIG</span></code></a> for SIG defined models (for example, from the model specification), or <a class="reference internal" href="#c.BT_MESH_SCENE_ENTRY_VND" title="BT_MESH_SCENE_ENTRY_VND"><code class="xref c c-macro docutils literal notranslate"><span class="pre">BT_MESH_SCENE_ENTRY_VND</span></code></a> for vendor-specific models.
These macros will allocate the structure in flash, and make them known to the Scene Server model.</p>
<p>For instance, the Generic OnOff Server model defines its scene entry by declaring a <a class="reference internal" href="#c.bt_mesh_scene_entry" title="bt_mesh_scene_entry"><code class="xref c c-type docutils literal notranslate"><span class="pre">bt_mesh_scene_entry</span></code></a> structure with the Generic OnOff Server model ID and a set of callbacks:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="kt">ssize_t</span><span class="w"> </span><span class="nf">scene_store</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">bt_mesh_model</span><span class="w"> </span><span class="o">*</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">data</span><span class="p">[])</span>
<span class="p">{</span>
<span class="w">	</span><span class="k">struct</span><span class="w"> </span><span class="nc">bt_mesh_onoff_srv</span><span class="w"> </span><span class="o">*</span><span class="n">srv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model</span><span class="o">-&gt;</span><span class="n">user_data</span><span class="p">;</span>
<span class="w">	</span><span class="k">struct</span><span class="w"> </span><span class="nc">bt_mesh_onoff_status</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">};</span>

<span class="w">	</span><span class="cm">/* Only store the next stable on_off state: */</span>
<span class="w">	</span><span class="n">srv</span><span class="o">-&gt;</span><span class="n">handlers</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">(</span><span class="n">srv</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">status</span><span class="p">);</span>
<span class="w">	</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">status</span><span class="p">.</span><span class="n">remaining_time</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">status</span><span class="p">.</span><span class="n">target_on_off</span><span class="w"> </span><span class="o">:</span>
<span class="w">					  </span><span class="n">status</span><span class="p">.</span><span class="n">present_on_off</span><span class="p">;</span>

<span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">scene_recall</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">bt_mesh_model</span><span class="w"> </span><span class="o">*</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">data</span><span class="p">[],</span>
<span class="w">			 </span><span class="kt">size_t</span><span class="w"> </span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">bt_mesh_model_transition</span><span class="w"> </span><span class="o">*</span><span class="n">transition</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="k">struct</span><span class="w"> </span><span class="nc">bt_mesh_onoff_srv</span><span class="w"> </span><span class="o">*</span><span class="n">srv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model</span><span class="o">-&gt;</span><span class="n">user_data</span><span class="p">;</span>
<span class="w">	</span><span class="k">struct</span><span class="w"> </span><span class="nc">bt_mesh_onoff_status</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">};</span>
<span class="w">	</span><span class="k">struct</span><span class="w"> </span><span class="nc">bt_mesh_onoff_set</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">		</span><span class="p">.</span><span class="n">on_off</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<span class="w">		</span><span class="p">.</span><span class="n">transition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">transition</span><span class="p">,</span>
<span class="w">	</span><span class="p">};</span>

<span class="w">	</span><span class="n">srv</span><span class="o">-&gt;</span><span class="n">handlers</span><span class="o">-&gt;</span><span class="n">set</span><span class="p">(</span><span class="n">srv</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">set</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">status</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">scene_recall_complete</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">bt_mesh_model</span><span class="w"> </span><span class="o">*</span><span class="n">model</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="k">struct</span><span class="w"> </span><span class="nc">bt_mesh_onoff_srv</span><span class="w"> </span><span class="o">*</span><span class="n">srv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model</span><span class="o">-&gt;</span><span class="n">user_data</span><span class="p">;</span>
<span class="w">	</span><span class="k">struct</span><span class="w"> </span><span class="nc">bt_mesh_onoff_status</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">};</span>

<span class="w">	</span><span class="n">srv</span><span class="o">-&gt;</span><span class="n">handlers</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">(</span><span class="n">srv</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">status</span><span class="p">);</span>

<span class="w">	</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">bt_mesh_onoff_srv_pub</span><span class="p">(</span><span class="n">srv</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">status</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">BT_MESH_SCENE_ENTRY_SIG</span><span class="p">(</span><span class="n">onoff</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">	</span><span class="p">.</span><span class="n">id</span><span class="p">.</span><span class="n">sig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BT_MESH_MODEL_ID_GEN_ONOFF_SRV</span><span class="p">,</span>
<span class="w">	</span><span class="p">.</span><span class="n">maxlen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">	</span><span class="p">.</span><span class="n">store</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scene_store</span><span class="p">,</span>
<span class="w">	</span><span class="p">.</span><span class="n">recall</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scene_recall</span><span class="p">,</span>
<span class="w">	</span><span class="p">.</span><span class="n">recall_complete</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scene_recall_complete</span><span class="p">,</span>
<span class="p">};</span>
</pre></div>
</div>
<p>The Generic OnOff Server model only needs to store its OnOff state in the scene, so it always stores and recalls a single byte, as reflected in the <a class="reference internal" href="#c.bt_mesh_scene_entry.maxlen" title="bt_mesh_scene_entry.maxlen"><code class="xref c c-member docutils literal notranslate"><span class="pre">bt_mesh_scene_entry.maxlen</span></code></a> member of the <a class="reference internal" href="#c.bt_mesh_scene_entry" title="bt_mesh_scene_entry"><code class="xref c c-type docutils literal notranslate"><span class="pre">bt_mesh_scene_entry</span></code></a>.</p>
</section>
<section id="storing-and-recalling-scene-data">
<h3><a class="toc-backref" href="#id10">Storing and recalling scene data</a><a class="headerlink" href="#storing-and-recalling-scene-data" title="Permalink to this heading"></a></h3>
<p>When storing and recalling a scene, the Scene Server will go through each model in the composition data elements it represents, and check if there is a scene entry for this model ID.</p>
<p>The Scene Server will use the callbacks in the scene entry to either store or recall the model’s scene data for each model whose model ID is specified in the scene entry.</p>
<p>If you want to skip a specific model instance, return <code class="docutils literal notranslate"><span class="pre">0</span></code> from the <code class="docutils literal notranslate"><span class="pre">store</span></code> callback.</p>
<p>If a model is extended by other models, it will neither be stored nor recalled with the scene, even if there is a scene entry for this model ID.</p>
<p>If a scene store operation is requested in the middle of a transition between two states, the model should commit the target state to the scene data.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">recall</span></code> callback contains a transition time pointer, which should be taken into account when implementing the model behavior.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">recall_complete</span></code> callback is called to notify that recalling scene data is finished.
A model can use this callback when it needs to publish its state, which is a composite state and requires all corresponding models to recall their scene data first.</p>
</section>
<section id="invalidating-scene-data">
<h3><a class="toc-backref" href="#id11">Invalidating scene data</a><a class="headerlink" href="#invalidating-scene-data" title="Permalink to this heading"></a></h3>
<p>A scene is valid as long as its state is unchanged.
As soon as one of the models in a scene detect a change to the scene data, either because of an incoming message or because of an internal change, the node is no longer in an active scene.
When a model detects a change to its own data, it calls <a class="reference internal" href="#c.bt_mesh_scene_invalidate" title="bt_mesh_scene_invalidate"><code class="xref c c-func docutils literal notranslate"><span class="pre">bt_mesh_scene_invalidate()</span></code></a>, passing a pointer to its own model pointer.
This resets the Scene Server’s current scene to <a class="reference internal" href="scene.html#c.BT_MESH_SCENE_NONE" title="BT_MESH_SCENE_NONE"><code class="xref c c-macro docutils literal notranslate"><span class="pre">BT_MESH_SCENE_NONE</span></code></a>.
The scene has to be stored again to include the change.</p>
</section>
</section>
<section id="states">
<h2><a class="toc-backref" href="#id12">States</a><a class="headerlink" href="#states" title="Permalink to this heading"></a></h2>
<dl class="simple">
<dt>Current scene: <code class="docutils literal notranslate"><span class="pre">uint16_t</span></code></dt><dd><p>The currently active scene.
As soon as one of the models included in the scene changes its state, the scene is invalidated, and set to <a class="reference internal" href="scene.html#c.BT_MESH_SCENE_NONE" title="BT_MESH_SCENE_NONE"><code class="xref c c-macro docutils literal notranslate"><span class="pre">BT_MESH_SCENE_NONE</span></code></a>.</p>
</dd>
<dt>Scene registry: <code class="docutils literal notranslate"><span class="pre">uint16_t[]</span></code></dt><dd><p>The full list of scenes stored by the Scene Server.
The scene registry has a limited number of slots, controlled by <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_BT_MESH_SCENES_MAX</span></code>.</p>
</dd>
</dl>
</section>
<section id="extended-models">
<h2><a class="toc-backref" href="#id13">Extended models</a><a class="headerlink" href="#extended-models" title="Permalink to this heading"></a></h2>
<p>None.</p>
</section>
<section id="persistent-storage">
<h2><a class="toc-backref" href="#id14">Persistent storage</a><a class="headerlink" href="#persistent-storage" title="Permalink to this heading"></a></h2>
<p>The Scene Server stores the scene registry persistently.</p>
<p>Each scene in the scene registry is stored as a separate serialized data structure, containing the scene data of all participating models.
The serialized data is split into pages of 256 bytes to allow storage of more data than the settings backend can fit in one entry.</p>
<p>The serialized scene data includes 4 bytes of overhead for every stored SIG model, and 6 bytes of overhead for every stored vendor model.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As the Scene Server will store data for every model for every scene, the persistent storage space required for the Scene Server is significant.
It’s important to monitor the storage requirements actively during development to ensure the allocated flash pages aren’t worn out too early.</p>
</div>
</section>
<section id="api-documentation">
<h2><a class="toc-backref" href="#id15">API documentation</a><a class="headerlink" href="#api-documentation" title="Permalink to this heading"></a></h2>
<div class="line-block">
<div class="line">Header file: <code class="file docutils literal notranslate"><span class="pre">include/bluetooth/mesh/scene_srv.h</span></code></div>
<div class="line">Source file: <code class="file docutils literal notranslate"><span class="pre">subsys/bluetooth/mesh/scene_srv.c</span></code></div>
</div>
<dl>
<dt class="sig sig-object cpp">
<span class="target" id="group__bt__mesh__scene__srv"></span><em><span class="pre">group</span></em> <span class="sig-name descname"><span class="pre">bt_mesh_scene_srv</span></span></dt>
<dd><p>API for the Scene Server model. </p>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-defines">Defines</p>
<dl class="c macro">
<dt class="sig sig-object c" id="c.CONFIG_BT_MESH_SCENES_MAX">
<span class="target" id="group__bt__mesh__scene__srv_1gaa53811d0937e9e2500967b302e96b1b6"></span><span class="sig-name descname"><span class="n"><span class="pre">CONFIG_BT_MESH_SCENES_MAX</span></span></span><a class="headerlink" href="#c.CONFIG_BT_MESH_SCENES_MAX" title="Permalink to this definition"></a><br /></dt>
<dd></dd></dl>

<dl class="c macro">
<dt class="sig sig-object c" id="c.BT_MESH_SCENE_ENTRY_SIG">
<span class="target" id="group__bt__mesh__scene__srv_1gacc3006b0bfae1f4078388db6619d159f"></span><span class="sig-name descname"><span class="n"><span class="pre">BT_MESH_SCENE_ENTRY_SIG</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">_name</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.BT_MESH_SCENE_ENTRY_SIG" title="Permalink to this definition"></a><br /></dt>
<dd><p>Scene entry type definition for SIG models. </p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>_name</strong> – <strong>[in]</strong> Name of the scene entry type </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c macro">
<dt class="sig sig-object c" id="c.BT_MESH_SCENE_ENTRY_VND">
<span class="target" id="group__bt__mesh__scene__srv_1ga2dc6ba7da1cb74d5869b7cf641c6826e"></span><span class="sig-name descname"><span class="n"><span class="pre">BT_MESH_SCENE_ENTRY_VND</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">_name</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.BT_MESH_SCENE_ENTRY_VND" title="Permalink to this definition"></a><br /></dt>
<dd><p>Scene entry type definition for vendor models. </p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>_name</strong> – <strong>[in]</strong> Name of the scene entry type </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c macro">
<dt class="sig sig-object c" id="c.BT_MESH_MODEL_SCENE_SRV">
<span class="target" id="group__bt__mesh__scene__srv_1gaafb98fd13ba00ab41fc90def2fb1f550"></span><span class="sig-name descname"><span class="n"><span class="pre">BT_MESH_MODEL_SCENE_SRV</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">_srv</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.BT_MESH_MODEL_SCENE_SRV" title="Permalink to this definition"></a><br /></dt>
<dd><p>Scene Server model composition data entry. </p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>_srv</strong> – <strong>[in]</strong> Pointer to a <a class="reference internal" href="#group__bt__mesh__scene__srv"><span class="std std-ref">Scene Server model</span></a> instance. </p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-functions">Functions</p>
<dl class="c function">
<dt class="sig sig-object c" id="c.bt_mesh_scene_invalidate">
<span class="target" id="group__bt__mesh__scene__srv_1ga0ad626e1db2b96ce7d460d918e843cda"></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">bt_mesh_scene_invalidate</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">bt_mesh_model</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">mod</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.bt_mesh_scene_invalidate" title="Permalink to this definition"></a><br /></dt>
<dd><p>Notify the Scene Server that a Scene entry has changed. </p>
<p>Whenever some state in the Scene has changed outside of Scene recall procedure, this function must be called to notify the Scene Server that the current Scene is no longer active.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mod</strong> – <strong>[in]</strong> Model that invalidated the scene. </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.bt_mesh_scene_srv_set">
<span class="target" id="group__bt__mesh__scene__srv_1gaec8f3cacf43706c4d717d74bb959edea"></span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">bt_mesh_scene_srv_set</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.bt_mesh_scene_srv" title="bt_mesh_scene_srv"><span class="n"><span class="pre">bt_mesh_scene_srv</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">srv</span></span>, <span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="n"><span class="pre">scene</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="model_types.html#c.bt_mesh_model_transition" title="bt_mesh_model_transition"><span class="n"><span class="pre">bt_mesh_model_transition</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">transition</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.bt_mesh_scene_srv_set" title="Permalink to this definition"></a><br /></dt>
<dd><p>Set the current Scene. </p>
<p>All Scene entries of the given Scene Server will transition to the given Scene according to the transition parameters.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>srv</strong> – <strong>[in]</strong> Scene Server model. </p></li>
<li><p><strong>scene</strong> – <strong>[in]</strong> Scene to transition to. Cannot be <a class="reference internal" href="scene.html#group__bt__mesh__scene_1gaf68df55bc0247c8e0d90182c34fa35d5"><span class="std std-ref">BT_MESH_SCENE_NONE</span></a>. </p></li>
<li><p><strong>transition</strong> – <strong>[in]</strong> Transition parameters, or NULL to use the default parameters.</p></li>
</ul>
</dd>
<dt class="field-even">Return values</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>0</strong> – Successfully transitioned to the given scene. </p></li>
<li><p><strong>-EINVAL</strong> – Invalid scene number or transition parameters. </p></li>
<li><p><strong>-ENOENT</strong> – No such scene. </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.bt_mesh_scene_srv_pub">
<span class="target" id="group__bt__mesh__scene__srv_1gac2ef8ab0a91d5eb4aa74197702f04ba1"></span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">bt_mesh_scene_srv_pub</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.bt_mesh_scene_srv" title="bt_mesh_scene_srv"><span class="n"><span class="pre">bt_mesh_scene_srv</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">srv</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">bt_mesh_msg_ctx</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">ctx</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.bt_mesh_scene_srv_pub" title="Permalink to this definition"></a><br /></dt>
<dd><p>Publish the current Scene status. </p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>srv</strong> – <strong>[in]</strong> Scene Server model. </p></li>
<li><p><strong>ctx</strong> – <strong>[in]</strong> Message context, or NULL to publish with the configured parameters.</p></li>
</ul>
</dd>
<dt class="field-even">Return values</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>-EADDRNOTAVAIL</strong> – A message context was not provided and publishing is not configured. </p></li>
<li><p><strong>-EAGAIN</strong> – The device has not been provisioned. </p></li>
</ul>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>0 Successfully published the current Scene state. </p>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.bt_mesh_scene_srv_current_scene_get">
<span class="target" id="group__bt__mesh__scene__srv_1ga28f7377853b6eda79a43cfec06ff7f2d"></span><span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">bt_mesh_scene_srv_current_scene_get</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.bt_mesh_scene_srv" title="bt_mesh_scene_srv"><span class="n"><span class="pre">bt_mesh_scene_srv</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">srv</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.bt_mesh_scene_srv_current_scene_get" title="Permalink to this definition"></a><br /></dt>
<dd><p>Get the current scene. </p>
<p>This will return the scene that the scene servers is currently in. If there is no currently active scene this will return <a class="reference internal" href="scene.html#group__bt__mesh__scene_1gaf68df55bc0247c8e0d90182c34fa35d5"><span class="std std-ref">BT_MESH_SCENE_NONE</span></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>srv</strong> – <strong>[in]</strong> Scene Server model.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Return the current scene for the scene server. </p>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.bt_mesh_scene_srv_target_scene_get">
<span class="target" id="group__bt__mesh__scene__srv_1gad4731e54838569a4736dbbc7c043702b"></span><span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">bt_mesh_scene_srv_target_scene_get</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.bt_mesh_scene_srv" title="bt_mesh_scene_srv"><span class="n"><span class="pre">bt_mesh_scene_srv</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">srv</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.bt_mesh_scene_srv_target_scene_get" title="Permalink to this definition"></a><br /></dt>
<dd><p>Get the target scene. </p>
<p>This will return the scene that the scene servers is transiting into. If there is no transition running this will return <a class="reference internal" href="scene.html#group__bt__mesh__scene_1gaf68df55bc0247c8e0d90182c34fa35d5"><span class="std std-ref">BT_MESH_SCENE_NONE</span></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>srv</strong> – <strong>[in]</strong> Scene Server model.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Return the target scene for the scene server. </p>
</dd>
</dl>
</dd></dl>

</div>
<dl class="c struct">
<dt class="sig sig-object c" id="c.bt_mesh_scene_srv">
<span class="target" id="structbt__mesh__scene__srv"></span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">bt_mesh_scene_srv</span></span></span><a class="headerlink" href="#c.bt_mesh_scene_srv" title="Permalink to this definition"></a><br /></dt>
<dd><div class="docutils container">
<em>#include &lt;scene_srv.h&gt;</em></div>
<p>Scene Server model instance </p>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-public-members">Public Members</p>
<dl class="c var">
<dt class="sig sig-object c" id="c.bt_mesh_scene_srv.all">
<span class="target" id="structbt__mesh__scene__srv_1a83655df22cf3a235bfcea5f30d9d1029"></span><span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">all</span></span></span><span class="p"><span class="pre">[</span></span><span class="m"><span class="pre">0</span></span><span class="p"><span class="pre">]</span></span><a class="headerlink" href="#c.bt_mesh_scene_srv.all" title="Permalink to this definition"></a><br /></dt>
<dd><p>All known scenes. </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.bt_mesh_scene_srv.count">
<span class="target" id="structbt__mesh__scene__srv_1a25f09d01683756bc687bd930e757382b"></span><span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">count</span></span></span><a class="headerlink" href="#c.bt_mesh_scene_srv.count" title="Permalink to this definition"></a><br /></dt>
<dd><p>Number of known scenes. </p>
</dd></dl>

</div>
</dd></dl>

<dl class="c struct">
<dt class="sig sig-object c" id="c.bt_mesh_scene_entry">
<span class="target" id="structbt__mesh__scene__entry"></span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">bt_mesh_scene_entry</span></span></span><a class="headerlink" href="#c.bt_mesh_scene_entry" title="Permalink to this definition"></a><br /></dt>
<dd><div class="docutils container">
<em>#include &lt;scene_srv.h&gt;</em></div>
<p>Scene entry type. </p>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-public-members">Public Members</p>
<dl class="c var">
<dt class="sig sig-object c" id="c.bt_mesh_scene_entry.sig">
<span class="target" id="structbt__mesh__scene__entry_1abbf3c9d44aa655bd341e5649c2cddf0b"></span><span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">sig</span></span></span><a class="headerlink" href="#c.bt_mesh_scene_entry.sig" title="Permalink to this definition"></a><br /></dt>
<dd><p>SIG model ID </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.bt_mesh_scene_entry.vnd">
<span class="target" id="structbt__mesh__scene__entry_1a105ec567ebbdbd85bade4aeb4599e0d3"></span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">bt_mesh_mod_id_vnd</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">vnd</span></span></span><a class="headerlink" href="#c.bt_mesh_scene_entry.vnd" title="Permalink to this definition"></a><br /></dt>
<dd><p>Vendor model ID </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.bt_mesh_scene_entry.id">
<span class="target" id="structbt__mesh__scene__entry_1a4f220e011e9a962b8f79060945d6f1ab"></span><span class="k"><span class="pre">union</span></span><span class="w"> </span><a class="reference internal" href="#c.bt_mesh_scene_entry" title="bt_mesh_scene_entry"><span class="n"><span class="pre">bt_mesh_scene_entry</span></span></a><span class="p"><span class="pre">.</span></span><span class="n"><span class="pre">[anonymous]</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">id</span></span></span><a class="headerlink" href="#c.bt_mesh_scene_entry.id" title="Permalink to this definition"></a><br /></dt>
<dd><p>Model ID </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.bt_mesh_scene_entry.maxlen">
<span class="target" id="structbt__mesh__scene__entry_1ac53682711ceeee79772d78c76d602335"></span><span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">maxlen</span></span></span><a class="headerlink" href="#c.bt_mesh_scene_entry.maxlen" title="Permalink to this definition"></a><br /></dt>
<dd><p>Longest scene data </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.bt_mesh_scene_entry.store">
<span class="target" id="structbt__mesh__scene__entry_1a269933d1289831c7de5ce2262a6fb1e3"></span><span class="n"><span class="pre">ssize_t</span></span><span class="w"> </span><span class="p"><span class="pre">(</span></span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">store</span></span></span><span class="p"><span class="pre">)</span></span><span class="p"><span class="pre">(</span></span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">bt_mesh_model</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">model</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">)</span></span><a class="headerlink" href="#c.bt_mesh_scene_entry.store" title="Permalink to this definition"></a><br /></dt>
<dd><p>Store the current state as a scene. </p>
<p>The callback should fill the <code class="docutils literal notranslate"><span class="pre">data</span></code> with the current scene state and return the number of bytes written. <code class="docutils literal notranslate"><span class="pre">data</span></code> is guaranteed to fit <code class="docutils literal notranslate"><span class="pre">maxlen</span></code> number of bytes.</p>
<dl class="field-list simple">
<dt class="field-odd">Param model</dt>
<dd class="field-odd"><p><strong>[in]</strong> Model to get the scene data of. </p>
</dd>
<dt class="field-even">Param data</dt>
<dd class="field-even"><p><strong>[out]</strong> Scene data buffer to fill. Fits <code class="docutils literal notranslate"><span class="pre">maxlen</span></code> bytes.</p>
</dd>
<dt class="field-odd">Return</dt>
<dd class="field-odd"><p>The number of bytes written to <code class="docutils literal notranslate"><span class="pre">data</span></code> or a negative value on failure. </p>
</dd>
</dl>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.bt_mesh_scene_entry.recall">
<span class="target" id="structbt__mesh__scene__entry_1a259065f1e378ecbd8c134a8409652e89"></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">(</span></span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">recall</span></span></span><span class="p"><span class="pre">)</span></span><span class="p"><span class="pre">(</span></span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">bt_mesh_model</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">model</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="n"><span class="pre">len</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="model_types.html#c.bt_mesh_model_transition" title="bt_mesh_model_transition"><span class="n"><span class="pre">bt_mesh_model_transition</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">transition</span></span><span class="p"><span class="pre">)</span></span><a class="headerlink" href="#c.bt_mesh_scene_entry.recall" title="Permalink to this definition"></a><br /></dt>
<dd><p>Recall a scene based on the given scene data. </p>
<p>When a scene is recalled, the Scene Server calls this callback for every scene entry that has data for the recalled scene. The handler shall start transitioning to the given scene with the given transition parameters. If the transition is non-instantaneous, for example when <a class="reference internal" href="model_types.html#group__bt__mesh__model__types_1gaa845685eb265d1294b17bb80fbde4996"><span class="std std-ref">bt_mesh_model_transition_time</span></a> returns a nonzero value, the handler shall publish a status message at the end of the transition.</p>
<dl class="field-list simple">
<dt class="field-odd">Param model</dt>
<dd class="field-odd"><p><strong>[in]</strong> Model to restore the scene of. </p>
</dd>
<dt class="field-even">Param data</dt>
<dd class="field-even"><p><strong>[in]</strong> Scene data to restore. </p>
</dd>
<dt class="field-odd">Param len</dt>
<dd class="field-odd"><p><strong>[in]</strong> Scene data length. </p>
</dd>
<dt class="field-even">Param transition</dt>
<dd class="field-even"><p><strong>[in]</strong> Transition parameters. </p>
</dd>
</dl>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.bt_mesh_scene_entry.recall_complete">
<span class="target" id="structbt__mesh__scene__entry_1ab9b5a145dcc9003e4480cede56aac6b4"></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">(</span></span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">recall_complete</span></span></span><span class="p"><span class="pre">)</span></span><span class="p"><span class="pre">(</span></span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">bt_mesh_model</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">model</span></span><span class="p"><span class="pre">)</span></span><a class="headerlink" href="#c.bt_mesh_scene_entry.recall_complete" title="Permalink to this definition"></a><br /></dt>
<dd><p>Recall a scene is completed. </p>
<p>This callback is called for each model that has a scene entry when recalling a scene data is done and <a class="reference internal" href="#structbt__mesh__scene__entry_1a259065f1e378ecbd8c134a8409652e89"><span class="std std-ref">bt_mesh_scene_entry::recall</span></a> callback has been called for all models. The model can use this callback when it needs to publish its state, which is a composite state and requires all corresponding models to recall their scene data first.</p>
<p>Can be NULL.</p>
<dl class="field-list simple">
<dt class="field-odd">Param model</dt>
<dd class="field-odd"><p><strong>[in]</strong> Model to restore the scene of. </p>
</dd>
</dl>
</dd></dl>

</div>
</dd></dl>

</dd></dl>

</section>
</section>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="scene_cli.html" class="btn btn-neutral float-right" title="Scene Client" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="scene.html" class="btn btn-neutral" title="Scene models" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">

<table>
<tr>
<td>
    <p>
        &copy; Copyright 2019-2023, Nordic Semiconductor.
      Last updated on Mar 20, 2023.

    </p>
</td>
<td id="nordiclogo">
  <a href="https://www.nordicsemi.com/"><img src="../../../_static/images/nordic-logo.png" border="0"/></a>
</td>
</tr>
</table>
  </div> 


</footer>

<div id="scroll-container">
  <button type="button" id="scroll-btn" class="btn">
    <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="#fff"/></svg>
  </button>
</div>

<script>
  const scrollBtn = document.querySelector("#scroll-btn");

  document.addEventListener("scroll", () => {
    if (window.scrollY > 400) {
          scrollBtn.style.visibility = "visible";
      } else {
          scrollBtn.style.visibility = "hidden";
      }
  });

  scrollBtn.addEventListener("click", () => {
      window.scrollTo({ top: 0, behavior: "smooth" });
  });
</script>
        </div>
      </div>
    </section>
  </div>
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> nRF Connect SDK</span>
       <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      
      <div class="rst-other-version ncs">
        <a href="../../../../nrf/index.html">nRF Connect SDK</a>
      </div>
      
      <div class="rst-other-version nrfx">
        <a href="../../../../nrfx/index.html">nrfx</a>
      </div>
      
      <div class="rst-other-version nrfxlib">
        <a href="../../../../nrfxlib/README.html">nrfxlib</a>
      </div>
      
      <div class="rst-other-version zephyr">
        <a href="../../../../zephyr/index.html">Zephyr Project</a>
      </div>
      
      <div class="rst-other-version mcuboot">
        <a href="../../../../mcuboot/wrapper.html">MCUboot</a>
      </div>
      
      <div class="rst-other-version tfm">
        <a href="../../../../tfm/index.html">Trusted Firmware-M</a>
      </div>
      
      <div class="rst-other-version matter">
        <a href="../../../../matter/index.html">Matter</a>
      </div>
      
      <div class="rst-other-version kconfig">
        <a href="../../../../kconfig/index.html">Kconfig Reference</a>
      </div>
    </div>
  </div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>