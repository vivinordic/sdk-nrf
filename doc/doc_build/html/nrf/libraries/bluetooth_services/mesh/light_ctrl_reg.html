<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Illuminance regulator interface &mdash; nRF Connect SDK 2.3.99 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/nordic.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/togglebutton.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/nrf.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/tabs.css" type="text/css" /> 
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
        <script src="https://www.googletagmanager.com/gtag/js?id=G-ZPVZRKFQJR"></script>
        <script src="../../../_static/js/ga-tracker.js"></script>
        <script data-culture="EN" id="CookieConsent" type="text/javascript" src="https://policy.app.cookieinformation.com/uc.js"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../../_static/togglebutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/js/theme.js"></script>
<script
  type="text/javascript"
  src="../../../_static/js/ncs.js"
></script>
<script src="../../../_static/js/bootstrap.bundle.min.js"></script>

    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Specification-defined illuminance regulator" href="light_ctrl_reg_spec.html" />
    <link rel="prev" title="Light Lightness Control Client" href="light_ctrl_cli.html" />
<link
  href="../../../_static/css/bootstrap.min.css"
  rel="stylesheet"
/>
<link
  rel="shortcut icon"
  href="../../../_static/images/favicon.ico"
/>

</head>

<body class="wy-body-for-nav">
<div class="announcement"></div>
<div class="d-print-none ncs-header">
  <div class="container-xl ncs-header-top">
    <div class="row h-100">
      <div class="d-none d-md-block col-2">
        <div class="bg-white py-4 px-3 ml-2 ncs-header-logo">
          <img
            class="ncs-header-logo"
            src="../../../_static/images/nordic-logo.png"
            alt=""
          />
        </div>
      </div>
      <div
        class="col-8 col-md-7 pl-md-4 d-flex align-self-center justify-content-center"
      >
        <form class="w-75" action="../../../search.html" method="get">
          <div class="form-group">
            <input
              type="text"
              name="q"
              class="ncs-search-input form-control"
              placeholder="Search all docs..."
            />
          </div>
        </form>
      </div>
      <div class="col-4 col-md-3 d-md-block p-3 text-end">
        <div class="dropdown">
          <button
            class="btn dropdown-toggle ncs-btn-versions"
            type="button"
            id="dropdownMenuButton1"
            data-bs-toggle="dropdown"
            aria-expanded="false"
          >
            <span class="d-none d-md-inline">nRF Connect SDK</span>
            <span id="ncsversion" class="d-inline"></span>
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton"></div>
        </div>
      </div>
    </div>
  </div>
  <div class="ncs-header-nav">
    <div class="container-xl">
      <div class="row">
        <div class="col col-12 d-flex justify-content-center">
          <nav class="navbar navbar-dark navbar-expand-lg p-0">
            <span class="navbar-brand d-block d-lg-none py-2 pl-1"
              >Documentation sets</span
            >
            <button
              class="navbar-toggler"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#navbarNavAltMarkup"
              aria-controls="navbarNavAltMarkup"
              aria-expanded="false"
              aria-label="Toggle navigation"
            >
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
              <ul class="navbar-nav">
                <li class="nav-item active py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../nrf/index.html"
                    >nRF Connect SDK</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../nrfx/index.html"
                    >nrfx</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../nrfxlib/README.html"
                    >nrfxlib</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../zephyr/index.html"
                    >Zephyr Project</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../mcuboot/wrapper.html"
                    >MCUboot</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../tfm/index.html"
                    >Trusted Firmware-M</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../matter/index.html"
                    >Matter</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../kconfig/index.html"
                    >Kconfig Reference</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
              </ul>
            </div>
          </nav>
        </div>
      </div>
    </div>
  </div>
</div>

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> nRF Connect SDK
          </a>
              <div class="version">
                2.3.99
              </div>
<div id="searchbox" role="search">
  <div class="searchformwrapper">
    <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
  </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev_model.html">Development model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../app_dev.html">Application development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ecosystem_integration.html">Ecosystems integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nrf91.html">Working with nRF91 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nrf70.html">Working with nRF70 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nrf53.html">Working with nRF53 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nrf52.html">Working with nRF52 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../protocols.html">Protocols</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../applications.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../samples.html">Samples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../drivers.html">Drivers</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Libraries</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../bin/index.html">Binary libraries</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Bluetooth libraries and services</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../adv_prov.html">Bluetooth LE advertising providers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../conn_ctx.html">Bluetooth connection context</a></li>
<li class="toctree-l3"><a class="reference internal" href="../enocean.html">Bluetooth EnOcean</a></li>
<li class="toctree-l3"><a class="reference internal" href="../gatt_dm.html">GATT Discovery Manager</a></li>
<li class="toctree-l3"><a class="reference internal" href="../gatt_pool.html">Bluetooth GATT attribute pools</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../mesh.html">Bluetooth mesh profile</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="model_types.html">Bluetooth mesh models overview</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="models.html">Bluetooth mesh models</a></li>
<li class="toctree-l4"><a class="reference internal" href="properties.html">Bluetooth mesh properties</a></li>
<li class="toctree-l4"><a class="reference internal" href="dk_prov.html">Bluetooth mesh provisioning handler for Nordic DKs</a></li>
<li class="toctree-l4"><a class="reference internal" href="sensor.html">Bluetooth mesh sensors</a></li>
<li class="toctree-l4"><a class="reference internal" href="sensor_types.html">Bluetooth mesh sensor types</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../rpc.html">Bluetooth Low Energy Remote Procedure Call</a></li>
<li class="toctree-l3"><a class="reference internal" href="../scan.html">Scanning module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/ams_client.html">Apple Media Service (AMS) Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/ancs_client.html">Apple Notification Center Service (ANCS) Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/bas_client.html">GATT Battery Service (BAS) Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/bms.html">GATT Bond Management Service (BMS)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/cgms.html">GATT Continuous Glucose Monitoring Service (CGMS)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/cts_client.html">GATT Current Time Service (CTS) Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/ddfs.html">Direction and Distance Finding Service (DDFS)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/dfu_smp.html">GATT DFU SMP Service Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/fast_pair.html">Google Fast Pair Service (GFPS)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/gattp.html">Generic Attribute (GATT) Profile</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/hids.html">GATT Human Interface Device (HID) Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/hogp.html">GATT Human Interface Device Service (HIDS) Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/hrs_client.html">GATT Heart Rate Service (HRS) Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/latency.html">GATT Latency Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/latency_client.html">GATT Latency Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/lbs.html">LED Button Service (LBS)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/mds.html">Memfault Diagnostic Service (MDS)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/nsms.html">Nordic Status Message Service (NSMS)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/nus.html">Nordic UART Service (NUS)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/nus_client.html">Nordic UART Service (NUS) Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/rscs.html">Running Speed and Cadence Service (RSCS)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/throughput.html">GATT Throughput Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/wifi_prov.html">Wi-Fi Provisioning Service</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../bootloader/index.html">Bootloader libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../caf/index.html">Common Application Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../debug/index.html">Debug libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dfu/index.html">DFU libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../gazell/index.html">Gazell libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../modem/index.html">Modem libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../mpsl/index.html">Multiprotocol Service Layer libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../networking/index.html">Libraries for networking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nfc/index.html">Libraries for NFC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nrf_rpc/index.html">nRF RPC libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../others/index.html">Other libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../shell/index.html">Shell libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tfm/index.html">TF-M libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../zigbee/index.html">Libraries for Zigbee</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../scripts.html">Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../release_notes.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../known_issues.html">Known issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../software_maturity.html">Software maturity levels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation.html">About this documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">nRF Connect SDK</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Libraries</a></li>
          <li class="breadcrumb-item"><a href="../index.html">Bluetooth libraries and services</a></li>
          <li class="breadcrumb-item"><a href="../mesh.html">Bluetooth mesh profile</a></li>
          <li class="breadcrumb-item"><a href="models.html">Bluetooth mesh models</a></li>
          <li class="breadcrumb-item"><a href="light_ctrl.html">Light Lightness Control models</a></li>
      <li class="breadcrumb-item active">Illuminance regulator interface</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/libraries/bluetooth_services/mesh/light_ctrl_reg.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="illuminance-regulator-interface">
<span id="bt-mesh-light-ctrl-reg-readme"></span><h1>Illuminance regulator interface<a class="headerlink" href="#illuminance-regulator-interface" title="Permalink to this heading"></a></h1>
<p>This module defines an interface for implementation and interaction with an abstract illuminance regulator.</p>
<section id="using-the-regulator">
<h2>Using the regulator<a class="headerlink" href="#using-the-regulator" title="Permalink to this heading"></a></h2>
<p>As this defines an interface for an abstract illuminance regulator, it cannot be used on its own.
For an example of regulator usage, see <a class="reference internal" href="light_ctrl_srv.html#bt-mesh-light-ctrl-srv-readme"><span class="std std-ref">Light Lightness Control Server</span></a>.</p>
<p>A regulator implementation will provide a <a class="reference internal" href="#c.bt_mesh_light_ctrl_reg" title="bt_mesh_light_ctrl_reg"><code class="xref c c-struct docutils literal notranslate"><span class="pre">bt_mesh_light_ctrl_reg</span></code></a> instance, and this is used as the interface to the regulator.
Field <a class="reference internal" href="#c.bt_mesh_light_ctrl_reg.user_data" title="bt_mesh_light_ctrl_reg.user_data"><code class="xref c c-member docutils literal notranslate"><span class="pre">bt_mesh_light_ctrl_reg.user_data</span></code></a> of this struct can be used to store a user context.</p>
<p>Before using the regulator, it needs to be initialized through the <a class="reference internal" href="#c.bt_mesh_light_ctrl_reg.init" title="bt_mesh_light_ctrl_reg.init"><code class="xref c c-member docutils literal notranslate"><span class="pre">bt_mesh_light_ctrl_reg.init</span></code></a> function.
Functions <a class="reference internal" href="#c.bt_mesh_light_ctrl_reg.start" title="bt_mesh_light_ctrl_reg.start"><code class="xref c c-member docutils literal notranslate"><span class="pre">bt_mesh_light_ctrl_reg.start</span></code></a> and <a class="reference internal" href="#c.bt_mesh_light_ctrl_reg.stop" title="bt_mesh_light_ctrl_reg.stop"><code class="xref c c-member docutils literal notranslate"><span class="pre">bt_mesh_light_ctrl_reg.stop</span></code></a> are used to start and stop the regulator.</p>
<section id="regulator-inputs">
<h3>Regulator inputs<a class="headerlink" href="#regulator-inputs" title="Permalink to this heading"></a></h3>
<p>The regulator has two inputs:</p>
<ul class="simple">
<li><p>Target value</p></li>
<li><p>Measured value</p></li>
</ul>
<p>The illuminance regulator takes the specified target value as the reference level and compares it to the reported measured value.
The inputs are compared to establish an error for the regulator, which the regulator tries to minimize.</p>
<p>The measured value is passed through the <a class="reference internal" href="#c.bt_mesh_light_ctrl_reg.measured" title="bt_mesh_light_ctrl_reg.measured"><code class="xref c c-member docutils literal notranslate"><span class="pre">bt_mesh_light_ctrl_reg.measured</span></code></a> variable.
The passed value is to be used in the next regulator step.
The regulator depends on measurement frequency to provide a stable output.
The measurement frequency should be as close as possible to the update interval of the regulator.
If the measurement frequency is too low, the regulator might oscillate as it attempts to compensate for outdated feedback.</p>
<p>The desired target value is passed through the <a class="reference internal" href="#c.bt_mesh_light_ctrl_reg_target_set" title="bt_mesh_light_ctrl_reg_target_set"><code class="xref c c-func docutils literal notranslate"><span class="pre">bt_mesh_light_ctrl_reg_target_set()</span></code></a> function.
If the transition time is greater than zero, the target value will be interpolated linearly over the transition time from the previously set value to the new one.</p>
</section>
<section id="regulator-output">
<h3>Regulator output<a class="headerlink" href="#regulator-output" title="Permalink to this heading"></a></h3>
<p>The regulator contains a proportional (P) and an integral (I) component whose outputs are summarized to a regulator output value.
To get output from the regulator, set the <a class="reference internal" href="#c.bt_mesh_light_ctrl_reg.updated" title="bt_mesh_light_ctrl_reg.updated"><code class="xref c c-member docutils literal notranslate"><span class="pre">bt_mesh_light_ctrl_reg.updated</span></code></a> callback.
When the regulator is running, it will repeatedly call this callback.</p>
</section>
<section id="tuning-the-regulator">
<h3>Tuning the regulator<a class="headerlink" href="#tuning-the-regulator" title="Permalink to this heading"></a></h3>
<p>Regulator tuning is complex and depends on a lot of internal and external parameters.
Varying sensor delay, light output and light change rate may significantly affect the regulator performance and accuracy.
To compensate for the external parameters, each regulator component provides user controllable coefficients that change their impact on the output value:</p>
<ul class="simple">
<li><p>K<sub>p</sub> - for the proportional component</p></li>
<li><p>K<sub>i</sub> - for the integral component</p></li>
</ul>
<p>These coefficients can have individual values for positive and negative errors, referenced as follows in the API:</p>
<ul class="simple">
<li><p>K<sub>pu</sub> - proportional up; used when target is higher.</p></li>
<li><p>K<sub>pd</sub> - proportional down; used when target is lower.</p></li>
<li><p>K<sub>iu</sub> - integral up; used when target is higher.</p></li>
<li><p>K<sub>id</sub> - integral down; used when target is lower</p></li>
</ul>
<p>Regulators are tuned to fit their environment by changing the coefficients.
The coefficient adjustments are typically done by analyzing the system’s <em>step response</em>.
The step response is the overall system response to a change in reference value, for instance in a state change in the light level state machine.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The transition time between states in the Light LC Server makes the feedback loop more forgiving.
A larger transition time can compensate for poor regulator response.</p>
</div>
<p>The illuminance regulator is a PI regulator, which uses the following components to compensate for a mismatch between the reference and the measured level:</p>
<ul class="simple">
<li><p>Instantaneous error - The proportional component that is typically the main source of correction for a PI regulator.
It compares the reference value to the most recent feedback value, and attempts to correct the error by eliminating the difference.</p></li>
<li><p>Accumulated error - The integral component that compensates for errors by adding up the sum of the error over time.
Its main contribution is to eliminate system bias and accelerate the system step response.</p></li>
</ul>
<p>Changing different coefficients will affect the step response differently.
Increasing the two coefficients will have the following effect on the step response:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 18%" />
<col style="width: 15%" />
<col style="width: 15%" />
<col style="width: 22%" />
<col style="width: 30%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Coefficient</p></th>
<th class="head"><p>Rise time</p></th>
<th class="head"><p>Overshoot</p></th>
<th class="head"><p>Settling time</p></th>
<th class="head"><p>Steady-state error</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>K<sub>p</sub></p></td>
<td><p>Faster</p></td>
<td><p>Higher</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
</tr>
<tr class="row-odd"><td><p>K<sub>i</sub></p></td>
<td><p>Faster</p></td>
<td><p>Higher</p></td>
<td><p>Longer</p></td>
<td><p>Reduced</p></td>
</tr>
</tbody>
</table>
<p>The value of the coefficients is typically a trade-off between fast response time and system instability:</p>
<ul class="simple">
<li><p>If the value is too high, the system might become unstable, potentially leading to oscillation and loss of control.</p></li>
<li><p>If the value is too low, the step response might be too slow or unable to reach the target value altogether.</p></li>
</ul>
</section>
</section>
<section id="implementing-a-new-regulator">
<h2>Implementing a new regulator<a class="headerlink" href="#implementing-a-new-regulator" title="Permalink to this heading"></a></h2>
<p>To implement a new regulator using this generic interface, declare a <a class="reference internal" href="#c.bt_mesh_light_ctrl_reg" title="bt_mesh_light_ctrl_reg"><code class="xref c c-struct docutils literal notranslate"><span class="pre">bt_mesh_light_ctrl_reg</span></code></a> struct, and set the <a class="reference internal" href="#c.bt_mesh_light_ctrl_reg.init" title="bt_mesh_light_ctrl_reg.init"><code class="xref c c-member docutils literal notranslate"><span class="pre">bt_mesh_light_ctrl_reg.init</span></code></a>, <a class="reference internal" href="#c.bt_mesh_light_ctrl_reg.start" title="bt_mesh_light_ctrl_reg.start"><code class="xref c c-member docutils literal notranslate"><span class="pre">bt_mesh_light_ctrl_reg.start</span></code></a>, and <a class="reference internal" href="#c.bt_mesh_light_ctrl_reg.stop" title="bt_mesh_light_ctrl_reg.stop"><code class="xref c c-member docutils literal notranslate"><span class="pre">bt_mesh_light_ctrl_reg.stop</span></code></a> fields to implementations of these functions.
Use <code class="xref c c-func docutils literal notranslate"><span class="pre">bt_mesh_light_ctrl_reg_input_get()</span></code> to get the current target value for the regulator supplied by the regulator user.
The value returned is interpolated linearly over the transition time, if a transition time is requested by the regulator user.</p>
<p>The <a class="reference internal" href="#c.bt_mesh_light_ctrl_reg.init" title="bt_mesh_light_ctrl_reg.init"><code class="xref c c-member docutils literal notranslate"><span class="pre">bt_mesh_light_ctrl_reg.init</span></code></a> function must perform the necessary steps to initialize the implementation, such as initializing interrupt handlers or timers, but not start the regulator.</p>
<p>Use the <a class="reference internal" href="#c.bt_mesh_light_ctrl_reg.start" title="bt_mesh_light_ctrl_reg.start"><code class="xref c c-member docutils literal notranslate"><span class="pre">bt_mesh_light_ctrl_reg.start</span></code></a> and <a class="reference internal" href="#c.bt_mesh_light_ctrl_reg.stop" title="bt_mesh_light_ctrl_reg.stop"><code class="xref c c-member docutils literal notranslate"><span class="pre">bt_mesh_light_ctrl_reg.stop</span></code></a> functions to start and stop the regulator after it has been initialized by a call to <code class="docutils literal notranslate"><span class="pre">init</span></code>.</p>
<p>On every regulator step, the regulator must call <a class="reference internal" href="#c.bt_mesh_light_ctrl_reg.updated" title="bt_mesh_light_ctrl_reg.updated"><code class="xref c c-member docutils literal notranslate"><span class="pre">bt_mesh_light_ctrl_reg.updated</span></code></a> callback supplied by the user.</p>
<p>For an example of regulator implementation, see <a class="reference internal" href="light_ctrl_reg_spec.html#bt-mesh-light-ctrl-reg-spec-readme"><span class="std std-ref">Specification-defined illuminance regulator</span></a>.</p>
</section>
<section id="api-documentation">
<h2>API documentation<a class="headerlink" href="#api-documentation" title="Permalink to this heading"></a></h2>
<div class="line-block">
<div class="line">Header file: <code class="file docutils literal notranslate"><span class="pre">include/bluetooth/mesh/light_ctrl_reg.h</span></code></div>
<div class="line">Source file: <code class="file docutils literal notranslate"><span class="pre">subsys/bluetooth/mesh/light_ctrl_reg.c</span></code></div>
</div>
<dl>
<dt class="sig sig-object cpp">
<span class="target" id="group__bt__mesh__light__ctrl__reg"></span><em><span class="pre">group</span></em> <span class="sig-name descname"><span class="pre">bt_mesh_light_ctrl_reg</span></span></dt>
<dd><p>Illuminance regulator API. </p>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-functions">Functions</p>
<dl class="c function">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_reg_target_set">
<span class="target" id="group__bt__mesh__light__ctrl__reg_1ga2f19b5ea722ef9916f21eb1769f9ccc3"></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">bt_mesh_light_ctrl_reg_target_set</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.bt_mesh_light_ctrl_reg" title="bt_mesh_light_ctrl_reg"><span class="n"><span class="pre">bt_mesh_light_ctrl_reg</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">reg</span></span>, <span class="kt"><span class="pre">float</span></span><span class="w"> </span><span class="n"><span class="pre">target</span></span>, <span class="n"><span class="pre">int32_t</span></span><span class="w"> </span><span class="n"><span class="pre">transition_time</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.bt_mesh_light_ctrl_reg_target_set" title="Permalink to this definition"></a><br /></dt>
<dd><p>Set the target lightness for the regulator. </p>
<p>Sets the target lightness, also known as the setpoint, for the regulator. Transition time is optional.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>reg</strong> – <strong>[in]</strong> Illuminance regulator instance.</p></li>
<li><p><strong>target</strong> – <strong>[in]</strong> Target lightness (setpoint).</p></li>
<li><p><strong>transition_time</strong> – <strong>[in]</strong> Transition time until the target lightness should reach the specified value. Pass 0 to change immediately. </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_reg_target_get">
<span class="target" id="group__bt__mesh__light__ctrl__reg_1ga3e0dec6f4d0d863c9a502f1d0cce6af7"></span><span class="kt"><span class="pre">float</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">bt_mesh_light_ctrl_reg_target_get</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.bt_mesh_light_ctrl_reg" title="bt_mesh_light_ctrl_reg"><span class="n"><span class="pre">bt_mesh_light_ctrl_reg</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">reg</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.bt_mesh_light_ctrl_reg_target_get" title="Permalink to this definition"></a><br /></dt>
<dd><p>Get the target lightness for the regulator. </p>
<p>Returns the target lightness, taking the requested transition time into account, for use in regulator implementations.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>reg</strong> – <strong>[in]</strong> Illuminance regulator instance.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The current target lightness, interpolated during transition time. </p>
</dd>
</dl>
</dd></dl>

</div>
<dl class="c struct">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_reg_coeff">
<span class="target" id="structbt__mesh__light__ctrl__reg__coeff"></span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">bt_mesh_light_ctrl_reg_coeff</span></span></span><a class="headerlink" href="#c.bt_mesh_light_ctrl_reg_coeff" title="Permalink to this definition"></a><br /></dt>
<dd><div class="docutils container">
<em>#include &lt;light_ctrl_reg.h&gt;</em></div>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-public-members">Public Members</p>
<dl class="c var">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_reg_coeff.up">
<span class="target" id="structbt__mesh__light__ctrl__reg__coeff_1a874326ef50b23d948604981bba137db8"></span><span class="kt"><span class="pre">float</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">up</span></span></span><a class="headerlink" href="#c.bt_mesh_light_ctrl_reg_coeff.up" title="Permalink to this definition"></a><br /></dt>
<dd><p>Upwards coefficient. </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_reg_coeff.down">
<span class="target" id="structbt__mesh__light__ctrl__reg__coeff_1af18e94838b7a8c0fee2a4d8767014bed"></span><span class="kt"><span class="pre">float</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">down</span></span></span><a class="headerlink" href="#c.bt_mesh_light_ctrl_reg_coeff.down" title="Permalink to this definition"></a><br /></dt>
<dd><p>Downwards coefficient. </p>
</dd></dl>

</div>
</dd></dl>

<dl class="c struct">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_reg_cfg">
<span class="target" id="structbt__mesh__light__ctrl__reg__cfg"></span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">bt_mesh_light_ctrl_reg_cfg</span></span></span><a class="headerlink" href="#c.bt_mesh_light_ctrl_reg_cfg" title="Permalink to this definition"></a><br /></dt>
<dd><div class="docutils container">
<em>#include &lt;light_ctrl_reg.h&gt;</em></div>
<p>Illuminance regulator configuration. </p>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-public-members">Public Members</p>
<dl class="c var">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_reg_cfg.ki">
<span class="target" id="structbt__mesh__light__ctrl__reg__cfg_1a34053c824fd66d49808b996323a72c50"></span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.bt_mesh_light_ctrl_reg_coeff" title="bt_mesh_light_ctrl_reg_coeff"><span class="n"><span class="pre">bt_mesh_light_ctrl_reg_coeff</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">ki</span></span></span><a class="headerlink" href="#c.bt_mesh_light_ctrl_reg_cfg.ki" title="Permalink to this definition"></a><br /></dt>
<dd><p>Regulator integral coefficient. </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_reg_cfg.kp">
<span class="target" id="structbt__mesh__light__ctrl__reg__cfg_1ac2e023e539ba80097027dd52201ca994"></span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.bt_mesh_light_ctrl_reg_coeff" title="bt_mesh_light_ctrl_reg_coeff"><span class="n"><span class="pre">bt_mesh_light_ctrl_reg_coeff</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">kp</span></span></span><a class="headerlink" href="#c.bt_mesh_light_ctrl_reg_cfg.kp" title="Permalink to this definition"></a><br /></dt>
<dd><p>Regulator proportional coefficient. </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_reg_cfg.accuracy">
<span class="target" id="structbt__mesh__light__ctrl__reg__cfg_1a590fba968a03918f4a79dd50c87b8049"></span><span class="kt"><span class="pre">float</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">accuracy</span></span></span><a class="headerlink" href="#c.bt_mesh_light_ctrl_reg_cfg.accuracy" title="Permalink to this definition"></a><br /></dt>
<dd><p>Regulator dead zone (in percentage). </p>
</dd></dl>

</div>
</dd></dl>

<dl class="c struct">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_reg">
<span class="target" id="structbt__mesh__light__ctrl__reg"></span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">bt_mesh_light_ctrl_reg</span></span></span><a class="headerlink" href="#c.bt_mesh_light_ctrl_reg" title="Permalink to this definition"></a><br /></dt>
<dd><div class="docutils container">
<em>#include &lt;light_ctrl_reg.h&gt;</em></div>
<p>Common regulator context </p>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-public-members">Public Members</p>
<dl class="c var">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_reg.init">
<span class="target" id="structbt__mesh__light__ctrl__reg_1a328d7199b74d0a028e8479e17aad4d2b"></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">(</span></span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">init</span></span></span><span class="p"><span class="pre">)</span></span><span class="p"><span class="pre">(</span></span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.bt_mesh_light_ctrl_reg" title="bt_mesh_light_ctrl_reg"><span class="n"><span class="pre">bt_mesh_light_ctrl_reg</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">reg</span></span><span class="p"><span class="pre">)</span></span><a class="headerlink" href="#c.bt_mesh_light_ctrl_reg.init" title="Permalink to this definition"></a><br /></dt>
<dd><p>Initialize the regulator. </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_reg.start">
<span class="target" id="structbt__mesh__light__ctrl__reg_1a711a9d8688d6102a47d47cfe3e582e99"></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">(</span></span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">start</span></span></span><span class="p"><span class="pre">)</span></span><span class="p"><span class="pre">(</span></span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.bt_mesh_light_ctrl_reg" title="bt_mesh_light_ctrl_reg"><span class="n"><span class="pre">bt_mesh_light_ctrl_reg</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">reg</span></span><span class="p"><span class="pre">)</span></span><a class="headerlink" href="#c.bt_mesh_light_ctrl_reg.start" title="Permalink to this definition"></a><br /></dt>
<dd><p>Start the regulator. </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_reg.stop">
<span class="target" id="structbt__mesh__light__ctrl__reg_1aa63d61a30d1a413d8c6bb8bc5e0d5a40"></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">(</span></span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">stop</span></span></span><span class="p"><span class="pre">)</span></span><span class="p"><span class="pre">(</span></span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.bt_mesh_light_ctrl_reg" title="bt_mesh_light_ctrl_reg"><span class="n"><span class="pre">bt_mesh_light_ctrl_reg</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">reg</span></span><span class="p"><span class="pre">)</span></span><a class="headerlink" href="#c.bt_mesh_light_ctrl_reg.stop" title="Permalink to this definition"></a><br /></dt>
<dd><p>Stop the regulator. </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_reg.cfg">
<span class="target" id="structbt__mesh__light__ctrl__reg_1a1bf4961ce560a18198acf1e31e60879b"></span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.bt_mesh_light_ctrl_reg_cfg" title="bt_mesh_light_ctrl_reg_cfg"><span class="n"><span class="pre">bt_mesh_light_ctrl_reg_cfg</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">cfg</span></span></span><a class="headerlink" href="#c.bt_mesh_light_ctrl_reg.cfg" title="Permalink to this definition"></a><br /></dt>
<dd><p>Regulator configuration. </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_reg.measured">
<span class="target" id="structbt__mesh__light__ctrl__reg_1a973ee693187d418724b1076dfab7ad7f"></span><span class="kt"><span class="pre">float</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">measured</span></span></span><a class="headerlink" href="#c.bt_mesh_light_ctrl_reg.measured" title="Permalink to this definition"></a><br /></dt>
<dd><p>Measured value. </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_reg.updated">
<span class="target" id="structbt__mesh__light__ctrl__reg_1a1cd069fd46edffecf3a9eea2a49b40fb"></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">(</span></span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">updated</span></span></span><span class="p"><span class="pre">)</span></span><span class="p"><span class="pre">(</span></span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.bt_mesh_light_ctrl_reg" title="bt_mesh_light_ctrl_reg"><span class="n"><span class="pre">bt_mesh_light_ctrl_reg</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">reg</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="kt"><span class="pre">float</span></span><span class="w"> </span><span class="n"><span class="pre">output</span></span><span class="p"><span class="pre">)</span></span><a class="headerlink" href="#c.bt_mesh_light_ctrl_reg.updated" title="Permalink to this definition"></a><br /></dt>
<dd><p>Regulator output update callback. </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_reg.user_data">
<span class="target" id="structbt__mesh__light__ctrl__reg_1a84b90e5b52a7cfa99d2888c1a9034424"></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">user_data</span></span></span><a class="headerlink" href="#c.bt_mesh_light_ctrl_reg.user_data" title="Permalink to this definition"></a><br /></dt>
<dd><p>User data, available in update callback. </p>
</dd></dl>

</div>
</dd></dl>

</dd></dl>

</section>
</section>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="light_ctrl_reg_spec.html" class="btn btn-neutral float-right" title="Specification-defined illuminance regulator" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="light_ctrl_cli.html" class="btn btn-neutral" title="Light Lightness Control Client" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">

<table>
<tr>
<td>
    <p>
        &copy; Copyright 2019-2023, Nordic Semiconductor.
      Last updated on Mar 20, 2023.

    </p>
</td>
<td id="nordiclogo">
  <a href="https://www.nordicsemi.com/"><img src="../../../_static/images/nordic-logo.png" border="0"/></a>
</td>
</tr>
</table>
  </div> 


</footer>

<div id="scroll-container">
  <button type="button" id="scroll-btn" class="btn">
    <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="#fff"/></svg>
  </button>
</div>

<script>
  const scrollBtn = document.querySelector("#scroll-btn");

  document.addEventListener("scroll", () => {
    if (window.scrollY > 400) {
          scrollBtn.style.visibility = "visible";
      } else {
          scrollBtn.style.visibility = "hidden";
      }
  });

  scrollBtn.addEventListener("click", () => {
      window.scrollTo({ top: 0, behavior: "smooth" });
  });
</script>
        </div>
      </div>
    </section>
  </div>
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> nRF Connect SDK</span>
       <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      
      <div class="rst-other-version ncs">
        <a href="../../../../nrf/index.html">nRF Connect SDK</a>
      </div>
      
      <div class="rst-other-version nrfx">
        <a href="../../../../nrfx/index.html">nrfx</a>
      </div>
      
      <div class="rst-other-version nrfxlib">
        <a href="../../../../nrfxlib/README.html">nrfxlib</a>
      </div>
      
      <div class="rst-other-version zephyr">
        <a href="../../../../zephyr/index.html">Zephyr Project</a>
      </div>
      
      <div class="rst-other-version mcuboot">
        <a href="../../../../mcuboot/wrapper.html">MCUboot</a>
      </div>
      
      <div class="rst-other-version tfm">
        <a href="../../../../tfm/index.html">Trusted Firmware-M</a>
      </div>
      
      <div class="rst-other-version matter">
        <a href="../../../../matter/index.html">Matter</a>
      </div>
      
      <div class="rst-other-version kconfig">
        <a href="../../../../kconfig/index.html">Kconfig Reference</a>
      </div>
    </div>
  </div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>