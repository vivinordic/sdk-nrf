<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Light Lightness Control Server &mdash; nRF Connect SDK 2.3.99 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/nordic.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/togglebutton.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/nrf.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/tabs.css" type="text/css" /> 
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
        <script src="https://www.googletagmanager.com/gtag/js?id=G-ZPVZRKFQJR"></script>
        <script src="../../../_static/js/ga-tracker.js"></script>
        <script data-culture="EN" id="CookieConsent" type="text/javascript" src="https://policy.app.cookieinformation.com/uc.js"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../../_static/togglebutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/js/theme.js"></script>
<script
  type="text/javascript"
  src="../../../_static/js/ncs.js"
></script>
<script src="../../../_static/js/bootstrap.bundle.min.js"></script>

    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Light Lightness Control Client" href="light_ctrl_cli.html" />
    <link rel="prev" title="Light Lightness Control models" href="light_ctrl.html" />
<link
  href="../../../_static/css/bootstrap.min.css"
  rel="stylesheet"
/>
<link
  rel="shortcut icon"
  href="../../../_static/images/favicon.ico"
/>

</head>

<body class="wy-body-for-nav">
<div class="announcement"></div>
<div class="d-print-none ncs-header">
  <div class="container-xl ncs-header-top">
    <div class="row h-100">
      <div class="d-none d-md-block col-2">
        <div class="bg-white py-4 px-3 ml-2 ncs-header-logo">
          <img
            class="ncs-header-logo"
            src="../../../_static/images/nordic-logo.png"
            alt=""
          />
        </div>
      </div>
      <div
        class="col-8 col-md-7 pl-md-4 d-flex align-self-center justify-content-center"
      >
        <form class="w-75" action="../../../search.html" method="get">
          <div class="form-group">
            <input
              type="text"
              name="q"
              class="ncs-search-input form-control"
              placeholder="Search all docs..."
            />
          </div>
        </form>
      </div>
      <div class="col-4 col-md-3 d-md-block p-3 text-end">
        <div class="dropdown">
          <button
            class="btn dropdown-toggle ncs-btn-versions"
            type="button"
            id="dropdownMenuButton1"
            data-bs-toggle="dropdown"
            aria-expanded="false"
          >
            <span class="d-none d-md-inline">nRF Connect SDK</span>
            <span id="ncsversion" class="d-inline"></span>
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton"></div>
        </div>
      </div>
    </div>
  </div>
  <div class="ncs-header-nav">
    <div class="container-xl">
      <div class="row">
        <div class="col col-12 d-flex justify-content-center">
          <nav class="navbar navbar-dark navbar-expand-lg p-0">
            <span class="navbar-brand d-block d-lg-none py-2 pl-1"
              >Documentation sets</span
            >
            <button
              class="navbar-toggler"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#navbarNavAltMarkup"
              aria-controls="navbarNavAltMarkup"
              aria-expanded="false"
              aria-label="Toggle navigation"
            >
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
              <ul class="navbar-nav">
                <li class="nav-item active py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../nrf/index.html"
                    >nRF Connect SDK</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../nrfx/index.html"
                    >nrfx</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../nrfxlib/README.html"
                    >nrfxlib</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../zephyr/index.html"
                    >Zephyr Project</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../mcuboot/wrapper.html"
                    >MCUboot</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../tfm/index.html"
                    >Trusted Firmware-M</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../matter/index.html"
                    >Matter</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../kconfig/index.html"
                    >Kconfig Reference</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
              </ul>
            </div>
          </nav>
        </div>
      </div>
    </div>
  </div>
</div>

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> nRF Connect SDK
          </a>
              <div class="version">
                2.3.99
              </div>
<div id="searchbox" role="search">
  <div class="searchformwrapper">
    <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
  </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev_model.html">Development model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../app_dev.html">Application development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ecosystem_integration.html">Ecosystems integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nrf91.html">Working with nRF91 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nrf70.html">Working with nRF70 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nrf53.html">Working with nRF53 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nrf52.html">Working with nRF52 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../protocols.html">Protocols</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../applications.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../samples.html">Samples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../drivers.html">Drivers</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Libraries</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../bin/index.html">Binary libraries</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Bluetooth libraries and services</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../adv_prov.html">Bluetooth LE advertising providers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../conn_ctx.html">Bluetooth connection context</a></li>
<li class="toctree-l3"><a class="reference internal" href="../enocean.html">Bluetooth EnOcean</a></li>
<li class="toctree-l3"><a class="reference internal" href="../gatt_dm.html">GATT Discovery Manager</a></li>
<li class="toctree-l3"><a class="reference internal" href="../gatt_pool.html">Bluetooth GATT attribute pools</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../mesh.html">Bluetooth mesh profile</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="model_types.html">Bluetooth mesh models overview</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="models.html">Bluetooth mesh models</a></li>
<li class="toctree-l4"><a class="reference internal" href="properties.html">Bluetooth mesh properties</a></li>
<li class="toctree-l4"><a class="reference internal" href="dk_prov.html">Bluetooth mesh provisioning handler for Nordic DKs</a></li>
<li class="toctree-l4"><a class="reference internal" href="sensor.html">Bluetooth mesh sensors</a></li>
<li class="toctree-l4"><a class="reference internal" href="sensor_types.html">Bluetooth mesh sensor types</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../rpc.html">Bluetooth Low Energy Remote Procedure Call</a></li>
<li class="toctree-l3"><a class="reference internal" href="../scan.html">Scanning module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/ams_client.html">Apple Media Service (AMS) Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/ancs_client.html">Apple Notification Center Service (ANCS) Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/bas_client.html">GATT Battery Service (BAS) Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/bms.html">GATT Bond Management Service (BMS)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/cgms.html">GATT Continuous Glucose Monitoring Service (CGMS)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/cts_client.html">GATT Current Time Service (CTS) Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/ddfs.html">Direction and Distance Finding Service (DDFS)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/dfu_smp.html">GATT DFU SMP Service Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/fast_pair.html">Google Fast Pair Service (GFPS)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/gattp.html">Generic Attribute (GATT) Profile</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/hids.html">GATT Human Interface Device (HID) Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/hogp.html">GATT Human Interface Device Service (HIDS) Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/hrs_client.html">GATT Heart Rate Service (HRS) Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/latency.html">GATT Latency Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/latency_client.html">GATT Latency Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/lbs.html">LED Button Service (LBS)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/mds.html">Memfault Diagnostic Service (MDS)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/nsms.html">Nordic Status Message Service (NSMS)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/nus.html">Nordic UART Service (NUS)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/nus_client.html">Nordic UART Service (NUS) Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/rscs.html">Running Speed and Cadence Service (RSCS)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/throughput.html">GATT Throughput Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/wifi_prov.html">Wi-Fi Provisioning Service</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../bootloader/index.html">Bootloader libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../caf/index.html">Common Application Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../debug/index.html">Debug libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dfu/index.html">DFU libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../gazell/index.html">Gazell libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../modem/index.html">Modem libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../mpsl/index.html">Multiprotocol Service Layer libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../networking/index.html">Libraries for networking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nfc/index.html">Libraries for NFC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nrf_rpc/index.html">nRF RPC libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../others/index.html">Other libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../shell/index.html">Shell libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tfm/index.html">TF-M libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../zigbee/index.html">Libraries for Zigbee</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../scripts.html">Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../release_notes.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../known_issues.html">Known issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../software_maturity.html">Software maturity levels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation.html">About this documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">nRF Connect SDK</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Libraries</a></li>
          <li class="breadcrumb-item"><a href="../index.html">Bluetooth libraries and services</a></li>
          <li class="breadcrumb-item"><a href="../mesh.html">Bluetooth mesh profile</a></li>
          <li class="breadcrumb-item"><a href="models.html">Bluetooth mesh models</a></li>
          <li class="breadcrumb-item"><a href="light_ctrl.html">Light Lightness Control models</a></li>
      <li class="breadcrumb-item active">Light Lightness Control Server</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/libraries/bluetooth_services/mesh/light_ctrl_srv.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="light-lightness-control-server">
<span id="bt-mesh-light-ctrl-srv-readme"></span><h1>Light Lightness Control Server<a class="headerlink" href="#light-lightness-control-server" title="Permalink to this heading"></a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#overview" id="id11">Overview</a></p>
<ul>
<li><p><a class="reference internal" href="#composition-data-structure" id="id12">Composition data structure</a></p></li>
<li><p><a class="reference internal" href="#relationship-with-other-nodes" id="id13">Relationship with other nodes</a></p></li>
<li><p><a class="reference internal" href="#lightness-state-machine" id="id14">Lightness state machine</a></p></li>
<li><p><a class="reference internal" href="#illuminance-regulator" id="id15">Illuminance regulator</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#states" id="id16">States</a></p></li>
<li><p><a class="reference internal" href="#extended-models" id="id17">Extended models</a></p></li>
<li><p><a class="reference internal" href="#persistent-storage" id="id18">Persistent Storage</a></p>
<ul>
<li><p><a class="reference internal" href="#power-up-behavior" id="id19">Power-up behavior</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#api-documentation" id="id20">API documentation</a></p></li>
</ul>
</div>
<p>The Light Lightness Control (LC) Server controls a single <a class="reference internal" href="lightness_srv.html#bt-mesh-lightness-srv-readme"><span class="std std-ref">Light Lightness Server</span></a> instance on the same device with a state machine.</p>
<p>The state machine defines common behavior for a light fixture through three states, each with its own timing parameters and light levels.
As input to its state machine, the Light LC Server listens for Sensor and OnOff messages.</p>
<p>In addition to the state machine, the Light LC Server may optionally use a regulator to control the ambient illuminance in the room.
The regulator requires illuminance sensor readings acting as feedback for its regulator loop.</p>
<p>The Lightness Control Server is always disabled by default, and must be enabled by a <a class="reference internal" href="light_ctrl_cli.html#bt-mesh-light-ctrl-cli-readme"><span class="std std-ref">Light Lightness Control Client</span></a>.</p>
<section id="overview">
<h2><a class="toc-backref" href="#id11">Overview</a><a class="headerlink" href="#overview" title="Permalink to this heading"></a></h2>
<p>In this section, you can find more detailed information about the following aspects of the Light LC Server:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#composition-data-structure">Composition data structure</a></p></li>
<li><p><a class="reference internal" href="#relationship-with-other-nodes">Relationship with other nodes</a></p></li>
<li><p><a class="reference internal" href="#lightness-state-machine">Lightness state machine</a></p></li>
<li><p><a class="reference internal" href="#illuminance-regulator">Illuminance regulator</a></p></li>
</ul>
<section id="composition-data-structure">
<span id="bt-mesh-light-ctrl-srv-composition"></span><h3><a class="toc-backref" href="#id12">Composition data structure</a><a class="headerlink" href="#composition-data-structure" title="Permalink to this heading"></a></h3>
<p>As both the Light LC Server and the Light Lightness Server extend the Generic OnOff model, the two models cannot be instantiated on the same element.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Due to implementation limitations, the Light LC Server is instantiated on the next element after the Light Lightness Server it is controlling.</p>
</div>
<figure class="align-default" id="id7">
<img alt="Light Lightness Control Server composition data structure" src="../../../_images/bt_mesh_light_ctrl_composition.svg" /><figcaption>
<p><span class="caption-text">Light Lightness Control Server composition data structure</span><a class="headerlink" href="#id7" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>In the application, this composition data looks like this:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">bt_mesh_elem</span><span class="w"> </span><span class="n">elements</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="cm">/* Lightness element */</span>
<span class="w">   </span><span class="n">BT_MESH_ELEM</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
<span class="w">       </span><span class="n">BT_MESH_MODEL_LIST</span><span class="p">(</span><span class="n">BT_MESH_MODEL_LIGHTNESS_SRV</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lightness_srv</span><span class="p">)),</span>
<span class="w">       </span><span class="n">BT_MESH_MODEL_NONE</span><span class="p">),</span>
<span class="w">   </span><span class="cm">/* Light Control element */</span>
<span class="w">   </span><span class="n">BT_MESH_ELEM</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span>
<span class="w">       </span><span class="n">BT_MESH_MODEL_LIST</span><span class="p">(</span><span class="n">BT_MESH_MODEL_LIGHT_CTRL_SRV</span><span class="p">(</span><span class="o">&amp;</span><span class="n">light_ctrl_srv</span><span class="p">)),</span>
<span class="w">       </span><span class="n">BT_MESH_MODEL_NONE</span><span class="p">),</span>
<span class="p">};</span>
</pre></div>
</div>
<p>The Light LC Server will log an error during initialization if the controlled Light Lightness Server is on the same element.</p>
</section>
<section id="relationship-with-other-nodes">
<h3><a class="toc-backref" href="#id13">Relationship with other nodes</a><a class="headerlink" href="#relationship-with-other-nodes" title="Permalink to this heading"></a></h3>
<p>When the Light LC Server model controls a Light Lightness Server, all nodes should publish to the LC Server or its extended Generic OnOff model, instead of publishing directly to the Light Lightness Server:</p>
<figure class="align-default">
<img alt="Light Lightness Control Server node organization" src="../../../_images/bt_mesh_light_ctrl_nodes.svg" /></figure>
<p>The dimmer devices that want to override the light level of the Light Lightness Server can publish directly to it.
This disengages the Light LC Server, and the Light Lightness Server operates independently until the Light LC Server is explicitly re-enabled.</p>
</section>
<section id="lightness-state-machine">
<span id="bt-mesh-light-ctrl-srv-composition-state-machine"></span><h3><a class="toc-backref" href="#id14">Lightness state machine</a><a class="headerlink" href="#lightness-state-machine" title="Permalink to this heading"></a></h3>
<p>The Light LC Server’s lightness state machine operates in the following states:</p>
<dl class="simple">
<dt>Standby</dt><dd><p>There is no activity in the room, and the device’s light are either off or dimmed.</p>
</dd>
<dt>On</dt><dd><p>There is activity in the room, and the lights are on.</p>
</dd>
<dt>Prolong</dt><dd><p>There is no activity detected.
The lights are at a slightly dimmed level, ready to get back to their <em>On</em> level as soon as activity is detected.</p>
</dd>
</dl>
<p>Each state has a lightness level and a transition time used for fading.
When the state changes, the light level fades from the previous state’s level to the new state’s level in a transition time span determined by the new state.</p>
<p>When the Light LC Server is turned on, the following sequence takes place:</p>
<figure class="align-default" id="id8">
<img alt="Light Lightness Control Server light levels" src="../../../_images/bt_mesh_light_ctrl_levels.svg" /><figcaption>
<p><span class="caption-text">Light Lightness Control Server light levels</span><a class="headerlink" href="#id8" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>The state machine cycles through the states with the following events:</p>
<dl class="simple">
<dt>Timeout</dt><dd><p>Triggered when the current state has timed out.
The state machine automatically moves into the next state.</p>
</dd>
<dt>On</dt><dd><p>Toggled when a motion sensor is triggered or the On button is pressed on a light switch.</p>
</dd>
<dt>Off</dt><dd><p>Toggled when the Off button is pressed on a light switch.</p>
</dd>
</dl>
<p>The On and Prolong states will start a timer as soon as the transition into the state is finished.
When this timer expires, the state machine will automatically go into the next state.
If the On event is triggered while in the On state, the timer is reset, and the transition to the Prolong state is postponed.</p>
<figure class="align-default" id="id9">
<img alt="Light Lightness Control Server state machine" src="../../../_images/bt_mesh_light_ctrl_states.svg" /><figcaption>
<p><span class="caption-text">Light Lightness Control Server state machine</span><a class="headerlink" href="#id9" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The state machine only works while the Light LC Server is enabled, and it always starts in the Standby state.</p>
</div>
<section id="resuming-the-state-machine-operation">
<h4>Resuming the state machine operation<a class="headerlink" href="#resuming-the-state-machine-operation" title="Permalink to this heading"></a></h4>
<p>Whenever something but the Light LC Server interacts with the controlled Light Lightness Server, the Light LC Server disables its state machine, and the Light Lightness Server starts running independently.
To resume the state machine operation, the Light LC Server must be explicitly re-enabled.</p>
<p>To avoid having a Light Lightness Server running independently forever, the Light LC Server implements a resume timer that lets the Light LC Server regain control after being disabled for a certain number of seconds.
The resume timer can be configured with the <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_BT_MESH_LIGHT_CTRL_SRV_RESUME_DELAY</span></code> option, and is disabled by default.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The resume timer does not exist in the Bluetooth® mesh specification, and may become incompatible with future specification changes.
Although it does not break the specification or qualification tests in the current iteration of the Bluetooth mesh specification, its behavior may be unexpected for third party devices, and should be used with caution.</p>
</div>
</section>
<section id="state-machine-outputs">
<h4>State machine outputs<a class="headerlink" href="#state-machine-outputs" title="Permalink to this heading"></a></h4>
<p>The state machine has two different output values for each state:</p>
<dl class="simple">
<dt>Light level</dt><dd><p>The light level decides the output light level sent to the controlled Light Lightness Server.
Each state has a configurable light level, and the output light level will be the light level of the current state, with linear transitions between the states.
The default light level values per state are:</p>
<ul class="simple">
<li><p>Standby state - 0%</p></li>
<li><p>On state - 100%</p></li>
<li><p>Prolong state - 50%</p></li>
</ul>
</dd>
<dt>Target illuminance level</dt><dd><p>Each state has a configurable target illuminance level, which is used as input to the <a class="reference internal" href="#bt-mesh-light-ctrl-srv-reg-readme"><span class="std std-ref">Illuminance regulator</span></a>.
The target illuminance level decides the ambient illuminance the regulator should try to achieve, as measured by illuminance sensors nearby.
Just like with the light level, the target illuminance always matches the configured target illuminance for the current state, with linear transitions between the states.</p>
</dd>
</dl>
</section>
<section id="external-event-triggers">
<h4>External event triggers<a class="headerlink" href="#external-event-triggers" title="Permalink to this heading"></a></h4>
<p>While the Timeout event is controlled internally, the On and Off events are produced by external behavior.</p>
<section id="on-event">
<h5>On event<a class="headerlink" href="#on-event" title="Permalink to this heading"></a></h5>
<p>The On event lets the Light LC Server know that there is activity in the room.
It can be generated by light switches and sensors.</p>
<ul class="simple">
<li><p>Light switches can implement one of the following models to send On messages that turn the Light LC Server on:</p>
<ul>
<li><p>The <a class="reference internal" href="gen_onoff_cli.html#bt-mesh-onoff-cli-readme"><span class="std std-ref">Generic OnOff Client</span></a> model – which should publish to the Light LC Server’s extended Generic OnOff Server model.</p></li>
<li><p>The <a class="reference internal" href="light_ctrl_cli.html#bt-mesh-light-ctrl-cli-readme"><span class="std std-ref">Light Lightness Control Client</span></a> model – which should publish Light OnOff Set messages to the Light LC Server.</p></li>
</ul>
</li>
<li><p>Occupancy sensors can also trigger the On event, depending on the current state and occupancy mode:</p>
<ul>
<li><p>If the occupancy mode is enabled, sensor readings that indicate activity can trigger an On event at any time.</p></li>
<li><p>If the occupancy mode is disabled, sensors cannot turn the lights on, but they will still prevent lights from turning off.</p></li>
</ul>
</li>
</ul>
<p>The following sensor types can also trigger the On event:</p>
<dl class="simple">
<dt>Motion sensed - <a class="reference internal" href="sensor_types.html#c.bt_mesh_sensor_motion_sensed" title="bt_mesh_sensor_motion_sensed"><code class="xref c c-var docutils literal notranslate"><span class="pre">bt_mesh_sensor_motion_sensed</span></code></a></dt><dd><p>Any sensor value higher than 0 triggers an On event in the Light LC Server state machine.
Messages with a value of 0 are ignored.</p>
</dd>
<dt>People count - <a class="reference internal" href="sensor_types.html#c.bt_mesh_sensor_people_count" title="bt_mesh_sensor_people_count"><code class="xref c c-var docutils literal notranslate"><span class="pre">bt_mesh_sensor_people_count</span></code></a></dt><dd><p>Any sensor value higher than <code class="docutils literal notranslate"><span class="pre">0</span></code> triggers an On event in the Light LC Server state machine.
Messages with a value of <code class="docutils literal notranslate"><span class="pre">0</span></code> are ignored.</p>
</dd>
<dt>Presence detected - <a class="reference internal" href="sensor_types.html#c.bt_mesh_sensor_presence_detected" title="bt_mesh_sensor_presence_detected"><code class="xref c c-var docutils literal notranslate"><span class="pre">bt_mesh_sensor_presence_detected</span></code></a></dt><dd><p>Messages with a <code class="docutils literal notranslate"><span class="pre">true</span></code> value triggers an On event in the Light LC Server state machine.
Messages with a <code class="docutils literal notranslate"><span class="pre">false</span></code> value are ignored.</p>
</dd>
<dt>Time since motion sensed - <a class="reference internal" href="sensor_types.html#c.bt_mesh_sensor_time_since_motion_sensed" title="bt_mesh_sensor_time_since_motion_sensed"><code class="xref c c-var docutils literal notranslate"><span class="pre">bt_mesh_sensor_time_since_motion_sensed</span></code></a></dt><dd><p>When the sensor’s <em>Time since motion sensed</em> value is lower than the Light LC Server’s occupancy delay, the Light LC Server starts a timer that expires at the time equal to <em>Motion sensed</em> plus <em>occupancy delay</em>.
When this timer expires, an On event is generated.</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Only sensors reporting the <em>Time since motion sensed</em> type will be affected by the occupancy delay.
Other sensor triggers are always instantaneous.</p>
</div>
</section>
<section id="off-event">
<h5>Off event<a class="headerlink" href="#off-event" title="Permalink to this heading"></a></h5>
<p>The Off event can only be generated by a light switch being turned off.
It moves the Light LC Server into Standby, transitioning from the previous light level with the manual mode Standby fade time (<a class="reference internal" href="light_ctrl.html#c.bt_mesh_light_ctrl_prop.BT_MESH_LIGHT_CTRL_PROP_TIME_FADE_STANDBY_MANUAL" title="BT_MESH_LIGHT_CTRL_PROP_TIME_FADE_STANDBY_MANUAL"><code class="xref c c-enumerator docutils literal notranslate"><span class="pre">BT_MESH_LIGHT_CTRL_PROP_TIME_FADE_STANDBY_MANUAL</span></code></a>).</p>
<p>The Off event puts the Light LC Server into manual mode, which disables sensor input until the manual mode timeout (<code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_BT_MESH_LIGHT_CTRL_SRV_TIME_MANUAL</span></code>) expires.
This prevents the lights from turning back on by the movement of the person that presses the light switch.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Unlike other timing parameters, the manual mode timeout is proprietary and cannot be reconfigured at runtime by other models in the mesh network.</p>
</div>
<p>Light switches can implement one of the following clients to send Off messages that turn the Light LC Server on:</p>
<ul class="simple">
<li><p><a class="reference internal" href="gen_onoff_cli.html#bt-mesh-onoff-cli-readme"><span class="std std-ref">Generic OnOff Client</span></a> - This model should publish to the Light LC Server’s extended Generic OnOff Server model.</p></li>
<li><p><a class="reference internal" href="light_ctrl_cli.html#bt-mesh-light-ctrl-cli-readme"><span class="std std-ref">Light Lightness Control Client</span></a> - This model should publish Light OnOff Set messages to the Light LC Server.</p></li>
</ul>
<p>If a Timeout transition from Prolong to Standby is already in progress, the Light LC Server will check whether the remaining transition time is shorter than the Off event fade time and will execute whichever is the fastest.</p>
</section>
</section>
<section id="state-machine-configuration">
<h4>State machine configuration<a class="headerlink" href="#state-machine-configuration" title="Permalink to this heading"></a></h4>
<p>Both the timing and output levels are configurable at compile time and at runtime:</p>
<ul class="simple">
<li><p>The compile time configuration is done through the Light Control Server Kconfig menu options.</p></li>
<li><p>The runtime configuration must be done by a Light Control Client model instance through the Light Lightness Controller Setup Server.</p></li>
</ul>
<section id="timing-parameters">
<h5>Timing parameters<a class="headerlink" href="#timing-parameters" title="Permalink to this heading"></a></h5>
<p>This section lists compile and runtime options to be used when setting timing parameters.</p>
<dl class="simple">
<dt>Delay from occupancy detected until light turns on</dt><dd><ul class="simple">
<li><p>Compile time: <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_BT_MESH_LIGHT_CTRL_SRV_OCCUPANCY_DELAY</span></code></p></li>
<li><p>Runtime: <a class="reference internal" href="light_ctrl.html#c.bt_mesh_light_ctrl_prop.BT_MESH_LIGHT_CTRL_PROP_TIME_OCCUPANCY_DELAY" title="BT_MESH_LIGHT_CTRL_PROP_TIME_OCCUPANCY_DELAY"><code class="xref c c-enumerator docutils literal notranslate"><span class="pre">BT_MESH_LIGHT_CTRL_PROP_TIME_OCCUPANCY_DELAY</span></code></a></p></li>
</ul>
</dd>
<dt>Transition time to On state</dt><dd><ul class="simple">
<li><p>Compile time: <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_BT_MESH_LIGHT_CTRL_SRV_TIME_FADE_ON</span></code></p></li>
<li><p>Runtime: <a class="reference internal" href="light_ctrl.html#c.bt_mesh_light_ctrl_prop.BT_MESH_LIGHT_CTRL_PROP_TIME_FADE_ON" title="BT_MESH_LIGHT_CTRL_PROP_TIME_FADE_ON"><code class="xref c c-enumerator docutils literal notranslate"><span class="pre">BT_MESH_LIGHT_CTRL_PROP_TIME_FADE_ON</span></code></a></p></li>
</ul>
</dd>
<dt>Time in On state</dt><dd><ul class="simple">
<li><p>Compile time: <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_BT_MESH_LIGHT_CTRL_SRV_TIME_ON</span></code></p></li>
<li><p>Runtime: <a class="reference internal" href="light_ctrl.html#c.bt_mesh_light_ctrl_prop.BT_MESH_LIGHT_CTRL_PROP_TIME_ON" title="BT_MESH_LIGHT_CTRL_PROP_TIME_ON"><code class="xref c c-enumerator docutils literal notranslate"><span class="pre">BT_MESH_LIGHT_CTRL_PROP_TIME_ON</span></code></a></p></li>
</ul>
</dd>
<dt>Transition time to Prolong state</dt><dd><ul class="simple">
<li><p>Compile time: <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_BT_MESH_LIGHT_CTRL_SRV_TIME_FADE_PROLONG</span></code></p></li>
<li><p>Runtime: <a class="reference internal" href="light_ctrl.html#c.bt_mesh_light_ctrl_prop.BT_MESH_LIGHT_CTRL_PROP_TIME_FADE_PROLONG" title="BT_MESH_LIGHT_CTRL_PROP_TIME_FADE_PROLONG"><code class="xref c c-enumerator docutils literal notranslate"><span class="pre">BT_MESH_LIGHT_CTRL_PROP_TIME_FADE_PROLONG</span></code></a></p></li>
</ul>
</dd>
<dt>Time in Prolong state</dt><dd><ul class="simple">
<li><p>Compile time: <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_BT_MESH_LIGHT_CTRL_SRV_TIME_PROLONG</span></code></p></li>
<li><p>Runtime: <a class="reference internal" href="light_ctrl.html#c.bt_mesh_light_ctrl_prop.BT_MESH_LIGHT_CTRL_PROP_TIME_PROLONG" title="BT_MESH_LIGHT_CTRL_PROP_TIME_PROLONG"><code class="xref c c-enumerator docutils literal notranslate"><span class="pre">BT_MESH_LIGHT_CTRL_PROP_TIME_PROLONG</span></code></a></p></li>
</ul>
</dd>
<dt>Transition time to Standby state (in auto mode)</dt><dd><ul class="simple">
<li><p>Compile time: <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_BT_MESH_LIGHT_CTRL_SRV_TIME_FADE_STANDBY_AUTO</span></code></p></li>
<li><p>Runtime: <a class="reference internal" href="light_ctrl.html#c.bt_mesh_light_ctrl_prop.BT_MESH_LIGHT_CTRL_PROP_TIME_FADE_STANDBY_AUTO" title="BT_MESH_LIGHT_CTRL_PROP_TIME_FADE_STANDBY_AUTO"><code class="xref c c-enumerator docutils literal notranslate"><span class="pre">BT_MESH_LIGHT_CTRL_PROP_TIME_FADE_STANDBY_AUTO</span></code></a></p></li>
</ul>
</dd>
<dt>Transition time to Standby state (in manual mode)</dt><dd><ul class="simple">
<li><p>Compile time: <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_BT_MESH_LIGHT_CTRL_SRV_TIME_FADE_STANDBY_MANUAL</span></code></p></li>
<li><p>Runtime: <a class="reference internal" href="light_ctrl.html#c.bt_mesh_light_ctrl_prop.BT_MESH_LIGHT_CTRL_PROP_TIME_FADE_STANDBY_MANUAL" title="BT_MESH_LIGHT_CTRL_PROP_TIME_FADE_STANDBY_MANUAL"><code class="xref c c-enumerator docutils literal notranslate"><span class="pre">BT_MESH_LIGHT_CTRL_PROP_TIME_FADE_STANDBY_MANUAL</span></code></a></p></li>
</ul>
</dd>
<dt>Manual mode timeout</dt><dd><ul class="simple">
<li><p>Compile time: <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_BT_MESH_LIGHT_CTRL_SRV_TIME_MANUAL</span></code></p></li>
<li><p>No runtime option available.</p></li>
</ul>
</dd>
</dl>
</section>
<section id="output-parameters">
<h5>Output parameters<a class="headerlink" href="#output-parameters" title="Permalink to this heading"></a></h5>
<p>This section lists compile and runtime options to be used when setting output parameters.</p>
<dl class="simple">
<dt>On state light level</dt><dd><ul class="simple">
<li><p>Compile time: <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_BT_MESH_LIGHT_CTRL_SRV_LVL_ON</span></code></p></li>
<li><p>Runtime: <code class="xref c c-enumerator docutils literal notranslate"><span class="pre">BT_MESH_LIGHT_CTRL_LIGHTNESS_ON</span></code></p></li>
</ul>
</dd>
<dt>Prolong state light level</dt><dd><ul class="simple">
<li><p>Compile time: <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_BT_MESH_LIGHT_CTRL_SRV_LVL_PROLONG</span></code></p></li>
<li><p>Runtime: <code class="xref c c-enumerator docutils literal notranslate"><span class="pre">BT_MESH_LIGHT_CTRL_LIGHTNESS_PROLONG</span></code></p></li>
</ul>
</dd>
<dt>Standby state light level</dt><dd><ul class="simple">
<li><p>Compile time: <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_BT_MESH_LIGHT_CTRL_SRV_LVL_STANDBY</span></code></p></li>
<li><p>Runtime: <code class="xref c c-enumerator docutils literal notranslate"><span class="pre">BT_MESH_LIGHT_CTRL_LIGHTNESS_STANDBY</span></code></p></li>
</ul>
</dd>
<dt>On state target illuminance</dt><dd><ul class="simple">
<li><p>Compile time: <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_BT_MESH_LIGHT_CTRL_SRV_REG_LUX_ON</span></code></p></li>
<li><p>Runtime: <a class="reference internal" href="light_ctrl.html#c.bt_mesh_light_ctrl_prop.BT_MESH_LIGHT_CTRL_PROP_ILLUMINANCE_ON" title="BT_MESH_LIGHT_CTRL_PROP_ILLUMINANCE_ON"><code class="xref c c-enumerator docutils literal notranslate"><span class="pre">BT_MESH_LIGHT_CTRL_PROP_ILLUMINANCE_ON</span></code></a></p></li>
</ul>
</dd>
<dt>Prolong state target illuminance</dt><dd><ul class="simple">
<li><p>Compile time: <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_BT_MESH_LIGHT_CTRL_SRV_REG_LUX_PROLONG</span></code></p></li>
<li><p>Runtime: <a class="reference internal" href="light_ctrl.html#c.bt_mesh_light_ctrl_prop.BT_MESH_LIGHT_CTRL_PROP_ILLUMINANCE_PROLONG" title="BT_MESH_LIGHT_CTRL_PROP_ILLUMINANCE_PROLONG"><code class="xref c c-enumerator docutils literal notranslate"><span class="pre">BT_MESH_LIGHT_CTRL_PROP_ILLUMINANCE_PROLONG</span></code></a></p></li>
</ul>
</dd>
<dt>Standby state target illuminance</dt><dd><ul class="simple">
<li><p>Compile time: <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_BT_MESH_LIGHT_CTRL_SRV_REG_LUX_STANDBY</span></code></p></li>
<li><p>Runtime: <a class="reference internal" href="light_ctrl.html#c.bt_mesh_light_ctrl_prop.BT_MESH_LIGHT_CTRL_PROP_ILLUMINANCE_STANDBY" title="BT_MESH_LIGHT_CTRL_PROP_ILLUMINANCE_STANDBY"><code class="xref c c-enumerator docutils literal notranslate"><span class="pre">BT_MESH_LIGHT_CTRL_PROP_ILLUMINANCE_STANDBY</span></code></a></p></li>
</ul>
</dd>
</dl>
</section>
</section>
</section>
<section id="illuminance-regulator">
<span id="bt-mesh-light-ctrl-srv-reg-readme"></span><h3><a class="toc-backref" href="#id15">Illuminance regulator</a><a class="headerlink" href="#illuminance-regulator" title="Permalink to this heading"></a></h3>
<p>The illuminance regulator complements the light level state machine by adding an ambient illuminance sensor feedback loop.
This allows the Light Lightness Server to adjust its output level that is based on the room’s ambient light, and as a result conserve energy and achieve more consistent light levels.</p>
<figure class="align-default" id="id10">
<img alt="Illuminance regulator" src="../../../_images/bt_mesh_light_ctrl_reg.svg" /><figcaption>
<p><span class="caption-text">Illuminance regulator</span><a class="headerlink" href="#id10" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>The illuminance regulator takes the specified target illuminance level as the reference level and compares it to sensor data from an external illuminance sensor.
The inputs are compared to establish an error for the regulator, which the regulator tries to minimize.
The regulator contains a proportional (P) and an integral (I) component whose outputs are summarized to a light level output.</p>
<p>The illuminance regulator’s output level only comes into effect if the required output level is higher than the state machine’s output light level.
To get full benefit of the regulator, the state machine’s light level output should generally be configured to a lower value than desired, while keeping the target illuminance levels high.
This allows the regulator to conserve energy by taking advantage of the room’s ambient lighting.</p>
<p>The Light LC Server uses <a class="reference internal" href="light_ctrl_reg.html#bt-mesh-light-ctrl-reg-readme"><span class="std std-ref">Illuminance regulator interface</span></a> to interact with the illuminance regulator.
If the regulator functionality is enabled and no regulator is specified (using <a class="reference internal" href="#c.BT_MESH_LIGHT_CTRL_SRV_INIT_WITH_REG" title="BT_MESH_LIGHT_CTRL_SRV_INIT_WITH_REG"><code class="xref c c-macro docutils literal notranslate"><span class="pre">BT_MESH_LIGHT_CTRL_SRV_INIT_WITH_REG</span></code></a>), the server will by default use the <a class="reference internal" href="light_ctrl_reg_spec.html#bt-mesh-light-ctrl-reg-spec-readme"><span class="std std-ref">Specification-defined illuminance regulator</span></a>.</p>
<section id="sensor-input">
<h4>Sensor input<a class="headerlink" href="#sensor-input" title="Permalink to this heading"></a></h4>
<p>The regulator relies on regular sensor input data to function correctly.
This sensor data must come from an external <a class="reference internal" href="sensor_srv.html#bt-mesh-sensor-srv-readme"><span class="std std-ref">Sensor Server</span></a> model and report the ambient light level with the <a class="reference internal" href="sensor_types.html#c.bt_mesh_sensor_present_amb_light_level" title="bt_mesh_sensor_present_amb_light_level"><code class="xref c c-var docutils literal notranslate"><span class="pre">bt_mesh_sensor_present_amb_light_level</span></code></a> sensor type.
The Sensor Server should publish its sensor readings to an address the Light LC Server is subscribed to, using a common application key.</p>
<p>The Light LC Server will process all incoming sensor messages and pass the reported ambient light level to the regulator.
The regulator depends on frequent readings from the sensor server to provide a stable output for the Light Lightness Server.
If the sensor reports are too slow, the regulator might oscillate as it attempts to compensate for outdated feedback.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Use the Sensor <a class="reference internal" href="sensor.html#bt-mesh-sensor-publishing-delta"><span class="std std-ref">Delta threshold</span></a> feature for ambient light sensors feeding the regulator.
This makes the sensor send frequent reports when the regulator is compensating for large errors, while keeping the mesh traffic low in stable periods.</p>
</div>
<p>The Sensor Server may be instantiated on the same mesh node as the Light LC Server, or on a different mesh node in the same area.
The regulator performance depends heavily on the sensor’s placement and sensitivity.
In general, ambient light sensor devices should be placed in a way that allows their light sensor to capture the human perception of the room’s light level as closely as possible.</p>
</section>
</section>
</section>
<section id="states">
<h2><a class="toc-backref" href="#id16">States</a><a class="headerlink" href="#states" title="Permalink to this heading"></a></h2>
<p>Not to be confused with the <a class="reference internal" href="#bt-mesh-light-ctrl-srv-composition-state-machine"><span class="std std-ref">state machine states</span></a>, the Light LC Server’s states represent its current mode of operation and configuration.</p>
<dl class="simple">
<dt>Mode: <code class="docutils literal notranslate"><span class="pre">bool</span></code></dt><dd><p>Enables or disables the Light LC Server.
When disabled, the controlled Light Lightness Server operates independently.</p>
</dd>
<dt>Occupancy mode: <code class="docutils literal notranslate"><span class="pre">bool</span></code></dt><dd><p>The occupancy mode controls whether sensor activity can turn the lights on.
If disabled, motion and occupancy sensor messages may only prevent the lights from turning off, and a light switch is required to turn them on.</p>
</dd>
<dt>Light OnOff: <code class="docutils literal notranslate"><span class="pre">bool</span></code></dt><dd><p>When set, the Light OnOff state may trigger transactions in the lightness state machine.
When read, the Light OnOff state indicates whether the lights are turned off (in the Standby state) or on (in the On state or the Prolong state).</p>
</dd>
<dt>Properties</dt><dd><p>The Light Control Properties are used to configure the Light LC Server behavior.
See <a class="reference internal" href="light_ctrl.html#c.bt_mesh_light_ctrl_prop" title="bt_mesh_light_ctrl_prop"><code class="xref c c-enum docutils literal notranslate"><span class="pre">bt_mesh_light_ctrl_prop</span></code></a> for a list of supported properties and their representation.</p>
</dd>
</dl>
</section>
<section id="extended-models">
<h2><a class="toc-backref" href="#id17">Extended models</a><a class="headerlink" href="#extended-models" title="Permalink to this heading"></a></h2>
<p>The Light LC Server extends the following models:</p>
<ul class="simple">
<li><p><a class="reference internal" href="gen_onoff_srv.html#bt-mesh-onoff-srv-readme"><span class="std std-ref">Generic OnOff Server</span></a></p></li>
</ul>
<p>Additionally, it requires a <a class="reference internal" href="lightness_srv.html#bt-mesh-lightness-srv-readme"><span class="std std-ref">Light Lightness Server</span></a> it can control, instantiated in a different element.
See the <a class="reference internal" href="#bt-mesh-light-ctrl-srv-composition"><span class="std std-ref">Composition data structure</span></a> section for details.</p>
</section>
<section id="persistent-storage">
<h2><a class="toc-backref" href="#id18">Persistent Storage</a><a class="headerlink" href="#persistent-storage" title="Permalink to this heading"></a></h2>
<p>If <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_BT_SETTINGS</span></code> is enabled, the Light LC Server stores all its states persistently using a configurable storage delay to stagger storing.
See <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_BT_MESH_MODEL_SRV_STORE_TIMEOUT</span></code>.</p>
<p>Changes to the configuration properties are stored and restored on power-up, so the compile time configuration is only valid the first time the device powers up, until the configuration is changed.</p>
<section id="power-up-behavior">
<h3><a class="toc-backref" href="#id19">Power-up behavior</a><a class="headerlink" href="#power-up-behavior" title="Permalink to this heading"></a></h3>
<p>When powering up, the Light LC Server behavior depends on the controlled Light Lightness Server’s extended <a class="reference internal" href="gen_ponoff_srv.html#bt-mesh-ponoff-srv-readme"><span class="std std-ref">Generic Power OnOff Server</span></a>’s state:</p>
<ul class="simple">
<li><p>On Power Up is <a class="reference internal" href="gen_ponoff.html#c.bt_mesh_on_power_up.BT_MESH_ON_POWER_UP_OFF" title="BT_MESH_ON_POWER_UP_OFF"><code class="xref c c-enumerator docutils literal notranslate"><span class="pre">BT_MESH_ON_POWER_UP_OFF</span></code></a> - The Light LC Server is disabled, and the Light Lightness Server remains off.</p></li>
<li><p>On Power Up is <a class="reference internal" href="gen_ponoff.html#c.bt_mesh_on_power_up.BT_MESH_ON_POWER_UP_ON" title="BT_MESH_ON_POWER_UP_ON"><code class="xref c c-enumerator docutils literal notranslate"><span class="pre">BT_MESH_ON_POWER_UP_ON</span></code></a> - The Light LC Server is disabled, and the Light Lightness Server’s Light level is set to its default value.</p></li>
<li><p>On Power Up is <a class="reference internal" href="gen_ponoff.html#c.bt_mesh_on_power_up.BT_MESH_ON_POWER_UP_RESTORE" title="BT_MESH_ON_POWER_UP_RESTORE"><code class="xref c c-enumerator docutils literal notranslate"><span class="pre">BT_MESH_ON_POWER_UP_RESTORE</span></code></a> - The Light LC Server is enabled and takes control of the Lightness Server.
If the last known value of the Light OnOff state was On, the Light LC Server triggers a transition to the On state.</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The Light LC Server is only re-enabled on startup if the Light Lightness Server’s extended Generic Power OnOff Server is in the restore mode.</p>
</div>
</section>
</section>
<section id="api-documentation">
<h2><a class="toc-backref" href="#id20">API documentation</a><a class="headerlink" href="#api-documentation" title="Permalink to this heading"></a></h2>
<div class="line-block">
<div class="line">Header file: <code class="file docutils literal notranslate"><span class="pre">include/bluetooth/mesh/light_ctrl_srv.h</span></code></div>
<div class="line">Source file: <code class="file docutils literal notranslate"><span class="pre">subsys/bluetooth/mesh/light_ctrl_srv.c</span></code></div>
</div>
<dl>
<dt class="sig sig-object cpp">
<span class="target" id="group__bt__mesh__light__ctrl__srv"></span><em><span class="pre">group</span></em> <span class="sig-name descname"><span class="pre">bt_mesh_light_ctrl_srv</span></span></dt>
<dd><p>Light Lightness Control Server model API. </p>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-defines">Defines</p>
<dl class="c macro">
<dt class="sig sig-object c" id="c.BT_MESH_LIGHT_CTRL_SRV_INIT_WITH_REG">
<span class="target" id="group__bt__mesh__light__ctrl__srv_1ga5cb6d8906cdd6fa887e348b28dee4697"></span><span class="sig-name descname"><span class="n"><span class="pre">BT_MESH_LIGHT_CTRL_SRV_INIT_WITH_REG</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">_lightness_srv</span></span>, <span class="n"><span class="pre">_reg</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.BT_MESH_LIGHT_CTRL_SRV_INIT_WITH_REG" title="Permalink to this definition"></a><br /></dt>
<dd><p>Initialization parameters for <a class="reference internal" href="#group__bt__mesh__light__ctrl__srv"><span class="std std-ref">Light Lightness Control Server</span></a> with custom regulator. </p>
<p>Only available if<span> <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_BT_MESH_LIGHT_CTRL_SRV_REG</span></code> </span> is selected.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>_lightness_srv</strong> – <strong>[in]</strong> Pointer to the <a class="reference internal" href="lightness_srv.html#group__bt__mesh__lightness__srv"><span class="std std-ref">Light Lightness Server model</span></a> this server controls. </p></li>
<li><p><strong>_reg</strong> – <strong>[in]</strong> Pointer to the <a class="reference internal" href="light_ctrl_reg.html#group__bt__mesh__light__ctrl__reg"><span class="std std-ref">Illuminance regulator</span></a> to use. </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c macro">
<dt class="sig sig-object c" id="c.BT_MESH_LIGHT_CTRL_SRV_INIT">
<span class="target" id="group__bt__mesh__light__ctrl__srv_1ga3f8a8e78a86277a5a98eb288b54e081b"></span><span class="sig-name descname"><span class="n"><span class="pre">BT_MESH_LIGHT_CTRL_SRV_INIT</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">_lightness_srv</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.BT_MESH_LIGHT_CTRL_SRV_INIT" title="Permalink to this definition"></a><br /></dt>
<dd><p>Initialization parameters for <a class="reference internal" href="#group__bt__mesh__light__ctrl__srv"><span class="std std-ref">Light Lightness Control Server</span></a>. </p>
<p>This will enable the specification-defined regulator if <span> <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_BT_MESH_LIGHT_CTRL_SRV_REG</span></code> </span> and <span> <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_BT_MESH_LIGHT_CTRL_REG_SPEC</span></code> </span> are selected.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>_lightness_srv</strong> – <strong>[in]</strong> Pointer to the <a class="reference internal" href="lightness_srv.html#group__bt__mesh__lightness__srv"><span class="std std-ref">Light Lightness Server model</span></a> this server controls. </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c macro">
<dt class="sig sig-object c" id="c.BT_MESH_MODEL_LIGHT_CTRL_SRV">
<span class="target" id="group__bt__mesh__light__ctrl__srv_1ga58a880f2c9085debeadec225a7a19da3"></span><span class="sig-name descname"><span class="n"><span class="pre">BT_MESH_MODEL_LIGHT_CTRL_SRV</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">_srv</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.BT_MESH_MODEL_LIGHT_CTRL_SRV" title="Permalink to this definition"></a><br /></dt>
<dd><p>Light Lightness model entry. </p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>_srv</strong> – <strong>[in]</strong> Pointer to a <a class="reference internal" href="#group__bt__mesh__light__ctrl__srv"><span class="std std-ref">Light Lightness Control Server</span></a> instance. </p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-enums">Enums</p>
<dl class="c enum">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_srv_state">
<span class="target" id="group__bt__mesh__light__ctrl__srv_1ga5ab0fe016100e77a9caafbbb18912c7d"></span><span class="k"><span class="pre">enum</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">bt_mesh_light_ctrl_srv_state</span></span></span><a class="headerlink" href="#c.bt_mesh_light_ctrl_srv_state" title="Permalink to this definition"></a><br /></dt>
<dd><p>Light Lightness Control Server state </p>
<p><em>Values:</em></p>
<dl class="c enumerator">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_srv_state.LIGHT_CTRL_STATE_STANDBY">
<span class="target" id="group__bt__mesh__light__ctrl__srv_1gga5ab0fe016100e77a9caafbbb18912c7dabbdce276617ba2641d56b7a54a8982a1"></span><span class="k"><span class="pre">enumerator</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">LIGHT_CTRL_STATE_STANDBY</span></span></span><a class="headerlink" href="#c.bt_mesh_light_ctrl_srv_state.LIGHT_CTRL_STATE_STANDBY" title="Permalink to this definition"></a><br /></dt>
<dd><p>Standby state </p>
</dd></dl>

<dl class="c enumerator">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_srv_state.LIGHT_CTRL_STATE_ON">
<span class="target" id="group__bt__mesh__light__ctrl__srv_1gga5ab0fe016100e77a9caafbbb18912c7da9b97b8aaf64f0411de2cba1c803c5588"></span><span class="k"><span class="pre">enumerator</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">LIGHT_CTRL_STATE_ON</span></span></span><a class="headerlink" href="#c.bt_mesh_light_ctrl_srv_state.LIGHT_CTRL_STATE_ON" title="Permalink to this definition"></a><br /></dt>
<dd><p>On state </p>
</dd></dl>

<dl class="c enumerator">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_srv_state.LIGHT_CTRL_STATE_PROLONG">
<span class="target" id="group__bt__mesh__light__ctrl__srv_1gga5ab0fe016100e77a9caafbbb18912c7da95bacece9b3421a815649e0c2e1e771e"></span><span class="k"><span class="pre">enumerator</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">LIGHT_CTRL_STATE_PROLONG</span></span></span><a class="headerlink" href="#c.bt_mesh_light_ctrl_srv_state.LIGHT_CTRL_STATE_PROLONG" title="Permalink to this definition"></a><br /></dt>
<dd><p>Prolong state </p>
</dd></dl>

<dl class="c enumerator">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_srv_state.LIGHT_CTRL_STATE_COUNT">
<span class="target" id="group__bt__mesh__light__ctrl__srv_1gga5ab0fe016100e77a9caafbbb18912c7da1b949044bccfe035bd40661aab31d279"></span><span class="k"><span class="pre">enumerator</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">LIGHT_CTRL_STATE_COUNT</span></span></span><a class="headerlink" href="#c.bt_mesh_light_ctrl_srv_state.LIGHT_CTRL_STATE_COUNT" title="Permalink to this definition"></a><br /></dt>
<dd><p>The number of states. </p>
</dd></dl>

</dd></dl>

</div>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-functions">Functions</p>
<dl class="c function">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_srv_on">
<span class="target" id="group__bt__mesh__light__ctrl__srv_1ga22e6434414814fcb0ee469f41caf275d"></span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">bt_mesh_light_ctrl_srv_on</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.bt_mesh_light_ctrl_srv" title="bt_mesh_light_ctrl_srv"><span class="n"><span class="pre">bt_mesh_light_ctrl_srv</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">srv</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.bt_mesh_light_ctrl_srv_on" title="Permalink to this definition"></a><br /></dt>
<dd><p>Turn the light on. </p>
<p>Instructs the controlled Lightness Server to turn the light on. If the light was already on, the dimming timeout is reset. If the light was in the Prolong state, it’s moved back into the On state.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>srv</strong> – <strong>[in]</strong> Light Lightness Control Server instance.</p></li>
</ul>
</dd>
<dt class="field-even">Return values</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>0</strong> – The Light Lightness Control Server was successfully turned on. </p></li>
<li><p><strong>-EBUSY</strong> – The Light Lightness Control Server is disabled. </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_srv_off">
<span class="target" id="group__bt__mesh__light__ctrl__srv_1ga3224811b702ef0b6066b5d5e529cdeb6"></span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">bt_mesh_light_ctrl_srv_off</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.bt_mesh_light_ctrl_srv" title="bt_mesh_light_ctrl_srv"><span class="n"><span class="pre">bt_mesh_light_ctrl_srv</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">srv</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.bt_mesh_light_ctrl_srv_off" title="Permalink to this definition"></a><br /></dt>
<dd><p>Manually turn the light off. </p>
<p>Instructs the controlled Lightness Server to turn the light off (Standby state). Calling this function temporarily disables occupancy sensor triggering (referred to as “manual mode” in the documentation). The server will remain in manual mode until the manual mode timer expires, see <span> <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_BT_MESH_LIGHT_CTRL_SRV_TIME_MANUAL</span></code> </span>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>srv</strong> – <strong>[in]</strong> Light Lightness Control Server instance.</p></li>
</ul>
</dd>
<dt class="field-even">Return values</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>0</strong> – The Light Lightness Control Server was successfully turned off. </p></li>
<li><p><strong>-EBUSY</strong> – The Light Lightness Control Server is disabled. </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_srv_enable">
<span class="target" id="group__bt__mesh__light__ctrl__srv_1gaa454c6cd9e77aeb1fc8b18ce3a180889"></span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">bt_mesh_light_ctrl_srv_enable</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.bt_mesh_light_ctrl_srv" title="bt_mesh_light_ctrl_srv"><span class="n"><span class="pre">bt_mesh_light_ctrl_srv</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">srv</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.bt_mesh_light_ctrl_srv_enable" title="Permalink to this definition"></a><br /></dt>
<dd><p>Enable the Light Lightness Control Server. </p>
<p>The Server must be enabled to take control of the Lightness Server.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>srv</strong> – <strong>[in]</strong> Light Lightness Control Server instance.</p></li>
</ul>
</dd>
<dt class="field-even">Return values</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>0</strong> – The Light Lightness Control Server was successfully enabled. </p></li>
<li><p><strong>-EALREADY</strong> – The Light Lightness Control Server was already enabled. </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_srv_disable">
<span class="target" id="group__bt__mesh__light__ctrl__srv_1ga91a8835348034a260a76d74a77a8fe63"></span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">bt_mesh_light_ctrl_srv_disable</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.bt_mesh_light_ctrl_srv" title="bt_mesh_light_ctrl_srv"><span class="n"><span class="pre">bt_mesh_light_ctrl_srv</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">srv</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.bt_mesh_light_ctrl_srv_disable" title="Permalink to this definition"></a><br /></dt>
<dd><p>Disable the Light Lightness Control Server. </p>
<p>The server must be enabled to take control of the Lightness Server. Disabling the server disengages the control over the Lightness Server, which will start running as an independent model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>srv</strong> – <strong>[in]</strong> Light Lightness Control Server instance.</p></li>
</ul>
</dd>
<dt class="field-even">Return values</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>0</strong> – The Light Lightness Control Server was successfully enabled. </p></li>
<li><p><strong>-EALREADY</strong> – The Light Lightness Control Server was already enabled. </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_srv_is_on">
<span class="target" id="group__bt__mesh__light__ctrl__srv_1gad2e284e80e64856ca36a8947dd965bc3"></span><span class="kt"><span class="pre">bool</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">bt_mesh_light_ctrl_srv_is_on</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.bt_mesh_light_ctrl_srv" title="bt_mesh_light_ctrl_srv"><span class="n"><span class="pre">bt_mesh_light_ctrl_srv</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">srv</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.bt_mesh_light_ctrl_srv_is_on" title="Permalink to this definition"></a><br /></dt>
<dd><p>Check if the Light Lightness Control Server has turned the light on. </p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>srv</strong> – <strong>[in]</strong> Light Lightness Control Server instance.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>true if the Lightness Server’s light is on because of its binding with the Light Lightness Control Server, false otherwise. </p>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_srv_pub">
<span class="target" id="group__bt__mesh__light__ctrl__srv_1gaaf1177482eba55c8fe4c0cf495598b30"></span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">bt_mesh_light_ctrl_srv_pub</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.bt_mesh_light_ctrl_srv" title="bt_mesh_light_ctrl_srv"><span class="n"><span class="pre">bt_mesh_light_ctrl_srv</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">srv</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">bt_mesh_msg_ctx</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">ctx</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.bt_mesh_light_ctrl_srv_pub" title="Permalink to this definition"></a><br /></dt>
<dd><p>Publish the current OnOff state. </p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>srv</strong> – <strong>[in]</strong> Light Lightness Control Server instance. </p></li>
<li><p><strong>ctx</strong> – <strong>[in]</strong> Message context, or NULL to publish with the configured parameters.</p></li>
</ul>
</dd>
<dt class="field-even">Return values</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>-EADDRNOTAVAIL</strong> – A message context was not provided and publishing is not configured. </p></li>
<li><p><strong>-EAGAIN</strong> – The device has not been provisioned. </p></li>
</ul>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>0 Successfully published the current Light state. </p>
</dd>
</dl>
</dd></dl>

</div>
<dl class="c struct">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_srv_cfg">
<span class="target" id="structbt__mesh__light__ctrl__srv__cfg"></span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">bt_mesh_light_ctrl_srv_cfg</span></span></span><a class="headerlink" href="#c.bt_mesh_light_ctrl_srv_cfg" title="Permalink to this definition"></a><br /></dt>
<dd><div class="docutils container">
<em>#include &lt;light_ctrl_srv.h&gt;</em></div>
<p>Light Lightness Control Server configuration. </p>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-public-members">Public Members</p>
<dl class="c var">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_srv_cfg.occupancy_delay">
<span class="target" id="structbt__mesh__light__ctrl__srv__cfg_1ab4f9bbaad222c3d5d13badc18b839a02"></span><span class="n"><span class="pre">uint32_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">occupancy_delay</span></span></span><a class="headerlink" href="#c.bt_mesh_light_ctrl_srv_cfg.occupancy_delay" title="Permalink to this definition"></a><br /></dt>
<dd><p>Delay from occupancy detected until light turns on. </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_srv_cfg.fade_on">
<span class="target" id="structbt__mesh__light__ctrl__srv__cfg_1a6704b5e114bc6f8ac1c335c0b8fcb494"></span><span class="n"><span class="pre">uint32_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">fade_on</span></span></span><a class="headerlink" href="#c.bt_mesh_light_ctrl_srv_cfg.fade_on" title="Permalink to this definition"></a><br /></dt>
<dd><p>Transition time to On state. </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_srv_cfg.on">
<span class="target" id="structbt__mesh__light__ctrl__srv__cfg_1aea90a818998b74508e2eea077a50151a"></span><span class="n"><span class="pre">uint32_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">on</span></span></span><a class="headerlink" href="#c.bt_mesh_light_ctrl_srv_cfg.on" title="Permalink to this definition"></a><br /></dt>
<dd><p>Time in On state. </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_srv_cfg.fade_prolong">
<span class="target" id="structbt__mesh__light__ctrl__srv__cfg_1a0d486330c60fdf4acff7afd41b6c6edc"></span><span class="n"><span class="pre">uint32_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">fade_prolong</span></span></span><a class="headerlink" href="#c.bt_mesh_light_ctrl_srv_cfg.fade_prolong" title="Permalink to this definition"></a><br /></dt>
<dd><p>Transition time to Prolong state. </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_srv_cfg.prolong">
<span class="target" id="structbt__mesh__light__ctrl__srv__cfg_1a1c0b3e89b341b21016918025a838b772"></span><span class="n"><span class="pre">uint32_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">prolong</span></span></span><a class="headerlink" href="#c.bt_mesh_light_ctrl_srv_cfg.prolong" title="Permalink to this definition"></a><br /></dt>
<dd><p>Time in Prolong state. </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_srv_cfg.fade_standby_auto">
<span class="target" id="structbt__mesh__light__ctrl__srv__cfg_1a02f1e69f39109ec5e14adb07aab3c3e4"></span><span class="n"><span class="pre">uint32_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">fade_standby_auto</span></span></span><a class="headerlink" href="#c.bt_mesh_light_ctrl_srv_cfg.fade_standby_auto" title="Permalink to this definition"></a><br /></dt>
<dd><p>Transition time to Standby state (in auto mode). </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_srv_cfg.fade_standby_manual">
<span class="target" id="structbt__mesh__light__ctrl__srv__cfg_1a8ca9a4034e61dba8fcb0b765e357ca83"></span><span class="n"><span class="pre">uint32_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">fade_standby_manual</span></span></span><a class="headerlink" href="#c.bt_mesh_light_ctrl_srv_cfg.fade_standby_manual" title="Permalink to this definition"></a><br /></dt>
<dd><p>Transition time to Standby state (in manual mode). </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_srv_cfg.light">
<span class="target" id="structbt__mesh__light__ctrl__srv__cfg_1af55b5c1be98a4ca4c400cde65167a05b"></span><span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">light</span></span></span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#c.bt_mesh_light_ctrl_srv_state.LIGHT_CTRL_STATE_COUNT" title="LIGHT_CTRL_STATE_COUNT"><span class="n"><span class="pre">LIGHT_CTRL_STATE_COUNT</span></span></a><span class="p"><span class="pre">]</span></span><a class="headerlink" href="#c.bt_mesh_light_ctrl_srv_cfg.light" title="Permalink to this definition"></a><br /></dt>
<dd><p>State-wise light levels. </p>
</dd></dl>

</div>
</dd></dl>

<dl class="c struct">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_srv">
<span class="target" id="structbt__mesh__light__ctrl__srv"></span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">bt_mesh_light_ctrl_srv</span></span></span><a class="headerlink" href="#c.bt_mesh_light_ctrl_srv" title="Permalink to this definition"></a><br /></dt>
<dd><div class="docutils container">
<em>#include &lt;light_ctrl_srv.h&gt;</em></div>
<p>Light Lightness Control Server instance. </p>
<p>Should be initialized with <a class="reference internal" href="#group__bt__mesh__light__ctrl__srv_1ga3f8a8e78a86277a5a98eb288b54e081b"><span class="std std-ref">BT_MESH_LIGHT_CTRL_SRV_INIT</span></a>. </p>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-public-members">Public Members</p>
<dl class="c var">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_srv.state">
<span class="target" id="structbt__mesh__light__ctrl__srv_1a104871501b1b9f87a99de69834119386"></span><span class="k"><span class="pre">enum</span></span><span class="w"> </span><a class="reference internal" href="#c.bt_mesh_light_ctrl_srv_state" title="bt_mesh_light_ctrl_srv_state"><span class="n"><span class="pre">bt_mesh_light_ctrl_srv_state</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">state</span></span></span><a class="headerlink" href="#c.bt_mesh_light_ctrl_srv.state" title="Permalink to this definition"></a><br /></dt>
<dd><p>Current control state </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_srv.flags">
<span class="target" id="structbt__mesh__light__ctrl__srv_1a661ce8fefeef0709ba3e8efa496da2e8"></span><span class="n"><span class="pre">atomic_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">flags</span></span></span><a class="headerlink" href="#c.bt_mesh_light_ctrl_srv.flags" title="Permalink to this definition"></a><br /></dt>
<dd><p>Internal flag field </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_srv.initial_light">
<span class="target" id="structbt__mesh__light__ctrl__srv_1a407c350e27e248f1131ea4cef4009575"></span><span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">initial_light</span></span></span><a class="headerlink" href="#c.bt_mesh_light_ctrl_srv.initial_light" title="Permalink to this definition"></a><br /></dt>
<dd><p>Initial light level </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_srv.initial_lux">
<span class="target" id="structbt__mesh__light__ctrl__srv_1a14422600e565bc0e3cd7e6e32236695b"></span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">sensor_value</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">initial_lux</span></span></span><a class="headerlink" href="#c.bt_mesh_light_ctrl_srv.initial_lux" title="Permalink to this definition"></a><br /></dt>
<dd><p>Initial illumination level </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_srv.duration">
<span class="target" id="structbt__mesh__light__ctrl__srv_1a28ada13234b9ec583f580ee32ca27471"></span><span class="n"><span class="pre">uint32_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">duration</span></span></span><a class="headerlink" href="#c.bt_mesh_light_ctrl_srv.duration" title="Permalink to this definition"></a><br /></dt>
<dd><p>Fade duration </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_srv.fade">
<span class="target" id="structbt__mesh__light__ctrl__srv_1acbdee87528cacc99cda6c41f72f46f9a"></span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.bt_mesh_light_ctrl_srv" title="bt_mesh_light_ctrl_srv"><span class="n"><span class="pre">bt_mesh_light_ctrl_srv</span></span></a><span class="p"><span class="pre">.</span></span><span class="n"><span class="pre">[anonymous]</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">fade</span></span></span><a class="headerlink" href="#c.bt_mesh_light_ctrl_srv.fade" title="Permalink to this definition"></a><br /></dt>
<dd><p>Parameters for the start of current state </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_srv.timer">
<span class="target" id="structbt__mesh__light__ctrl__srv_1ae6315aee743a701603a72e841810365a"></span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">k_work_delayable</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">timer</span></span></span><a class="headerlink" href="#c.bt_mesh_light_ctrl_srv.timer" title="Permalink to this definition"></a><br /></dt>
<dd><p>State timer </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_srv.action_delay">
<span class="target" id="structbt__mesh__light__ctrl__srv_1a4c26c1fe67a97162330493f1363d3994"></span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">k_work_delayable</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">action_delay</span></span></span><a class="headerlink" href="#c.bt_mesh_light_ctrl_srv.action_delay" title="Permalink to this definition"></a><br /></dt>
<dd><p>Timer for delayed action </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_srv.cfg">
<span class="target" id="structbt__mesh__light__ctrl__srv_1ad35c3c58d3575c1cc70b5b41aadfe8ee"></span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.bt_mesh_light_ctrl_srv_cfg" title="bt_mesh_light_ctrl_srv_cfg"><span class="n"><span class="pre">bt_mesh_light_ctrl_srv_cfg</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">cfg</span></span></span><a class="headerlink" href="#c.bt_mesh_light_ctrl_srv.cfg" title="Permalink to this definition"></a><br /></dt>
<dd><p>Configuration parameters </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_srv.pub">
<span class="target" id="structbt__mesh__light__ctrl__srv_1abc539627609ba280825ea1691a26bca8"></span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">bt_mesh_model_pub</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">pub</span></span></span><a class="headerlink" href="#c.bt_mesh_light_ctrl_srv.pub" title="Permalink to this definition"></a><br /></dt>
<dd><p>Publish parameters </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_srv.resume">
<span class="target" id="structbt__mesh__light__ctrl__srv_1aa40a05a4b993bc989d61f75939585e9e"></span><span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">resume</span></span></span><a class="headerlink" href="#c.bt_mesh_light_ctrl_srv.resume" title="Permalink to this definition"></a><br /></dt>
<dd><p>Resume control timeout (in seconds) </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_srv.setup_pub">
<span class="target" id="structbt__mesh__light__ctrl__srv_1a4c344ee7944123cae10a05ecf1df4637"></span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">bt_mesh_model_pub</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">setup_pub</span></span></span><a class="headerlink" href="#c.bt_mesh_light_ctrl_srv.setup_pub" title="Permalink to this definition"></a><br /></dt>
<dd><p>Setup model publish parameters </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_srv.lightness">
<span class="target" id="structbt__mesh__light__ctrl__srv_1a9b988c131bffcc32fe0c82be09fd7f68"></span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="lightness_srv.html#c.bt_mesh_lightness_srv" title="bt_mesh_lightness_srv"><span class="n"><span class="pre">bt_mesh_lightness_srv</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">lightness</span></span></span><a class="headerlink" href="#c.bt_mesh_light_ctrl_srv.lightness" title="Permalink to this definition"></a><br /></dt>
<dd><p>Lightness server instance </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_srv.onoff">
<span class="target" id="structbt__mesh__light__ctrl__srv_1a3b20163d2ded5efdd011d3cb96cc38cf"></span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="gen_onoff_srv.html#c.bt_mesh_onoff_srv" title="bt_mesh_onoff_srv"><span class="n"><span class="pre">bt_mesh_onoff_srv</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">onoff</span></span></span><a class="headerlink" href="#c.bt_mesh_light_ctrl_srv.onoff" title="Permalink to this definition"></a><br /></dt>
<dd><p>Extended Generic OnOff server </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_srv.tid">
<span class="target" id="structbt__mesh__light__ctrl__srv_1a566d25d7381c32cd8b254ca80f688d38"></span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="model_types.html#c.bt_mesh_tid_ctx" title="bt_mesh_tid_ctx"><span class="n"><span class="pre">bt_mesh_tid_ctx</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tid</span></span></span><a class="headerlink" href="#c.bt_mesh_light_ctrl_srv.tid" title="Permalink to this definition"></a><br /></dt>
<dd><p>Transaction ID tracking context </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_srv.model">
<span class="target" id="structbt__mesh__light__ctrl__srv_1a584ad009a765f5be270164cd1eab4ba8"></span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">bt_mesh_model</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">model</span></span></span><a class="headerlink" href="#c.bt_mesh_light_ctrl_srv.model" title="Permalink to this definition"></a><br /></dt>
<dd><p>Composition data server model instance </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.bt_mesh_light_ctrl_srv.setup_srv">
<span class="target" id="structbt__mesh__light__ctrl__srv_1a2418a130dd666d7c9de3384859ddbd59"></span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">bt_mesh_model</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">setup_srv</span></span></span><a class="headerlink" href="#c.bt_mesh_light_ctrl_srv.setup_srv" title="Permalink to this definition"></a><br /></dt>
<dd><p>Composition data setup server model instance </p>
</dd></dl>

</div>
</dd></dl>

</dd></dl>

</section>
</section>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="light_ctrl_cli.html" class="btn btn-neutral float-right" title="Light Lightness Control Client" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="light_ctrl.html" class="btn btn-neutral" title="Light Lightness Control models" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">

<table>
<tr>
<td>
    <p>
        &copy; Copyright 2019-2023, Nordic Semiconductor.
      Last updated on Mar 20, 2023.

    </p>
</td>
<td id="nordiclogo">
  <a href="https://www.nordicsemi.com/"><img src="../../../_static/images/nordic-logo.png" border="0"/></a>
</td>
</tr>
</table>
  </div> 


</footer>

<div id="scroll-container">
  <button type="button" id="scroll-btn" class="btn">
    <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="#fff"/></svg>
  </button>
</div>

<script>
  const scrollBtn = document.querySelector("#scroll-btn");

  document.addEventListener("scroll", () => {
    if (window.scrollY > 400) {
          scrollBtn.style.visibility = "visible";
      } else {
          scrollBtn.style.visibility = "hidden";
      }
  });

  scrollBtn.addEventListener("click", () => {
      window.scrollTo({ top: 0, behavior: "smooth" });
  });
</script>
        </div>
      </div>
    </section>
  </div>
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> nRF Connect SDK</span>
       <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      
      <div class="rst-other-version ncs">
        <a href="../../../../nrf/index.html">nRF Connect SDK</a>
      </div>
      
      <div class="rst-other-version nrfx">
        <a href="../../../../nrfx/index.html">nrfx</a>
      </div>
      
      <div class="rst-other-version nrfxlib">
        <a href="../../../../nrfxlib/README.html">nrfxlib</a>
      </div>
      
      <div class="rst-other-version zephyr">
        <a href="../../../../zephyr/index.html">Zephyr Project</a>
      </div>
      
      <div class="rst-other-version mcuboot">
        <a href="../../../../mcuboot/wrapper.html">MCUboot</a>
      </div>
      
      <div class="rst-other-version tfm">
        <a href="../../../../tfm/index.html">Trusted Firmware-M</a>
      </div>
      
      <div class="rst-other-version matter">
        <a href="../../../../matter/index.html">Matter</a>
      </div>
      
      <div class="rst-other-version kconfig">
        <a href="../../../../kconfig/index.html">Kconfig Reference</a>
      </div>
    </div>
  </div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>