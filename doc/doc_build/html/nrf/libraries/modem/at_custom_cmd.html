<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Custom AT commands &mdash; nRF Connect SDK 2.3.99 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/nordic.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/togglebutton.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/nrf.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/tabs.css" type="text/css" /> 
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="https://www.googletagmanager.com/gtag/js?id=G-ZPVZRKFQJR"></script>
        <script src="../../_static/js/ga-tracker.js"></script>
        <script data-culture="EN" id="CookieConsent" type="text/javascript" src="https://policy.app.cookieinformation.com/uc.js"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../_static/togglebutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/js/theme.js"></script>
<script
  type="text/javascript"
  src="../../_static/js/ncs.js"
></script>
<script src="../../_static/js/bootstrap.bundle.min.js"></script>

    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="AT Host" href="at_host.html" />
    <link rel="prev" title="AT command parser" href="at_cmd_parser.html" />
<link
  href="../../_static/css/bootstrap.min.css"
  rel="stylesheet"
/>
<link
  rel="shortcut icon"
  href="../../_static/images/favicon.ico"
/>

</head>

<body class="wy-body-for-nav">
<div class="announcement"></div>
<div class="d-print-none ncs-header">
  <div class="container-xl ncs-header-top">
    <div class="row h-100">
      <div class="d-none d-md-block col-2">
        <div class="bg-white py-4 px-3 ml-2 ncs-header-logo">
          <img
            class="ncs-header-logo"
            src="../../_static/images/nordic-logo.png"
            alt=""
          />
        </div>
      </div>
      <div
        class="col-8 col-md-7 pl-md-4 d-flex align-self-center justify-content-center"
      >
        <form class="w-75" action="../../search.html" method="get">
          <div class="form-group">
            <input
              type="text"
              name="q"
              class="ncs-search-input form-control"
              placeholder="Search all docs..."
            />
          </div>
        </form>
      </div>
      <div class="col-4 col-md-3 d-md-block p-3 text-end">
        <div class="dropdown">
          <button
            class="btn dropdown-toggle ncs-btn-versions"
            type="button"
            id="dropdownMenuButton1"
            data-bs-toggle="dropdown"
            aria-expanded="false"
          >
            <span class="d-none d-md-inline">nRF Connect SDK</span>
            <span id="ncsversion" class="d-inline"></span>
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton"></div>
        </div>
      </div>
    </div>
  </div>
  <div class="ncs-header-nav">
    <div class="container-xl">
      <div class="row">
        <div class="col col-12 d-flex justify-content-center">
          <nav class="navbar navbar-dark navbar-expand-lg p-0">
            <span class="navbar-brand d-block d-lg-none py-2 pl-1"
              >Documentation sets</span
            >
            <button
              class="navbar-toggler"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#navbarNavAltMarkup"
              aria-controls="navbarNavAltMarkup"
              aria-expanded="false"
              aria-label="Toggle navigation"
            >
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
              <ul class="navbar-nav">
                <li class="nav-item active py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../nrf/index.html"
                    >nRF Connect SDK</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../nrfx/index.html"
                    >nrfx</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../nrfxlib/README.html"
                    >nrfxlib</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../zephyr/index.html"
                    >Zephyr Project</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../mcuboot/wrapper.html"
                    >MCUboot</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../tfm/index.html"
                    >Trusted Firmware-M</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../matter/index.html"
                    >Matter</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../kconfig/index.html"
                    >Kconfig Reference</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
              </ul>
            </div>
          </nav>
        </div>
      </div>
    </div>
  </div>
</div>

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> nRF Connect SDK
          </a>
              <div class="version">
                2.3.99
              </div>
<div id="searchbox" role="search">
  <div class="searchformwrapper">
    <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
  </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev_model.html">Development model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../app_dev.html">Application development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ecosystem_integration.html">Ecosystems integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nrf91.html">Working with nRF91 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nrf70.html">Working with nRF70 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nrf53.html">Working with nRF53 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nrf52.html">Working with nRF52 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../protocols.html">Protocols</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../applications.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../samples.html">Samples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../drivers.html">Drivers</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Libraries</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../bin/index.html">Binary libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bluetooth_services/index.html">Bluetooth libraries and services</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bootloader/index.html">Bootloader libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../caf/index.html">Common Application Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="../debug/index.html">Debug libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dfu/index.html">DFU libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gazell/index.html">Gazell libraries</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Modem libraries</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="at_cmd_parser.html">AT command parser</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Custom AT commands</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#usage">Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="#api-documentation">API documentation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="at_host.html">AT Host</a></li>
<li class="toctree-l3"><a class="reference internal" href="at_monitor.html">AT monitor</a></li>
<li class="toctree-l3"><a class="reference internal" href="at_params.html">AT parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="at_shell.html">AT shell</a></li>
<li class="toctree-l3"><a class="reference internal" href="gcf_sms_lib.html">GCF SMS</a></li>
<li class="toctree-l3"><a class="reference internal" href="location.html">Location</a></li>
<li class="toctree-l3"><a class="reference internal" href="lte_lc.html">LTE link controller</a></li>
<li class="toctree-l3"><a class="reference internal" href="modem_antenna.html">Modem antenna</a></li>
<li class="toctree-l3"><a class="reference internal" href="modem_attest_token.html">Modem attestation token</a></li>
<li class="toctree-l3"><a class="reference internal" href="modem_info.html">Modem information</a></li>
<li class="toctree-l3"><a class="reference internal" href="modem_jwt.html">Modem JWT</a></li>
<li class="toctree-l3"><a class="reference internal" href="modem_key_mgmt.html">Modem key management</a></li>
<li class="toctree-l3"><a class="reference internal" href="modem_slm.html">Modem SLM</a></li>
<li class="toctree-l3"><a class="reference internal" href="nrf_modem_lib.html">Modem library integration layer</a></li>
<li class="toctree-l3"><a class="reference internal" href="pdn.html">PDN</a></li>
<li class="toctree-l3"><a class="reference internal" href="sms.html">SMS subscriber</a></li>
<li class="toctree-l3"><a class="reference internal" href="zzhc.html">China Telecom ZZHC library</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../mpsl/index.html">Multiprotocol Service Layer libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../networking/index.html">Libraries for networking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nfc/index.html">Libraries for NFC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nrf_rpc/index.html">nRF RPC libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../others/index.html">Other libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shell/index.html">Shell libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tfm/index.html">TF-M libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../zigbee/index.html">Libraries for Zigbee</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../scripts.html">Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../known_issues.html">Known issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../software_maturity.html">Software maturity levels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation.html">About this documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">nRF Connect SDK</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Libraries</a></li>
          <li class="breadcrumb-item"><a href="index.html">Modem libraries</a></li>
      <li class="breadcrumb-item active">Custom AT commands</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/libraries/modem/at_custom_cmd.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="custom-at-commands">
<span id="at-custom-cmd-readme"></span><h1>Custom AT commands<a class="headerlink" href="#custom-at-commands" title="Permalink to this heading"></a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#configuration" id="id7">Configuration</a></p></li>
<li><p><a class="reference internal" href="#usage" id="id8">Usage</a></p>
<ul>
<li><p><a class="reference internal" href="#adding-a-custom-command" id="id9">Adding a custom command</a></p></li>
<li><p><a class="reference internal" href="#at-command-responses-for-custom-commands" id="id10">AT command responses for custom commands</a></p></li>
<li><p><a class="reference internal" href="#pausing-and-resuming" id="id11">Pausing and resuming</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#api-documentation" id="id12">API documentation</a></p></li>
</ul>
</div>
<p>The custom AT commands library allows any part of the application to register custom AT commands that are handled in the application.
The list of custom AT commands are passed to the Modem library. This allows the application to add custom AT commands and to override modem AT calls with application callbacks while using the standard AT API of the Modem library.</p>
<section id="configuration">
<h2><a class="toc-backref" href="#id7">Configuration</a><a class="headerlink" href="#configuration" title="Permalink to this heading"></a></h2>
<p>You can enable the custom AT commands library by setting the <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_AT_CUSTOM_CMD</span></code> Kconfig option.</p>
</section>
<section id="usage">
<h2><a class="toc-backref" href="#id8">Usage</a><a class="headerlink" href="#usage" title="Permalink to this heading"></a></h2>
<p>To add a custom AT command or overwrite an existing command, you must add the AT commands filter and callback with the <a class="reference internal" href="#c.AT_CUSTOM_CMD" title="AT_CUSTOM_CMD"><code class="xref c c-macro docutils literal notranslate"><span class="pre">AT_CUSTOM_CMD</span></code></a> macro in the <code class="file docutils literal notranslate"><span class="pre">at_custom_cmd.h</span></code> file.
If the filter matches the first characters of the AT command that is sent to the <code class="xref c c-func docutils literal notranslate"><span class="pre">nrf_modem_at_cmd()</span></code> function, the AT command is passed to the filter callback instead of to the modem.
When returning from the callback, the content of the provided buffer is treated as the modem response and is returned to the <code class="docutils literal notranslate"><span class="pre">nrf_modem_at_</span></code> API that sent the command.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When the custom AT commands library is enabled, the application must not call the <code class="xref c c-func docutils literal notranslate"><span class="pre">nrf_modem_at_cmd_filter_set()</span></code> function because it overrides the handler set by the library.
Instead, the application must add the AT filters using the <a class="reference internal" href="#c.AT_CUSTOM_CMD" title="AT_CUSTOM_CMD"><code class="xref c c-macro docutils literal notranslate"><span class="pre">AT_CUSTOM_CMD</span></code></a> macro.</p>
</div>
<section id="adding-a-custom-command">
<h3><a class="toc-backref" href="#id9">Adding a custom command</a><a class="headerlink" href="#adding-a-custom-command" title="Permalink to this heading"></a></h3>
<p>The application can define an custom command to receive a callback using the <a class="reference internal" href="#c.AT_CUSTOM_CMD" title="AT_CUSTOM_CMD"><code class="xref c c-macro docutils literal notranslate"><span class="pre">AT_CUSTOM_CMD</span></code></a> macro.
A custom AT command has a name, a filter string, a callback function, and a state.
Multiple parts of the application can define their own custom commands.
However, there can be only one callback per filter match.
The filter uses the callback of the first match found in the list of custom commands.
Hence, make sure to keep the filters accurate to avoid conflicts with other filters.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The custom commands only trigger on calls to the <code class="xref c c-func docutils literal notranslate"><span class="pre">nrf_modem_at_cmd()</span></code> function.
Calls to <code class="xref c c-func docutils literal notranslate"><span class="pre">nrf_modem_at_printf()</span></code>, <code class="xref c c-func docutils literal notranslate"><span class="pre">nrf_modem_at_cmd_async()</span></code>, and <code class="xref c c-func docutils literal notranslate"><span class="pre">nrf_modem_at_scanf()</span></code> are forwarded directly to the modem.</p>
</div>
<p>The following code snippet shows how to add a custom command that triggers on <code class="docutils literal notranslate"><span class="pre">+MYCOMMAND</span></code> calls to the <code class="xref c c-func docutils literal notranslate"><span class="pre">nrf_modem_at_cmd()</span></code> function:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* AT filter callback for +MYCOMMAND calls */</span>
<span class="n">AT_CUSTOM_CMD</span><span class="p">(</span><span class="n">my_command_filter</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;AT+MYCOMMAND&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">my_command_callback</span><span class="p">);</span>

<span class="w">     </span><span class="kt">int</span><span class="w"> </span><span class="nf">my_command_callback</span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">at_cmd</span><span class="p">);</span>
<span class="w">     </span><span class="p">{</span>
<span class="w">             </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Callback for %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">at_cmd</span><span class="p">);</span>
<span class="w">             </span><span class="k">return</span><span class="w"> </span><span class="n">at_custom_cmd_respond</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;OK</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">     </span><span class="p">}</span>
</pre></div>
</div>
</section>
<section id="at-command-responses-for-custom-commands">
<h3><a class="toc-backref" href="#id10">AT command responses for custom commands</a><a class="headerlink" href="#at-command-responses-for-custom-commands" title="Permalink to this heading"></a></h3>
<p>When returning from the callback, the content of the provided <code class="xref c c-var docutils literal notranslate"><span class="pre">buf</span></code> buffer is treated as the modem response by the Modem library.
Hence, the following response format must match that of the modem:</p>
<ul class="simple">
<li><p>The successful responses end with <code class="docutils literal notranslate"><span class="pre">OK\r\n</span></code>.</p></li>
<li><p>For error response, use <code class="docutils literal notranslate"><span class="pre">ERROR\r\n</span></code>, <code class="docutils literal notranslate"><span class="pre">+CME</span> <span class="pre">ERROR:</span> <span class="pre">&lt;errorcode&gt;</span></code>, or <code class="docutils literal notranslate"><span class="pre">+CMS</span> <span class="pre">ERROR:</span> <span class="pre">&lt;errorcode&gt;</span></code> depending on the error.</p></li>
</ul>
<p>To simplify filling the response buffer, you can use the <a class="reference internal" href="#c.at_custom_cmd_respond" title="at_custom_cmd_respond"><code class="xref c c-func docutils literal notranslate"><span class="pre">at_custom_cmd_respond()</span></code></a> function.
This allows formatting arguments and ensures that the response does not overflow the response buffer.</p>
<p>The following code snippet shows how responses can be added to the <code class="docutils literal notranslate"><span class="pre">+MYCOMMAND</span></code> AT command.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* AT filter callback for +MYCOMMAND calls */</span>
<span class="n">AT_CUSTOM_CMD</span><span class="p">(</span><span class="n">my_command_filter</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;AT+MYCOMMAND&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">my_command_callback</span><span class="p">);</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">my_command_callback</span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">at_cmd</span><span class="p">);</span>
<span class="p">{</span>
<span class="w">        </span><span class="cm">/* test */</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">strncmp</span><span class="p">(</span><span class="s">&quot;AT+MYCOMMAND=?&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">at_cmd</span><span class="p">,</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="s">&quot;AT+MYCOMMAND=?&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">at_custom_cmd_respond</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;+MYCOMMAND: (%d, %d)</span><span class="se">\r\n</span><span class="s">OK</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="cm">/* set */</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">strncmp</span><span class="p">(</span><span class="s">&quot;AT+MYCOMMAND=&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">at_cmd</span><span class="p">,</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="s">&quot;AT+MYCOMMAND=&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">at_custom_cmd_respond</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;OK</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="cm">/* read */</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">strncmp</span><span class="p">(</span><span class="s">&quot;AT+MYCOMMAND?&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">at_cmd</span><span class="p">,</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="s">&quot;AT+MYCOMMAND?&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">at_custom_cmd_respond</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;+CME ERROR: %d</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="pausing-and-resuming">
<h3><a class="toc-backref" href="#id11">Pausing and resuming</a><a class="headerlink" href="#pausing-and-resuming" title="Permalink to this heading"></a></h3>
<p>A custom AT command is active by default.
A custom AT command can be paused and resumed with the <a class="reference internal" href="#c.at_custom_cmd_pause" title="at_custom_cmd_pause"><code class="xref c c-func docutils literal notranslate"><span class="pre">at_custom_cmd_pause()</span></code></a> and <a class="reference internal" href="#c.at_custom_cmd_resume" title="at_custom_cmd_resume"><code class="xref c c-func docutils literal notranslate"><span class="pre">at_custom_cmd_resume()</span></code></a> functions, respectively.
You can pause a custom command at declaration by appending <a class="reference internal" href="#c.AT_CUSTOM_CMD_PAUSED" title="AT_CUSTOM_CMD_PAUSED"><code class="xref c c-macro docutils literal notranslate"><span class="pre">AT_CUSTOM_CMD_PAUSED</span></code></a> to the filter definition.</p>
<p>The following code snippet shows how to resume a custom command that is paused by default:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* AT filter callback for +MYCOMMAND calls */</span>
<span class="n">AT_CUSTOM_CMD</span><span class="p">(</span><span class="n">my_command_filter</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;AT+MYCOMMAND&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">my_command_callback</span><span class="p">,</span><span class="w"> </span><span class="n">AT_CUSTOM_CMD_PAUSED</span><span class="p">);</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">resume_my_command_filter</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">        </span><span class="cm">/* resume the filter */</span>
<span class="w">        </span><span class="n">at_custom_cmd_resume</span><span class="p">(</span><span class="o">&amp;</span><span class="n">my_command_filter</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">my_command_callback</span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">at_cmd</span><span class="p">);</span>
<span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">at_custom_cmd_respond</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="s">&quot;OK</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="api-documentation">
<h2><a class="toc-backref" href="#id12">API documentation</a><a class="headerlink" href="#api-documentation" title="Permalink to this heading"></a></h2>
<div class="line-block">
<div class="line">Header file: <code class="file docutils literal notranslate"><span class="pre">include/modem/at_custom_cmd.h</span></code></div>
<div class="line">Source file: <code class="file docutils literal notranslate"><span class="pre">lib/at_custom_cmd/src/at_custom_cmd.c</span></code></div>
</div>
<dl>
<dt class="sig sig-object cpp">
<span class="target" id="group__at__custom__cmd"></span><em><span class="pre">group</span></em> <span class="sig-name descname"><span class="pre">at_custom_cmd</span></span></dt>
<dd><p>Public API for adding custom AT commands using filters in the Modem library with application callbacks. </p>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-defines">Defines</p>
<dl class="c macro">
<dt class="sig sig-object c" id="c.AT_CUSTOM_CMD_PAUSED">
<span class="target" id="group__at__custom__cmd_1gaf5177193fbf770996c75658353786e40"></span><span class="sig-name descname"><span class="n"><span class="pre">AT_CUSTOM_CMD_PAUSED</span></span></span><a class="headerlink" href="#c.AT_CUSTOM_CMD_PAUSED" title="Permalink to this definition"></a><br /></dt>
<dd></dd></dl>

<dl class="c macro">
<dt class="sig sig-object c" id="c.AT_CUSTOM_CMD_ACTIVE">
<span class="target" id="group__at__custom__cmd_1gabbc68502d00650be9be27ddaa619cdc7"></span><span class="sig-name descname"><span class="n"><span class="pre">AT_CUSTOM_CMD_ACTIVE</span></span></span><a class="headerlink" href="#c.AT_CUSTOM_CMD_ACTIVE" title="Permalink to this definition"></a><br /></dt>
<dd></dd></dl>

<dl class="c macro">
<dt class="sig sig-object c" id="c.AT_CUSTOM_CMD">
<span class="target" id="group__at__custom__cmd_1ga64bdbbc83b4076c51c2e65dc88af37b8"></span><span class="sig-name descname"><span class="n"><span class="pre">AT_CUSTOM_CMD</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">entry</span></span>, <span class="n"><span class="pre">_filter</span></span>, <span class="n"><span class="pre">_callback</span></span>, <span class="p"><span class="pre">...</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.AT_CUSTOM_CMD" title="Permalink to this definition"></a><br /></dt>
<dd><p>Define an custom AT command callback. </p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>entry</strong> – The entry name. </p></li>
<li><p><strong>_filter</strong> – The (partial) AT command on which the callback should trigger. </p></li>
<li><p><strong>_callback</strong> – The AT command callback function. </p></li>
<li><p><strong>...</strong> – Optional initial state ( <code class="docutils literal notranslate"><span class="pre">AT_CUSTOM_CMD_PAUSED</span></code> or <code class="docutils literal notranslate"><span class="pre">AT_CUSTOM_CMD_ACTIVE</span></code> ). The default is <code class="docutils literal notranslate"><span class="pre">AT_CUSTOM_CMD_ACTIVE</span></code> . </p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-functions">Functions</p>
<dl class="c function">
<dt class="sig sig-object c" id="c.at_custom_cmd_respond">
<span class="target" id="group__at__custom__cmd_1ga5793d4dc72cd5568b4a99592bfd34591"></span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">at_custom_cmd_respond</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">buf</span></span>, <span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="n"><span class="pre">buf_size</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">response</span></span>, <span class="p"><span class="pre">...</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.at_custom_cmd_respond" title="Permalink to this definition"></a><br /></dt>
<dd><p>Fill response buffer without overflowing the buffer. </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For the modem library to accept the response in <code class="docutils literal notranslate"><span class="pre">buf</span></code> as a success, the response must contain “OK\r\n”. If the response is an error, use “ERROR\r\n” or appropriate CMS/CME responses, e.g. “+CMS ERROR: &lt;errorcode&gt;”.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>buf</strong> – Buffer to put response into. </p></li>
<li><p><strong>buf_size</strong> – Size of the response buffer. </p></li>
<li><p><strong>response</strong> – Response format. </p></li>
<li><p><strong>...</strong> – Format arguments.</p></li>
</ul>
</dd>
<dt class="field-even">Return values</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>0</strong> – on success. </p></li>
<li><p><strong>-NRF_EFAULT</strong> – if no buffer provided. </p></li>
<li><p><strong>-NRF_E2BIG</strong> – if the provided buffer is too small for the response. </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.at_custom_cmd_pause">
<span class="target" id="group__at__custom__cmd_1ga143d89c95c972ab6d9962353662fa8e3"></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">at_custom_cmd_pause</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">nrf_modem_at_cmd_filter</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">entry</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.at_custom_cmd_pause" title="Permalink to this definition"></a><br /></dt>
<dd><p>Pause a custom AT command. </p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>entry</strong> – Pointer to the custom AT command to pause. </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.at_custom_cmd_resume">
<span class="target" id="group__at__custom__cmd_1ga2f6c9df1a7464f8e5e7520c52c5f930b"></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">at_custom_cmd_resume</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">nrf_modem_at_cmd_filter</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">entry</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.at_custom_cmd_resume" title="Permalink to this definition"></a><br /></dt>
<dd><p>Resume a custom AT command. </p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>entry</strong> – Pointer to the custom AT command to resume. </p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>
</dd></dl>

</section>
</section>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="at_host.html" class="btn btn-neutral float-right" title="AT Host" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="at_cmd_parser.html" class="btn btn-neutral" title="AT command parser" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">

<table>
<tr>
<td>
    <p>
        &copy; Copyright 2019-2023, Nordic Semiconductor.
      Last updated on Mar 20, 2023.

    </p>
</td>
<td id="nordiclogo">
  <a href="https://www.nordicsemi.com/"><img src="../../_static/images/nordic-logo.png" border="0"/></a>
</td>
</tr>
</table>
  </div> 


</footer>

<div id="scroll-container">
  <button type="button" id="scroll-btn" class="btn">
    <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="#fff"/></svg>
  </button>
</div>

<script>
  const scrollBtn = document.querySelector("#scroll-btn");

  document.addEventListener("scroll", () => {
    if (window.scrollY > 400) {
          scrollBtn.style.visibility = "visible";
      } else {
          scrollBtn.style.visibility = "hidden";
      }
  });

  scrollBtn.addEventListener("click", () => {
      window.scrollTo({ top: 0, behavior: "smooth" });
  });
</script>
        </div>
      </div>
    </section>
  </div>
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> nRF Connect SDK</span>
       <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      
      <div class="rst-other-version ncs">
        <a href="../../../nrf/index.html">nRF Connect SDK</a>
      </div>
      
      <div class="rst-other-version nrfx">
        <a href="../../../nrfx/index.html">nrfx</a>
      </div>
      
      <div class="rst-other-version nrfxlib">
        <a href="../../../nrfxlib/README.html">nrfxlib</a>
      </div>
      
      <div class="rst-other-version zephyr">
        <a href="../../../zephyr/index.html">Zephyr Project</a>
      </div>
      
      <div class="rst-other-version mcuboot">
        <a href="../../../mcuboot/wrapper.html">MCUboot</a>
      </div>
      
      <div class="rst-other-version tfm">
        <a href="../../../tfm/index.html">Trusted Firmware-M</a>
      </div>
      
      <div class="rst-other-version matter">
        <a href="../../../matter/index.html">Matter</a>
      </div>
      
      <div class="rst-other-version kconfig">
        <a href="../../../kconfig/index.html">Kconfig Reference</a>
      </div>
    </div>
  </div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>