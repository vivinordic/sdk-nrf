<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CAF: LEDs module &mdash; nRF Connect SDK 2.3.99 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/nordic.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/togglebutton.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/nrf.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/tabs.css" type="text/css" /> 
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="https://www.googletagmanager.com/gtag/js?id=G-ZPVZRKFQJR"></script>
        <script src="../../_static/js/ga-tracker.js"></script>
        <script data-culture="EN" id="CookieConsent" type="text/javascript" src="https://policy.app.cookieinformation.com/uc.js"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../_static/togglebutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/js/theme.js"></script>
<script
  type="text/javascript"
  src="../../_static/js/ncs.js"
></script>
<script src="../../_static/js/bootstrap.bundle.min.js"></script>

    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="CAF: Network state module" href="net_state.html" />
    <link rel="prev" title="CAF: Click detector module" href="click_detector.html" />
<link
  href="../../_static/css/bootstrap.min.css"
  rel="stylesheet"
/>
<link
  rel="shortcut icon"
  href="../../_static/images/favicon.ico"
/>

</head>

<body class="wy-body-for-nav">
<div class="announcement"></div>
<div class="d-print-none ncs-header">
  <div class="container-xl ncs-header-top">
    <div class="row h-100">
      <div class="d-none d-md-block col-2">
        <div class="bg-white py-4 px-3 ml-2 ncs-header-logo">
          <img
            class="ncs-header-logo"
            src="../../_static/images/nordic-logo.png"
            alt=""
          />
        </div>
      </div>
      <div
        class="col-8 col-md-7 pl-md-4 d-flex align-self-center justify-content-center"
      >
        <form class="w-75" action="../../search.html" method="get">
          <div class="form-group">
            <input
              type="text"
              name="q"
              class="ncs-search-input form-control"
              placeholder="Search all docs..."
            />
          </div>
        </form>
      </div>
      <div class="col-4 col-md-3 d-md-block p-3 text-end">
        <div class="dropdown">
          <button
            class="btn dropdown-toggle ncs-btn-versions"
            type="button"
            id="dropdownMenuButton1"
            data-bs-toggle="dropdown"
            aria-expanded="false"
          >
            <span class="d-none d-md-inline">nRF Connect SDK</span>
            <span id="ncsversion" class="d-inline"></span>
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton"></div>
        </div>
      </div>
    </div>
  </div>
  <div class="ncs-header-nav">
    <div class="container-xl">
      <div class="row">
        <div class="col col-12 d-flex justify-content-center">
          <nav class="navbar navbar-dark navbar-expand-lg p-0">
            <span class="navbar-brand d-block d-lg-none py-2 pl-1"
              >Documentation sets</span
            >
            <button
              class="navbar-toggler"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#navbarNavAltMarkup"
              aria-controls="navbarNavAltMarkup"
              aria-expanded="false"
              aria-label="Toggle navigation"
            >
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
              <ul class="navbar-nav">
                <li class="nav-item active py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../nrf/index.html"
                    >nRF Connect SDK</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../nrfx/index.html"
                    >nrfx</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../nrfxlib/README.html"
                    >nrfxlib</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../zephyr/index.html"
                    >Zephyr Project</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../mcuboot/wrapper.html"
                    >MCUboot</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../tfm/index.html"
                    >Trusted Firmware-M</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../matter/index.html"
                    >Matter</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../kconfig/index.html"
                    >Kconfig Reference</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
              </ul>
            </div>
          </nav>
        </div>
      </div>
    </div>
  </div>
</div>

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> nRF Connect SDK
          </a>
              <div class="version">
                2.3.99
              </div>
<div id="searchbox" role="search">
  <div class="searchformwrapper">
    <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
  </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev_model.html">Development model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../app_dev.html">Application development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ecosystem_integration.html">Ecosystems integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nrf91.html">Working with nRF91 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nrf70.html">Working with nRF70 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nrf53.html">Working with nRF53 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nrf52.html">Working with nRF52 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../protocols.html">Protocols</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../applications.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../samples.html">Samples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../drivers.html">Drivers</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Libraries</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../bin/index.html">Binary libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bluetooth_services/index.html">Bluetooth libraries and services</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bootloader/index.html">Bootloader libraries</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Common Application Framework</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="caf_overview.html">Common Application Framework overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="ble_adv.html">CAF: Bluetooth LE advertising module</a></li>
<li class="toctree-l3"><a class="reference internal" href="ble_bond.html">CAF: Bluetooth LE bond module</a></li>
<li class="toctree-l3"><a class="reference internal" href="ble_smp.html">CAF: Simple Management Protocol module</a></li>
<li class="toctree-l3"><a class="reference internal" href="ble_state.html">CAF: Bluetooth LE state module</a></li>
<li class="toctree-l3"><a class="reference internal" href="ble_state_pm.html">CAF: Bluetooth state power manager module</a></li>
<li class="toctree-l3"><a class="reference internal" href="buttons.html">CAF: Buttons module</a></li>
<li class="toctree-l3"><a class="reference internal" href="buttons_pm_keep_alive.html">CAF: Power manager keep alive module for buttons</a></li>
<li class="toctree-l3"><a class="reference internal" href="click_detector.html">CAF: Click detector module</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">CAF: LEDs module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#implementation-details">Implementation details</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="net_state.html">CAF: Network state module</a></li>
<li class="toctree-l3"><a class="reference internal" href="power_manager.html">CAF: Power manager module</a></li>
<li class="toctree-l3"><a class="reference internal" href="sensor_data_aggregator.html">CAF: Sensor data aggregator module</a></li>
<li class="toctree-l3"><a class="reference internal" href="sensor_manager.html">CAF: Sensor manager module</a></li>
<li class="toctree-l3"><a class="reference internal" href="settings_loader.html">CAF: Settings loader module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../debug/index.html">Debug libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dfu/index.html">DFU libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gazell/index.html">Gazell libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modem/index.html">Modem libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mpsl/index.html">Multiprotocol Service Layer libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../networking/index.html">Libraries for networking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nfc/index.html">Libraries for NFC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nrf_rpc/index.html">nRF RPC libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../others/index.html">Other libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shell/index.html">Shell libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tfm/index.html">TF-M libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../zigbee/index.html">Libraries for Zigbee</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../scripts.html">Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../known_issues.html">Known issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../software_maturity.html">Software maturity levels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation.html">About this documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">nRF Connect SDK</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Libraries</a></li>
          <li class="breadcrumb-item"><a href="index.html">Common Application Framework</a></li>
      <li class="breadcrumb-item active">CAF: LEDs module</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/libraries/caf/leds.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="caf-leds-module">
<span id="caf-leds"></span><h1>CAF: LEDs module<a class="headerlink" href="#caf-leds-module" title="Permalink to this heading"></a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#configuration" id="id7">Configuration</a></p>
<ul>
<li><p><a class="reference internal" href="#configuring-leds-in-dts" id="id8">Configuring LEDs in DTS</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#implementation-details" id="id9">Implementation details</a></p>
<ul>
<li><p><a class="reference internal" href="#led-effect" id="id10">LED effect</a></p></li>
<li><p><a class="reference internal" href="#power-management-events" id="id11">Power management events</a></p></li>
</ul>
</li>
</ul>
</div>
<p>The LEDs module of the <a class="reference internal" href="index.html#lib-caf"><span class="std std-ref">Common Application Framework</span></a> (CAF) is responsible for controlling LEDs in response to LED effect set by a <code class="docutils literal notranslate"><span class="pre">led_event</span></code>.
The source of such events could be any other module in nRF Connect SDK.</p>
<p>The module uses Zephyr’s <span class="xref std std-ref">zephyr:led_api</span> driver for setting the LED color, either RGB or monochromatic.
Zephyr’s LED driver can use the implementation based on either GPIO or PWM.
Use the PWM-based implementation to achieve smooth changes of brightness.
Use the GPIO-based implementation if your board does not support PWM or if you want to control LEDs connected using the GPIO expander.</p>
<section id="configuration">
<h2><a class="toc-backref" href="#id7">Configuration</a><a class="headerlink" href="#configuration" title="Permalink to this heading"></a></h2>
<p>To use the module, you must fulfill the following requirements:</p>
<ol class="arabic simple">
<li><p>Enable the following Kconfig options:</p>
<ul class="simple">
<li><p><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_CAF_LEDS</span></code> - This option enables the LEDs module.</p></li>
<li><p><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_LED</span></code> - This option enables the LED driver API.</p></li>
</ul>
</li>
<li><p>Complete one of the following steps to choose and configure the LED driver implementation:</p>
<ol class="loweralpha simple">
<li><p>For the PWM-based implementation, Zephyr’s <span class="xref std std-ref">zephyr:pwm_api</span> driver is used for setting the LED color (that is, the brightness of the diodes).
For this reason, set the following options:</p>
<ul class="simple">
<li><p><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_CAF_LEDS_PWM</span></code></p></li>
<li><p><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_LED_PWM</span></code></p></li>
<li><p><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_PWM</span></code></p></li>
</ul>
</li>
<li><p>For the GPIO-based implementation, Zephyr’s <span class="xref std std-ref">zephyr:gpio_api</span> driver is used for setting the LED color (that is, the brightness of the diodes).
For this reason, set the following options:</p>
<ul class="simple">
<li><p><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_CAF_LEDS_GPIO</span></code></p></li>
<li><p><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_LED_GPIO</span></code></p></li>
<li><p><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_GPIO</span></code></p></li>
</ul>
</li>
</ol>
</li>
<li><p>Configure LEDs in DTS.
See <a class="reference internal" href="#configuring-leds-in-dts">Configuring LEDs in DTS</a> for details.</p></li>
</ol>
<p>The following Kconfig options are also available for this module:</p>
<ul class="simple">
<li><p><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_CAF_LEDS_PM_EVENTS</span></code> - This option enables the reaction to <a class="reference internal" href="#power-management-events">Power management events</a>.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The GPIO-based LED driver implementation supports only turning LED on or off.
Smooth changes of brightness are not supported, because of hardware limitations.
Therefore, the LED effects that use smooth changes of LED brightness are not properly displayed by this implementation.</p>
</div>
<section id="configuring-leds-in-dts">
<h3><a class="toc-backref" href="#id8">Configuring LEDs in DTS</a><a class="headerlink" href="#configuring-leds-in-dts" title="Permalink to this heading"></a></h3>
<p>Zephyr’s LEDs are configured using compatible DTS nodes.
You must enable or create DTS nodes for the configuration to work.
You can do this in the devicetree file, either in the board-specific <code class="file docutils literal notranslate"><span class="pre">dts</span></code> file or in a DTS overlay file.
Using the option with the overlay file merges the settings to configuration.
For more help, see <span class="xref std std-ref">zephyr:dt-guide</span>.</p>
<p>The value of the <code class="docutils literal notranslate"><span class="pre">compatible</span></code> property of the DTS node depends on the selected LED driver implementation.
For example, you can use a node that is compatible with <code class="docutils literal notranslate"><span class="pre">pwm-leds</span></code> to configure LEDs controlled with PWM.
See the following subsections for more detailed information about configuring LED driver implementations supported by CAF LEDs.</p>
<p>The LEDs module assumes that a single DTS node is a separate and complete logical LED.
The LEDs module expects that the node will hold configuration of HW LEDs responsible for reproducing all required color channels.
The number of HW LEDs configured to reproduce color channels can be either one or three (either monochromatic or following the RGB order, with the red channel defined first, then the green one, then the blue one).
If only one HW LED is used for a monochromatic setting, the module converts the tri-channel color to a single value of brightness and passes it to this single HW LED.
The LED color channels are represented as child nodes of the compatible DTS node.</p>
<section id="configuring-pwm-leds">
<h4>Configuring PWM LEDs<a class="headerlink" href="#configuring-pwm-leds" title="Permalink to this heading"></a></h4>
<p>To properly use the LEDs module and have LEDs driven by PWM, you must configure the PWM driver and the LED PWM driver.</p>
<p>Configuring the PWM driver specifies which PWM channel is related to which GPIO pin.
Configuring the LED PWM driver defines which PWM port is to be used for each LED and selects the GPIO pin for usage.
In case of the LED PWM driver, the GPIO pin must match the one passed to the PWM driver.</p>
<p>The configuration process requires enabling the PWM ports and enabling or creating the LED PWM nodes.
Make sure to configure all PWM ports and channels that are used by the application.</p>
<section id="enabling-the-pwm-ports">
<h5>Enabling the PWM ports<a class="headerlink" href="#enabling-the-pwm-ports" title="Permalink to this heading"></a></h5>
<p>To enable the PWM ports, you must set the PWM port status to <code class="docutils literal notranslate"><span class="pre">&quot;okay&quot;</span></code> in the devicetree file and configure an appropriate pin control configuration.</p>
<p>The following code snippets show examples of the DTS nodes:</p>
<ul>
<li><p>Example 1 (enabling an existing port node):</p>
<div class="highlight-devicetree notranslate"><div class="highlight"><pre><span></span><span class="o">&amp;</span><span class="na">pinctrl</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nl">pwm0_default_alt</span><span class="p">:</span><span class="w"> </span><span class="nf">pwm0_default_alt</span><span class="cm"> </span><span class="p">{</span>
<span class="w">                </span><span class="nf">group1</span><span class="cm"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">psels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="na">NRF_PSEL</span><span class="p">(</span><span class="na">PWM_OUT0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">                </span><span class="p">};</span>
<span class="w">        </span><span class="p">};</span>

<span class="w">        </span><span class="nl">pwm0_sleep_alt</span><span class="p">:</span><span class="w"> </span><span class="nf">pwm0_sleep_alt</span><span class="cm"> </span><span class="p">{</span>
<span class="w">                </span><span class="nf">group1</span><span class="cm"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">psels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="na">NRF_PSEL</span><span class="p">(</span><span class="na">PWM_OUT0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">                        </span><span class="n">low-power-enable</span><span class="p">;</span>
<span class="w">                </span><span class="p">};</span>
<span class="w">        </span><span class="p">};</span>
<span class="p">};</span>

<span class="o">&amp;</span><span class="nf">pwm0</span><span class="cm"> </span><span class="p">{</span>
<span class="w">        </span><span class="kr">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;okay&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="n">pinctrl-0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&amp;</span><span class="na">pwm0_default_alt</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">        </span><span class="n">pinctrl-1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&amp;</span><span class="na">pwm0_sleep_alt</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">        </span><span class="n">pinctrl-names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;default&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;sleep&quot;</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>In this example, the <code class="docutils literal notranslate"><span class="pre">pwm0</span></code> has its channel 0 bound to the GPIO pin number <code class="docutils literal notranslate"><span class="pre">8</span></code>.</p>
</li>
<li><p>Example 2 (enabling an existing port node):</p>
<div class="highlight-devicetree notranslate"><div class="highlight"><pre><span></span><span class="o">&amp;</span><span class="na">pinctrl</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nl">pwm0_default_alt</span><span class="p">:</span><span class="w"> </span><span class="nf">pwm0_default_alt</span><span class="cm"> </span><span class="p">{</span>
<span class="w">                </span><span class="nf">group1</span><span class="cm"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">psels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="na">NRF_PSEL</span><span class="p">(</span><span class="na">PWM_OUT0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">                                </span><span class="o">&lt;</span><span class="na">NRF_PSEL</span><span class="p">(</span><span class="na">PWM_OUT1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">26</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">                                </span><span class="o">&lt;</span><span class="na">NRF_PSEL</span><span class="p">(</span><span class="na">PWM_OUT2</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">27</span><span class="p">)</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">                        </span><span class="n">nordic</span><span class="p">,</span><span class="n">invert</span><span class="p">;</span>
<span class="w">                </span><span class="p">};</span>
<span class="w">        </span><span class="p">};</span>

<span class="w">        </span><span class="nl">pwm0_sleep_alt</span><span class="p">:</span><span class="w"> </span><span class="nf">pwm0_sleep_alt</span><span class="cm"> </span><span class="p">{</span>
<span class="w">                </span><span class="nf">group1</span><span class="cm"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">psels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="na">NRF_PSEL</span><span class="p">(</span><span class="na">PWM_OUT0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">                                </span><span class="o">&lt;</span><span class="na">NRF_PSEL</span><span class="p">(</span><span class="na">PWM_OUT1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">26</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">                                </span><span class="o">&lt;</span><span class="na">NRF_PSEL</span><span class="p">(</span><span class="na">PWM_OUT2</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">27</span><span class="p">)</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">                        </span><span class="n">low-power-enable</span><span class="p">;</span>
<span class="w">                </span><span class="p">};</span>
<span class="w">        </span><span class="p">};</span>

<span class="w">        </span><span class="nl">pwm1_default_alt</span><span class="p">:</span><span class="w"> </span><span class="nf">pwm1_default_alt</span><span class="cm"> </span><span class="p">{</span>
<span class="w">                </span><span class="nf">group1</span><span class="cm"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">psels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="na">NRF_PSEL</span><span class="p">(</span><span class="na">PWM_OUT0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">                </span><span class="p">};</span>
<span class="w">        </span><span class="p">};</span>

<span class="w">        </span><span class="nl">pwm1_sleep_alt</span><span class="p">:</span><span class="w"> </span><span class="nf">pwm1_sleep_alt</span><span class="cm"> </span><span class="p">{</span>
<span class="w">                </span><span class="nf">group1</span><span class="cm"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">psels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="na">NRF_PSEL</span><span class="p">(</span><span class="na">PWM_OUT0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">                        </span><span class="n">low-power-enable</span><span class="p">;</span>
<span class="w">                </span><span class="p">};</span>
<span class="w">        </span><span class="p">};</span>
<span class="p">};</span>

<span class="o">&amp;</span><span class="nf">pwm0</span><span class="cm"> </span><span class="p">{</span>
<span class="w">        </span><span class="kr">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;okay&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="n">pinctrl-0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&amp;</span><span class="na">pwm0_default_alt</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">        </span><span class="n">pinctrl-1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&amp;</span><span class="na">pwm0_sleep_alt</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">        </span><span class="n">pinctrl-names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;default&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;sleep&quot;</span><span class="p">;</span>
<span class="p">};</span>

<span class="o">&amp;</span><span class="nf">pwm1</span><span class="cm"> </span><span class="p">{</span>
<span class="w">        </span><span class="kr">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;okay&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="n">pinctrl-0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&amp;</span><span class="na">pwm1_default_alt</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">        </span><span class="n">pinctrl-1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&amp;</span><span class="na">pwm1_sleep_alt</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">        </span><span class="n">pinctrl-names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;default&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;sleep&quot;</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="enabling-the-led-pwm-nodes">
<h5>Enabling the LED PWM nodes<a class="headerlink" href="#enabling-the-led-pwm-nodes" title="Permalink to this heading"></a></h5>
<p>To enable the LED PWM nodes in the devicetree file, you must set their status to <code class="docutils literal notranslate"><span class="pre">&quot;okay&quot;</span></code> in the devicetree file and specify to which PWM node they are related to.
You can also decide to create these nodes from scratch.
There is no limit to the number of node instances you can create.</p>
<p>For the LEDs to be configured correctly, make sure that LED PWM node channel numbers in the <code class="file docutils literal notranslate"><span class="pre">dts</span></code> file are matching the PWM nodes set when <a class="reference internal" href="#enabling-the-pwm-ports">Enabling the PWM ports</a>.</p>
<p>The following code snippets show examples of the DTS nodes:</p>
<ul>
<li><p>Example 1 (enabling existing LED PWM node):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&amp;pwm_led0 {
        status = &quot;okay&quot;;
        pwms = &lt;&amp;pwm0 0 PWM_MSEC(20) PWM_POLARITY_NORMAL&gt;;
        label = &quot;LED0&quot;;
};
</pre></div>
</div>
<p>In this example, the <code class="docutils literal notranslate"><span class="pre">pwms</span></code> property is pointing to the <code class="docutils literal notranslate"><span class="pre">pwm0</span></code> PWM node set in Example 1 in <a class="reference internal" href="#enabling-the-pwm-ports">Enabling the PWM ports</a>, with the respective channel number (<code class="docutils literal notranslate"><span class="pre">0</span></code>).</p>
</li>
<li><p>Example 2 (creating new LED PWM nodes):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>pwmleds0 {
        compatible = &quot;pwm-leds&quot;;
        status = &quot;okay&quot;;

        pwm_led0: led_pwm_0 {
                status = &quot;okay&quot;;
                pwms = &lt;&amp;pwm0 0 PWM_MSEC(1) PWM_POLARITY_INVERTED&gt;;
                label = &quot;LED0 red&quot;;
        };

        pwm_led1: led_pwm_1 {
                status = &quot;okay&quot;;
                pwms = &lt;&amp;pwm0 1 PWM_MSEC(1) PWM_POLARITY_INVERTED&gt;;
                label = &quot;LED0 green&quot;;
        };

        pwm_led2: led_pwm_2 {
                status = &quot;okay&quot;;
                pwms = &lt;&amp;pwm0 2 PWM_MSEC(1) PWM_POLARITY_INVERTED&gt;;
                label = &quot;LED0 blue&quot;;
        };
};

pwmleds1 {
        compatible = &quot;pwm-leds&quot;;
        status = &quot;okay&quot;;

        pwm_led3: led_pwm_3 {
                status = &quot;okay&quot;;
                pwms = &lt;&amp;pwm1 0 PWM_MSEC(20) PWM_POLARITY_NORMAL&gt;;
                label = &quot;LED1&quot;;
        };
};
</pre></div>
</div>
<p>In this example, <code class="docutils literal notranslate"><span class="pre">pwmleds0</span></code> is a tri-channel color LED node, while <code class="docutils literal notranslate"><span class="pre">pwmleds1</span></code> is a monochromatic LED node.
Both <code class="docutils literal notranslate"><span class="pre">pwmleds</span></code> nodes are pointing to the <code class="docutils literal notranslate"><span class="pre">pwms</span></code> properties corresponding to PWM nodes set in Example 2 in <a class="reference internal" href="#enabling-the-pwm-ports">Enabling the PWM ports</a>, with the respective channel numbers.</p>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Set the PWM period for the LED to a smaller value, such as 1 millisecond, to avoid glitches during tri-channel LED color updates.
Because of the limitations of Zephyr’s <span class="xref std std-ref">zephyr:pwm_api</span>, color channels are not updated simultaneously.
The first LED channel is updated one PWM period before other channels.
A short LED PWM period mitigates the glitches.</p>
</div>
</section>
</section>
<section id="configuring-gpio-leds">
<h4>Configuring GPIO LEDs<a class="headerlink" href="#configuring-gpio-leds" title="Permalink to this heading"></a></h4>
<p>To properly use the LEDs module and have LEDs driven by GPIO, you must configure the GPIO driver and the LED GPIO driver.</p>
<section id="enabling-the-gpios">
<h5>Enabling the GPIOs<a class="headerlink" href="#enabling-the-gpios" title="Permalink to this heading"></a></h5>
<p>In general, boards in Zephyr configure and enable the GPIO drivers by default, so no additional configuration is needed.
You can also use the LED GPIO driver to control LEDs connected using a GPIO expander supported by Zephyr.
For example, the DTS configuration of the <code class="docutils literal notranslate"><span class="pre">thingy52_nrf52832</span></code> board supports <code class="docutils literal notranslate"><span class="pre">sx1509b</span></code> GPIO expander, which is used to control lightwell RGB LEDs.</p>
</section>
<section id="enabling-the-led-gpio-nodes">
<h5>Enabling the LED GPIO nodes<a class="headerlink" href="#enabling-the-led-gpio-nodes" title="Permalink to this heading"></a></h5>
<p>To enable the LED GPIO nodes in the devicetree file, you must set their status to <code class="docutils literal notranslate"><span class="pre">&quot;okay&quot;</span></code> and specify to which GPIO nodes they are related to.
You can also decide to create these nodes from scratch.
There is no limit to the number of node instances you can create.</p>
<p>The LED GPIO is configured as a node that is compatible with <code class="docutils literal notranslate"><span class="pre">gpio-leds</span></code>.
The following code snippets show examples of DTS nodes:</p>
<ul>
<li><p>Example 1 - RGB LED controlled using GPIO expander (<code class="docutils literal notranslate"><span class="pre">sx1509b</span></code>)</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>leds0 {
        compatible = &quot;gpio-leds&quot;;
        label = &quot;Lightwell RGB&quot;;
        status = &quot;okay&quot;;

        led0: led_0 {
                gpios = &lt;&amp;sx1509b 7 GPIO_ACTIVE_LOW&gt;;
                label = &quot;Red LED&quot;;
        };
        led1: led_1 {
                gpios = &lt;&amp;sx1509b 5 GPIO_ACTIVE_LOW&gt;;
                label = &quot;Green LED&quot;;
        };
        led2: led_2 {
                gpios = &lt;&amp;sx1509b 6 GPIO_ACTIVE_LOW&gt;;
                label = &quot;Blue LED&quot;;
        };
};
</pre></div>
</div>
</li>
<li><p>Example 2 - Monochromatic LED connected directly to the GPIO of an MCU</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>leds1 {
        compatible = &quot;gpio-leds&quot;;
        label = &quot;Green LED&quot;;
        status = &quot;okay&quot;;

        led0: led_0 {
                gpios = &lt;&amp;gpio0 13 GPIO_ACTIVE_LOW&gt;;
                label = &quot;Green LED 0&quot;;
        };
};
</pre></div>
</div>
</li>
</ul>
<p>Make sure to configure all the LED GPIO nodes that are used by the application.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In general, boards defined by Zephyr define a <code class="docutils literal notranslate"><span class="pre">leds</span></code> node that is compatible with <code class="docutils literal notranslate"><span class="pre">gpio-leds</span></code>.
The node can also be used by the module.
Before enabling the node, make sure it meets the requirements of the CAF LEDs module.</p>
</div>
</section>
</section>
</section>
</section>
<section id="implementation-details">
<h2><a class="toc-backref" href="#id9">Implementation details</a><a class="headerlink" href="#implementation-details" title="Permalink to this heading"></a></h2>
<p>The LED effect defines the LED behavior over time for the LEDs by setting their brightness level periodically.
This allows for different RGB or monochromatic colors.
An example may be an LED that is blinking or breathing with a given color.
Such LED behavior is referred to as <em>LED effect</em>.</p>
<p>The LED color is achieved by setting the proper pulse widths for the PWM signals.
To achieve the desired LED effect, colors for the given LED are periodically updated using work (<code class="xref c c-struct docutils literal notranslate"><span class="pre">k_work_delayable</span></code>).
One work automatically updates the color of a single LED.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you use the GPIO-based implementation, the signal’s duty cycle can be either 0% or 100% and the LED can be either turned on or off.</p>
</div>
<p>If the application goes to the error state, the LEDs are used to indicate error.</p>
<section id="led-effect">
<h3><a class="toc-backref" href="#id10">LED effect</a><a class="headerlink" href="#led-effect" title="Permalink to this heading"></a></h3>
<p>The LED effect (<a class="reference internal" href="../../applications/nrf_desktop/doc/led_state.html#c.led_effect" title="led_effect"><code class="xref c c-struct docutils literal notranslate"><span class="pre">led_effect</span></code></a>) is described by the following characteristics:</p>
<ul class="simple">
<li><p>Pointer to an array of LED steps (<a class="reference internal" href="../../applications/nrf_desktop/doc/led_state.html#c.led_effect.steps" title="led_effect.steps"><code class="xref c c-member docutils literal notranslate"><span class="pre">led_effect.steps</span></code></a>).</p></li>
<li><p>Size of the array (<a class="reference internal" href="../../applications/nrf_desktop/doc/led_state.html#c.led_effect.step_count" title="led_effect.step_count"><code class="xref c c-member docutils literal notranslate"><span class="pre">led_effect.step_count</span></code></a>).</p></li>
<li><p>Flag indicating if the sequence should start over after it finishes (<a class="reference internal" href="../../applications/nrf_desktop/doc/led_state.html#c.led_effect.loop_forever" title="led_effect.loop_forever"><code class="xref c c-member docutils literal notranslate"><span class="pre">led_effect.loop_forever</span></code></a>).</p></li>
</ul>
<p>To achieve the desired LED effect, the LED color is updated periodically based on the LED steps defined for the given LED effect, which in turn are divided in multiple smaller updates called <em>substeps</em>.</p>
<figure class="align-default" id="id6">
<img alt="Characteristics of a led_effect" src="../../_images/caf_led_effect_structure.svg" /><figcaption>
<p><span class="caption-text">Characteristics of a led_effect</span><a class="headerlink" href="#id6" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>During every substep, the next LED color is calculated using a linear approximation between the current LED color and the <a class="reference internal" href="../../applications/nrf_desktop/doc/led_state.html#c.led_effect_step.color" title="led_effect_step.color"><code class="xref c c-member docutils literal notranslate"><span class="pre">led_effect_step.color</span></code></a> described in the next LED step.
A single LED step also defines the number of substeps for color change between the given LED step and the previous one (<a class="reference internal" href="../../applications/nrf_desktop/doc/led_state.html#c.led_effect_step.substep_count" title="led_effect_step.substep_count"><code class="xref c c-member docutils literal notranslate"><span class="pre">led_effect_step.substep_count</span></code></a>), as well as the period of time between color updates (<a class="reference internal" href="../../applications/nrf_desktop/doc/led_state.html#c.led_effect_step.substep_time" title="led_effect_step.substep_time"><code class="xref c c-member docutils literal notranslate"><span class="pre">led_effect_step.substep_time</span></code></a>).
After achieving the color described in the next step, the index of the next step is updated.</p>
<p>After the last step, the sequence restarts if the <a class="reference internal" href="../../applications/nrf_desktop/doc/led_state.html#c.led_effect.loop_forever" title="led_effect.loop_forever"><code class="xref c c-member docutils literal notranslate"><span class="pre">led_effect.loop_forever</span></code></a> flag is set for the given LED effect.
If the flag is not set, the sequence stops and the given LED effect ends.</p>
</section>
<section id="power-management-events">
<h3><a class="toc-backref" href="#id11">Power management events</a><a class="headerlink" href="#power-management-events" title="Permalink to this heading"></a></h3>
<p>If the <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_CAF_LEDS_PM_EVENTS</span></code> Kconfig option is enabled, the module can react to following power management events:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">power_down_event</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wake_up_event</span></code></p></li>
</ul>
<p>If a <code class="docutils literal notranslate"><span class="pre">power_down_event</span></code> comes, the module turns LEDs off.
The PWM drivers are set to the suspended state to reduce power consumption.</p>
<p>If a <code class="docutils literal notranslate"><span class="pre">wake_up_event</span></code> comes, PWM drivers are set to state active and LED effects are updated.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="net_state.html" class="btn btn-neutral float-right" title="CAF: Network state module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="click_detector.html" class="btn btn-neutral" title="CAF: Click detector module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">

<table>
<tr>
<td>
    <p>
        &copy; Copyright 2019-2023, Nordic Semiconductor.
      Last updated on Mar 20, 2023.

    </p>
</td>
<td id="nordiclogo">
  <a href="https://www.nordicsemi.com/"><img src="../../_static/images/nordic-logo.png" border="0"/></a>
</td>
</tr>
</table>
  </div> 


</footer>

<div id="scroll-container">
  <button type="button" id="scroll-btn" class="btn">
    <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="#fff"/></svg>
  </button>
</div>

<script>
  const scrollBtn = document.querySelector("#scroll-btn");

  document.addEventListener("scroll", () => {
    if (window.scrollY > 400) {
          scrollBtn.style.visibility = "visible";
      } else {
          scrollBtn.style.visibility = "hidden";
      }
  });

  scrollBtn.addEventListener("click", () => {
      window.scrollTo({ top: 0, behavior: "smooth" });
  });
</script>
        </div>
      </div>
    </section>
  </div>
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> nRF Connect SDK</span>
       <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      
      <div class="rst-other-version ncs">
        <a href="../../../nrf/index.html">nRF Connect SDK</a>
      </div>
      
      <div class="rst-other-version nrfx">
        <a href="../../../nrfx/index.html">nrfx</a>
      </div>
      
      <div class="rst-other-version nrfxlib">
        <a href="../../../nrfxlib/README.html">nrfxlib</a>
      </div>
      
      <div class="rst-other-version zephyr">
        <a href="../../../zephyr/index.html">Zephyr Project</a>
      </div>
      
      <div class="rst-other-version mcuboot">
        <a href="../../../mcuboot/wrapper.html">MCUboot</a>
      </div>
      
      <div class="rst-other-version tfm">
        <a href="../../../tfm/index.html">Trusted Firmware-M</a>
      </div>
      
      <div class="rst-other-version matter">
        <a href="../../../matter/index.html">Matter</a>
      </div>
      
      <div class="rst-other-version kconfig">
        <a href="../../../kconfig/index.html">Kconfig Reference</a>
      </div>
    </div>
  </div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>