<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CAF: Power manager module &mdash; nRF Connect SDK 2.3.99 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/nordic.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/togglebutton.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/nrf.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/tabs.css" type="text/css" /> 
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="https://www.googletagmanager.com/gtag/js?id=G-ZPVZRKFQJR"></script>
        <script src="../../_static/js/ga-tracker.js"></script>
        <script data-culture="EN" id="CookieConsent" type="text/javascript" src="https://policy.app.cookieinformation.com/uc.js"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../_static/togglebutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/js/theme.js"></script>
<script
  type="text/javascript"
  src="../../_static/js/ncs.js"
></script>
<script src="../../_static/js/bootstrap.bundle.min.js"></script>

    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="CAF: Sensor data aggregator module" href="sensor_data_aggregator.html" />
    <link rel="prev" title="CAF: Network state module" href="net_state.html" />
<link
  href="../../_static/css/bootstrap.min.css"
  rel="stylesheet"
/>
<link
  rel="shortcut icon"
  href="../../_static/images/favicon.ico"
/>

</head>

<body class="wy-body-for-nav">
<div class="announcement"></div>
<div class="d-print-none ncs-header">
  <div class="container-xl ncs-header-top">
    <div class="row h-100">
      <div class="d-none d-md-block col-2">
        <div class="bg-white py-4 px-3 ml-2 ncs-header-logo">
          <img
            class="ncs-header-logo"
            src="../../_static/images/nordic-logo.png"
            alt=""
          />
        </div>
      </div>
      <div
        class="col-8 col-md-7 pl-md-4 d-flex align-self-center justify-content-center"
      >
        <form class="w-75" action="../../search.html" method="get">
          <div class="form-group">
            <input
              type="text"
              name="q"
              class="ncs-search-input form-control"
              placeholder="Search all docs..."
            />
          </div>
        </form>
      </div>
      <div class="col-4 col-md-3 d-md-block p-3 text-end">
        <div class="dropdown">
          <button
            class="btn dropdown-toggle ncs-btn-versions"
            type="button"
            id="dropdownMenuButton1"
            data-bs-toggle="dropdown"
            aria-expanded="false"
          >
            <span class="d-none d-md-inline">nRF Connect SDK</span>
            <span id="ncsversion" class="d-inline"></span>
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton"></div>
        </div>
      </div>
    </div>
  </div>
  <div class="ncs-header-nav">
    <div class="container-xl">
      <div class="row">
        <div class="col col-12 d-flex justify-content-center">
          <nav class="navbar navbar-dark navbar-expand-lg p-0">
            <span class="navbar-brand d-block d-lg-none py-2 pl-1"
              >Documentation sets</span
            >
            <button
              class="navbar-toggler"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#navbarNavAltMarkup"
              aria-controls="navbarNavAltMarkup"
              aria-expanded="false"
              aria-label="Toggle navigation"
            >
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
              <ul class="navbar-nav">
                <li class="nav-item active py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../nrf/index.html"
                    >nRF Connect SDK</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../nrfx/index.html"
                    >nrfx</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../nrfxlib/README.html"
                    >nrfxlib</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../zephyr/index.html"
                    >Zephyr Project</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../mcuboot/wrapper.html"
                    >MCUboot</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../tfm/index.html"
                    >Trusted Firmware-M</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../matter/index.html"
                    >Matter</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../kconfig/index.html"
                    >Kconfig Reference</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
              </ul>
            </div>
          </nav>
        </div>
      </div>
    </div>
  </div>
</div>

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> nRF Connect SDK
          </a>
              <div class="version">
                2.3.99
              </div>
<div id="searchbox" role="search">
  <div class="searchformwrapper">
    <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
  </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev_model.html">Development model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../app_dev.html">Application development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ecosystem_integration.html">Ecosystems integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nrf91.html">Working with nRF91 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nrf70.html">Working with nRF70 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nrf53.html">Working with nRF53 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nrf52.html">Working with nRF52 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../protocols.html">Protocols</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../applications.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../samples.html">Samples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../drivers.html">Drivers</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Libraries</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../bin/index.html">Binary libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bluetooth_services/index.html">Bluetooth libraries and services</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bootloader/index.html">Bootloader libraries</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Common Application Framework</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="caf_overview.html">Common Application Framework overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="ble_adv.html">CAF: Bluetooth LE advertising module</a></li>
<li class="toctree-l3"><a class="reference internal" href="ble_bond.html">CAF: Bluetooth LE bond module</a></li>
<li class="toctree-l3"><a class="reference internal" href="ble_smp.html">CAF: Simple Management Protocol module</a></li>
<li class="toctree-l3"><a class="reference internal" href="ble_state.html">CAF: Bluetooth LE state module</a></li>
<li class="toctree-l3"><a class="reference internal" href="ble_state_pm.html">CAF: Bluetooth state power manager module</a></li>
<li class="toctree-l3"><a class="reference internal" href="buttons.html">CAF: Buttons module</a></li>
<li class="toctree-l3"><a class="reference internal" href="buttons_pm_keep_alive.html">CAF: Power manager keep alive module for buttons</a></li>
<li class="toctree-l3"><a class="reference internal" href="click_detector.html">CAF: Click detector module</a></li>
<li class="toctree-l3"><a class="reference internal" href="leds.html">CAF: LEDs module</a></li>
<li class="toctree-l3"><a class="reference internal" href="net_state.html">CAF: Network state module</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">CAF: Power manager module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#implementation-details">Implementation details</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="sensor_data_aggregator.html">CAF: Sensor data aggregator module</a></li>
<li class="toctree-l3"><a class="reference internal" href="sensor_manager.html">CAF: Sensor manager module</a></li>
<li class="toctree-l3"><a class="reference internal" href="settings_loader.html">CAF: Settings loader module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../debug/index.html">Debug libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dfu/index.html">DFU libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gazell/index.html">Gazell libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modem/index.html">Modem libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mpsl/index.html">Multiprotocol Service Layer libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../networking/index.html">Libraries for networking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nfc/index.html">Libraries for NFC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nrf_rpc/index.html">nRF RPC libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../others/index.html">Other libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shell/index.html">Shell libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tfm/index.html">TF-M libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../zigbee/index.html">Libraries for Zigbee</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../scripts.html">Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../known_issues.html">Known issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../software_maturity.html">Software maturity levels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation.html">About this documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">nRF Connect SDK</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Libraries</a></li>
          <li class="breadcrumb-item"><a href="index.html">Common Application Framework</a></li>
      <li class="breadcrumb-item active">CAF: Power manager module</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/libraries/caf/power_manager.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="caf-power-manager-module">
<span id="caf-power-manager"></span><h1>CAF: Power manager module<a class="headerlink" href="#caf-power-manager-module" title="Permalink to this heading"></a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#configuration" id="id7">Configuration</a></p>
<ul>
<li><p><a class="reference internal" href="#timeout-configuration-options" id="id8">Timeout configuration options</a></p></li>
<li><p><a class="reference internal" href="#optional-boolean-for-keeping-the-system-on" id="id9">Optional boolean for keeping the system on</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#implementation-details" id="id10">Implementation details</a></p>
<ul>
<li><p><a class="reference internal" href="#power-states" id="id11">Power states</a></p></li>
<li><p><a class="reference internal" href="#restricting-power-states" id="id12">Restricting power states</a></p></li>
<li><p><a class="reference internal" href="#switching-to-low-power" id="id13">Switching to low power</a></p></li>
<li><p><a class="reference internal" href="#wake-up-scenarios" id="id14">Wake-up scenarios</a></p></li>
</ul>
</li>
</ul>
</div>
<p>The power manager module of the <a class="reference internal" href="index.html#lib-caf"><span class="std std-ref">Common Application Framework</span></a> (CAF) is responsible for reducing the energy consumption of battery-powered devices.
The module achieves this reduction by switching to low power modes when the device is not used for a longer period of time.</p>
<section id="configuration">
<h2><a class="toc-backref" href="#id7">Configuration</a><a class="headerlink" href="#configuration" title="Permalink to this heading"></a></h2>
<p>You can enable the power manager module by selecting the <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_CAF_POWER_MANAGER</span></code> option in the configuration.</p>
<p>This module uses Zephyr’s <span class="xref std std-ref">zephyr:pm_api</span> subsystem.</p>
<section id="timeout-configuration-options">
<h3><a class="toc-backref" href="#id8">Timeout configuration options</a><a class="headerlink" href="#timeout-configuration-options" title="Permalink to this heading"></a></h3>
<p>With the <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_CAF_POWER_MANAGER_TIMEOUT</span></code> configuration option, you can set the period of time after which the application enters the low power mode.
By default, the timeout is set to 120 seconds.</p>
<p>The <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_CAF_POWER_MANAGER_ERROR_TIMEOUT</span></code> sets the period of time after which the device is turned off upon an internal error.</p>
</section>
<section id="optional-boolean-for-keeping-the-system-on">
<h3><a class="toc-backref" href="#id9">Optional boolean for keeping the system on</a><a class="headerlink" href="#optional-boolean-for-keeping-the-system-on" title="Permalink to this heading"></a></h3>
<p>The <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_CAF_POWER_MANAGER_STAY_ON</span></code> lets the system stay on also when there are no active connections.</p>
<p>For more information about configuration options, check the help in the configuration tool.</p>
</section>
</section>
<section id="implementation-details">
<h2><a class="toc-backref" href="#id10">Implementation details</a><a class="headerlink" href="#implementation-details" title="Permalink to this heading"></a></h2>
<p>The power manager module is started when the “main” is ready (which is reported using <a class="reference internal" href="caf_overview.html#c.module_state_event" title="module_state_event"><code class="xref c c-struct docutils literal notranslate"><span class="pre">module_state_event</span></code></a>).</p>
<p>When started, it can do the following operations:</p>
<ul class="simple">
<li><p>Manage <a class="reference internal" href="#power-states">Power states</a></p></li>
<li><p>Trigger <a class="reference internal" href="#switching-to-low-power">Switching to low power</a></p></li>
<li><p>Handle <a class="reference internal" href="#wake-up-scenarios">Wake-up scenarios</a> from suspended or off states</p></li>
</ul>
<section id="power-states">
<h3><a class="toc-backref" href="#id11">Power states</a><a class="headerlink" href="#power-states" title="Permalink to this heading"></a></h3>
<p>The application can be in the following power states:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#idle">Idle</a></p></li>
<li><p><a class="reference internal" href="#suspended">Suspended</a></p></li>
<li><p><a class="reference internal" href="#off">Off</a></p></li>
<li><p><a class="reference internal" href="#error">Error</a></p></li>
</ul>
<p>The power manager module takes control of the overall operating system power state.</p>
<figure class="align-default" id="id6">
<img alt="Power manager state handling in CAF" src="../../_images/caf_power_manager_states.svg" /><figcaption>
<p><span class="caption-text">Power manager state handling in CAF</span><a class="headerlink" href="#id6" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>See the following section for more details about how the application state converts to the system power state.</p>
<section id="idle">
<h4>Idle<a class="headerlink" href="#idle" title="Permalink to this heading"></a></h4>
<p>In this state, the board power management is left totally to the operating system.
The peripherals can be turned on, including LEDs.</p>
<p>The application remains in this state indefinitely if any of the modules has restricted the allowed power level to <a class="reference internal" href="caf_overview.html#c.power_manager_level.POWER_MANAGER_LEVEL_ALIVE" title="POWER_MANAGER_LEVEL_ALIVE"><code class="xref c c-enum docutils literal notranslate"><span class="pre">POWER_MANAGER_LEVEL_ALIVE</span></code></a>.</p>
<p>If no module blocks other power states, the power-down counter is active.
On timeout, the power manager module sets the application to either the suspended or the off state.
There are some events that reset the power-down counter:</p>
<ul class="simple">
<li><p><a class="reference internal" href="caf_overview.html#c.keep_alive_event" title="keep_alive_event"><code class="xref c c-struct docutils literal notranslate"><span class="pre">keep_alive_event</span></code></a></p></li>
<li><p>The moment when the last module stops restricting <a class="reference internal" href="caf_overview.html#c.power_manager_level.POWER_MANAGER_LEVEL_ALIVE" title="POWER_MANAGER_LEVEL_ALIVE"><code class="xref c c-enum docutils literal notranslate"><span class="pre">POWER_MANAGER_LEVEL_ALIVE</span></code></a> - that is, at the moment when any power-down state is allowed, the counter is cleared too.</p></li>
</ul>
</section>
<section id="suspended">
<h4>Suspended<a class="headerlink" href="#suspended" title="Permalink to this heading"></a></h4>
<p>Upon power-down timeout, the power manager module switches the application to the suspended state if there is at least one module that restricts power-down levels to <a class="reference internal" href="caf_overview.html#c.power_manager_level.POWER_MANAGER_LEVEL_SUSPENDED" title="POWER_MANAGER_LEVEL_SUSPENDED"><code class="xref c c-enum docutils literal notranslate"><span class="pre">POWER_MANAGER_LEVEL_SUSPENDED</span></code></a> and there is no module that restricts power below level to any higher state (<a class="reference internal" href="caf_overview.html#c.power_manager_level.POWER_MANAGER_LEVEL_ALIVE" title="POWER_MANAGER_LEVEL_ALIVE"><code class="xref c c-enum docutils literal notranslate"><span class="pre">POWER_MANAGER_LEVEL_ALIVE</span></code></a>).</p>
<p>The other modules of the application, if applicable, will turn off the peripherals or switch them to standby to conserve power.
The operating system is kept in the <code class="xref c c-enum docutils literal notranslate"><span class="pre">PM_STATE_ACTIVE</span></code> state.</p>
<p>It is assumed that the operating system will conserve power by setting the CPU state to idle whenever possible.
The established connection is maintained.</p>
</section>
<section id="off">
<h4>Off<a class="headerlink" href="#off" title="Permalink to this heading"></a></h4>
<p>Upon power-down timeout, the power manager module switches the application to the deep sleep mode if no module restricts it.
This means that all the modules are restricted to <a class="reference internal" href="caf_overview.html#c.power_manager_level.POWER_MANAGER_LEVEL_OFF" title="POWER_MANAGER_LEVEL_OFF"><code class="xref c c-enum docutils literal notranslate"><span class="pre">POWER_MANAGER_LEVEL_OFF</span></code></a> or <a class="reference internal" href="caf_overview.html#c.power_manager_level.POWER_MANAGER_LEVEL_MAX" title="POWER_MANAGER_LEVEL_MAX"><code class="xref c c-enum docutils literal notranslate"><span class="pre">POWER_MANAGER_LEVEL_MAX</span></code></a>.</p>
<p>If applicable, the other modules of the application turn off the peripherals or switch them to standby to conserve power.
The operating system switches to the <code class="xref c c-enum docutils literal notranslate"><span class="pre">POWER_STATE_DEEP_SLEEP_1</span></code> state.
The devices are suspended and the CPU is switched to the deep sleep (off) mode.</p>
<p>A device reboot is required to exit this state.</p>
</section>
<section id="error">
<h4>Error<a class="headerlink" href="#error" title="Permalink to this heading"></a></h4>
<p>The power manager module checks if any application modules have reported an error condition.</p>
<p>When any application module switches to the error state (that is, broadcasts <a class="reference internal" href="caf_overview.html#c.module_state.MODULE_STATE_ERROR" title="MODULE_STATE_ERROR"><code class="xref c c-enum docutils literal notranslate"><span class="pre">MODULE_STATE_ERROR</span></code></a> through <a class="reference internal" href="caf_overview.html#c.module_state_event" title="module_state_event"><code class="xref c c-struct docutils literal notranslate"><span class="pre">module_state_event</span></code></a>), the power manager module puts the application into the error state.
Then, after the period of time defined by <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_CAF_POWER_MANAGER_ERROR_TIMEOUT</span></code>, it puts the application to the off state.
During this period, other modules can report the error condition to the user (for example, <a class="reference internal" href="leds.html#caf-leds"><span class="std std-ref">CAF: LEDs module</span></a> can keep working in the error state).</p>
</section>
</section>
<section id="restricting-power-states">
<h3><a class="toc-backref" href="#id12">Restricting power states</a><a class="headerlink" href="#restricting-power-states" title="Permalink to this heading"></a></h3>
<p>Any registered module can restrict the power state allowed by the usage of <a class="reference internal" href="caf_overview.html#c.power_manager_restrict_event" title="power_manager_restrict_event"><code class="xref c c-struct docutils literal notranslate"><span class="pre">power_manager_restrict_event</span></code></a>.
It provides the module ID and the deepest allowed power state.
The power manager module uses flags to restrict modes for any module.
This means that you can repeatedly send the <a class="reference internal" href="caf_overview.html#c.power_manager_restrict_event" title="power_manager_restrict_event"><code class="xref c c-struct docutils literal notranslate"><span class="pre">power_manager_restrict_event</span></code></a>.</p>
</section>
<section id="switching-to-low-power">
<h3><a class="toc-backref" href="#id13">Switching to low power</a><a class="headerlink" href="#switching-to-low-power" title="Permalink to this heading"></a></h3>
<p>When the power manager module detects that the application is about to enter the low power state (either suspended or off), it sends a <a class="reference internal" href="caf_overview.html#c.power_down_event" title="power_down_event"><code class="xref c c-struct docutils literal notranslate"><span class="pre">power_down_event</span></code></a>.
Other application modules react to this event by changing their configuration to low power, for example by turning off LEDs.</p>
<p>Some modules might not be ready to switch to the lower power state.
In such case, the module that is not yet ready should consume the <a class="reference internal" href="caf_overview.html#c.power_down_event" title="power_down_event"><code class="xref c c-struct docutils literal notranslate"><span class="pre">power_down_event</span></code></a> and change its internal state, so that it enters the low power state when ready.</p>
<p>After entering the low power state, each module must report this by sending a <a class="reference internal" href="caf_overview.html#c.module_state_event" title="module_state_event"><code class="xref c c-struct docutils literal notranslate"><span class="pre">module_state_event</span></code></a>.
The power manager module continues with the low power state change when it gets a notification that the module switched to the low power.</p>
<p>Only after all modules confirmed that they have entered the low power state (by not consuming the <a class="reference internal" href="caf_overview.html#c.power_down_event" title="power_down_event"><code class="xref c c-struct docutils literal notranslate"><span class="pre">power_down_event</span></code></a>), the power manager module sets the required application’s state.</p>
<p>If a disconnection happens while the device is in the suspended state, the power manager module switches the application to the off state.</p>
<p>However, the application can also be configured to keep the system in the suspended state when there are no active connections, instead of switching to the off state.
To select this behavior, use the <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_CAF_POWER_MANAGER_STAY_ON</span></code> configuration option.</p>
</section>
<section id="wake-up-scenarios">
<h3><a class="toc-backref" href="#id14">Wake-up scenarios</a><a class="headerlink" href="#wake-up-scenarios" title="Permalink to this heading"></a></h3>
<p>The application can be woken up in the following scenarios:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#wake-up-from-the-suspended-state">Wake-up from the suspended state</a></p></li>
<li><p><a class="reference internal" href="#wake-up-from-the-off-state">Wake-up from the off state</a></p></li>
</ul>
<section id="wake-up-from-the-suspended-state">
<h4>Wake-up from the suspended state<a class="headerlink" href="#wake-up-from-the-suspended-state" title="Permalink to this heading"></a></h4>
<p>Any module can trigger the application to switch from the suspended state back to the idle state by submitting a <a class="reference internal" href="caf_overview.html#c.wake_up_event" title="wake_up_event"><code class="xref c c-struct docutils literal notranslate"><span class="pre">wake_up_event</span></code></a>.
This is normally done on some external event, for example upon interaction from the user of the device.</p>
<p>The application modules receive a <a class="reference internal" href="caf_overview.html#c.wake_up_event" title="wake_up_event"><code class="xref c c-struct docutils literal notranslate"><span class="pre">wake_up_event</span></code></a>, which switches them back to the normal operation.
The power manager module sets the application to the idle state.
This also restarts the power-down counter if the device is not connected through USB.</p>
</section>
<section id="wake-up-from-the-off-state">
<h4>Wake-up from the off state<a class="headerlink" href="#wake-up-from-the-off-state" title="Permalink to this heading"></a></h4>
<p>In the off state, the CPU is not running and the CPU reboot is required.</p>
<p>Before the application enters the off state, at least one module must configure the peripheral under its control, so that it issues a hardware-related event capable of rebooting the CPU (that is, capable of leaving the CPU off mode).
After the reboot, the application initializes itself again.</p>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="sensor_data_aggregator.html" class="btn btn-neutral float-right" title="CAF: Sensor data aggregator module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="net_state.html" class="btn btn-neutral" title="CAF: Network state module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">

<table>
<tr>
<td>
    <p>
        &copy; Copyright 2019-2023, Nordic Semiconductor.
      Last updated on Mar 20, 2023.

    </p>
</td>
<td id="nordiclogo">
  <a href="https://www.nordicsemi.com/"><img src="../../_static/images/nordic-logo.png" border="0"/></a>
</td>
</tr>
</table>
  </div> 


</footer>

<div id="scroll-container">
  <button type="button" id="scroll-btn" class="btn">
    <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="#fff"/></svg>
  </button>
</div>

<script>
  const scrollBtn = document.querySelector("#scroll-btn");

  document.addEventListener("scroll", () => {
    if (window.scrollY > 400) {
          scrollBtn.style.visibility = "visible";
      } else {
          scrollBtn.style.visibility = "hidden";
      }
  });

  scrollBtn.addEventListener("click", () => {
      window.scrollTo({ top: 0, behavior: "smooth" });
  });
</script>
        </div>
      </div>
    </section>
  </div>
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> nRF Connect SDK</span>
       <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      
      <div class="rst-other-version ncs">
        <a href="../../../nrf/index.html">nRF Connect SDK</a>
      </div>
      
      <div class="rst-other-version nrfx">
        <a href="../../../nrfx/index.html">nrfx</a>
      </div>
      
      <div class="rst-other-version nrfxlib">
        <a href="../../../nrfxlib/README.html">nrfxlib</a>
      </div>
      
      <div class="rst-other-version zephyr">
        <a href="../../../zephyr/index.html">Zephyr Project</a>
      </div>
      
      <div class="rst-other-version mcuboot">
        <a href="../../../mcuboot/wrapper.html">MCUboot</a>
      </div>
      
      <div class="rst-other-version tfm">
        <a href="../../../tfm/index.html">Trusted Firmware-M</a>
      </div>
      
      <div class="rst-other-version matter">
        <a href="../../../matter/index.html">Matter</a>
      </div>
      
      <div class="rst-other-version kconfig">
        <a href="../../../kconfig/index.html">Kconfig Reference</a>
      </div>
    </div>
  </div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>