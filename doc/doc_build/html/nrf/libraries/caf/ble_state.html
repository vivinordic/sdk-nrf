<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CAF: Bluetooth LE state module &mdash; nRF Connect SDK 2.3.99 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/nordic.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/togglebutton.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/nrf.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/tabs.css" type="text/css" /> 
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="https://www.googletagmanager.com/gtag/js?id=G-ZPVZRKFQJR"></script>
        <script src="../../_static/js/ga-tracker.js"></script>
        <script data-culture="EN" id="CookieConsent" type="text/javascript" src="https://policy.app.cookieinformation.com/uc.js"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../_static/togglebutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/js/theme.js"></script>
<script
  type="text/javascript"
  src="../../_static/js/ncs.js"
></script>
<script src="../../_static/js/bootstrap.bundle.min.js"></script>

    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="CAF: Bluetooth state power manager module" href="ble_state_pm.html" />
    <link rel="prev" title="CAF: Simple Management Protocol module" href="ble_smp.html" />
<link
  href="../../_static/css/bootstrap.min.css"
  rel="stylesheet"
/>
<link
  rel="shortcut icon"
  href="../../_static/images/favicon.ico"
/>

</head>

<body class="wy-body-for-nav">
<div class="announcement"></div>
<div class="d-print-none ncs-header">
  <div class="container-xl ncs-header-top">
    <div class="row h-100">
      <div class="d-none d-md-block col-2">
        <div class="bg-white py-4 px-3 ml-2 ncs-header-logo">
          <img
            class="ncs-header-logo"
            src="../../_static/images/nordic-logo.png"
            alt=""
          />
        </div>
      </div>
      <div
        class="col-8 col-md-7 pl-md-4 d-flex align-self-center justify-content-center"
      >
        <form class="w-75" action="../../search.html" method="get">
          <div class="form-group">
            <input
              type="text"
              name="q"
              class="ncs-search-input form-control"
              placeholder="Search all docs..."
            />
          </div>
        </form>
      </div>
      <div class="col-4 col-md-3 d-md-block p-3 text-end">
        <div class="dropdown">
          <button
            class="btn dropdown-toggle ncs-btn-versions"
            type="button"
            id="dropdownMenuButton1"
            data-bs-toggle="dropdown"
            aria-expanded="false"
          >
            <span class="d-none d-md-inline">nRF Connect SDK</span>
            <span id="ncsversion" class="d-inline"></span>
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton"></div>
        </div>
      </div>
    </div>
  </div>
  <div class="ncs-header-nav">
    <div class="container-xl">
      <div class="row">
        <div class="col col-12 d-flex justify-content-center">
          <nav class="navbar navbar-dark navbar-expand-lg p-0">
            <span class="navbar-brand d-block d-lg-none py-2 pl-1"
              >Documentation sets</span
            >
            <button
              class="navbar-toggler"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#navbarNavAltMarkup"
              aria-controls="navbarNavAltMarkup"
              aria-expanded="false"
              aria-label="Toggle navigation"
            >
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
              <ul class="navbar-nav">
                <li class="nav-item active py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../nrf/index.html"
                    >nRF Connect SDK</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../nrfx/index.html"
                    >nrfx</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../nrfxlib/README.html"
                    >nrfxlib</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../zephyr/index.html"
                    >Zephyr Project</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../mcuboot/wrapper.html"
                    >MCUboot</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../tfm/index.html"
                    >Trusted Firmware-M</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../matter/index.html"
                    >Matter</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../kconfig/index.html"
                    >Kconfig Reference</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
              </ul>
            </div>
          </nav>
        </div>
      </div>
    </div>
  </div>
</div>

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> nRF Connect SDK
          </a>
              <div class="version">
                2.3.99
              </div>
<div id="searchbox" role="search">
  <div class="searchformwrapper">
    <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
  </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev_model.html">Development model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../app_dev.html">Application development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ecosystem_integration.html">Ecosystems integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nrf91.html">Working with nRF91 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nrf70.html">Working with nRF70 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nrf53.html">Working with nRF53 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nrf52.html">Working with nRF52 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../protocols.html">Protocols</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../applications.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../samples.html">Samples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../drivers.html">Drivers</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Libraries</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../bin/index.html">Binary libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bluetooth_services/index.html">Bluetooth libraries and services</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bootloader/index.html">Bootloader libraries</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Common Application Framework</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="caf_overview.html">Common Application Framework overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="ble_adv.html">CAF: Bluetooth LE advertising module</a></li>
<li class="toctree-l3"><a class="reference internal" href="ble_bond.html">CAF: Bluetooth LE bond module</a></li>
<li class="toctree-l3"><a class="reference internal" href="ble_smp.html">CAF: Simple Management Protocol module</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">CAF: Bluetooth LE state module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#implementation-details">Implementation details</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="ble_state_pm.html">CAF: Bluetooth state power manager module</a></li>
<li class="toctree-l3"><a class="reference internal" href="buttons.html">CAF: Buttons module</a></li>
<li class="toctree-l3"><a class="reference internal" href="buttons_pm_keep_alive.html">CAF: Power manager keep alive module for buttons</a></li>
<li class="toctree-l3"><a class="reference internal" href="click_detector.html">CAF: Click detector module</a></li>
<li class="toctree-l3"><a class="reference internal" href="leds.html">CAF: LEDs module</a></li>
<li class="toctree-l3"><a class="reference internal" href="net_state.html">CAF: Network state module</a></li>
<li class="toctree-l3"><a class="reference internal" href="power_manager.html">CAF: Power manager module</a></li>
<li class="toctree-l3"><a class="reference internal" href="sensor_data_aggregator.html">CAF: Sensor data aggregator module</a></li>
<li class="toctree-l3"><a class="reference internal" href="sensor_manager.html">CAF: Sensor manager module</a></li>
<li class="toctree-l3"><a class="reference internal" href="settings_loader.html">CAF: Settings loader module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../debug/index.html">Debug libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dfu/index.html">DFU libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gazell/index.html">Gazell libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modem/index.html">Modem libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mpsl/index.html">Multiprotocol Service Layer libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../networking/index.html">Libraries for networking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nfc/index.html">Libraries for NFC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nrf_rpc/index.html">nRF RPC libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../others/index.html">Other libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shell/index.html">Shell libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tfm/index.html">TF-M libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../zigbee/index.html">Libraries for Zigbee</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../scripts.html">Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../known_issues.html">Known issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../software_maturity.html">Software maturity levels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation.html">About this documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">nRF Connect SDK</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Libraries</a></li>
          <li class="breadcrumb-item"><a href="index.html">Common Application Framework</a></li>
      <li class="breadcrumb-item active">CAF: Bluetooth LE state module</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/libraries/caf/ble_state.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="caf-bluetooth-le-state-module">
<span id="caf-ble-state"></span><h1>CAF: Bluetooth LE state module<a class="headerlink" href="#caf-bluetooth-le-state-module" title="Permalink to this heading"></a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#configuration" id="id7">Configuration</a></p></li>
<li><p><a class="reference internal" href="#implementation-details" id="id8">Implementation details</a></p>
<ul>
<li><p><a class="reference internal" href="#connection-state-change" id="id9">Connection state change</a></p></li>
<li><p><a class="reference internal" href="#connection-parameter-change" id="id10">Connection parameter change</a></p></li>
<li><p><a class="reference internal" href="#connection-references" id="id11">Connection references</a></p></li>
<li><p><a class="reference internal" href="#behavior-with-softdevice-link-layer" id="id12">Behavior with SoftDevice Link Layer</a></p></li>
</ul>
</li>
</ul>
</div>
<p>The Bluetooth® LE state module is a core Bluetooth module in <a class="reference internal" href="index.html#lib-caf"><span class="std std-ref">Common Application Framework</span></a> (CAF).
When enabled for an application, the Bluetooth LE state module is responsible for the following actions:</p>
<ul class="simple">
<li><p>Enabling Bluetooth (<code class="xref c c-func docutils literal notranslate"><span class="pre">bt_enable()</span></code>)</p></li>
<li><p>Handling Bluetooth connection callbacks (<code class="xref c c-struct docutils literal notranslate"><span class="pre">bt_conn_cb</span></code>)</p></li>
<li><p>Propagating information about the connection state and parameters with <a class="reference internal" href="../others/app_event_manager.html#app-event-manager"><span class="std std-ref">Application Event Manager</span></a> events</p></li>
</ul>
<p>The Bluetooth LE state module does not handle Bluetooth advertising or scanning.
If you want to use these functionalities to connect over Bluetooth LE, use <a class="reference internal" href="ble_adv.html#caf-ble-adv"><span class="std std-ref">CAF’s Bluetooth LE advertising module</span></a> or Zephyr’s <span class="xref std std-ref">Bluetooth API</span> directly.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>CAF assumes that Bluetooth Peripheral device supports only one simultaneous connection.</p>
</div>
<section id="configuration">
<h2><a class="toc-backref" href="#id7">Configuration</a><a class="headerlink" href="#configuration" title="Permalink to this heading"></a></h2>
<p>To use the module, you must enable the following Kconfig options:</p>
<ul class="simple">
<li><p><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_BT</span></code></p></li>
<li><p><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_BT_SMP</span></code> - This option enables Security Manager Protocol support.</p></li>
<li><p><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_CAF_BLE_STATE</span></code> - This option enables the Bluetooth LE state module and selects the <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_CAF_BLE_COMMON_EVENTS</span></code> Kconfig option, which enables Bluetooth LE common events in CAF.</p></li>
</ul>
<p>The following Kconfig options are also available for this module:</p>
<ul class="simple">
<li><p><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_CAF_BLE_STATE_EXCHANGE_MTU</span></code> - This option can be used for GATT client (<code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_BT_GATT_CLIENT</span></code>) to set the Maximum Transmission Unit (MTU) to the maximum possible size that the buffers can hold.
This option is enabled by default.</p></li>
<li><p><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_CAF_BLE_USE_LLPM</span></code> - This option enables the Low Latency Packet Mode (LLPM).
This option is enabled by default and depends on <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_BT_CTLR_SDC_LLPM</span></code> and <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_BT_LL_SOFTDEVICE</span></code>.</p></li>
<li><p><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_CAF_BLE_STATE_SECURITY_REQ</span></code> - This option enables setting the security level 2 for a Bluetooth LE connection automatically, right after the connection is established.
The security level 2 or higher enables connection encryption.
The device disconnects if establishing the connection security level 2 fails.</p></li>
<li><p><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_CAF_BLE_STATE_MAX_LOCAL_ID_BONDS</span></code> - This option allows to specify the maximum number of allowed bonds per Bluetooth local identity for a Bluetooth Peripheral (<code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_BT_PERIPHERAL</span></code>).
If a local identity is already bonded with the maximum number of allowed bonds, new peers are disconnected right after Bluetooth connection is established.</p></li>
</ul>
</section>
<section id="implementation-details">
<h2><a class="toc-backref" href="#id8">Implementation details</a><a class="headerlink" href="#implementation-details" title="Permalink to this heading"></a></h2>
<p>The Bluetooth LE state module is used by both Bluetooth Peripheral and Bluetooth Central devices.</p>
<p>In line with other CAF modules, the Bluetooth LE state module uses <a class="reference internal" href="../others/app_event_manager.html#app-event-manager"><span class="std std-ref">Application Event Manager</span></a> events to broadcast changes in connection state and parameters.
It also updates connection reference counts to ensure the connections remain valid as long as application modules use them.</p>
<section id="connection-state-change">
<h3><a class="toc-backref" href="#id9">Connection state change</a><a class="headerlink" href="#connection-state-change" title="Permalink to this heading"></a></h3>
<p>The module propagates information about the connection state changes using <a class="reference internal" href="caf_overview.html#c.ble_peer_event" title="ble_peer_event"><code class="xref c c-struct docutils literal notranslate"><span class="pre">ble_peer_event</span></code></a>.
In this event, <a class="reference internal" href="caf_overview.html#c.ble_peer_event.id" title="ble_peer_event.id"><code class="xref c c-member docutils literal notranslate"><span class="pre">ble_peer_event.id</span></code></a> is a pointer to the connection object and <a class="reference internal" href="caf_overview.html#c.ble_peer_event.state" title="ble_peer_event.state"><code class="xref c c-member docutils literal notranslate"><span class="pre">ble_peer_event.state</span></code></a> is the connection state.</p>
<figure class="align-default" id="id6">
<img alt="Bluetooth connection state handling in CAF" src="../../_images/caf_ble_state_transitions.svg" /><figcaption>
<p><span class="caption-text">Bluetooth connection state handling in CAF</span><a class="headerlink" href="#id6" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>The connection state can be set to one of the following values:</p>
<ul class="simple">
<li><p><a class="reference internal" href="caf_overview.html#c.peer_state.PEER_STATE_CONNECTED" title="PEER_STATE_CONNECTED"><code class="xref c c-enum docutils literal notranslate"><span class="pre">PEER_STATE_CONNECTED</span></code></a> - Bluetooth stack successfully connected to the remote peer.</p></li>
<li><p><a class="reference internal" href="caf_overview.html#c.peer_state.PEER_STATE_CONN_FAILED" title="PEER_STATE_CONN_FAILED"><code class="xref c c-enum docutils literal notranslate"><span class="pre">PEER_STATE_CONN_FAILED</span></code></a> - Bluetooth stack failed to connect the remote peer.</p></li>
<li><p><a class="reference internal" href="caf_overview.html#c.peer_state.PEER_STATE_SECURED" title="PEER_STATE_SECURED"><code class="xref c c-enum docutils literal notranslate"><span class="pre">PEER_STATE_SECURED</span></code></a> - Bluetooth stack set the connection security to at least level 2 (that is, encryption and no authentication).</p></li>
<li><p><a class="reference internal" href="caf_overview.html#c.peer_state.PEER_STATE_DISCONNECTED" title="PEER_STATE_DISCONNECTED"><code class="xref c c-enum docutils literal notranslate"><span class="pre">PEER_STATE_DISCONNECTED</span></code></a> - Bluetooth stack disconnected from the remote peer.</p></li>
</ul>
<p>Other application modules can call <code class="xref c c-func docutils literal notranslate"><span class="pre">bt_conn_disconnect()</span></code> to disconnect the remote peer.
The application module can submit a <a class="reference internal" href="caf_overview.html#c.ble_peer_event" title="ble_peer_event"><code class="xref c c-struct docutils literal notranslate"><span class="pre">ble_peer_event</span></code></a> with <a class="reference internal" href="caf_overview.html#c.ble_peer_event.state" title="ble_peer_event.state"><code class="xref c c-member docutils literal notranslate"><span class="pre">ble_peer_event.state</span></code></a> set to <a class="reference internal" href="caf_overview.html#c.peer_state.PEER_STATE_DISCONNECTING" title="PEER_STATE_DISCONNECTING"><code class="xref c c-enum docutils literal notranslate"><span class="pre">PEER_STATE_DISCONNECTING</span></code></a> to let other application modules prepare for the disconnection.</p>
</section>
<section id="connection-parameter-change">
<h3><a class="toc-backref" href="#id10">Connection parameter change</a><a class="headerlink" href="#connection-parameter-change" title="Permalink to this heading"></a></h3>
<p>The module submits a <a class="reference internal" href="caf_overview.html#c.ble_peer_conn_params_event" title="ble_peer_conn_params_event"><code class="xref c c-struct docutils literal notranslate"><span class="pre">ble_peer_conn_params_event</span></code></a> to inform other application modules about connection parameter update requests and connection parameter updates.</p>
<p>The Bluetooth LE state module rejects the connection parameter update request in Zephyr’s callback.
An application module can handle the <a class="reference internal" href="caf_overview.html#c.ble_peer_conn_params_event" title="ble_peer_conn_params_event"><code class="xref c c-struct docutils literal notranslate"><span class="pre">ble_peer_conn_params_event</span></code></a> and update the connection parameters.</p>
</section>
<section id="connection-references">
<h3><a class="toc-backref" href="#id11">Connection references</a><a class="headerlink" href="#connection-references" title="Permalink to this heading"></a></h3>
<p>The Bluetooth LE state module keeps references to <code class="xref c c-struct docutils literal notranslate"><span class="pre">bt_conn</span></code> objects to ensure that they remain valid when other application modules access them.
When a new connection is established, the module calls <code class="xref c c-func docutils literal notranslate"><span class="pre">bt_conn_ref()</span></code> to increase the object reference counter.
After <a class="reference internal" href="caf_overview.html#c.ble_peer_event" title="ble_peer_event"><code class="xref c c-struct docutils literal notranslate"><span class="pre">ble_peer_event</span></code></a> about disconnection or connection failure is received by all other application modules, the Bluetooth LE state module decrements the <code class="xref c c-struct docutils literal notranslate"><span class="pre">bt_conn</span></code> object by using <code class="xref c c-func docutils literal notranslate"><span class="pre">bt_conn_unref()</span></code>.</p>
</section>
<section id="behavior-with-softdevice-link-layer">
<h3><a class="toc-backref" href="#id12">Behavior with SoftDevice Link Layer</a><a class="headerlink" href="#behavior-with-softdevice-link-layer" title="Permalink to this heading"></a></h3>
<p>If Nordic Semiconductor’s SoftDevice Bluetooth LE Link Layer is selected (<code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_BT_LL_SOFTDEVICE</span></code>) and the <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_CAF_BLE_USE_LLPM</span></code> option is enabled, the Bluetooth LE state module sends a Bluetooth HCI command to enable the LLPM when Bluetooth is ready.</p>
<p>If the SoftDevice Link Layer is selected, the Bluetooth LE state module also sets the TX power for connections.
The TX power is set according to Zephyr’s Kconfig options related to selecting the default TX power.
This is necessary because the mentioned Kconfig options are not automatically applied by the Bluetooth stack if the SoftDevice Link Layer is selected.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ble_state_pm.html" class="btn btn-neutral float-right" title="CAF: Bluetooth state power manager module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="ble_smp.html" class="btn btn-neutral" title="CAF: Simple Management Protocol module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">

<table>
<tr>
<td>
    <p>
        &copy; Copyright 2019-2023, Nordic Semiconductor.
      Last updated on Mar 20, 2023.

    </p>
</td>
<td id="nordiclogo">
  <a href="https://www.nordicsemi.com/"><img src="../../_static/images/nordic-logo.png" border="0"/></a>
</td>
</tr>
</table>
  </div> 


</footer>

<div id="scroll-container">
  <button type="button" id="scroll-btn" class="btn">
    <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="#fff"/></svg>
  </button>
</div>

<script>
  const scrollBtn = document.querySelector("#scroll-btn");

  document.addEventListener("scroll", () => {
    if (window.scrollY > 400) {
          scrollBtn.style.visibility = "visible";
      } else {
          scrollBtn.style.visibility = "hidden";
      }
  });

  scrollBtn.addEventListener("click", () => {
      window.scrollTo({ top: 0, behavior: "smooth" });
  });
</script>
        </div>
      </div>
    </section>
  </div>
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> nRF Connect SDK</span>
       <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      
      <div class="rst-other-version ncs">
        <a href="../../../nrf/index.html">nRF Connect SDK</a>
      </div>
      
      <div class="rst-other-version nrfx">
        <a href="../../../nrfx/index.html">nrfx</a>
      </div>
      
      <div class="rst-other-version nrfxlib">
        <a href="../../../nrfxlib/README.html">nrfxlib</a>
      </div>
      
      <div class="rst-other-version zephyr">
        <a href="../../../zephyr/index.html">Zephyr Project</a>
      </div>
      
      <div class="rst-other-version mcuboot">
        <a href="../../../mcuboot/wrapper.html">MCUboot</a>
      </div>
      
      <div class="rst-other-version tfm">
        <a href="../../../tfm/index.html">Trusted Firmware-M</a>
      </div>
      
      <div class="rst-other-version matter">
        <a href="../../../matter/index.html">Matter</a>
      </div>
      
      <div class="rst-other-version kconfig">
        <a href="../../../kconfig/index.html">Kconfig Reference</a>
      </div>
    </div>
  </div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>