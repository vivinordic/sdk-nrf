<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TNEP for tag device &mdash; nRF Connect SDK 2.3.99 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/nordic.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/togglebutton.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/nrf.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/tabs.css" type="text/css" /> 
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
        <script src="https://www.googletagmanager.com/gtag/js?id=G-ZPVZRKFQJR"></script>
        <script src="../../../_static/js/ga-tracker.js"></script>
        <script data-culture="EN" id="CookieConsent" type="text/javascript" src="https://policy.app.cookieinformation.com/uc.js"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../../_static/togglebutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/js/theme.js"></script>
<script
  type="text/javascript"
  src="../../../_static/js/ncs.js"
></script>
<script src="../../../_static/js/bootstrap.bundle.min.js"></script>

    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="nRF RPC libraries" href="../../nrf_rpc/index.html" />
    <link rel="prev" title="TNEP for polling device" href="poller.html" />
<link
  href="../../../_static/css/bootstrap.min.css"
  rel="stylesheet"
/>
<link
  rel="shortcut icon"
  href="../../../_static/images/favicon.ico"
/>

</head>

<body class="wy-body-for-nav">
<div class="announcement"></div>
<div class="d-print-none ncs-header">
  <div class="container-xl ncs-header-top">
    <div class="row h-100">
      <div class="d-none d-md-block col-2">
        <div class="bg-white py-4 px-3 ml-2 ncs-header-logo">
          <img
            class="ncs-header-logo"
            src="../../../_static/images/nordic-logo.png"
            alt=""
          />
        </div>
      </div>
      <div
        class="col-8 col-md-7 pl-md-4 d-flex align-self-center justify-content-center"
      >
        <form class="w-75" action="../../../search.html" method="get">
          <div class="form-group">
            <input
              type="text"
              name="q"
              class="ncs-search-input form-control"
              placeholder="Search all docs..."
            />
          </div>
        </form>
      </div>
      <div class="col-4 col-md-3 d-md-block p-3 text-end">
        <div class="dropdown">
          <button
            class="btn dropdown-toggle ncs-btn-versions"
            type="button"
            id="dropdownMenuButton1"
            data-bs-toggle="dropdown"
            aria-expanded="false"
          >
            <span class="d-none d-md-inline">nRF Connect SDK</span>
            <span id="ncsversion" class="d-inline"></span>
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton"></div>
        </div>
      </div>
    </div>
  </div>
  <div class="ncs-header-nav">
    <div class="container-xl">
      <div class="row">
        <div class="col col-12 d-flex justify-content-center">
          <nav class="navbar navbar-dark navbar-expand-lg p-0">
            <span class="navbar-brand d-block d-lg-none py-2 pl-1"
              >Documentation sets</span
            >
            <button
              class="navbar-toggler"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#navbarNavAltMarkup"
              aria-controls="navbarNavAltMarkup"
              aria-expanded="false"
              aria-label="Toggle navigation"
            >
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
              <ul class="navbar-nav">
                <li class="nav-item active py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../nrf/index.html"
                    >nRF Connect SDK</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../nrfx/index.html"
                    >nrfx</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../nrfxlib/README.html"
                    >nrfxlib</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../zephyr/index.html"
                    >Zephyr Project</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../mcuboot/wrapper.html"
                    >MCUboot</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../tfm/index.html"
                    >Trusted Firmware-M</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../matter/index.html"
                    >Matter</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../kconfig/index.html"
                    >Kconfig Reference</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
              </ul>
            </div>
          </nav>
        </div>
      </div>
    </div>
  </div>
</div>

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> nRF Connect SDK
          </a>
              <div class="version">
                2.3.99
              </div>
<div id="searchbox" role="search">
  <div class="searchformwrapper">
    <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
  </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev_model.html">Development model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../app_dev.html">Application development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ecosystem_integration.html">Ecosystems integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nrf91.html">Working with nRF91 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nrf70.html">Working with nRF70 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nrf53.html">Working with nRF53 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nrf52.html">Working with nRF52 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../protocols.html">Protocols</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../applications.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../samples.html">Samples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../drivers.html">Drivers</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Libraries</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../bin/index.html">Binary libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../bluetooth_services/index.html">Bluetooth libraries and services</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../bootloader/index.html">Bootloader libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../caf/index.html">Common Application Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../debug/index.html">Debug libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dfu/index.html">DFU libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../gazell/index.html">Gazell libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../modem/index.html">Modem libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../mpsl/index.html">Multiprotocol Service Layer libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../networking/index.html">Libraries for networking</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Libraries for NFC</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../ndef/index.html">NFC Data Exchange Format (NDEF)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../t2t/index.html">Type 2 Tag</a></li>
<li class="toctree-l3"><a class="reference internal" href="../t4t/index.html">Type 4 Tag</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Tag NDEF Exchange Protocol (TNEP)</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="ch.html">NFC TNEP Connection Handover</a></li>
<li class="toctree-l4"><a class="reference internal" href="poller.html">TNEP for polling device</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">TNEP for tag device</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../nrf_rpc/index.html">nRF RPC libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../others/index.html">Other libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../shell/index.html">Shell libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tfm/index.html">TF-M libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../zigbee/index.html">Libraries for Zigbee</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../scripts.html">Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../release_notes.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../known_issues.html">Known issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../software_maturity.html">Software maturity levels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation.html">About this documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">nRF Connect SDK</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Libraries</a></li>
          <li class="breadcrumb-item"><a href="../index.html">Libraries for NFC</a></li>
          <li class="breadcrumb-item"><a href="index.html">Tag NDEF Exchange Protocol (TNEP)</a></li>
      <li class="breadcrumb-item active">TNEP for tag device</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/libraries/nfc/tnep/tag.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="tnep-for-tag-device">
<span id="tnep-tag-readme"></span><h1>TNEP for tag device<a class="headerlink" href="#tnep-for-tag-device" title="Permalink to this heading"></a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#initialization" id="id7">Initialization</a></p>
<ul>
<li><p><a class="reference internal" href="#configuring-ndef-message-buffers" id="id8">Configuring NDEF message buffers</a></p></li>
<li><p><a class="reference internal" href="#defining-tnep-services" id="id9">Defining TNEP services</a></p></li>
<li><p><a class="reference internal" href="#initial-tnep-ndef-message" id="id10">Initial TNEP NDEF message</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#configuration" id="id11">Configuration</a></p></li>
<li><p><a class="reference internal" href="#receiving-new-messages" id="id12">Receiving new messages</a></p></li>
<li><p><a class="reference internal" href="#api-documentation" id="id13">API documentation</a></p></li>
</ul>
</div>
<p>This library provides an implementation of the Tag NDEF Exchange Protocol (TNEP) for an NFC tag device.</p>
<p>It is used in the <a class="reference internal" href="../../../samples/nfc/tnep_tag/README.html#nfc-tnep-tag"><span class="std std-ref">NFC: TNEP tag</span></a> sample.</p>
<section id="initialization">
<h2><a class="toc-backref" href="#id7">Initialization</a><a class="headerlink" href="#initialization" title="Permalink to this heading"></a></h2>
<p>Before using the TNEP library in an NFC tag application, you must configure the NDEF message buffers and define the TNEP services.</p>
<section id="configuring-ndef-message-buffers">
<h3><a class="toc-backref" href="#id8">Configuring NDEF message buffers</a><a class="headerlink" href="#configuring-ndef-message-buffers" title="Permalink to this heading"></a></h3>
<p>The tag library communicates with the <span class="xref std std-ref">nrfxlib:type_4_tag</span> library using NDEF message buffers.
The buffers are initialized all at the same time by <a class="reference internal" href="#c.nfc_tnep_tag_tx_msg_buffer_register" title="nfc_tnep_tag_tx_msg_buffer_register"><code class="xref c c-func docutils literal notranslate"><span class="pre">nfc_tnep_tag_tx_msg_buffer_register()</span></code></a>.</p>
<p>To use the NDEF message buffers, you must configure the following elements:</p>
<ul class="simple">
<li><p>Provide a pointer to two TX buffers - one for the NDEF message used for tag emulation and another one for encoding the new NDEF message for later usage.</p></li>
<li><p>Set a maximum buffer size in bytes, which is valid for both buffers.</p></li>
</ul>
<p>The buffers must be linked with the tag layer in the application.</p>
<p>When the polling device writes a new NDEF message to the tag buffer, the application must inform the tag library by calling <a class="reference internal" href="#c.nfc_tnep_tag_rx_msg_indicate" title="nfc_tnep_tag_rx_msg_indicate"><code class="xref c c-func docutils literal notranslate"><span class="pre">nfc_tnep_tag_rx_msg_indicate()</span></code></a>.</p>
</section>
<section id="defining-tnep-services">
<h3><a class="toc-backref" href="#id9">Defining TNEP services</a><a class="headerlink" href="#defining-tnep-services" title="Permalink to this heading"></a></h3>
<p>TNEP provides mechanisms for creating services and exchanging data through these services.
The client (application or upper-layer protocol) must define these services and use them for data transfer.
At least one TNEP service must be defined for the initial NDEF message to be created.</p>
<p>To create a TNEP service, use the <a class="reference internal" href="#c.NFC_TNEP_TAG_SERVICE_DEF" title="NFC_TNEP_TAG_SERVICE_DEF"><code class="xref c c-macro docutils literal notranslate"><span class="pre">NFC_TNEP_TAG_SERVICE_DEF</span></code></a> macro.
The service data is stored in the persistent storage.</p>
</section>
<section id="initial-tnep-ndef-message">
<h3><a class="toc-backref" href="#id10">Initial TNEP NDEF message</a><a class="headerlink" href="#initial-tnep-ndef-message" title="Permalink to this heading"></a></h3>
<p>When calling the <a class="reference internal" href="#c.nfc_tnep_tag_initial_msg_create" title="nfc_tnep_tag_initial_msg_create"><code class="xref c c-func docutils literal notranslate"><span class="pre">nfc_tnep_tag_initial_msg_create()</span></code></a> function, the service data is loaded and the Service Parameter record of each service is inserted into the Initial TNEP message.
A Service Parameter record contains parameters for communicating with the service.
You can also encode additional NDEF records into the Initial TNEP message in the following way:</p>
<ol class="arabic simple">
<li><p>Pass a callback to <a class="reference internal" href="#c.nfc_tnep_tag_initial_msg_create" title="nfc_tnep_tag_initial_msg_create"><code class="xref c c-func docutils literal notranslate"><span class="pre">nfc_tnep_tag_initial_msg_create()</span></code></a>.</p></li>
<li><p>Define an additional record inside the callback and call <a class="reference internal" href="#c.nfc_tnep_initial_msg_encode" title="nfc_tnep_initial_msg_encode"><code class="xref c c-func docutils literal notranslate"><span class="pre">nfc_tnep_initial_msg_encode()</span></code></a>.</p></li>
</ol>
<p>See the following code for an example of the Initial message encoding:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">tnep_initial_msg_encode</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">nfc_ndef_msg_desc</span><span class="w"> </span><span class="o">*</span><span class="n">msg</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="k">const</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">text</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Hello World&quot;</span><span class="p">;</span>

<span class="w">	</span><span class="n">NFC_NDEF_TEXT_RECORD_DESC_DEF</span><span class="p">(</span><span class="n">nfc_text</span><span class="p">,</span><span class="w"> </span><span class="n">UTF_8</span><span class="p">,</span><span class="w"> </span><span class="n">en_code</span><span class="p">,</span>
<span class="w">				      </span><span class="k">sizeof</span><span class="p">(</span><span class="n">en_code</span><span class="p">),</span><span class="w"> </span><span class="n">text</span><span class="p">,</span>
<span class="w">				      </span><span class="n">strlen</span><span class="p">(</span><span class="n">text</span><span class="p">));</span>

<span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="n">nfc_tnep_initial_msg_encode</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span>
<span class="w">					   </span><span class="o">&amp;</span><span class="n">NFC_NDEF_TEXT_RECORD_DESC</span><span class="p">(</span><span class="n">nfc_text</span><span class="p">),</span>
<span class="w">					   </span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The following code shows how to create the Initial NDEF message:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="w">	</span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nfc_tnep_tag_initial_msg_create</span><span class="p">(</span><span class="n">TNEP_INITIAL_MSG_RECORD_COUNT</span><span class="p">,</span>
<span class="w">					      </span><span class="n">tnep_initial_msg_encode</span><span class="p">);</span>
<span class="w">	</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">		</span><span class="n">printk</span><span class="p">(</span><span class="s">&quot;Cannot create initial TNEP message, err: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="p">);</span>
<span class="w">	</span><span class="p">}</span>
</pre></div>
</div>
<p>See also the following code for an example of service definition and TNEP initialization:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define NFC_TNEP_TAG_SERVICE_DEF(service_name, uri, uri_length, mode, t_wait, n_wait, mac_msg_size</span>
<span class="w">                                                         </span><span class="n">select_cb</span><span class="p">,</span><span class="w"> </span><span class="n">deselect_cb</span><span class="w"> </span><span class="n">message_cb</span><span class="p">,</span><span class="w"> </span><span class="n">timeout_cb</span><span class="p">,</span><span class="w"> </span><span class="n">error_cb</span><span class="p">)</span>

<span class="n">nfc_tnep_tx_msg_buffer_register</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="n">swap_buffer</span><span class="p">,</span><span class="w"> </span><span class="n">buffer_length</span><span class="p">);</span>

<span class="n">nfc_tnep_init</span><span class="p">(</span><span class="n">event</span><span class="p">,</span><span class="w"> </span><span class="n">event_cnt</span><span class="p">,</span><span class="w"> </span><span class="n">nfc_txt_rw_payload_set</span><span class="p">);</span>

<span class="n">nfc_tXt_setup</span><span class="p">();</span>

<span class="n">nfc_tnep_tag_initial_msg_create</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>

<span class="n">nfc_tXt_emulation_start</span><span class="p">();</span>
</pre></div>
</div>
</section>
</section>
<section id="configuration">
<h2><a class="toc-backref" href="#id11">Configuration</a><a class="headerlink" href="#configuration" title="Permalink to this heading"></a></h2>
<p>After initialization, the tag library is in the Service Ready state and the NDEF message buffer contains Service Parameter records provided with the initial TNEP message.</p>
<p>The initial TNEP message can also include NDEF records that are not related with TNEP.
The polling device, which does not support TNEP, can still interact with them.</p>
<p>Make sure to call the <a class="reference internal" href="#c.nfc_tnep_tag_process" title="nfc_tnep_tag_process"><code class="xref c c-func docutils literal notranslate"><span class="pre">nfc_tnep_tag_process()</span></code></a> function in an infinite loop in the application.</p>
</section>
<section id="receiving-new-messages">
<h2><a class="toc-backref" href="#id12">Receiving new messages</a><a class="headerlink" href="#receiving-new-messages" title="Permalink to this heading"></a></h2>
<p>When a new NDEF message appears in the buffer and it contains a Service Select record, the application can select this service.
To do this, the application should inform the TNEP tag library of the received NDEF message by calling <a class="reference internal" href="#c.nfc_tnep_tag_rx_msg_indicate" title="nfc_tnep_tag_rx_msg_indicate"><code class="xref c c-func docutils literal notranslate"><span class="pre">nfc_tnep_tag_rx_msg_indicate()</span></code></a>.
The tag library will then change its state to Service Selected.
From that point, the service description message will no longer be provided.</p>
<p>After the successful service selection, the select callback function of the service is called.
If the tag library was already in Service Selected state when receiving the NDEF message with the Service Select record, the deselect callback of the previous service is called before the select callback of the new service.</p>
<p>When the library is in the Service Selected state, the service’s new message callback is called after successfully processing the new message.
Application data can be added to the reply message with <a class="reference internal" href="#c.nfc_tnep_tag_tx_msg_app_data" title="nfc_tnep_tag_tx_msg_app_data"><code class="xref c c-func docutils literal notranslate"><span class="pre">nfc_tnep_tag_tx_msg_app_data()</span></code></a>.
This function can be called from the Service Selected callback or from any other context, for example a different thread.</p>
<p>If the tag application has no more data, it will reply by using <a class="reference internal" href="#c.nfc_tnep_tag_tx_msg_no_app_data" title="nfc_tnep_tag_tx_msg_no_app_data"><code class="xref c c-func docutils literal notranslate"><span class="pre">nfc_tnep_tag_tx_msg_no_app_data()</span></code></a>.
If the application does not reply before the expiration on the time period specified by the service’s initialization parameters, the service will be deselected by the polling device.</p>
<p>The following code demonstrates how to exchange NDEF messages using the tag library after initialization:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">tnep_svc_one_selected</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="kt">int</span><span class="w"> </span><span class="n">err</span><span class="p">;</span>
<span class="w">	</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">svc_one_msg</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Service pi = 3.14159265358979323846&quot;</span><span class="p">;</span>

<span class="w">	</span><span class="n">printk</span><span class="p">(</span><span class="s">&quot;Service one selected</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

<span class="w">	</span><span class="n">NFC_TNEP_TAG_APP_MSG_DEF</span><span class="p">(</span><span class="n">app_msg</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">	</span><span class="n">NFC_NDEF_TEXT_RECORD_DESC_DEF</span><span class="p">(</span><span class="n">svc_one_rec</span><span class="p">,</span><span class="w"> </span><span class="n">UTF_8</span><span class="p">,</span><span class="w"> </span><span class="n">en_code</span><span class="p">,</span>
<span class="w">				      </span><span class="k">sizeof</span><span class="p">(</span><span class="n">en_code</span><span class="p">),</span><span class="w"> </span><span class="n">svc_one_msg</span><span class="p">,</span>
<span class="w">				      </span><span class="n">strlen</span><span class="p">(</span><span class="n">svc_one_msg</span><span class="p">));</span>

<span class="w">	</span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nfc_ndef_msg_record_add</span><span class="p">(</span><span class="o">&amp;</span><span class="n">NFC_NDEF_MSG</span><span class="p">(</span><span class="n">app_msg</span><span class="p">),</span>
<span class="w">				      </span><span class="o">&amp;</span><span class="n">NFC_NDEF_TEXT_RECORD_DESC</span><span class="p">(</span><span class="n">svc_one_rec</span><span class="p">));</span>

<span class="w">	</span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nfc_tnep_tag_tx_msg_app_data</span><span class="p">(</span><span class="o">&amp;</span><span class="n">NFC_NDEF_MSG</span><span class="p">(</span><span class="n">app_msg</span><span class="p">),</span>
<span class="w">					   </span><span class="n">NFC_TNEP_STATUS_SUCCESS</span><span class="p">);</span>
<span class="w">	</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">		</span><span class="n">printk</span><span class="p">(</span><span class="s">&quot;Service app data set err: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="p">);</span>
<span class="w">	</span><span class="p">}</span>

<span class="w">	</span><span class="n">dk_set_led_on</span><span class="p">(</span><span class="n">LED_SVC_ONE</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">tnep_svc_one_deselected</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="n">printk</span><span class="p">(</span><span class="s">&quot;Service one deselected</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

<span class="w">	</span><span class="n">dk_set_led_off</span><span class="p">(</span><span class="n">LED_SVC_ONE</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">tnep_svc_one_msg_received</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">len</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="kt">int</span><span class="w"> </span><span class="n">err</span><span class="p">;</span>

<span class="w">	</span><span class="n">printk</span><span class="p">(</span><span class="s">&quot;New service data received. Finish service data exchange</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

<span class="w">	</span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nfc_tnep_tag_tx_msg_no_app_data</span><span class="p">();</span>
<span class="w">	</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">		</span><span class="n">printk</span><span class="p">(</span><span class="s">&quot;TNEP Service data finish err: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="p">);</span>
<span class="w">	</span><span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">tnep_svc_error</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">err_code</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="n">printk</span><span class="p">(</span><span class="s">&quot;Service data exchange error: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">err_code</span><span class="p">);</span>
<span class="p">}</span>

</pre></div>
</div>
<p>The following code demonstrates how to process the TNEP library:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">tag_x_tag_handler</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">        </span><span class="n">nfc_tnep_tag_rx_msg_indicate</span><span class="p">();</span>
<span class="p">}</span>

<span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">        </span><span class="cm">/*initialization code, application code*/</span>
<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">nfc_tnep_tag_process</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="api-documentation">
<h2><a class="toc-backref" href="#id13">API documentation</a><a class="headerlink" href="#api-documentation" title="Permalink to this heading"></a></h2>
<div class="line-block">
<div class="line">Header file: <code class="file docutils literal notranslate"><span class="pre">include/tnep/tag.h</span></code></div>
<div class="line">Source file: <code class="file docutils literal notranslate"><span class="pre">subsys/tnep/tag.c</span></code></div>
</div>
<dl>
<dt class="sig sig-object cpp">
<span class="target" id="group__nfc__tnep__tag"></span><em><span class="pre">group</span></em> <span class="sig-name descname"><span class="pre">nfc_tnep_tag</span></span></dt>
<dd><p>TAG NDEF Exchange Protocol for the NFC Tag Device. </p>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-defines">Defines</p>
<dl class="c macro">
<dt class="sig sig-object c" id="c.NFC_TNEP_EVENTS_NUMBER">
<span class="target" id="group__nfc__tnep__tag_1ga5fbe879ccd249dac56610bedfbb7d9b3"></span><span class="sig-name descname"><span class="n"><span class="pre">NFC_TNEP_EVENTS_NUMBER</span></span></span><a class="headerlink" href="#c.NFC_TNEP_EVENTS_NUMBER" title="Permalink to this definition"></a><br /></dt>
<dd><p>NFC TNEP library event count. </p>
</dd></dl>

<dl class="c macro">
<dt class="sig sig-object c" id="c.NFC_TNEP_TAG_MAX_WAIT_TIME">
<span class="target" id="group__nfc__tnep__tag_1gac46c92e2ad76e43819874f661689ef18"></span><span class="sig-name descname"><span class="n"><span class="pre">NFC_TNEP_TAG_MAX_WAIT_TIME</span></span></span><a class="headerlink" href="#c.NFC_TNEP_TAG_MAX_WAIT_TIME" title="Permalink to this definition"></a><br /></dt>
<dd><p>Maximum Service Waiting Time. </p>
</dd></dl>

<dl class="c macro">
<dt class="sig sig-object c" id="c.NFC_TNEP_TAG_MAX_N_WAIT_TIME">
<span class="target" id="group__nfc__tnep__tag_1gaa03a4517334cfdd1eb5d5bd33cd62dda"></span><span class="sig-name descname"><span class="n"><span class="pre">NFC_TNEP_TAG_MAX_N_WAIT_TIME</span></span></span><a class="headerlink" href="#c.NFC_TNEP_TAG_MAX_N_WAIT_TIME" title="Permalink to this definition"></a><br /></dt>
<dd><p>Maximum Waiting Time extension. </p>
</dd></dl>

<dl class="c macro">
<dt class="sig sig-object c" id="c.NFC_TNEP_TAG_APP_MSG_DEF">
<span class="target" id="group__nfc__tnep__tag_1gab6576033968225cdbc21341f6c2813d4"></span><span class="sig-name descname"><span class="n"><span class="pre">NFC_TNEP_TAG_APP_MSG_DEF</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">_name</span></span>, <span class="n"><span class="pre">_max_record_cnt</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.NFC_TNEP_TAG_APP_MSG_DEF" title="Permalink to this definition"></a><br /></dt>
<dd><p>Create and initialize an NFC NDEF TNEP Application message descriptor. </p>
<p>Use the macro <a class="reference internal" href="../ndef/msg.html#group__nfc__ndef__msg_1gaa3254c3d074722505b84cbe9c02e957d"><span class="std std-ref">NFC_NDEF_MSG</span></a> to access the NDEF message descriptor instance. This macro reserves place for the TNEP status record.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>_name</strong> – Name of the related instance. </p></li>
<li><p><strong>_max_record_cnt</strong> – Maximum count of records in the message. </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c macro">
<dt class="sig sig-object c" id="c.NFC_TNEP_TAG_SERVICE_DEF">
<span class="target" id="group__nfc__tnep__tag_1ga8e79e1dc610721be025d74f1f58f3b05"></span><span class="sig-name descname"><span class="n"><span class="pre">NFC_TNEP_TAG_SERVICE_DEF</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">_name</span></span>, <span class="n"><span class="pre">_uri</span></span>, <span class="n"><span class="pre">_uri_length</span></span>, <span class="n"><span class="pre">_mode</span></span>, <span class="n"><span class="pre">_t_wait</span></span>, <span class="n"><span class="pre">_n_wait</span></span>, <span class="n"><span class="pre">_max_msg_size</span></span>, <span class="n"><span class="pre">_select_cb</span></span>, <span class="n"><span class="pre">_deselect_cb</span></span>, <span class="n"><span class="pre">_message_cb</span></span>, <span class="n"><span class="pre">_error_cb</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.NFC_TNEP_TAG_SERVICE_DEF" title="Permalink to this definition"></a><br /></dt>
<dd><p>Macro to define TNEP service. </p>
<p>TNEP Service instance contains information about Services Parameter and callback s for NDEF application. The Service Parameter contains the Service Name URI of the Service and the TNEP parameters used to communicate with the Service. The Reader/Writer will configure the TNEP communication according to the announced parameter in the Service Parameter record.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>_name</strong> – <strong>[in]</strong> Service instance name used in code. Use <a class="reference internal" href="#group__nfc__tnep__tag_1ga3607a164b1bcf6afe670cfd4f6f2d41e"><span class="std std-ref">NFC_TNEP_TAG_SERVICE</span></a> to get service by name. </p></li>
<li><p><strong>_uri</strong> – <strong>[in]</strong> Service Name URI. </p></li>
<li><p><strong>_uri_length</strong> – <strong>[in]</strong> Service Name URI length in bytes. </p></li>
<li><p><strong>_mode</strong> – <strong>[in]</strong> Service mode - TNEP Communication Mode: Single Response or Service specific </p></li>
<li><p><strong>_t_wait</strong> – <strong>[in]</strong> Minimum Waiting Time measured between the end of the last write command of an NDEF Write Procedure and the start of the first command of the first NDEF Read Procedure following the NDEF Write Procedures. T_wait has a value between 0 and 63 and is converted to time units using protocol specified formula. </p></li>
<li><p><strong>_n_wait</strong> – <strong>[in]</strong> Maximum Number of Waiting Time Extensions is the maximum number of requested waiting time extensions n_wait for a specific Service. N_wait can vary between 0 and 15 repetitions. </p></li>
<li><p><strong>_max_msg_size</strong> – <strong>[in]</strong> Maximum NDEF message size in bytes. </p></li>
<li><p><strong>_select_cb</strong> – <strong>[in]</strong> Callback function, called by protocol library when service is selected by the Reader/Writer. </p></li>
<li><p><strong>_deselect_cb</strong> – <strong>[in]</strong> Callback function, called by protocol library when service is deselected by the Reader/Writer. </p></li>
<li><p><strong>_message_cb</strong> – <strong>[in]</strong> Callback function, called by protocol library when new message is received from the Reader/Writer. </p></li>
<li><p><strong>_error_cb</strong> – <strong>[in]</strong> Callback function, called by protocol library when an internal error occurred. </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c macro">
<dt class="sig sig-object c" id="c.NFC_TNEP_TAG_SERVICE">
<span class="target" id="group__nfc__tnep__tag_1ga3607a164b1bcf6afe670cfd4f6f2d41e"></span><span class="sig-name descname"><span class="n"><span class="pre">NFC_TNEP_TAG_SERVICE</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">_name</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.NFC_TNEP_TAG_SERVICE" title="Permalink to this definition"></a><br /></dt>
<dd><p>macro for accessing the TNEP Service. </p>
</dd></dl>

</div>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-typedefs">Typedefs</p>
<dl class="c type">
<dt class="sig sig-object c" id="c.nfc_payload_set_t">
<span class="target" id="group__nfc__tnep__tag_1gaad679ef99e2e2d11b219af1149373fb2"></span><span class="k"><span class="pre">typedef</span></span><span class="w"> </span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="p"><span class="pre">(</span></span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">nfc_payload_set_t</span></span></span><span class="p"><span class="pre">)</span></span><span class="p"><span class="pre">(</span></span><span class="n"><span class="pre">uint8_t</span></span><span class="p"><span class="pre">*</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="n"><span class="pre">size_t</span></span><span class="p"><span class="pre">)</span></span><a class="headerlink" href="#c.nfc_payload_set_t" title="Permalink to this definition"></a><br /></dt>
<dd></dd></dl>

<dl class="c type">
<dt class="sig sig-object c" id="c.initial_msg_encode_t">
<span class="target" id="group__nfc__tnep__tag_1ga7faf9e5f72704155fd0307febae4dc50"></span><span class="k"><span class="pre">typedef</span></span><span class="w"> </span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="p"><span class="pre">(</span></span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">initial_msg_encode_t</span></span></span><span class="p"><span class="pre">)</span></span><span class="p"><span class="pre">(</span></span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="../ndef/msg.html#c.nfc_ndef_msg_desc" title="nfc_ndef_msg_desc"><span class="n"><span class="pre">nfc_ndef_msg_desc</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">msg</span></span><span class="p"><span class="pre">)</span></span><a class="headerlink" href="#c.initial_msg_encode_t" title="Permalink to this definition"></a><br /></dt>
<dd><p>Callback type for encoding the Initial TNEP NDEF message. </p>
<p>This callback is called every time when the TNEP NDEF library encodes the Initial TNEP message. You must use <a class="reference internal" href="#group__nfc__tnep__tag_1ga4cbee380fb3a62b1063010b146940863"><span class="std std-ref">nfc_tnep_initial_msg_encode</span></a> function to finish encoding.</p>
<dl class="field-list simple">
<dt class="field-odd">Param msg</dt>
<dd class="field-odd"><p><strong>[in]</strong> Pointer to the Initial TNEP NDEF message.</p>
</dd>
<dt class="field-even">Retval 0</dt>
<dd class="field-even"><p>If the operation was successful. Otherwise, a (negative) error code is returned. </p>
</dd>
</dl>
</dd></dl>

</div>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-functions">Functions</p>
<dl class="c function">
<dt class="sig sig-object c" id="c.nfc_tnep_tag_tx_msg_buffer_register">
<span class="target" id="group__nfc__tnep__tag_1ga77f0b9e72d9372fbc02afa9e810179c4"></span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">nfc_tnep_tag_tx_msg_buffer_register</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tx_buff</span></span>, <span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tx_swap_buff</span></span>, <span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="n"><span class="pre">len</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.nfc_tnep_tag_tx_msg_buffer_register" title="Permalink to this definition"></a><br /></dt>
<dd><p>Register TNEP message buffer. </p>
<p>TNEP Tag Device needs two buffers one for current NDEF message and seconds for new message.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tx_buff</strong> – <strong>[in]</strong> Pointer to NDEF message buffer. </p></li>
<li><p><strong>tx_swap_buff</strong> – <strong>[in]</strong> Pointer to swap NDEF message buffer. </p></li>
<li><p><strong>len</strong> – <strong>[in]</strong> Length of NDEF message buffers.</p></li>
</ul>
</dd>
<dt class="field-even">Return values</dt>
<dd class="field-even"><p><strong>0</strong> – If the operation was successful. Otherwise, a (negative) error code is returned. </p>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.nfc_tnep_tag_init">
<span class="target" id="group__nfc__tnep__tag_1ga5891bd96778029c66f8df217c706b6c2"></span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">nfc_tnep_tag_init</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">k_poll_event</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">events</span></span>, <span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="n"><span class="pre">event_cnt</span></span>, <a class="reference internal" href="#c.nfc_payload_set_t" title="nfc_payload_set_t"><span class="n"><span class="pre">nfc_payload_set_t</span></span></a><span class="w"> </span><span class="n"><span class="pre">payload_set</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.nfc_tnep_tag_init" title="Permalink to this definition"></a><br /></dt>
<dd><p>Start communication using TNEP. </p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>events</strong> – <strong>[out]</strong> TNEP Tag Events. </p></li>
<li><p><strong>event_cnt</strong> – <strong>[in]</strong> Event count. This library needs 2 events. </p></li>
<li><p><strong>payload_set</strong> – <strong>[in]</strong> Function for setting NDEF data for NFC TNEP Tag Device. This library use it internally to set raw NDEF message to the Tag NDEF file. This function is called from atomic context, so sleeping or anyhow delaying is not allowed there.</p></li>
</ul>
</dd>
<dt class="field-even">Return values</dt>
<dd class="field-even"><p><strong>0</strong> – If the operation was successful. Otherwise, a (negative) error code is returned. </p>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.nfc_tnep_tag_initial_msg_create">
<span class="target" id="group__nfc__tnep__tag_1gaf5c071a830658743c3cb404c8101a2ed"></span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">nfc_tnep_tag_initial_msg_create</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="n"><span class="pre">max_record_cnt</span></span>, <a class="reference internal" href="#c.initial_msg_encode_t" title="initial_msg_encode_t"><span class="n"><span class="pre">initial_msg_encode_t</span></span></a><span class="w"> </span><span class="n"><span class="pre">msg_encode_cb</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.nfc_tnep_tag_initial_msg_create" title="Permalink to this definition"></a><br /></dt>
<dd><p>Create the Initial TNEP NDEF message. </p>
<p>This function creates the Initial TNEP message. Initial NDEF message has to contain at least one service parameters record defined using <a class="reference internal" href="#group__nfc__tnep__tag_1ga8e79e1dc610721be025d74f1f58f3b05"><span class="std std-ref">NFC_TNEP_TAG_SERVICE_DEF</span></a>. It can also contain optional NDEF records which can be used by NFC Poller Device which does not support TNEP Protocol.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>max_record_cnt</strong> – <strong>[in]</strong> Maximum count of the optional NDEF records </p></li>
<li><p><strong>msg_encode_cb</strong> – <strong>[in]</strong> Callback function for encoding the Initial TNEP NDEF message. Can be set to NULL if <code class="docutils literal notranslate"><span class="pre">max_record_cnt</span></code> is 0 then only the Service Parameters Records are encoded into the Initial TNEP NDEF message.</p></li>
</ul>
</dd>
<dt class="field-even">Return values</dt>
<dd class="field-even"><p><strong>0</strong> – If the operation was successful. Otherwise, a (negative) error code is returned. </p>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.nfc_tnep_initial_msg_encode">
<span class="target" id="group__nfc__tnep__tag_1ga4cbee380fb3a62b1063010b146940863"></span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">nfc_tnep_initial_msg_encode</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="../ndef/msg.html#c.nfc_ndef_msg_desc" title="nfc_ndef_msg_desc"><span class="n"><span class="pre">nfc_ndef_msg_desc</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">msg</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="../ndef/msg.html#c.nfc_ndef_record_desc" title="nfc_ndef_record_desc"><span class="n"><span class="pre">nfc_ndef_record_desc</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">records</span></span>, <span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="n"><span class="pre">records_cnt</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.nfc_tnep_initial_msg_encode" title="Permalink to this definition"></a><br /></dt>
<dd><p>Encode the Initial NDEF message. </p>
<p>This function encodes the Initial TNEP NDEF message. It must be used in combination with <a class="reference internal" href="#group__nfc__tnep__tag_1ga7faf9e5f72704155fd0307febae4dc50"><span class="std std-ref">initial_msg_encode_t</span></a> callback function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>msg</strong> – <strong>[in]</strong> Pointer to the Initial NDEF message descriptor. NDEF records can be added to it also before calling this function. </p></li>
<li><p><strong>records</strong> – <strong>[in]</strong> Pointer to the first NDEF records structure. Can be set to NULL if there are no additional NDEF records to encode or records are encoded directly to the Initial NDEF message. </p></li>
<li><p><strong>records_cnt</strong> – <strong>[in]</strong> Number of provided NDEF records. It must be set to 0 when <code class="docutils literal notranslate"><span class="pre">records</span></code> is NULL.</p></li>
</ul>
</dd>
<dt class="field-even">Return values</dt>
<dd class="field-even"><p><strong>0</strong> – If the operation was successful. Otherwise, a (negative) error code is returned. </p>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.nfc_tnep_tag_process">
<span class="target" id="group__nfc__tnep__tag_1gad05e7c609999eebc2890f254c717b9b9"></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">nfc_tnep_tag_process</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">void</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.nfc_tnep_tag_process" title="Permalink to this definition"></a><br /></dt>
<dd><p>Waiting for a signals to execute protocol logic. </p>
<p>This function must be called periodically from thread to process the TNEP Tag Device.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This function cannot be called before <em>nfc_tnep_init()</em>. </p>
</div>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.nfc_tnep_tag_rx_msg_indicate">
<span class="target" id="group__nfc__tnep__tag_1ga3ea96b2eaf4e8fe14db01b0a6dd89d32"></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">nfc_tnep_tag_rx_msg_indicate</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">rx_buffer</span></span>, <span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="n"><span class="pre">len</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.nfc_tnep_tag_rx_msg_indicate" title="Permalink to this definition"></a><br /></dt>
<dd><p>Indicate about new TNEP message available in buffer. </p>
<p>The NFC Tag Device concludes that the NDEF Write Procedure is finished when, after a write command of the NDEF Write Procedure, an NDEF message is available in the data area. If, after the write command of the NDEF Write Procedure, no NDEF message is available in the data area, the NFC Tag Device concludes that the actual NDEF Write Procedure is ongoing.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>rx_buffer</strong> – <strong>[in]</strong> Pointer to NDEF message buffer. </p></li>
<li><p><strong>len</strong> – <strong>[in]</strong> Length of NDEF message buffer. </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.nfc_tnep_tag_tx_msg_app_data">
<span class="target" id="group__nfc__tnep__tag_1gadb35ef2966b941ed3c363907c4b2b441"></span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">nfc_tnep_tag_tx_msg_app_data</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="../ndef/msg.html#c.nfc_ndef_msg_desc" title="nfc_ndef_msg_desc"><span class="n"><span class="pre">nfc_ndef_msg_desc</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">msg</span></span>, <span class="k"><span class="pre">enum</span></span><span class="w"> </span><span class="n"><span class="pre">nfc_tnep_status_value</span></span><span class="w"> </span><span class="n"><span class="pre">status</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.nfc_tnep_tag_tx_msg_app_data" title="Permalink to this definition"></a><br /></dt>
<dd><p>Add application data record to next message. </p>
<p>Use this function to set application data after the service selection to set service application data and use it also during service data exchange with the NFC Polling Device. To indicate that application has no more data use <a class="reference internal" href="#group__nfc__tnep__tag_1gae92b0da3f2dcada148c1c163092a1ddc"><span class="std std-ref">nfc_tnep_tag_tx_msg_no_app_data()</span></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>msg</strong> – <strong>[in]</strong> Pointer to NDEF message with application data. The message must have at least one free slot for the TNEP status record which is added automatically by this function. So if you want to encode for example 2 NDEF records the NDEF message minimal record count is 3. Use <a class="reference internal" href="#group__nfc__tnep__tag_1gab6576033968225cdbc21341f6c2813d4"><span class="std std-ref">NFC_TNEP_TAG_APP_MSG_DEF</span></a> which reserves slot for the TNEP status record. </p></li>
<li><p><strong>status</strong> – <strong>[in]</strong> TNEP App data message status.</p></li>
</ul>
</dd>
<dt class="field-even">Return values</dt>
<dd class="field-even"><p><strong>0</strong> – If the operation was successful. Otherwise, a (negative) error code is returned. </p>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.nfc_tnep_tag_tx_msg_no_app_data">
<span class="target" id="group__nfc__tnep__tag_1gae92b0da3f2dcada148c1c163092a1ddc"></span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">nfc_tnep_tag_tx_msg_no_app_data</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">void</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.nfc_tnep_tag_tx_msg_no_app_data" title="Permalink to this definition"></a><br /></dt>
<dd><p>Respond with no more application data. </p>
<p>If the NDEF application on the NFC Tag Device has finished, and therefore the NFC Tag Device has no more application data available for the Reader/Writer, then the NFC Tag Device SHALL provide a status message containing a single record that is a TNEP status record indicating success.</p>
<dl class="field-list simple">
<dt class="field-odd">Return values</dt>
<dd class="field-odd"><p><strong>0</strong> – If the operation was successful. Otherwise, a (negative) error code is returned. </p>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.nfc_tnep_tag_on_selected">
<span class="target" id="group__nfc__tnep__tag_1ga2e57d1195ba4d65fad71f76d3401b493"></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">nfc_tnep_tag_on_selected</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">void</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.nfc_tnep_tag_on_selected" title="Permalink to this definition"></a><br /></dt>
<dd><p>Handle NFC Tag selected event. </p>
<p>If data exchange with poller starts again, NFC TNEP Tag device shall provide TNEP Initial message. </p>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.nfc_tnep_tag_svc_count_get">
<span class="target" id="group__nfc__tnep__tag_1gaf2bd0bb295d37ba2d63ca2cb57da6494"></span><span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">nfc_tnep_tag_svc_count_get</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">void</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.nfc_tnep_tag_svc_count_get" title="Permalink to this definition"></a><br /></dt>
<dd><p>Get the NFC Tag TNEP service count. </p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>TNEP Tag Service count. </p>
</dd>
</dl>
</dd></dl>

</div>
<dl class="c struct">
<dt class="sig sig-object c" id="c.nfc_tnep_tag_service_cb">
<span class="target" id="structnfc__tnep__tag__service__cb"></span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">nfc_tnep_tag_service_cb</span></span></span><a class="headerlink" href="#c.nfc_tnep_tag_service_cb" title="Permalink to this definition"></a><br /></dt>
<dd><div class="docutils container">
<em>#include &lt;tag.h&gt;</em></div>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-public-members">Public Members</p>
<dl class="c var">
<dt class="sig sig-object c" id="c.nfc_tnep_tag_service_cb.selected">
<span class="target" id="structnfc__tnep__tag__service__cb_1a0e0986c3cdfbe21b7ec2ccd08b73c092"></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">(</span></span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">selected</span></span></span><span class="p"><span class="pre">)</span></span><span class="p"><span class="pre">(</span></span><span class="kt"><span class="pre">void</span></span><span class="p"><span class="pre">)</span></span><a class="headerlink" href="#c.nfc_tnep_tag_service_cb.selected" title="Permalink to this definition"></a><br /></dt>
<dd><p>Function called when service was selected. </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.nfc_tnep_tag_service_cb.deselected">
<span class="target" id="structnfc__tnep__tag__service__cb_1ace17573d4a865cff77ce0a3f9b1bc3f8"></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">(</span></span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">deselected</span></span></span><span class="p"><span class="pre">)</span></span><span class="p"><span class="pre">(</span></span><span class="kt"><span class="pre">void</span></span><span class="p"><span class="pre">)</span></span><a class="headerlink" href="#c.nfc_tnep_tag_service_cb.deselected" title="Permalink to this definition"></a><br /></dt>
<dd><p>Function called when service deselected. </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.nfc_tnep_tag_service_cb.message_received">
<span class="target" id="structnfc__tnep__tag__service__cb_1a6964b9337da1e38bcd40e883b98f98ec"></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">(</span></span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">message_received</span></span></span><span class="p"><span class="pre">)</span></span><span class="p"><span class="pre">(</span></span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="n"><span class="pre">len</span></span><span class="p"><span class="pre">)</span></span><a class="headerlink" href="#c.nfc_tnep_tag_service_cb.message_received" title="Permalink to this definition"></a><br /></dt>
<dd><p>Function called when new message was received. </p>
<dl class="field-list simple">
<dt class="field-odd">Param data</dt>
<dd class="field-odd"><p><strong>[in]</strong> Pointer to received data. </p>
</dd>
<dt class="field-even">Param len</dt>
<dd class="field-even"><p><strong>[in]</strong> Received data length. </p>
</dd>
</dl>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.nfc_tnep_tag_service_cb.error_detected">
<span class="target" id="structnfc__tnep__tag__service__cb_1ace5ad7760b7e4dc756b1e2b8be314f80"></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">(</span></span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">error_detected</span></span></span><span class="p"><span class="pre">)</span></span><span class="p"><span class="pre">(</span></span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">err</span></span><span class="p"><span class="pre">)</span></span><a class="headerlink" href="#c.nfc_tnep_tag_service_cb.error_detected" title="Permalink to this definition"></a><br /></dt>
<dd><p>Function called when an internal error in TNEP detected. </p>
<dl class="field-list simple">
<dt class="field-odd">Param err</dt>
<dd class="field-odd"><p>Detected error code. </p>
</dd>
</dl>
</dd></dl>

</div>
</dd></dl>

<dl class="c struct">
<dt class="sig sig-object c" id="c.nfc_tnep_tag_service">
<span class="target" id="structnfc__tnep__tag__service"></span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">nfc_tnep_tag_service</span></span></span><a class="headerlink" href="#c.nfc_tnep_tag_service" title="Permalink to this definition"></a><br /></dt>
<dd><div class="docutils container">
<em>#include &lt;tag.h&gt;</em></div>
<p>Service structure. </p>
<p>This structure contains all information about user service. It contains service parameters, service parameters record and services callbacks. It is used by <em>tnep_init()</em> function. </p>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-public-members">Public Members</p>
<dl class="c var">
<dt class="sig sig-object c" id="c.nfc_tnep_tag_service.parameters">
<span class="target" id="structnfc__tnep__tag__service_1ae2b1f9340c5c41a00aec1744d26a7c66"></span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">nfc_ndef_tnep_rec_svc_param</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">parameters</span></span></span><a class="headerlink" href="#c.nfc_tnep_tag_service.parameters" title="Permalink to this definition"></a><br /></dt>
<dd><p>Services parameters. </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.nfc_tnep_tag_service.ndef_record">
<span class="target" id="structnfc__tnep__tag__service_1a70eec10020a92af5ca38ebbd15061b32"></span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="../ndef/msg.html#c.nfc_ndef_record_desc" title="nfc_ndef_record_desc"><span class="n"><span class="pre">nfc_ndef_record_desc</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">ndef_record</span></span></span><a class="headerlink" href="#c.nfc_tnep_tag_service.ndef_record" title="Permalink to this definition"></a><br /></dt>
<dd><p>NDEF records data. </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.nfc_tnep_tag_service.callbacks">
<span class="target" id="structnfc__tnep__tag__service_1a4dedd8be029071a810eacd982813df57"></span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.nfc_tnep_tag_service_cb" title="nfc_tnep_tag_service_cb"><span class="n"><span class="pre">nfc_tnep_tag_service_cb</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">callbacks</span></span></span><a class="headerlink" href="#c.nfc_tnep_tag_service.callbacks" title="Permalink to this definition"></a><br /></dt>
<dd><p>Callbacks structure. </p>
</dd></dl>

</div>
</dd></dl>

</dd></dl>

</section>
</section>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../nrf_rpc/index.html" class="btn btn-neutral float-right" title="nRF RPC libraries" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="poller.html" class="btn btn-neutral" title="TNEP for polling device" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">

<table>
<tr>
<td>
    <p>
        &copy; Copyright 2019-2023, Nordic Semiconductor.
      Last updated on Mar 20, 2023.

    </p>
</td>
<td id="nordiclogo">
  <a href="https://www.nordicsemi.com/"><img src="../../../_static/images/nordic-logo.png" border="0"/></a>
</td>
</tr>
</table>
  </div> 


</footer>

<div id="scroll-container">
  <button type="button" id="scroll-btn" class="btn">
    <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="#fff"/></svg>
  </button>
</div>

<script>
  const scrollBtn = document.querySelector("#scroll-btn");

  document.addEventListener("scroll", () => {
    if (window.scrollY > 400) {
          scrollBtn.style.visibility = "visible";
      } else {
          scrollBtn.style.visibility = "hidden";
      }
  });

  scrollBtn.addEventListener("click", () => {
      window.scrollTo({ top: 0, behavior: "smooth" });
  });
</script>
        </div>
      </div>
    </section>
  </div>
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> nRF Connect SDK</span>
       <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      
      <div class="rst-other-version ncs">
        <a href="../../../../nrf/index.html">nRF Connect SDK</a>
      </div>
      
      <div class="rst-other-version nrfx">
        <a href="../../../../nrfx/index.html">nrfx</a>
      </div>
      
      <div class="rst-other-version nrfxlib">
        <a href="../../../../nrfxlib/README.html">nrfxlib</a>
      </div>
      
      <div class="rst-other-version zephyr">
        <a href="../../../../zephyr/index.html">Zephyr Project</a>
      </div>
      
      <div class="rst-other-version mcuboot">
        <a href="../../../../mcuboot/wrapper.html">MCUboot</a>
      </div>
      
      <div class="rst-other-version tfm">
        <a href="../../../../tfm/index.html">Trusted Firmware-M</a>
      </div>
      
      <div class="rst-other-version matter">
        <a href="../../../../matter/index.html">Matter</a>
      </div>
      
      <div class="rst-other-version kconfig">
        <a href="../../../../kconfig/index.html">Kconfig Reference</a>
      </div>
    </div>
  </div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>