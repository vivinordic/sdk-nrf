<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Operating in power save modes &mdash; nRF Connect SDK 2.3.99 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/nordic.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/togglebutton.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/nrf.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/tabs.css" type="text/css" /> 
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
        <script src="https://www.googletagmanager.com/gtag/js?id=G-ZPVZRKFQJR"></script>
        <script src="../../../_static/js/ga-tracker.js"></script>
        <script data-culture="EN" id="CookieConsent" type="text/javascript" src="https://policy.app.cookieinformation.com/uc.js"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../../_static/togglebutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/js/theme.js"></script>
<script
  type="text/javascript"
  src="../../../_static/js/ncs.js"
></script>
<script src="../../../_static/js/bootstrap.bundle.min.js"></script>

    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Operating with a resource constrained host" href="constrained.html" />
    <link rel="prev" title="Developing with nRF70 Series" href="index.html" />
<link
  href="../../../_static/css/bootstrap.min.css"
  rel="stylesheet"
/>
<link
  rel="shortcut icon"
  href="../../../_static/images/favicon.ico"
/>

</head>

<body class="wy-body-for-nav">
<div class="announcement"></div>
<div class="d-print-none ncs-header">
  <div class="container-xl ncs-header-top">
    <div class="row h-100">
      <div class="d-none d-md-block col-2">
        <div class="bg-white py-4 px-3 ml-2 ncs-header-logo">
          <img
            class="ncs-header-logo"
            src="../../../_static/images/nordic-logo.png"
            alt=""
          />
        </div>
      </div>
      <div
        class="col-8 col-md-7 pl-md-4 d-flex align-self-center justify-content-center"
      >
        <form class="w-75" action="../../../search.html" method="get">
          <div class="form-group">
            <input
              type="text"
              name="q"
              class="ncs-search-input form-control"
              placeholder="Search all docs..."
            />
          </div>
        </form>
      </div>
      <div class="col-4 col-md-3 d-md-block p-3 text-end">
        <div class="dropdown">
          <button
            class="btn dropdown-toggle ncs-btn-versions"
            type="button"
            id="dropdownMenuButton1"
            data-bs-toggle="dropdown"
            aria-expanded="false"
          >
            <span class="d-none d-md-inline">nRF Connect SDK</span>
            <span id="ncsversion" class="d-inline"></span>
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton"></div>
        </div>
      </div>
    </div>
  </div>
  <div class="ncs-header-nav">
    <div class="container-xl">
      <div class="row">
        <div class="col col-12 d-flex justify-content-center">
          <nav class="navbar navbar-dark navbar-expand-lg p-0">
            <span class="navbar-brand d-block d-lg-none py-2 pl-1"
              >Documentation sets</span
            >
            <button
              class="navbar-toggler"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#navbarNavAltMarkup"
              aria-controls="navbarNavAltMarkup"
              aria-expanded="false"
              aria-label="Toggle navigation"
            >
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
              <ul class="navbar-nav">
                <li class="nav-item active py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../nrf/index.html"
                    >nRF Connect SDK</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../nrfx/index.html"
                    >nrfx</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../nrfxlib/README.html"
                    >nrfxlib</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../zephyr/index.html"
                    >Zephyr Project</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../mcuboot/wrapper.html"
                    >MCUboot</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../tfm/index.html"
                    >Trusted Firmware-M</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../matter/index.html"
                    >Matter</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../kconfig/index.html"
                    >Kconfig Reference</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
              </ul>
            </div>
          </nav>
        </div>
      </div>
    </div>
  </div>
</div>

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> nRF Connect SDK
          </a>
              <div class="version">
                2.3.99
              </div>
<div id="searchbox" role="search">
  <div class="searchformwrapper">
    <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
  </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev_model.html">Development model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../app_dev.html">Application development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ecosystem_integration.html">Ecosystems integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nrf91.html">Working with nRF91 Series</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../nrf70.html">Working with nRF70 Series</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../features.html">Features of nRF70 Series</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gs.html">Getting started with nRF7002 DK</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Developing with nRF70 Series</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Operating in power save modes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#nrf70-series-device-states">nRF70 Series device states</a></li>
<li class="toctree-l4"><a class="reference internal" href="#power-save-mode">Power Save mode</a></li>
<li class="toctree-l4"><a class="reference internal" href="#delivery-traffic-indication-message-dtim">Delivery Traffic Indication Message (DTIM)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#target-wake-time-twt">Target Wake Time (TWT)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#usage">Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="#power-save-api">Power Save API</a></li>
<li class="toctree-l4"><a class="reference internal" href="#power-profiling">Power profiling</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="constrained.html">Operating with a resource constrained host</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../nrf53.html">Working with nRF53 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nrf52.html">Working with nRF52 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../protocols.html">Protocols</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../applications.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../samples.html">Samples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../drivers.html">Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../libraries/index.html">Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../scripts.html">Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../release_notes.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../known_issues.html">Known issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../software_maturity.html">Software maturity levels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation.html">About this documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">nRF Connect SDK</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../../../nrf70.html">Working with nRF70 Series</a></li>
          <li class="breadcrumb-item"><a href="index.html">Developing with nRF70 Series</a></li>
      <li class="breadcrumb-item active">Operating in power save modes</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/working_with_nrf/nrf70/developing/powersave.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="operating-in-power-save-modes">
<span id="ug-nrf70-developing-powersave"></span><h1>Operating in power save modes<a class="headerlink" href="#operating-in-power-save-modes" title="Permalink to this heading"></a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#nrf70-series-device-states" id="id16">nRF70 Series device states</a></p>
<ul>
<li><p><a class="reference internal" href="#power-state" id="id17">Power state</a></p></li>
<li><p><a class="reference internal" href="#functional-state" id="id18">Functional state</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#power-save-mode" id="id19">Power Save mode</a></p></li>
<li><p><a class="reference internal" href="#delivery-traffic-indication-message-dtim" id="id20">Delivery Traffic Indication Message (DTIM)</a></p>
<ul>
<li><p><a class="reference internal" href="#group-frames" id="id21">Group frames</a></p></li>
<li><p><a class="reference internal" href="#unicast-frames" id="id22">Unicast frames</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#target-wake-time-twt" id="id23">Target Wake Time (TWT)</a></p>
<ul>
<li><p><a class="reference internal" href="#modes-of-operation-in-twt-mode" id="id24">Modes of operation in TWT mode</a></p></li>
<li><p><a class="reference internal" href="#key-parameters" id="id25">Key parameters</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#usage" id="id26">Usage</a></p></li>
<li><p><a class="reference internal" href="#power-save-api" id="id27">Power Save API</a></p></li>
<li><p><a class="reference internal" href="#power-profiling" id="id28">Power profiling</a></p></li>
</ul>
</div>
<p>The nRF70 Series device supports multiple power save modes, enabling the device to minimize power consumption by shutting down most of the digital logic and RF circuits.</p>
<section id="nrf70-series-device-states">
<span id="ug-nrf70-developing-powersave-device-states"></span><h2><a class="toc-backref" href="#id16">nRF70 Series device states</a><a class="headerlink" href="#nrf70-series-device-states" title="Permalink to this heading"></a></h2>
<p>The power save state of the nRF70 Series device is described through a combination of the physical Power state of the logic or circuits and the logical Functional state as observed by the access point (AP).</p>
<section id="power-state">
<h3><a class="toc-backref" href="#id17">Power state</a><a class="headerlink" href="#power-state" title="Permalink to this heading"></a></h3>
<p>The nRF70 Series device can be in one of the following power states:</p>
<ul class="simple">
<li><p><strong>Active:</strong> The device is <strong>ON</strong> constantly so that it can receive and transmit the data.</p></li>
<li><p><strong>Sleep:</strong> The device is <strong>OFF</strong> to majority of the blocks that cannot receive and transmit the data.
In this state, the device consumes low power (~15 µA).
Real-time Clock (RTC) domain, RF retention memory, and firmware retention memory are powered <strong>ON</strong> to retain the state information.</p></li>
<li><p><strong>Shutdown:</strong> The device is completely powered <strong>OFF</strong>.
In this state, the device consumes very low power (~2 µA) and does not retain any state information (apart from the values in the OTP memory).
The device will only respond to a BUCKEN assertion to wake from the Shutdown state.</p></li>
</ul>
</section>
<section id="functional-state">
<h3><a class="toc-backref" href="#id18">Functional state</a><a class="headerlink" href="#functional-state" title="Permalink to this heading"></a></h3>
<p>The state information of the device at the access point database can be either Active or Power Save.
The device is in the Active state after the connection to a network.</p>
<p>The state change information must be given to an access point by a successful frame exchange.
The nRF70 Series device can operate in either of the following two functional states:</p>
<ul class="simple">
<li><p><strong>Active:</strong> The device is in the Active state permanently.
If the data exists, the access point can schedule transmission of the data to the device immediately.</p></li>
<li><p><strong>Power Save (PS):</strong> The device is in the Sleep state most of the time, but can also be woken up to transmit and receive data.
In this state, the access point buffers the required frames intended for the device.
The device can make a transition between the Active and Sleep states according to the IEEE 802.11 power save protocol.</p></li>
</ul>
</section>
</section>
<section id="power-save-mode">
<span id="ug-nrf70-developing-powersave-power-save-mode"></span><h2><a class="toc-backref" href="#id19">Power Save mode</a><a class="headerlink" href="#power-save-mode" title="Permalink to this heading"></a></h2>
<p>The nRF70 Series device can operate in Active mode or Power Save mode.
When the device changes from Active mode to Power Save mode, it informs the access point through a successful frame exchange.</p>
<p>Once the frame exchange completes, the access point buffers all the frames (multicast and broadcast) that are addressed to the device.
The device wakes up to receive buffered traffic for every Delivery Traffic Indication Message (DTIM) beacon and goes back to the Sleep state for the remaining period.</p>
<p>The following Power Save modes are supported and can be configured by the user or application:</p>
<ul class="simple">
<li><p><strong>Permanent Active:</strong> The device is in the Active mode.
The power consumption is high, but the performance is best in this mode.</p></li>
<li><p><strong>Static Power Save:</strong> The device is in the Power Save mode.
This mode saves the most power but provides the lowest throughput.
This mode is not supported in the current release.</p></li>
<li><p><strong>Dynamic Power Save:</strong> The device switches between Active and Power Save mode depending on the activity.
It enters the Power Save mode due to inactivity (timer expiry) and returns to the Active mode due to application traffic.
nRF70 Series devices operate in this mode by default.
The user or application can change the device to the Permanent Active mode using the <code class="docutils literal notranslate"><span class="pre">NET_REQUEST_WIFI_PS</span></code> network management API.</p></li>
</ul>
</section>
<section id="delivery-traffic-indication-message-dtim">
<span id="ug-nrf70-developing-powersave-dtim"></span><h2><a class="toc-backref" href="#id20">Delivery Traffic Indication Message (DTIM)</a><a class="headerlink" href="#delivery-traffic-indication-message-dtim" title="Permalink to this heading"></a></h2>
<p>The Wi-Fi® interface can be configured in either Delivery Traffic Indication Message or Target Wake Time (TWT) power save modes.
DTIM is the default configuration and enabled by the application based on the traffic profile.
TWT can be enabled if the connected access point is Wi-Fi 6 capable.</p>
<p>Devices in DTIM Power Save mode can wake at any time to transmit uplink traffic, but can only receive downlink traffic (broadcast, multicast or unicast) immediately after receiving a DTIM beacon.
To make the device in Power Save mode aware that the access point has buffered downlink traffic, the access point uses the Traffic Indication Map (TIM) element present in the beacon frames.
The device in Power Save mode wakes up to receive the DTIM beacon and checks the status of the TIM element.
This element indicates whether there are any buffered group frames or unicast frames that need to be retrieved from the access point.</p>
<section id="group-frames">
<span id="ug-nrf70-developing-powersave-dtim-group"></span><h3><a class="toc-backref" href="#id21">Group frames</a><a class="headerlink" href="#group-frames" title="Permalink to this heading"></a></h3>
<p>Group addressed frames are directed to all connected devices.
When there is at least one device in PS mode in the Basic Service Set (BSS), the access point buffers the broadcast and multicast traffic and transmits at specific time to ensure that all associated devices can receive it.</p>
<p>The buffered group traffic is delivered immediately after a DTIM beacon.
The following figure illustrates the group frame data retrieval mechanism in DTIM Power Save mode:</p>
<figure class="align-default" id="id6">
<img alt="Group frames" src="../../../_images/nRF70_ug_group_frames.svg" /><figcaption>
<p><span class="caption-text">Group frames</span><a class="headerlink" href="#id6" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="unicast-frames">
<span id="ug-nrf70-developing-powersave-dtim-unicast"></span><h3><a class="toc-backref" href="#id22">Unicast frames</a><a class="headerlink" href="#unicast-frames" title="Permalink to this heading"></a></h3>
<p>Unicast frames are directed to an intended device.
When a device in the PS mode parses a TIM element indicating any individually addressed buffered frames, retrieving the buffered frames depends on the IEEE power save operation modes.</p>
<section id="legacy-power-save-mode">
<h4>Legacy Power Save mode<a class="headerlink" href="#legacy-power-save-mode" title="Permalink to this heading"></a></h4>
<p>The Legacy PS mode mechanism is based on the PS-Poll frame retrieving the buffered frames from the AP.
The PS-Poll frame is a short Control Frame containing the Association Identifier (AID) value of the device.
In the Legacy PS mode, when the device receives a beacon with its AID in the TIM element, it initiates the frame delivery by transmitting a PS-POLL control frame to the AP.
The AP acknowledges the PS-Poll frame and responds with a single buffered frame.</p>
<p>The device stays active and retrieves the buffered frame.
The AP also indicates that there are buffered frames for the device using the <strong>More Data</strong> subfield.
The device continues to retrieve buffered frames using PS-Poll frames until there are no more frames and the <strong>More Data</strong> subfield is set to <code class="docutils literal notranslate"><span class="pre">0</span></code>.
The device goes back into the Sleep state after retrieving all the buffered frames.</p>
<p>The following figure illustrates the unicast frame data retrieval mechanism in Legacy Power Save mode:</p>
<figure class="align-default" id="id7">
<img alt="Legacy Power Save mode" src="../../../_images/nRF70_ug_legacy_power_save.svg" /><figcaption>
<p><span class="caption-text">Legacy Power Save mode</span><a class="headerlink" href="#id7" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="wireless-multimedia-wmm-power-save-mode">
<h4>Wireless Multimedia (WMM) Power Save mode<a class="headerlink" href="#wireless-multimedia-wmm-power-save-mode" title="Permalink to this heading"></a></h4>
<p>The Wireless Multimedia Power Save mode uses the Automatic Power Save Delivery (APSD) mechanism to retrieve the individual unicast-buffered traffic.
A device in the PS mode starts the Service Period (SP) by sending a trigger frame that is a QoS Data/QoS Null frame.</p>
<p>When the device receives a beacon with its AID in the TIM element, it initiates the SP by transmitting the trigger frame to the AP.
The AP sends one or more individually addressed buffered frames to the device.
The device remains active until the AP ends the SP by setting the End Of Service Period (EOSP) bit to <code class="docutils literal notranslate"><span class="pre">1</span></code> in the <strong>QoS Control</strong> field of the last QoS Data frame sent to the device.</p>
<p>The following figure illustrates the unicast frame data retrieval mechanism in WMM Power Save mode:</p>
<figure class="align-default" id="id8">
<img alt="WMM Power Save mode" src="../../../_images/nRF70_ug_wmm_power_save.svg" /><figcaption>
<p><span class="caption-text">WMM Power Save mode</span><a class="headerlink" href="#id8" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>Legacy Power Save mode is the default option in nRF70 Series devices.
The user or application can configure the WMM mode using the <code class="docutils literal notranslate"><span class="pre">NET_REQUEST_WIFI_PS_MODE</span></code> network management API.
The WMM mode does not deliver a significant performance or power difference when compared to Legacy mode in Dynamic Power Save operation.</p>
<p>The average power consumption of the device is affected by the DTIM period.
The typical value is three beacons, for example, 307 ms for a beacon period of 100-time units.
The higher DTIM period results in increased power saving and higher latency to the application data.</p>
</section>
</section>
</section>
<section id="target-wake-time-twt">
<span id="ug-nrf70-developing-powersave-twt"></span><h2><a class="toc-backref" href="#id23">Target Wake Time (TWT)</a><a class="headerlink" href="#target-wake-time-twt" title="Permalink to this heading"></a></h2>
<p>Target Wake Time is a new feature in Wi-Fi 6.
It allows devices to wake up at the negotiated times to transmit and receive data.
The access point and devices reach a TWT agreement that defines when a station is active and ready to receive and transmit data.</p>
<p>The TWT mechanism allows each device to negotiate its wake-up period with the AP to transmit and receive data packets.
Stations will only receive and transmit during the TWT Service Period and remain in the sleep state for the rest of the time.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The device follows the TWT wake schedule to save power and does not wake up for DTIM beacons.
It is not able to receive broadcast or multicast frames which are scheduled after the DTIM beacon.
Applications are expected to keep note of this and set up TWT sessions based on their traffic profile.</p>
</div>
<p>An access point has more control over the network in TWT mode and decides which device is going to transmit and when.
The AP decides how many and which Resource Units (RU) are to be used (an RU is a contiguous set of subcarriers).
TWT offers more efficient scheduling of transmissions.</p>
<p>Devices can remain in the sleep state even longer, if required.
Before Wi-Fi 6, a device would sleep for a DTIM period, wake up, exchange data, and then return to the sleep state for another DTIM period, repeating continuously.
With the introduction of TWT in Wi-Fi 6, a device can sleep for seconds, minutes, or even hours.
Some devices can be configured to communicate once a day to perform a transmission and sleep for the rest of the day.</p>
<p>The figure below illustrates the initiation of two independent TWT sessions.
The TWT session commences with a trigger frame from the AP at a time determined during the TWT establishment frame exchange (TWT1 and TWT2 for devices 1 and 2 respectively).</p>
<figure class="align-default" id="id9">
<img alt="TWT wakeup sequence" src="../../../_images/nRF70_ug_twt.svg" /><figcaption>
<p><span class="caption-text">TWT wakeup sequence</span><a class="headerlink" href="#id9" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<section id="modes-of-operation-in-twt-mode">
<h3><a class="toc-backref" href="#id24">Modes of operation in TWT mode</a><a class="headerlink" href="#modes-of-operation-in-twt-mode" title="Permalink to this heading"></a></h3>
<p>When the device is in the TWT mode, the following are the two modes of operation:</p>
<ul class="simple">
<li><p><strong>Individual:</strong> The device can choose when to wake up and sleep.
It can negotiate an agreement with the AP to wake up for receiving or transmitting the data.</p></li>
<li><p><strong>Broadcast:</strong> The AP provides the schedule to all devices that support broadcast TWT.
This mode is not supported in the current release.</p></li>
</ul>
<p>Here is an example of a typical sequence of states in a TWT use case:</p>
<ol class="arabic">
<li><p>Scan the network.</p></li>
<li><p>Connect to an access point.</p></li>
<li><p>Complete the application-level handshake.</p></li>
<li><p>Set up a TWT session using the following Wi-Fi shell command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">wifi twt setup</span>
</pre></div>
</div>
</li>
<li><p>Tear down the TWT session.</p>
<ul>
<li><p>An application can tear down an ongoing TWT session and enter DTIM Power Save mode, if it is expecting group addressed frames, and set up a TWT session again as applicable.</p></li>
<li><p>Devices are not expected to schedule transmission outside the TWT Service Period.
An application can tear down an ongoing TWT session and schedule, if there is a requirement for immediate transmission.</p></li>
<li><p>To tear down a TWT session, use the following Wi-Fi shell commands:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">wifi twt teardown</span>
<span class="go">wifi twt teardown_all</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ol>
</section>
<section id="key-parameters">
<h3><a class="toc-backref" href="#id25">Key parameters</a><a class="headerlink" href="#key-parameters" title="Permalink to this heading"></a></h3>
<p>Following are the two key parameters of Target Wake Time:</p>
<ul class="simple">
<li><p><strong>TWT Wake Duration</strong></p>
<ul>
<li><p>The amount of time that the TWT requesting device needs to be active to complete the frame exchanges during the TWT wake interval.</p></li>
<li><p>Valid range for duration is 1 ms to 256 ms.
Lower value results in more power saving at the cost of potential loss of data.
It is recommended not to go lower than 8 ms.
The application can choose a value lower than 8 ms at the cost of losing application data in the network.</p></li>
<li><p>The application must choose the right duration based on the traffic pattern.</p></li>
<li><p>Applications must take appropriate action if uplink or downlink traffic is more than anticipated.
It could terminate the ongoing TWT session and negotiate a fresh session based on new requirements.</p></li>
<li><p>Downlink traffic:</p>
<ol class="loweralpha simple">
<li><p>Predictability is the key for choosing the correct wake duration.</p></li>
<li><p>Wake duration must be sufficient for the AP to schedule all the incoming traffic to devices.
AP needs to contend the channel for scheduling frames and frames will be dropped if the duration is aggressive in busy channels.</p></li>
<li><p>AP will drop the device data if it cannot finish all transmission in the wake duration.
AP may buffer traffic until the next interval if sleep duration is in the order of 100 ms.
It will not buffer the device data if sleep duration is in the order of minutes and data will be lost.</p></li>
<li><p>Devices are allowed to sleep after the wake duration and there is no mechanism to extend the wake duration based on downlink traffic.
Device must be active during the wake duration even if there is no downlink traffic.</p></li>
</ol>
</li>
<li><p>Uplink traffic:</p>
<ol class="loweralpha simple">
<li><p>Trigger Enabled - When operating in Trigger Enabled mode, the nRF70 Series device:</p>
<ul>
<li><p>schedules uplink traffic as a response to trigger frames from the AP.</p></li>
<li><p>expects the AP to schedule trigger frames in the wake duration.</p></li>
<li><p>discards all pending uplink frames after wake time expiry before entering the sleep state.</p></li>
</ul>
</li>
<li><p>Non-trigger Enabled - When operating in Non-trigger Enabled mode, the nRF70 Series device:</p>
<ul>
<li><p>schedules uplink traffic using the legacy channel contention.</p></li>
<li><p>tries to schedule all uplink traffic in the wake duration and discard pending frames.</p></li>
<li><p>discards all pending uplink frames after wake time expiry before entering the sleep state.</p></li>
</ul>
</li>
</ol>
</li>
</ul>
</li>
<li><p><strong>TWT Wake Interval</strong></p>
<ul>
<li><p>Interval between successive TWT wake periods.</p></li>
<li><p>Valid range for duration is one ms to a few days.</p></li>
<li><p>Application must choose the right interval based on the expected traffic.</p></li>
</ul>
</li>
</ul>
<p>The following figure illustrates the two key parameters of Target Wake Time:</p>
<figure class="align-default" id="id10">
<img alt="TWT Wake Duration and Interval" src="../../../_images/nRF70_ug_twt_wake_interval.svg" /><figcaption>
<p><span class="caption-text">TWT Wake Duration and Interval</span><a class="headerlink" href="#id10" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
</section>
<section id="usage">
<span id="ug-nrf70-developing-powersave-usage"></span><h2><a class="toc-backref" href="#id26">Usage</a><a class="headerlink" href="#usage" title="Permalink to this heading"></a></h2>
<p>DTIM-based power save is the default configuration of the device after connection to an access point.
The wake-up and sleep period of the device is aligned to DTIM period advertised in the AP beacon.
The access point is in control of DTIM period and can be configured while setting up the network.
Stations connected to the AP cannot set or request a change in this value.</p>
<p>A higher DTIM period provides higher power saving in devices, but it adds latency to the downlink traffic.
The latency of the DTIM period is seen in the device for the initial downlink traffic.
A device can wake up and schedule uplink traffic at any time and latency of a few milliseconds is observed.</p>
<p>When operating in DTIM Power Save mode, the nRF70 Series device:</p>
<ul class="simple">
<li><p>wakes up to receive DTIM beacons and decode TIM.</p></li>
<li><p>receives all broadcast or multicast frames after DTIM beacon.</p></li>
<li><p>retrieves all unicast frames using either PS-POLL or Trigger frames.</p></li>
<li><p>maintains the Wi-Fi connection by responding to the keep alive packet exchange at any point of time.</p></li>
</ul>
<p>TWT-based power save allows devices to sleep for longer intervals than the DTIM power save.
It is suitable for devices that have predictable periodic uplink or downlink traffic and do not have low latency requirements.
DTIM-based power save is more efficient for sleep intervals that are in the range of milliseconds to a few seconds.
TWT will perform better if the sleep interval is in the 10s of seconds and above range.
DTIM-based power save performs better in high throughput applications compared to TWT.
As the device sleeps longer and does not wake up to receive DTIM beacons, it misses all multicast or broadcast frames.
The TWT session is expected to be set up by the application after the network level negotiation, after which it is not expected to receive any multicast or broadcast frames.</p>
</section>
<section id="power-save-api">
<span id="ug-nrf70-developing-powersave-api"></span><h2><a class="toc-backref" href="#id27">Power Save API</a><a class="headerlink" href="#power-save-api" title="Permalink to this heading"></a></h2>
<p>The following shell commands and network management APIs are provided for power save operations:</p>
<table class="docutils align-default" id="id11">
<caption><span class="caption-text">Wi-Fi Power Save network management APIs</span><a class="headerlink" href="#id11" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Network management APIs</p></th>
<th class="head"><p>Command</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Expected output</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>net_mgmt(NET_REQUEST_WIFI_PS)</p></td>
<td><p>wifi ps on</p></td>
<td><p>Turn on power save feature</p></td>
<td><p>Power Save enabled</p></td>
</tr>
<tr class="row-odd"><td><p>net_mgmt(NET_REQUEST_WIFI_PS)</p></td>
<td><p>wifi ps off</p></td>
<td><p>Turn off power save feature</p></td>
<td><p>Power Save disabled</p></td>
</tr>
<tr class="row-even"><td><p>net_mgmt(NET_REQUEST_WIFI_PS_MODE)</p></td>
<td><p>wifi ps_mode legacy</p></td>
<td><p>Config mode as Legacy</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>net_mgmt(NET_REQUEST_WIFI_PS_MODE)</p></td>
<td><p>wifi ps_mode wmm</p></td>
<td><p>Config mode as WMM</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>net_mgmt(NET_REQUEST_WIFI_TWT)</p></td>
<td><p>wifi twt setup 0 0 1 1 0 1 1 1 65 524</p></td>
<td><div class="line-block">
<div class="line">Set up TWT:</div>
<div class="line">TWT wake interval - 524 ms</div>
<div class="line">TWT wake duration - 65 ms</div>
</div>
</td>
<td><p>TWT operation TWT setup with dg - 1, flow_id - 1 requested</p></td>
</tr>
<tr class="row-odd"><td><p>net_mgmt(NET_REQUEST_WIFI_TWT)</p></td>
<td><p>wifi twt teardown 0 0 1 1</p></td>
<td><p>Tear down TWT session</p></td>
<td><p>TWT operation TWT setup with dg - 1, flow_id - 1 requested</p></td>
</tr>
<tr class="row-even"><td><p>net_mgmt(NET_REQUEST_WIFI_TWT)</p></td>
<td><p>wifi twt teardown_all</p></td>
<td><p>Tear down all sessions</p></td>
<td><p>TWT operation TWT teardown all flows</p></td>
</tr>
</tbody>
</table>
<p>See the <a class="reference internal" href="../../../samples/wifi/shell/README.html#wifi-shell-sample"><span class="std std-ref">Wi-Fi: Shell</span></a> sample for more information.</p>
</section>
<section id="power-profiling">
<span id="ug-nrf70-developing-powersave-profiling"></span><h2><a class="toc-backref" href="#id28">Power profiling</a><a class="headerlink" href="#power-profiling" title="Permalink to this heading"></a></h2>
<p>The Power Profiler Kit II of Nordic Semiconductor can be used to measure the power consumption of nRF70 Series devices in Low-power mode.
To measure the power consumption of the nRF70 Series device, complete the following steps:</p>
<ol class="arabic">
<li><p>Remove the jumper on <strong>P23</strong> (VBAT jumper).</p></li>
<li><p>Connect <strong>GND</strong> on the PPK2 kit to any <strong>GND</strong> on the DK.
You can use the <strong>P21</strong> pin <strong>1</strong> labeled as <strong>GND</strong> (-).</p></li>
<li><p>Connect the <strong>Vout</strong> on the PPK2 kit to the <strong>P23</strong> pin <strong>1</strong> on the DK.</p>
<figure class="align-default" id="id12">
<img alt="Typical configuration for measuring power on the DK" src="../../../_images/power_profiler2_pc_nrf7002_dk.svg" /><figcaption>
<p><span class="caption-text">Typical configuration for measuring power on the DK</span><a class="headerlink" href="#id12" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</li>
<li><p>Configure PPK2 as a source meter with 3.6 volts.</p>
<ul class="simple">
<li><p>The following image shows the Power Profiler Kit II example output for DTIM wakeup.</p></li>
</ul>
<figure class="align-default" id="id13">
<img alt="Power profiler output for DTIM wakeup" src="../../../_images/power_profiler_dtim_wakeup.png" />
<figcaption>
<p><span class="caption-text">Power Profiler Kit II output for DTIM wakeup</span><a class="headerlink" href="#id13" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<ul>
<li><p>To reproduce the plots for DTIM period of 3, complete the following steps using the <a class="reference internal" href="../../../samples/wifi/shell/README.html#wifi-shell-sample"><span class="std std-ref">Wi-Fi: Shell</span></a> sample:</p>
<ol class="arabic">
<li><p>Configure an AP with DTIM value of 3.</p></li>
<li><p>Connect to the AP using the following Wi-Fi shell commands:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">wifi scan</span>
<span class="go">wifi connect &lt;SSID&gt;</span>
</pre></div>
</div>
</li>
<li><p>Check the connection status using the following Wi-Fi shell command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">wifi status</span>
</pre></div>
</div>
</li>
</ol>
</li>
</ul>
<p>The following image shows the Power Profiler Kit II output for DTIM period of 3.</p>
<figure class="align-default" id="id14">
<img alt="Power profiler output for DTIM period of 3" src="../../../_images/power_profiler_dtim_output.png" />
<figcaption>
<p><span class="caption-text">Power Profiler Kit II output for DTIM period of 3</span><a class="headerlink" href="#id14" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<ul>
<li><p>To reproduce the plots for TWT interval of one minute, complete the following steps using the <a class="reference internal" href="../../../samples/wifi/shell/README.html#wifi-shell-sample"><span class="std std-ref">Wi-Fi: Shell</span></a> sample:</p>
<ol class="arabic">
<li><p>Connect to a TWT supported Wi-Fi 6 AP using the following Wi-Fi shell commands:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">wifi scan</span>
<span class="go">wifi connect &lt;SSID&gt;</span>
</pre></div>
</div>
</li>
<li><p>Check the connection status using the following Wi-Fi shell command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">wifi status</span>
</pre></div>
</div>
</li>
<li><p>Start a TWT session using the following Wi-Fi shell command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">wifi twt setup 0 0 1 1 0 1 1 1 8 60000</span>
</pre></div>
</div>
</li>
</ol>
</li>
</ul>
<p>The following image shows the Power Profiler Kit II output for TWT interval of one minute.</p>
<figure class="align-default" id="id15">
<img alt="Power profiler output for TWT" src="../../../_images/power_profiler_twt.png" />
<figcaption>
<p><span class="caption-text">Power Profiler Kit II output for TWT</span><a class="headerlink" href="#id15" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</li>
</ol>
</section>
</section>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="constrained.html" class="btn btn-neutral float-right" title="Operating with a resource constrained host" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="Developing with nRF70 Series" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">

<table>
<tr>
<td>
    <p>
        &copy; Copyright 2019-2023, Nordic Semiconductor.
      Last updated on Mar 20, 2023.

    </p>
</td>
<td id="nordiclogo">
  <a href="https://www.nordicsemi.com/"><img src="../../../_static/images/nordic-logo.png" border="0"/></a>
</td>
</tr>
</table>
  </div> 


</footer>

<div id="scroll-container">
  <button type="button" id="scroll-btn" class="btn">
    <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="#fff"/></svg>
  </button>
</div>

<script>
  const scrollBtn = document.querySelector("#scroll-btn");

  document.addEventListener("scroll", () => {
    if (window.scrollY > 400) {
          scrollBtn.style.visibility = "visible";
      } else {
          scrollBtn.style.visibility = "hidden";
      }
  });

  scrollBtn.addEventListener("click", () => {
      window.scrollTo({ top: 0, behavior: "smooth" });
  });
</script>
        </div>
      </div>
    </section>
  </div>
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> nRF Connect SDK</span>
       <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      
      <div class="rst-other-version ncs">
        <a href="../../../../nrf/index.html">nRF Connect SDK</a>
      </div>
      
      <div class="rst-other-version nrfx">
        <a href="../../../../nrfx/index.html">nrfx</a>
      </div>
      
      <div class="rst-other-version nrfxlib">
        <a href="../../../../nrfxlib/README.html">nrfxlib</a>
      </div>
      
      <div class="rst-other-version zephyr">
        <a href="../../../../zephyr/index.html">Zephyr Project</a>
      </div>
      
      <div class="rst-other-version mcuboot">
        <a href="../../../../mcuboot/wrapper.html">MCUboot</a>
      </div>
      
      <div class="rst-other-version tfm">
        <a href="../../../../tfm/index.html">Trusted Firmware-M</a>
      </div>
      
      <div class="rst-other-version matter">
        <a href="../../../../matter/index.html">Matter</a>
      </div>
      
      <div class="rst-other-version kconfig">
        <a href="../../../../kconfig/index.html">Kconfig Reference</a>
      </div>
    </div>
  </div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>