<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gazell Pairing &mdash; nRF Connect SDK 2.3.99 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/nordic.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/togglebutton.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/nrf.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/tabs.css" type="text/css" /> 
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="https://www.googletagmanager.com/gtag/js?id=G-ZPVZRKFQJR"></script>
        <script src="../../_static/js/ga-tracker.js"></script>
        <script data-culture="EN" id="CookieConsent" type="text/javascript" src="https://policy.app.cookieinformation.com/uc.js"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../_static/togglebutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/js/theme.js"></script>
<script
  type="text/javascript"
  src="../../_static/js/ncs.js"
></script>
<script src="../../_static/js/bootstrap.bundle.min.js"></script>

    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Matter" href="../matter/index.html" />
    <link rel="prev" title="Gazell Link Layer" href="gzll.html" />
<link
  href="../../_static/css/bootstrap.min.css"
  rel="stylesheet"
/>
<link
  rel="shortcut icon"
  href="../../_static/images/favicon.ico"
/>

</head>

<body class="wy-body-for-nav">
<div class="announcement"></div>
<div class="d-print-none ncs-header">
  <div class="container-xl ncs-header-top">
    <div class="row h-100">
      <div class="d-none d-md-block col-2">
        <div class="bg-white py-4 px-3 ml-2 ncs-header-logo">
          <img
            class="ncs-header-logo"
            src="../../_static/images/nordic-logo.png"
            alt=""
          />
        </div>
      </div>
      <div
        class="col-8 col-md-7 pl-md-4 d-flex align-self-center justify-content-center"
      >
        <form class="w-75" action="../../search.html" method="get">
          <div class="form-group">
            <input
              type="text"
              name="q"
              class="ncs-search-input form-control"
              placeholder="Search all docs..."
            />
          </div>
        </form>
      </div>
      <div class="col-4 col-md-3 d-md-block p-3 text-end">
        <div class="dropdown">
          <button
            class="btn dropdown-toggle ncs-btn-versions"
            type="button"
            id="dropdownMenuButton1"
            data-bs-toggle="dropdown"
            aria-expanded="false"
          >
            <span class="d-none d-md-inline">nRF Connect SDK</span>
            <span id="ncsversion" class="d-inline"></span>
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton"></div>
        </div>
      </div>
    </div>
  </div>
  <div class="ncs-header-nav">
    <div class="container-xl">
      <div class="row">
        <div class="col col-12 d-flex justify-content-center">
          <nav class="navbar navbar-dark navbar-expand-lg p-0">
            <span class="navbar-brand d-block d-lg-none py-2 pl-1"
              >Documentation sets</span
            >
            <button
              class="navbar-toggler"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#navbarNavAltMarkup"
              aria-controls="navbarNavAltMarkup"
              aria-expanded="false"
              aria-label="Toggle navigation"
            >
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
              <ul class="navbar-nav">
                <li class="nav-item active py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../nrf/index.html"
                    >nRF Connect SDK</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../nrfx/index.html"
                    >nrfx</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../nrfxlib/README.html"
                    >nrfxlib</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../zephyr/index.html"
                    >Zephyr Project</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../mcuboot/wrapper.html"
                    >MCUboot</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../tfm/index.html"
                    >Trusted Firmware-M</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../matter/index.html"
                    >Matter</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../kconfig/index.html"
                    >Kconfig Reference</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
              </ul>
            </div>
          </nav>
        </div>
      </div>
    </div>
  </div>
</div>

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> nRF Connect SDK
          </a>
              <div class="version">
                2.3.99
              </div>
<div id="searchbox" role="search">
  <div class="searchformwrapper">
    <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
  </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev_model.html">Development model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../app_dev.html">Application development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ecosystem_integration.html">Ecosystems integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nrf91.html">Working with nRF91 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nrf70.html">Working with nRF70 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nrf53.html">Working with nRF53 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nrf52.html">Working with nRF52 Series</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../protocols.html">Protocols</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../ble/index.html">Bluetooth LE Controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bt_mesh/index.html">Bluetooth mesh</a></li>
<li class="toctree-l2"><a class="reference internal" href="../esb/index.html">Enhanced ShockBurst (ESB)</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Gazell</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="gzll.html">Gazell Link Layer</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Gazell Pairing</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#features">Features</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pairing-and-key-exchange-stages">Pairing and key exchange stages</a></li>
<li class="toctree-l4"><a class="reference internal" href="#encrypted-user-data-exchange">Encrypted User Data exchange</a></li>
<li class="toctree-l4"><a class="reference internal" href="#system-address-and-channel-table-generation">System Address and channel table generation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#terminology">Terminology</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../matter/index.html">Matter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../multiprotocol/index.html">Multiprotocol support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nfc/index.html">Near Field Communication (NFC)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../thread/index.html">Thread</a></li>
<li class="toctree-l2"><a class="reference internal" href="../wifi/index.html">Wi-Fi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../zigbee/index.html">Zigbee</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../applications.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../samples.html">Samples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../drivers.html">Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../libraries/index.html">Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scripts.html">Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../known_issues.html">Known issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../software_maturity.html">Software maturity levels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation.html">About this documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">nRF Connect SDK</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../../protocols.html">Protocols</a></li>
          <li class="breadcrumb-item"><a href="index.html">Gazell</a></li>
      <li class="breadcrumb-item active">Gazell Pairing</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/protocols/gazell/gzp.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="gazell-pairing">
<span id="ug-gzp"></span><h1>Gazell Pairing<a class="headerlink" href="#gazell-pairing" title="Permalink to this heading"></a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#features" id="id11">Features</a></p></li>
<li><p><a class="reference internal" href="#pairing-and-key-exchange-stages" id="id12">Pairing and key exchange stages</a></p>
<ul>
<li><p><a class="reference internal" href="#factory-preset-parameters" id="id13">Factory preset parameters</a></p></li>
<li><p><a class="reference internal" href="#system-address-exchange" id="id14">System Address exchange</a></p></li>
<li><p><a class="reference internal" href="#host-id-exchange" id="id15">Host ID exchange</a></p></li>
<li><p><a class="reference internal" href="#dynamic-key-exchange" id="id16">Dynamic Key exchange</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#encrypted-user-data-exchange" id="id17">Encrypted User Data exchange</a></p></li>
<li><p><a class="reference internal" href="#system-address-and-channel-table-generation" id="id18">System Address and channel table generation</a></p></li>
<li><p><a class="reference internal" href="#terminology" id="id19">Terminology</a></p></li>
</ul>
</div>
<p>The Gazell Pairing library for the nRF52 Series enables applications to use the Gazell Link Layer to provide a secure wireless link between Gazell nodes.
The library is customized for pairing a Device (for example, a mouse, keyboard, or remote control) with a Host (typically a USB dongle) using Gazell.</p>
<p>Gazell Pairing also uses additional hardware peripherals and restricts the usage of the Gazell Link Layer.</p>
<p>See the <a class="reference internal" href="../../libraries/gazell/gzp.html#gzp"><span class="std std-ref">Gazell Pairing library</span></a> page for more information on how to use this library.</p>
<section id="features">
<h2><a class="toc-backref" href="#id11">Features</a><a class="headerlink" href="#features" title="Permalink to this heading"></a></h2>
<p>The Gazell Pairing library has the following features:</p>
<ul class="simple">
<li><p>Close proximity pairing</p></li>
<li><p>AES-128 encryption</p></li>
<li><p>Secure key exchange</p></li>
<li><p>Dynamic update of key during runtime</p></li>
<li><p>Storage of pairing parameters in non-volatile memory</p></li>
<li><p>One time programmable (OTP) device compatibility</p></li>
<li><p>Backwards compatible with Gazell Pairing library for the nRF24L IC.</p></li>
</ul>
<p>Secure key exchange in Gazell Pairing is based on a Secret Key that is factory-programmed.
Only nodes that share the same Secret Key for a desktop ecosystem, can form an encrypted link.
After a pair of nodes have authenticated each other’s Secret Key, the Gazell Host generates a random key termed the “Host ID”.
This is encrypted with the Secret Key and sent to the Gazell Device.
This Host ID key is used to transmit a dynamic key that is used for encrypting subsequent data.</p>
<p>All encrypted exchanges of keys and data use a session token that is equivalent to the AES counter mode and provides protection against ciphertext attacks.
In addition, all encrypted packets include an encrypted packet validation ID so that all packets are authenticated.</p>
<p>The security features of Gazell Pairing provide counter measures against a range of potential attacks, including:</p>
<ul class="simple">
<li><p>Frequency analysis attacks</p></li>
<li><p>Hostile device attacks</p></li>
<li><p>Known-plaintext attacks</p></li>
<li><p>Man-in-the-middle attacks</p></li>
<li><p>Passive eavesdropping</p></li>
<li><p>Replay attacks</p></li>
</ul>
<p>See <a class="reference internal" href="#terminology">Terminology</a> for a description of each of these security features.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Gazell only allows pairing when the Host and Device are in close proximity to each other.
The Received Signal Strength Indication (RSSI) is used on the Host side of the nRF52 Series so that only Devices residing close (&lt;30 cm) to the Host are allowed to pair (on the nRF24L IC Host nodes, the carrier detect functionality is employed).
Proximity estimation is essential to avoid confusion when pairing in certain environments, for example in an office.</p>
</div>
</section>
<section id="pairing-and-key-exchange-stages">
<h2><a class="toc-backref" href="#id12">Pairing and key exchange stages</a><a class="headerlink" href="#pairing-and-key-exchange-stages" title="Permalink to this heading"></a></h2>
<p>The pairing and key exchange process consists of the following stages:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#ug-gzp-sys-addr-exchange"><span class="std std-ref">System Address exchange</span></a></p></li>
<li><p><a class="reference internal" href="#ug-gzp-host-id-exchange"><span class="std std-ref">Host ID exchange</span></a></p></li>
<li><p><a class="reference internal" href="#ug-gzp-dyn-key-exchange"><span class="std std-ref">Dynamic Key exchange</span></a></p></li>
<li><p><a class="reference internal" href="#ug-gzp-enc-user-data-exchange"><span class="std std-ref">Encrypted User Data exchange</span></a></p></li>
</ul>
<p>Each of these stages are required to send encrypted user data from a Device to a Host.
If encryption is not required, only the “System Address exchange” stage is required to send unencrypted data on pipes 2-7.</p>
<section id="factory-preset-parameters">
<h3><a class="toc-backref" href="#id13">Factory preset parameters</a><a class="headerlink" href="#factory-preset-parameters" title="Permalink to this heading"></a></h3>
<p>For pairing and key exchange to occur, an unpaired Host and Device must share the following factory preset parameters:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 21%" />
<col style="width: 8%" />
<col style="width: 7%" />
<col style="width: 49%" />
<col style="width: 16%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Secret</p></th>
<th class="head"><p>Bytes</p></th>
<th class="head"><p>Purpose</p></th>
<th class="head"><p>Set</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Secret Key</p></td>
<td><p>Yes</p></td>
<td><p>16</p></td>
<td><p>Encrypting Host ID when sent from Host to Device</p></td>
<td><p>Factory preset</p></td>
</tr>
<tr class="row-odd"><td><p>Pairing Address</p></td>
<td><p>No</p></td>
<td><p>5</p></td>
<td><p>Sending of System Address from Host to Device</p></td>
<td><p>Factory preset</p></td>
</tr>
<tr class="row-even"><td><p>Packet Validation ID</p></td>
<td><p>No</p></td>
<td><p>3</p></td>
<td><p>Authentication of packets</p></td>
<td><p>Factory preset</p></td>
</tr>
</tbody>
</table>
<p>In addition, every Host has the unique parameters that are generated at runtime:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 6%" />
<col style="width: 5%" />
<col style="width: 39%" />
<col style="width: 39%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Secret</p></th>
<th class="head"><p>Bytes</p></th>
<th class="head"><p>Purpose</p></th>
<th class="head"><p>Set</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>System Address</p></td>
<td><p>No</p></td>
<td><p>5</p></td>
<td><p>Address used for all transmission.
Seed for generating channel set.</p></td>
<td><p>Runtime.
Generated when first system address request received.</p></td>
</tr>
<tr class="row-odd"><td><p>Host ID</p></td>
<td><p>Yes</p></td>
<td><p>5</p></td>
<td><p>Encrypting Dynamic Key when sent from Device to Host</p></td>
<td><p>Runtime.
Generated when first Host ID request is received.</p></td>
</tr>
</tbody>
</table>
<p>The System Address and Host ID are stored in the non-volatile memory (NVM) and apply for the lifetime of the Host unless the NVM is erased.</p>
<figure class="align-default" id="id6">
<img alt="Initial pairing parameters" src="../../_images/gzp_factory_defaults.svg" /><figcaption>
<p><span class="caption-text">Initial pairing parameters</span><a class="headerlink" href="#id6" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="system-address-exchange">
<span id="ug-gzp-sys-addr-exchange"></span><h3><a class="toc-backref" href="#id14">System Address exchange</a><a class="headerlink" href="#system-address-exchange" title="Permalink to this heading"></a></h3>
<p>The System Address is an individual Host’s private address.
For a Device to communicate with an individual Host, it needs to know the Host’s System Address.
When requesting a System Address, the Device sets the TX power to a low level using <code class="xref c c-macro docutils literal notranslate"><span class="pre">GZP_POWER</span></code>.
By measuring the received signal strength when a pairing request is received from a Device, the Host can estimate the relative proximity of the requesting Device.</p>
<p>For a Device to pair with a Host, it must first obtain the System Address on which all subsequent key exchange and data transfer occur.
This transaction occurs on the pipe 0 and is transmitted in cleartext on the air as it is not a secret.</p>
<figure class="align-default" id="id7">
<img alt="System address exchange" src="../../_images/gzp_address_exchange.svg" /><figcaption>
<p><span class="caption-text">System Address exchange</span><a class="headerlink" href="#id7" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="host-id-exchange">
<span id="ug-gzp-host-id-exchange"></span><h3><a class="toc-backref" href="#id15">Host ID exchange</a><a class="headerlink" href="#host-id-exchange" title="Permalink to this heading"></a></h3>
<p>Once the Device has the System Address, it can request the Host ID on the pipe using <a class="reference internal" href="../../libraries/gazell/gzp.html#c.GZP_DATA_PIPE" title="GZP_DATA_PIPE"><code class="xref c c-macro docutils literal notranslate"><span class="pre">GZP_DATA_PIPE</span></code></a>.
The Host ID is used to generate subsequent Dynamic Keys for encrypted data transfer.</p>
<p>After receiving a Host ID request, the Host generates the ID if it has not done it already.
The Host ID is generated using the random Session Token received from the Device in the Host ID request as well as the session counter.</p>
<p>The Device sends a packet to fetch the Host ID.
The secret Host ID is transmitted on the encrypted pipe <a class="reference internal" href="../../libraries/gazell/gzp.html#c.GZP_DATA_PIPE" title="GZP_DATA_PIPE"><code class="xref c c-macro docutils literal notranslate"><span class="pre">GZP_DATA_PIPE</span></code></a> using the shared Secret Key.</p>
<p>The following security precautions are taken for the Host ID exchange:</p>
<ul class="simple">
<li><p>Passive eavesdropping is prevented by using AES encryption.</p></li>
<li><p>Replay attacks are prevented by using session tokens.</p></li>
<li><p>Man-in-the-middle and malicious device attacks can be prevented by implementing a user validation stage before the Host ID is sent to the Device (see <a class="reference internal" href="#ug-gzp-host-id-validation"><span class="std std-ref">Optional Host ID validation stage</span></a>).</p></li>
</ul>
<figure class="align-default" id="id8">
<img alt="Host ID exchange" src="../../_images/gzp_host_id_exchange.svg" /><figcaption>
<p><span class="caption-text">Host ID exchange</span><a class="headerlink" href="#id8" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>The Host ID can be compromised if the attacker has knowledge of the Secret Key.
The attacker could eavesdrop the Host ID exchange and obtain the Host ID or attempt to pair as a malicious device and obtain the Host ID.
Before the Host ID is sent from the Host to the Device, the application can add a validation stage.</p>
<section id="optional-host-id-validation-stage">
<span id="ug-gzp-host-id-validation"></span><h4>Optional Host ID validation stage<a class="headerlink" href="#optional-host-id-validation-stage" title="Permalink to this heading"></a></h4>
<p>The validation stage would typically contain some user intervention, for example the user can be requested to write a keycode on the Device, displayed on a screen on the Host.</p>
<p>This requires the Device to be able to send user data before all parameters normally used for encrypting user data have been exchanged.
It is still possible to send encrypted data during the validation stage.
This data is encrypted in the same fashion as normal user data, described in Encrypted User Data exchange, except for the following differences:</p>
<ul class="simple">
<li><p>The Secret Key is used instead of the Dynamic Key.</p></li>
<li><p>Session token update is not sent from the Device to the Host.</p></li>
</ul>
<p>As the same session token is used throughout the entire validation stage, the data exchange in the validation stage has the following properties:</p>
<ul class="simple">
<li><p>Only the same Device as the one initializing the Host ID exchange can send data that will be accepted by the Host.</p></li>
<li><p>Only the Device used for sending user data during the validation stage can decrypt the Host ID sent from the Host.</p></li>
</ul>
</section>
</section>
<section id="dynamic-key-exchange">
<span id="ug-gzp-dyn-key-exchange"></span><h3><a class="toc-backref" href="#id16">Dynamic Key exchange</a><a class="headerlink" href="#dynamic-key-exchange" title="Permalink to this heading"></a></h3>
<p>The Dynamic Key is used for encrypting user data.
Each Device must have a unique Dynamic Key, and the Host must know the Dynamic Key of each Device it communicates with.</p>
<p>A Device can initialize the update of the Dynamic Key at any time.
The Dynamic Key is generated randomly on the Device and then communicated to the Host.
The Host ID is used for encrypting the Dynamic Key.</p>
<p>The Dynamic Key is considered a secret, and the following security precautions are taken:</p>
<ul class="simple">
<li><p>Passive eavesdropping is prevented by using AES encryption.</p></li>
<li><p>Replay attacks are prevented by using session tokens sent from Host.</p></li>
<li><p>Only Devices knowing the Host ID can update the Dynamic Key in the Host.</p></li>
</ul>
<figure class="align-default" id="id9">
<img alt="Dynamic Key exchange" src="../../_images/gzp_key_exchange.svg" /><figcaption>
<p><span class="caption-text">Dynamic Key exchange</span><a class="headerlink" href="#id9" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>The main reasons for using a Dynamic Key for encryption of user data are:</p>
<ul class="simple">
<li><p>A Host must be able to pair with multiple Devices at the same time, and none of these should use the same key for encryption of user data.</p></li>
<li><p>The solution must be available on OTP devices, where storing of keys in the non-volatile memory during runtime is not desired.</p></li>
</ul>
<p>The secrecy of the Dynamic Key is dependent on the secrecy of the Host ID.
The Dynamic Key can be compromised if both these conditions are met:</p>
<ul class="simple">
<li><p>Attacker eavesdrops the exchange of the Dynamic Key.</p></li>
<li><p>The Host ID has been compromised.</p></li>
</ul>
</section>
</section>
<section id="encrypted-user-data-exchange">
<span id="ug-gzp-enc-user-data-exchange"></span><h2><a class="toc-backref" href="#id17">Encrypted User Data exchange</a><a class="headerlink" href="#encrypted-user-data-exchange" title="Permalink to this heading"></a></h2>
<p>Once the Device and Host share a Dynamic key, encrypted data exchange can occur.
When sending Encrypted User Data, the following security precautions are taken:</p>
<ul class="simple">
<li><p>Passive eavesdropping is prevented by AES encryption.</p></li>
<li><p>“Hostile” device attacks are prevented as only Devices that know the current Dynamic Key can send user data that will be accepted by the Host.</p></li>
<li><p>Known plaintext or ciphertext attacks are prevented by AES encryption.</p></li>
<li><p>Replay attacks are prevented by using session tokens sent from the Host.</p></li>
<li><p>Frequency analysis attacks are prevented by updating session token for every packet.</p></li>
</ul>
<figure class="align-default" id="id10">
<img alt="Encrypted user data exchange" src="../../_images/gzp_user_data_exchange.svg" /><figcaption>
<p><span class="caption-text">Encrypted user data exchange</span><a class="headerlink" href="#id10" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>The secrecy of the Encrypted User Data is dependent on the secrecy of the Dynamic Key.
The Encrypted User Data may be compromised if both these conditions are met:</p>
<ul class="simple">
<li><p>Attacker eavesdrops the user data exchange.</p></li>
<li><p>The current Dynamic Key has been compromised.</p></li>
</ul>
</section>
<section id="system-address-and-channel-table-generation">
<h2><a class="toc-backref" href="#id18">System Address and channel table generation</a><a class="headerlink" href="#system-address-and-channel-table-generation" title="Permalink to this heading"></a></h2>
<p>The System Address determines the Gazell channel table on the Host and Device for subsequent transactions.</p>
<p>When sending the System Address request, the Device knows only the lowest and highest RF channels in the Host’s channel table (<code class="xref c c-macro docutils literal notranslate"><span class="pre">GZP_CHANNEL_LOW</span></code> and <code class="xref c c-macro docutils literal notranslate"><span class="pre">GZP_CHANNEL_HIGH</span></code>).
This is sufficient for the System Address transaction as the Device and Host eventually change channels so that they can communicate.
In an environment with many desktops using Gazell Pairing, the Device and Host will find another channel to communicate on.</p>
</section>
<section id="terminology">
<h2><a class="toc-backref" href="#id19">Terminology</a><a class="headerlink" href="#terminology" title="Permalink to this heading"></a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 15%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Frequency analysis attacks</p></td>
<td><p>Frequency analysis is the study of the frequency of letters, or groups of letters, in the ciphertext.
Even the most advanced ciphers such as AES, do not provide security against this type of attack unless precautions for such an attack have been taken.
Frequency analysis is based on the fact that certain letters and combinations of letters occur with varying frequencies.
Knowing these properties of a given language, it can be possible to decipher the packets sent from the keyboard without having to break the cipher itself.</p>
<p>The encrypted user data in Gazell pairing is protected against frequency analysis attacks by using a session token, which is incremented for every packet.
This is equivalent to AES “counter” mode.
As the keys can take on any value they cannot be compromised by a frequency analysis attack.</p>
</td>
</tr>
<tr class="row-odd"><td><p>Hostile device attack</p></td>
<td><p>Here, a hostile Device attack is used as a scenario, where a hostile third party Device has been able to pair with the Host and starts sending data that
is interpreted as trusted user data by the Host.
The hostile device may also obtain any keys shared with other devices in order to eavesdrop communications.
For example, having such a capability with a wireless keyboard, an attacker can easily perform a range of operations on the host PC, like damaging
contents on the PC or install spyware or key logging software.</p></td>
</tr>
<tr class="row-even"><td><p>Man-in-the-middle attack</p></td>
<td><p>The man-in-the-middle attack is a form of active eavesdropping in which the attacker makes independent connections with the victims during key exchanges
and relays messages between them, making them believe that they are talking directly to each other over a private connection, when in fact the entire
conversation is controlled by the attacker.</p>
<p>One method to prevent this attack is that the communicating parties have a shared secret to authenticate the source of the transmission.
In Gazell Pairing, this is provided by the factory-programmed Secret Key.</p>
</td>
</tr>
<tr class="row-odd"><td><p>Replay attacks</p></td>
<td><p>A replay attack is an attack where previously sent packets are recorded by a third party and resent to the receiver.
Here, the third party is not actually deciphering the keyboard packets, but repeats commands previously sent to the receiver.
For example, a typical login sequence on a PC consisting of entering a username and a password is in particular vulnerable for a replay attack.
In Gazell pairing, the use of dynamic keys and session tokens prevent this kind of attack.</p></td>
</tr>
<tr class="row-even"><td><p>Session token</p></td>
<td><p>A session token is a random or pseudo random number used for adding randomness to encryption of data packets.
The session token is not assumed as a secret.
The session token is generated before every new session and discarded after the session has ended.
Here, a session consists of one message sent from a transmitter to a recipient and one message being sent in return from the recipient to the
transmitter.</p></td>
</tr>
</tbody>
</table>
</section>
</section>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../matter/index.html" class="btn btn-neutral float-right" title="Matter" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="gzll.html" class="btn btn-neutral" title="Gazell Link Layer" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">

<table>
<tr>
<td>
    <p>
        &copy; Copyright 2019-2023, Nordic Semiconductor.
      Last updated on Mar 20, 2023.

    </p>
</td>
<td id="nordiclogo">
  <a href="https://www.nordicsemi.com/"><img src="../../_static/images/nordic-logo.png" border="0"/></a>
</td>
</tr>
</table>
  </div> 


</footer>

<div id="scroll-container">
  <button type="button" id="scroll-btn" class="btn">
    <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="#fff"/></svg>
  </button>
</div>

<script>
  const scrollBtn = document.querySelector("#scroll-btn");

  document.addEventListener("scroll", () => {
    if (window.scrollY > 400) {
          scrollBtn.style.visibility = "visible";
      } else {
          scrollBtn.style.visibility = "hidden";
      }
  });

  scrollBtn.addEventListener("click", () => {
      window.scrollTo({ top: 0, behavior: "smooth" });
  });
</script>
        </div>
      </div>
    </section>
  </div>
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> nRF Connect SDK</span>
       <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      
      <div class="rst-other-version ncs">
        <a href="../../../nrf/index.html">nRF Connect SDK</a>
      </div>
      
      <div class="rst-other-version nrfx">
        <a href="../../../nrfx/index.html">nrfx</a>
      </div>
      
      <div class="rst-other-version nrfxlib">
        <a href="../../../nrfxlib/README.html">nrfxlib</a>
      </div>
      
      <div class="rst-other-version zephyr">
        <a href="../../../zephyr/index.html">Zephyr Project</a>
      </div>
      
      <div class="rst-other-version mcuboot">
        <a href="../../../mcuboot/wrapper.html">MCUboot</a>
      </div>
      
      <div class="rst-other-version tfm">
        <a href="../../../tfm/index.html">Trusted Firmware-M</a>
      </div>
      
      <div class="rst-other-version matter">
        <a href="../../../matter/index.html">Matter</a>
      </div>
      
      <div class="rst-other-version kconfig">
        <a href="../../../kconfig/index.html">Kconfig Reference</a>
      </div>
    </div>
  </div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>