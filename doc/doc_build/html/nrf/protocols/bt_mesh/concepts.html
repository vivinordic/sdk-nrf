<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bluetooth mesh concepts &mdash; nRF Connect SDK 2.3.99 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/nordic.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/togglebutton.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/nrf.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/tabs.css" type="text/css" /> 
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="https://www.googletagmanager.com/gtag/js?id=G-ZPVZRKFQJR"></script>
        <script src="../../_static/js/ga-tracker.js"></script>
        <script data-culture="EN" id="CookieConsent" type="text/javascript" src="https://policy.app.cookieinformation.com/uc.js"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../_static/togglebutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/js/theme.js"></script>
<script
  type="text/javascript"
  src="../../_static/js/ncs.js"
></script>
<script src="../../_static/js/bootstrap.bundle.min.js"></script>

    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Bluetooth mesh stack architecture" href="architecture.html" />
    <link rel="prev" title="Supported Bluetooth mesh features" href="supported_features.html" />
<link
  href="../../_static/css/bootstrap.min.css"
  rel="stylesheet"
/>
<link
  rel="shortcut icon"
  href="../../_static/images/favicon.ico"
/>

</head>

<body class="wy-body-for-nav">
<div class="announcement"></div>
<div class="d-print-none ncs-header">
  <div class="container-xl ncs-header-top">
    <div class="row h-100">
      <div class="d-none d-md-block col-2">
        <div class="bg-white py-4 px-3 ml-2 ncs-header-logo">
          <img
            class="ncs-header-logo"
            src="../../_static/images/nordic-logo.png"
            alt=""
          />
        </div>
      </div>
      <div
        class="col-8 col-md-7 pl-md-4 d-flex align-self-center justify-content-center"
      >
        <form class="w-75" action="../../search.html" method="get">
          <div class="form-group">
            <input
              type="text"
              name="q"
              class="ncs-search-input form-control"
              placeholder="Search all docs..."
            />
          </div>
        </form>
      </div>
      <div class="col-4 col-md-3 d-md-block p-3 text-end">
        <div class="dropdown">
          <button
            class="btn dropdown-toggle ncs-btn-versions"
            type="button"
            id="dropdownMenuButton1"
            data-bs-toggle="dropdown"
            aria-expanded="false"
          >
            <span class="d-none d-md-inline">nRF Connect SDK</span>
            <span id="ncsversion" class="d-inline"></span>
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton"></div>
        </div>
      </div>
    </div>
  </div>
  <div class="ncs-header-nav">
    <div class="container-xl">
      <div class="row">
        <div class="col col-12 d-flex justify-content-center">
          <nav class="navbar navbar-dark navbar-expand-lg p-0">
            <span class="navbar-brand d-block d-lg-none py-2 pl-1"
              >Documentation sets</span
            >
            <button
              class="navbar-toggler"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#navbarNavAltMarkup"
              aria-controls="navbarNavAltMarkup"
              aria-expanded="false"
              aria-label="Toggle navigation"
            >
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
              <ul class="navbar-nav">
                <li class="nav-item active py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../nrf/index.html"
                    >nRF Connect SDK</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../nrfx/index.html"
                    >nrfx</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../nrfxlib/README.html"
                    >nrfxlib</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../zephyr/index.html"
                    >Zephyr Project</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../mcuboot/wrapper.html"
                    >MCUboot</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../tfm/index.html"
                    >Trusted Firmware-M</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../matter/index.html"
                    >Matter</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../kconfig/index.html"
                    >Kconfig Reference</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
              </ul>
            </div>
          </nav>
        </div>
      </div>
    </div>
  </div>
</div>

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> nRF Connect SDK
          </a>
              <div class="version">
                2.3.99
              </div>
<div id="searchbox" role="search">
  <div class="searchformwrapper">
    <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
  </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev_model.html">Development model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../app_dev.html">Application development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ecosystem_integration.html">Ecosystems integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nrf91.html">Working with nRF91 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nrf70.html">Working with nRF70 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nrf53.html">Working with nRF53 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nrf52.html">Working with nRF52 Series</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../protocols.html">Protocols</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../ble/index.html">Bluetooth LE Controller</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Bluetooth mesh</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="supported_features.html">Supported Bluetooth mesh features</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Bluetooth mesh concepts</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#application-areas">Application areas</a></li>
<li class="toctree-l4"><a class="reference internal" href="#network-topology-and-relaying">Network topology and relaying</a></li>
<li class="toctree-l4"><a class="reference internal" href="#addressing">Addressing</a></li>
<li class="toctree-l4"><a class="reference internal" href="#models-and-elements">Models and elements</a></li>
<li class="toctree-l4"><a class="reference internal" href="#device-life-cycle">Device life cycle</a></li>
<li class="toctree-l4"><a class="reference internal" href="#security">Security</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="architecture.html">Bluetooth mesh stack architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuring.html">Configuring Bluetooth mesh in nRF Connect SDK</a></li>
<li class="toctree-l3"><a class="reference internal" href="model_config_app.html">Configuring mesh models using the nRF Mesh mobile app</a></li>
<li class="toctree-l3"><a class="reference internal" href="fota.html">Performing FOTA updates in Bluetooth mesh</a></li>
<li class="toctree-l3"><a class="reference internal" href="node_removal.html">Removing a node from a mesh network</a></li>
<li class="toctree-l3"><a class="reference internal" href="vendor_model/index.html">Creating a new model</a></li>
<li class="toctree-l3"><a class="reference internal" href="reserved_ids.html">Reserved vendor model IDs and opcodes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../esb/index.html">Enhanced ShockBurst (ESB)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gazell/index.html">Gazell</a></li>
<li class="toctree-l2"><a class="reference internal" href="../matter/index.html">Matter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../multiprotocol/index.html">Multiprotocol support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nfc/index.html">Near Field Communication (NFC)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../thread/index.html">Thread</a></li>
<li class="toctree-l2"><a class="reference internal" href="../wifi/index.html">Wi-Fi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../zigbee/index.html">Zigbee</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../applications.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../samples.html">Samples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../drivers.html">Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../libraries/index.html">Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scripts.html">Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../known_issues.html">Known issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../software_maturity.html">Software maturity levels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation.html">About this documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">nRF Connect SDK</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../../protocols.html">Protocols</a></li>
          <li class="breadcrumb-item"><a href="index.html">Bluetooth mesh</a></li>
      <li class="breadcrumb-item active">Bluetooth mesh concepts</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/protocols/bt_mesh/concepts.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="bluetooth-mesh-concepts">
<span id="mesh-concepts"></span><h1>Bluetooth mesh concepts<a class="headerlink" href="#bluetooth-mesh-concepts" title="Permalink to this heading"></a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#application-areas" id="id9">Application areas</a></p></li>
<li><p><a class="reference internal" href="#network-topology-and-relaying" id="id10">Network topology and relaying</a></p>
<ul>
<li><p><a class="reference internal" href="#mesh-transport" id="id11">Mesh transport</a></p></li>
<li><p><a class="reference internal" href="#relays" id="id12">Relays</a></p></li>
<li><p><a class="reference internal" href="#power-consumption" id="id13">Power consumption</a></p></li>
<li><p><a class="reference internal" href="#gatt-proxy" id="id14">GATT proxy</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#addressing" id="id15">Addressing</a></p></li>
<li><p><a class="reference internal" href="#models-and-elements" id="id16">Models and elements</a></p></li>
<li><p><a class="reference internal" href="#device-life-cycle" id="id17">Device life cycle</a></p>
<ul>
<li><p><a class="reference internal" href="#provisioning" id="id18">Provisioning</a></p></li>
<li><p><a class="reference internal" href="#configuration" id="id19">Configuration</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#security" id="id20">Security</a></p>
<ul>
<li><p><a class="reference internal" href="#authentication" id="id21">Authentication</a></p></li>
<li><p><a class="reference internal" href="#message-encryption" id="id22">Message encryption</a></p></li>
<li><p><a class="reference internal" href="#privacy-key" id="id23">Privacy key</a></p></li>
<li><p><a class="reference internal" href="#replay-protection" id="id24">Replay protection</a></p></li>
</ul>
</li>
</ul>
</div>
<p>Bluetooth® mesh is a profile specification developed and published by the Bluetooth® Special Interest Group (SIG).
This document explains the basic concepts of the Bluetooth mesh and gives an overview of the operation and capabilities of the profile, as well as the life cycle of a mesh device.
For more information about the nRF Connect SDK implementation of the Bluetooth mesh, see <a class="reference internal" href="architecture.html#mesh-architecture"><span class="std std-ref">Bluetooth mesh architecture documentation</span></a>.</p>
<p>The Bluetooth mesh is based on the Bluetooth LE part of the Bluetooth® 4.0 Specification, and shares the lowest layers with this protocol.
On-air, the Bluetooth mesh physical representation is compatible with existing Bluetooth LE devices, as mesh messages are contained inside the payload of Bluetooth LE <em>advertisement</em> packets.
However, Bluetooth mesh specifies a completely new host stack, and although some concepts are shared, Bluetooth mesh is incompatible with the Bluetooth Host.</p>
<figure class="align-default" id="id6">
<img alt="Relationship between Bluetooth mesh and Bluetooth LE specifications" src="../../_images/bt_mesh_and_ble.svg" /><figcaption>
<p><span class="caption-text">Relationship between Bluetooth mesh and Bluetooth LE specifications</span><a class="headerlink" href="#id6" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>This page describes basic Bluetooth mesh concepts.
Check the official <a class="reference external" href="https://www.bluetooth.com/learn-about-bluetooth/recent-enhancements/mesh/mesh-glossary/">Bluetooth mesh glossary</a> for definitions of the most important Bluetooth mesh-related terms used in this documentation.</p>
<section id="application-areas">
<span id="mesh-concepts-app-areas"></span><h2><a class="toc-backref" href="#id9">Application areas</a><a class="headerlink" href="#application-areas" title="Permalink to this heading"></a></h2>
<p>Bluetooth mesh primarily targets simple control and monitoring applications, like light control or sensor data gathering.
The packet format is optimized for small control packets, issuing single commands or reports, and is not intended for data streaming or other high-bandwidth applications.</p>
<p>Using Bluetooth mesh causes higher power consumption than when using traditional Bluetooth LE applications.
This is mainly due to the need for keeping the radio running constantly.
Therefore, unlike the Bluetooth LE advertisers, active mesh devices cannot be powered by coin-cell batteries for extended periods of time.</p>
<p>Bluetooth mesh supports up to 32767 devices in a network, with a maximum network diameter of 126 hops.</p>
</section>
<section id="network-topology-and-relaying">
<span id="mesh-concepts-network-topo"></span><h2><a class="toc-backref" href="#id10">Network topology and relaying</a><a class="headerlink" href="#network-topology-and-relaying" title="Permalink to this heading"></a></h2>
<p>Bluetooth mesh is a broadcast-based network protocol, where every device in the network sends and receives all messages to and from all devices within radio range.</p>
<p>There is no concept of connections in a mesh network.
Any device in the network may relay messages from any other device.
This feature makes it possible for a mesh device to send messages to a device outside the radio range, by having one or more other devices relay the messages towards the destination.
This feature also allows devices to move around, and drop in and out of the network at any time.</p>
<section id="mesh-transport">
<span id="mesh-concepts-network-topo-transport"></span><h3><a class="toc-backref" href="#id11">Mesh transport</a><a class="headerlink" href="#mesh-transport" title="Permalink to this heading"></a></h3>
<p>Bluetooth mesh utilizes the Bluetooth LE advertiser and scanner roles, communicating through Bluetooth LE advertisement packets.
The advertisement packets are picked up by nearby mesh devices and handled like other Bluetooth LE advertisement packets.
The mesh packets are represented with a unique AD (advertisement data) type and added to the advertisement packet payload.</p>
<p>Bluetooth LE devices send advertisement packets at regular <em>advertisement intervals</em>, and mesh packets are no exception.
However, unlike traditional advertisers, mesh devices will change their advertisement payload on every transmission, broadcasting new mesh packets as they are queued up in the stack.</p>
<p>If there is no traffic in the mesh network or the mesh stack, or if the application does not generate any messages, the devices stay silent until there is something to transmit.</p>
</section>
<section id="relays">
<span id="mesh-concepts-network-topo-relays"></span><h3><a class="toc-backref" href="#id12">Relays</a><a class="headerlink" href="#relays" title="Permalink to this heading"></a></h3>
<p>Bluetooth mesh expands the range of the network by relaying messages.
Any mesh device may be configured to act as a relay, and no dedicated relay devices are needed to build a network.</p>
<p>Every device acting as a relay will decrement the time to live (TTL) value in received messages and forward them if the TTL equals two or higher.
This undirected relaying is referred to as <em>message flooding</em> and ensures a high probability of message delivery, without requiring any information on the network topology.</p>
<p>The Bluetooth mesh profile specification does not provide any routing mechanisms, and all messages are forwarded by all relays until the TTL value reaches zero.
To avoid messages being repeatedly forwarded by the same relays, all mesh devices maintain a <em>message cache</em>.
This cache is used for filtering out packets that the device has already handled.</p>
<p>The flooding-based approach to message relaying can cause a lot of redundant traffic on air, which may impact the throughput and reliability of the network.
Therefore, it is highly recommended to limit the number of relays in a network to restrict this effect.</p>
<p>The number of relay-enabled devices in the network is a trade-off between message route-redundancy and reliability.
It should be tuned according to:</p>
<ul class="simple">
<li><p>Network density</p></li>
<li><p>Traffic volumes</p></li>
<li><p>Network layout</p></li>
<li><p>Requirements for reliability and responsiveness</p></li>
</ul>
</section>
<section id="power-consumption">
<span id="mesh-concepts-network-topo-power"></span><h3><a class="toc-backref" href="#id13">Power consumption</a><a class="headerlink" href="#power-consumption" title="Permalink to this heading"></a></h3>
<p>To enable broadcast-based communication, the devices must continuously keep their radio in listening mode.
This causes significantly higher power consumption than in a typical Bluetooth LE device.</p>
<p>To enable low-power devices to take part in the mesh network, Bluetooth mesh contains a <em>friendship</em> feature.
This protocol lets low-power devices establish a relationship with a regular mesh device, which will then cache and forward messages to the low-power device at regular intervals.
This saves the low-power device from having to stay on to listen for incoming messages.</p>
</section>
<section id="gatt-proxy">
<span id="mesh-concepts-network-topo-gatt"></span><h3><a class="toc-backref" href="#id14">GATT proxy</a><a class="headerlink" href="#gatt-proxy" title="Permalink to this heading"></a></h3>
<p>To enable support for legacy Bluetooth LE devices that do not support receiving mesh packets, Bluetooth mesh defines a separate protocol for tunneling mesh messages over the Bluetooth LE GATT protocol.
For this purpose, the Bluetooth mesh profile specification defines a GATT bearer and the corresponding GATT Proxy Protocol.
This protocol allows legacy Bluetooth LE devices to participate in the mesh network by establishing a GATT connection to a mesh device that has the proxy feature enabled.</p>
<p>The legacy device gets assigned an address and the necessary keys to become a full-fledged member of the network.
The device receives the security credentials through the regular provisioning procedure or through some out-of-band mechanism.</p>
</section>
</section>
<section id="addressing">
<span id="mesh-concepts-addressing"></span><h2><a class="toc-backref" href="#id15">Addressing</a><a class="headerlink" href="#addressing" title="Permalink to this heading"></a></h2>
<p>The Bluetooth mesh addressing scheme is different from the Bluetooth LE addressing scheme.
It features three types of addresses:</p>
<ul class="simple">
<li><p><em>Unicast addresses</em> - Unique for every device</p></li>
<li><p><em>Group addresses</em> - For forming a group of devices and addressing them all at once</p></li>
<li><p><em>Virtual addresses</em> - Untracked UUID-based addresses with a large address space</p></li>
</ul>
<p>When a device is added to a network, it is assigned a range of unicast addresses that represents it.
A device’s unicast addresses cannot be changed and are always sequential.
The unicast address space supports having 32767 unicast addresses in a single mesh network.
Unicast addresses can be used by any application to directly send a message to a device.</p>
<p>Group addresses are allocated and assigned as part of the network configuration procedure.
A group address may represent any number of devices, and a device may be part of any number of groups.
There can at most be 16127 general purpose group addresses in a mesh network.</p>
<p>Virtual addresses can be considered a special form of group addresses, and can be used to represent any number of devices.
Each virtual address is a 128-bit UUID generated from a text label.
The virtual addresses do not have to be tracked by a network configuration device, and in this way, users can generate virtual addresses before deployment or addresses can be generated ad-hoc between devices in the network.</p>
</section>
<section id="models-and-elements">
<span id="mesh-concepts-models-and-elements"></span><h2><a class="toc-backref" href="#id16">Models and elements</a><a class="headerlink" href="#models-and-elements" title="Permalink to this heading"></a></h2>
<p>To standardize communication between devices from different vendors, the Bluetooth mesh profile specification defines an access layer, which routes mesh messages between the various <em>models</em> in a device.
A model represents a specific behavior or service and defines a set of states and messages that act on these states.
The Bluetooth mesh profile specification and the model specification each define a set of models to cover typical usage scenarios like device configuration, sensor readings, and light control.
In addition to these, vendors are free to define their own models with accompanying messages and states.</p>
<p>The models in a device belong in <em>elements</em>.
Every device has one or more elements, each acting as a virtual entity in the mesh with its own unique unicast address.
Each incoming message is handled by a model instance in an element.
To make it possible to uniquely resolve how messages are handled, only one model instance per element can implement a handler for a specific message opcode.
If a device has multiple instances of the same model, each instance must be assigned to a separate element.
Similarly, if two models implement handlers for the same message, these models must be in separate elements.</p>
<p>To represent complex behavior with minimal message and state duplication, models can be made up of other models, potentially spanning multiple elements.
These models are referred to as <em>extended models</em>.
Models that are purely self-contained are referred to as root models.</p>
<p>Models talk to each other through a publish-and-subscribe system.
Every model may subscribe to a set of group and virtual addresses, and the model will only handle messages that are published to one of its subscription addresses or the containing element’s unicast address.
Any model may maintain a publish address that it publishes messages to.
This publish address can be of any type.</p>
<figure class="align-default" id="id7">
<img alt="A graphical depiction of access layer structure" src="../../_images/bt_mesh_access.svg" /><figcaption>
<p><span class="caption-text">Access layer structure</span><a class="headerlink" href="#id7" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>For more information about models, see <a class="reference internal" href="../../libraries/bluetooth_services/mesh/models.html#bt-mesh-models"><span class="std std-ref">Bluetooth mesh models</span></a>.</p>
</section>
<section id="device-life-cycle">
<span id="mesh-concepts-lifecycle"></span><h2><a class="toc-backref" href="#id17">Device life cycle</a><a class="headerlink" href="#device-life-cycle" title="Permalink to this heading"></a></h2>
<p>Every new device that is to be added to the mesh network must go through the following stages to become a mesh network node:</p>
<ul>
<li><p><a class="reference internal" href="#mesh-concepts-lifecycle-provisioning"><span class="std std-ref">Provisioning</span></a> - After this stage, an unprovisioned device becomes a network node.
This stage includes the following steps:</p>
<ol class="arabic simple">
<li><p>Discovery</p></li>
<li><p><a class="reference internal" href="#mesh-concepts-security-authentication"><span class="std std-ref">Authentication</span></a></p></li>
<li><p><a class="reference internal" href="#mesh-concepts-addressing"><span class="std std-ref">Addressing</span></a> assignment and network information exchange</p></li>
</ol>
<p>After the last step, the device becomes a node.</p>
</li>
<li><p><a class="reference internal" href="#mesh-concepts-lifecycle-network-config"><span class="std std-ref">Configuration</span></a> - After this stage, a node is able to perform its tasks that require exchanging mesh messages with neighboring nodes.
This stage includes the following steps:</p>
<ol class="arabic simple">
<li><p>Configuration of the node using the mandatory Configuration Server model</p></li>
<li><p>Addition of desired application keys and additional network keys</p></li>
<li><p>Optional configuration of the application-specific <a class="reference internal" href="#mesh-concepts-models-and-elements"><span class="std std-ref">models</span></a>, for example for key bindings, publications or subscriptions (or both)</p></li>
</ol>
</li>
</ul>
<p>Both of these stages are typically carried out by one device that acts as provisioner and configurator.</p>
<figure class="align-default" id="id8">
<img alt="Diagram showing a mesh node life cycle" src="../../_images/bt_mesh_device_lifecycle.svg" /><figcaption>
<p><span class="caption-text">Mesh node life cycle</span><a class="headerlink" href="#id8" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>A mesh node can revert to being an unprovisioned device by performing a node reset procedure, which removes the node from the network.</p>
<p>The node can also be forcibly excluded from participating in the network with the key refresh procedure.
Once the key refresh procedure is completed for the rest of the nodes in a network, the node’s unicast address can be allocated to a new unprovisioned device.</p>
<section id="provisioning">
<span id="mesh-concepts-lifecycle-provisioning"></span><h3><a class="toc-backref" href="#id18">Provisioning</a><a class="headerlink" href="#provisioning" title="Permalink to this heading"></a></h3>
<p>Before a device can participate in normal mesh operation, it must be provisioned.</p>
<p>The provisioning is done by a <em>provisioner</em>, which is a trusted device with access to the full list of devices in the network, and their configuration data.
After the new device, called <em>provisionee</em>, has been provisioned, the provisioner uses the new device’s device key to establish a secure channel to configure it.</p>
<p>For more information about provisioning, see <span class="xref std std-ref">zephyr:bluetooth_mesh_provisioning</span>.</p>
</section>
<section id="configuration">
<span id="mesh-concepts-lifecycle-network-config"></span><h3><a class="toc-backref" href="#id19">Configuration</a><a class="headerlink" href="#configuration" title="Permalink to this heading"></a></h3>
<p>Bluetooth mesh leaves the network configuration to a central network configurator.
Devices are not expected to do any sort of service discovery on their own.</p>
<p>To control other devices, new devices must be configured by a provisioner, either through user interaction or by loading a predetermined configuration from a database.
Every device must implement a mandatory Configuration Server model in their first element, which is used to configure the rest of its models.</p>
<p>As soon as the provisioning is complete, the provisioner uses its instance of the Configuration Client model to give the new device a set of application keys and addresses.
The device will use these keys and addresses for the duration of its lifetime on the network, unless it gets reconfigured.</p>
<section id="configuration-example-scenario-a-light-bulb-and-a-switch">
<h4>Configuration example scenario: A light bulb and a switch<a class="headerlink" href="#configuration-example-scenario-a-light-bulb-and-a-switch" title="Permalink to this heading"></a></h4>
<p>After a new light switch has been provisioned:</p>
<ol class="arabic simple">
<li><p>The Configuration Client model in the provisioner reads out a list of the new device’s models and elements, and presents them to the user.</p></li>
<li><p>The user finds the light switch model in the device’s model list and gives it the <em>Light Control</em> application key.</p></li>
<li><p>The user sets the model’s publish address to the <em>Kitchen Area</em> group address, to which all the light bulbs in the kitchen subscribe.</p></li>
</ol>
<p>The next time the new light switch is pressed, all light bulbs in the kitchen turn on.</p>
</section>
</section>
</section>
<section id="security">
<span id="mesh-concepts-security"></span><h2><a class="toc-backref" href="#id20">Security</a><a class="headerlink" href="#security" title="Permalink to this heading"></a></h2>
<p>Bluetooth mesh employs several security measures to prevent third-party interference and monitoring:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#mesh-concepts-security-authentication"><span class="std std-ref">Authentication</span></a></p></li>
<li><p><a class="reference internal" href="#mesh-concepts-security-encryption"><span class="std std-ref">Message encryption</span></a></p></li>
<li><p><a class="reference internal" href="#mesh-concepts-security-privacy"><span class="std std-ref">Privacy key</span></a></p></li>
<li><p><a class="reference internal" href="#mesh-concepts-security-replay-protection"><span class="std std-ref">Replay protection</span></a></p></li>
</ul>
<section id="authentication">
<span id="mesh-concepts-security-authentication"></span><h3><a class="toc-backref" href="#id21">Authentication</a><a class="headerlink" href="#authentication" title="Permalink to this heading"></a></h3>
<p>Device authentication is part of the provisioning process and lets the user confirm that the device being added to the network is indeed the device they think it is.</p>
<p>The Bluetooth mesh profile specification defines a range of out-of-band authentication methods, such as:</p>
<ul class="simple">
<li><p>Blinking of lights</p></li>
<li><p>Output and input of passphrases</p></li>
<li><p>Static authentication against a pre-shared key</p></li>
</ul>
<p>To secure the provisioning procedure, elliptic curve Diffie-Helman (ECDH) public key cryptography is used.
After a device has been provisioned, it is part of the network and all its messages are considered authenticated.</p>
</section>
<section id="message-encryption">
<span id="mesh-concepts-security-encryption"></span><h3><a class="toc-backref" href="#id22">Message encryption</a><a class="headerlink" href="#message-encryption" title="Permalink to this heading"></a></h3>
<p>Bluetooth mesh features two levels of AES-CCM encryption with 128-bit keys for all messages going across the network:</p>
<dl>
<dt>Network encryption</dt><dd><p>The lowest layer that protects all messages in a mesh network from being readable by devices that are not part of the network.</p>
<p>The encryption is done with a network encryption key, and any network may consist of up to 4096 different subnets, each with their own network key.
All devices sharing a network key are considered part of the network, and may send and relay messages across it.
By using multiple network keys, a network administrator may effectively divide their network into multiple subnets, because a mesh relay only forwards messages that are encrypted with a known network key.</p>
</dd>
<dt>Transport encryption</dt><dd><p>The second encryption layer that limits which devices can do what <em>within a network</em> by encrypting the application payload with an application or device key.</p>
<p>As an example, consider a mesh network deployed in a hotel.
In this example it is desirable to limit some features that are to be controlled by the staff (like configuration of key cards or access to storage areas), and some features to be available to guests (like controlling room lighting or air conditioning).
For this, we can have one application key for the guests and one for the staff, allowing the messages to be relayed across the same network, while preventing the guests and the staff from reading each other’s messages.</p>
</dd>
</dl>
<p>While application keys are used to separate access rights to different applications in the network, the device keys are used to manage devices in the network.</p>
<p>Every device has a unique device key, which is only known to the provisioner and the device itself.
The device key is used when configuring a device with new encryption keys (network or application keys) or addresses, in addition to setting other device-specific parameters.
It can also be used to evict malicious devices from a network by transferring new keys to all the other devices in the network (using their individual device keys when transferring the keys).
This process is called the <em>key refresh procedure</em>.</p>
<p>Each encryption layer contains a message integrity check value that validates that the content of the message was encrypted with the indicated encryption keys.</p>
</section>
<section id="privacy-key">
<span id="mesh-concepts-security-privacy"></span><h3><a class="toc-backref" href="#id23">Privacy key</a><a class="headerlink" href="#privacy-key" title="Permalink to this heading"></a></h3>
<p>All mesh message payloads are fully encrypted.
Message metadata, like source address and message sequence number, is obfuscated with the privacy key derived from the network key, providing limited privacy even for public header fields.</p>
</section>
<section id="replay-protection">
<span id="mesh-concepts-security-replay-protection"></span><h3><a class="toc-backref" href="#id24">Replay protection</a><a class="headerlink" href="#replay-protection" title="Permalink to this heading"></a></h3>
<p>To guard against malicious devices replaying previous messages, every device keeps a running sequence number, which is used for outbound messages.
Each mesh message is sent with a unique pair of sequence number and source address. When receiving a message, the receiving device stores the sequence number and makes sure that it is more recent than the last sequence number it received from the same source address.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="architecture.html" class="btn btn-neutral float-right" title="Bluetooth mesh stack architecture" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="supported_features.html" class="btn btn-neutral" title="Supported Bluetooth mesh features" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">

<table>
<tr>
<td>
    <p>
        &copy; Copyright 2019-2023, Nordic Semiconductor.
      Last updated on Mar 20, 2023.

    </p>
</td>
<td id="nordiclogo">
  <a href="https://www.nordicsemi.com/"><img src="../../_static/images/nordic-logo.png" border="0"/></a>
</td>
</tr>
</table>
  </div> 


</footer>

<div id="scroll-container">
  <button type="button" id="scroll-btn" class="btn">
    <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="#fff"/></svg>
  </button>
</div>

<script>
  const scrollBtn = document.querySelector("#scroll-btn");

  document.addEventListener("scroll", () => {
    if (window.scrollY > 400) {
          scrollBtn.style.visibility = "visible";
      } else {
          scrollBtn.style.visibility = "hidden";
      }
  });

  scrollBtn.addEventListener("click", () => {
      window.scrollTo({ top: 0, behavior: "smooth" });
  });
</script>
        </div>
      </div>
    </section>
  </div>
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> nRF Connect SDK</span>
       <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      
      <div class="rst-other-version ncs">
        <a href="../../../nrf/index.html">nRF Connect SDK</a>
      </div>
      
      <div class="rst-other-version nrfx">
        <a href="../../../nrfx/index.html">nrfx</a>
      </div>
      
      <div class="rst-other-version nrfxlib">
        <a href="../../../nrfxlib/README.html">nrfxlib</a>
      </div>
      
      <div class="rst-other-version zephyr">
        <a href="../../../zephyr/index.html">Zephyr Project</a>
      </div>
      
      <div class="rst-other-version mcuboot">
        <a href="../../../mcuboot/wrapper.html">MCUboot</a>
      </div>
      
      <div class="rst-other-version tfm">
        <a href="../../../tfm/index.html">Trusted Firmware-M</a>
      </div>
      
      <div class="rst-other-version matter">
        <a href="../../../matter/index.html">Matter</a>
      </div>
      
      <div class="rst-other-version kconfig">
        <a href="../../../kconfig/index.html">Kconfig Reference</a>
      </div>
    </div>
  </div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>