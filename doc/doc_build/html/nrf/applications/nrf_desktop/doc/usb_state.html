<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>USB state module &mdash; nRF Connect SDK 2.3.99 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/nordic.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/togglebutton.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/nrf.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/tabs.css" type="text/css" /> 
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
        <script src="https://www.googletagmanager.com/gtag/js?id=G-ZPVZRKFQJR"></script>
        <script src="../../../_static/js/ga-tracker.js"></script>
        <script data-culture="EN" id="CookieConsent" type="text/javascript" src="https://policy.app.cookieinformation.com/uc.js"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../../_static/togglebutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/js/theme.js"></script>
<script
  type="text/javascript"
  src="../../../_static/js/ncs.js"
></script>
<script src="../../../_static/js/bootstrap.bundle.min.js"></script>

    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Watchdog module" href="watchdog.html" />
    <link rel="prev" title="USB state power manager module" href="usb_state_pm.html" />
<link
  href="../../../_static/css/bootstrap.min.css"
  rel="stylesheet"
/>
<link
  rel="shortcut icon"
  href="../../../_static/images/favicon.ico"
/>

</head>

<body class="wy-body-for-nav">
<div class="announcement"></div>
<div class="d-print-none ncs-header">
  <div class="container-xl ncs-header-top">
    <div class="row h-100">
      <div class="d-none d-md-block col-2">
        <div class="bg-white py-4 px-3 ml-2 ncs-header-logo">
          <img
            class="ncs-header-logo"
            src="../../../_static/images/nordic-logo.png"
            alt=""
          />
        </div>
      </div>
      <div
        class="col-8 col-md-7 pl-md-4 d-flex align-self-center justify-content-center"
      >
        <form class="w-75" action="../../../search.html" method="get">
          <div class="form-group">
            <input
              type="text"
              name="q"
              class="ncs-search-input form-control"
              placeholder="Search all docs..."
            />
          </div>
        </form>
      </div>
      <div class="col-4 col-md-3 d-md-block p-3 text-end">
        <div class="dropdown">
          <button
            class="btn dropdown-toggle ncs-btn-versions"
            type="button"
            id="dropdownMenuButton1"
            data-bs-toggle="dropdown"
            aria-expanded="false"
          >
            <span class="d-none d-md-inline">nRF Connect SDK</span>
            <span id="ncsversion" class="d-inline"></span>
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton"></div>
        </div>
      </div>
    </div>
  </div>
  <div class="ncs-header-nav">
    <div class="container-xl">
      <div class="row">
        <div class="col col-12 d-flex justify-content-center">
          <nav class="navbar navbar-dark navbar-expand-lg p-0">
            <span class="navbar-brand d-block d-lg-none py-2 pl-1"
              >Documentation sets</span
            >
            <button
              class="navbar-toggler"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#navbarNavAltMarkup"
              aria-controls="navbarNavAltMarkup"
              aria-expanded="false"
              aria-label="Toggle navigation"
            >
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
              <ul class="navbar-nav">
                <li class="nav-item active py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../nrf/index.html"
                    >nRF Connect SDK</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../nrfx/index.html"
                    >nrfx</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../nrfxlib/README.html"
                    >nrfxlib</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../zephyr/index.html"
                    >Zephyr Project</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../mcuboot/wrapper.html"
                    >MCUboot</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../tfm/index.html"
                    >Trusted Firmware-M</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../matter/index.html"
                    >Matter</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../kconfig/index.html"
                    >Kconfig Reference</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
              </ul>
            </div>
          </nav>
        </div>
      </div>
    </div>
  </div>
</div>

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> nRF Connect SDK
          </a>
              <div class="version">
                2.3.99
              </div>
<div id="searchbox" role="search">
  <div class="searchformwrapper">
    <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
  </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev_model.html">Development model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../app_dev.html">Application development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ecosystem_integration.html">Ecosystems integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nrf91.html">Working with nRF91 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nrf70.html">Working with nRF70 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nrf53.html">Working with nRF53 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nrf52.html">Working with nRF52 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../protocols.html">Protocols</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../applications.html">Applications</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../connectivity_bridge/README.html">Connectivity bridge</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../asset_tracker_v2/README.html">nRF9160: Asset Tracker v2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../serial_lte_modem/README.html">nRF9160: Serial LTE modem</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../README.html">nRF Desktop</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../README.html#overview-firmware-architecture">Overview: Firmware architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="../README.html#requirements">Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="../README.html#user-interface">User interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../README.html#configuration">Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../README.html#building-and-running">Building and running</a></li>
<li class="toctree-l3"><a class="reference internal" href="../README.html#integrating-your-own-hardware">Integrating your own hardware</a></li>
<li class="toctree-l3"><a class="reference internal" href="../README.html#dependencies">Dependencies</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../README.html#application-internal-modules">Application internal modules</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="main.html">Basic module (main)</a></li>
<li class="toctree-l4"><a class="reference internal" href="battery_charger.html">Battery charger module</a></li>
<li class="toctree-l4"><a class="reference internal" href="battery_meas.html">Battery measurement module</a></li>
<li class="toctree-l4"><a class="reference internal" href="ble_adv.html">Bluetooth LE advertising module</a></li>
<li class="toctree-l4"><a class="reference internal" href="ble_bond.html">Bluetooth LE bond module</a></li>
<li class="toctree-l4"><a class="reference internal" href="ble_conn_params.html">Bluetooth LE connection parameters module</a></li>
<li class="toctree-l4"><a class="reference internal" href="ble_discovery.html">Bluetooth LE discovery module</a></li>
<li class="toctree-l4"><a class="reference internal" href="ble_latency.html">Bluetooth LE latency module</a></li>
<li class="toctree-l4"><a class="reference internal" href="ble_passkey.html">Bluetooth LE passkey module</a></li>
<li class="toctree-l4"><a class="reference internal" href="ble_qos.html">Bluetooth LE Quality of Service module</a></li>
<li class="toctree-l4"><a class="reference internal" href="ble_scan.html">Bluetooth LE scanning module</a></li>
<li class="toctree-l4"><a class="reference internal" href="ble_state_pm.html">Bluetooth state power manager module</a></li>
<li class="toctree-l4"><a class="reference internal" href="ble_state.html">Bluetooth LE state module</a></li>
<li class="toctree-l4"><a class="reference internal" href="board.html">Board module</a></li>
<li class="toctree-l4"><a class="reference internal" href="buttons.html">Buttons module</a></li>
<li class="toctree-l4"><a class="reference internal" href="buttons_sim.html">Button simulator module</a></li>
<li class="toctree-l4"><a class="reference internal" href="click_detector.html">Click detector module</a></li>
<li class="toctree-l4"><a class="reference internal" href="config_channel.html">Configuration channel</a></li>
<li class="toctree-l4"><a class="reference internal" href="cpu_meas.html">CPU measurement module</a></li>
<li class="toctree-l4"><a class="reference internal" href="dev_descr.html">Device description module</a></li>
<li class="toctree-l4"><a class="reference internal" href="dfu.html">Device Firmware Upgrade module</a></li>
<li class="toctree-l4"><a class="reference internal" href="failsafe.html">Failsafe module</a></li>
<li class="toctree-l4"><a class="reference internal" href="fast_pair_app.html">Fast Pair module</a></li>
<li class="toctree-l4"><a class="reference internal" href="fn_keys.html">Function key module</a></li>
<li class="toctree-l4"><a class="reference internal" href="bas.html">GATT Battery Service module</a></li>
<li class="toctree-l4"><a class="reference internal" href="hid_forward.html">HID forward module</a></li>
<li class="toctree-l4"><a class="reference internal" href="hid_state.html">HID state module</a></li>
<li class="toctree-l4"><a class="reference internal" href="hid_state_pm.html">HID state power manager module</a></li>
<li class="toctree-l4"><a class="reference internal" href="hids.html">HID Service module</a></li>
<li class="toctree-l4"><a class="reference internal" href="info.html">Info module</a></li>
<li class="toctree-l4"><a class="reference internal" href="led_state.html">LED state module</a></li>
<li class="toctree-l4"><a class="reference internal" href="led_stream.html">LED stream module</a></li>
<li class="toctree-l4"><a class="reference internal" href="leds.html">LEDs module</a></li>
<li class="toctree-l4"><a class="reference internal" href="motion.html">Motion module</a></li>
<li class="toctree-l4"><a class="reference internal" href="passkey.html">Passkey module</a></li>
<li class="toctree-l4"><a class="reference internal" href="power_manager.html">Power manager module</a></li>
<li class="toctree-l4"><a class="reference internal" href="nrf_profiler_sync.html">nRF Profiler synchronization module</a></li>
<li class="toctree-l4"><a class="reference internal" href="qos.html">Quality of Service module</a></li>
<li class="toctree-l4"><a class="reference internal" href="selector.html">Selector module</a></li>
<li class="toctree-l4"><a class="reference internal" href="smp.html">Simple Management Protocol module</a></li>
<li class="toctree-l4"><a class="reference internal" href="settings_loader.html">Settings loader module</a></li>
<li class="toctree-l4"><a class="reference internal" href="usb_state_pm.html">USB state power manager module</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">USB state module</a></li>
<li class="toctree-l4"><a class="reference internal" href="watchdog.html">Watchdog module</a></li>
<li class="toctree-l4"><a class="reference internal" href="wheel.html">Wheel module</a></li>
<li class="toctree-l4"><a class="reference internal" href="constlat.html">Constant latency hotfix module</a></li>
<li class="toctree-l4"><a class="reference internal" href="hfclk_lock.html">High frequency clock lock hotfix module</a></li>
<li class="toctree-l4"><a class="reference internal" href="event_rel_modules.html">Source and sink module lists</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../README.html#application-configuration-options">Application configuration options</a></li>
<li class="toctree-l3"><a class="reference internal" href="../README.html#api-documentation">API documentation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../nrf5340_audio/README.html">nRF5340 Audio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../machine_learning/README.html">nRF Machine Learning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../matter_weather_station/README.html">Thingy:53: Matter weather station</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../zigbee_weather_station/README.html">Thingy:53: Zigbee weather station</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../samples.html">Samples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../drivers.html">Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../libraries/index.html">Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../scripts.html">Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../release_notes.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../known_issues.html">Known issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../software_maturity.html">Software maturity levels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation.html">About this documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">nRF Connect SDK</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../../../applications.html">Applications</a></li>
          <li class="breadcrumb-item"><a href="../README.html">nRF Desktop</a></li>
      <li class="breadcrumb-item active">USB state module</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/applications/nrf_desktop/doc/usb_state.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="usb-state-module">
<span id="nrf-desktop-usb-state"></span><h1>USB state module<a class="headerlink" href="#usb-state-module" title="Permalink to this heading"></a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#module-events" id="id6">Module events</a></p></li>
<li><p><a class="reference internal" href="#configuration" id="id7">Configuration</a></p>
<ul>
<li><p><a class="reference internal" href="#usb-device-identifiers" id="id8">USB device identifiers</a></p></li>
<li><p><a class="reference internal" href="#low-latency-device-configuration" id="id9">Low latency device configuration</a></p></li>
<li><p><a class="reference internal" href="#boot-protocol-configuration" id="id10">Boot protocol configuration</a></p></li>
<li><p><a class="reference internal" href="#usb-device-instance-configuration" id="id11">USB device instance configuration</a></p></li>
<li><p><a class="reference internal" href="#usb-wakeup-configuration" id="id12">USB wakeup configuration</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#implementation-details" id="id13">Implementation details</a></p></li>
</ul>
</div>
<p>The USB state module is responsible for tracking the USB connection.
It is also responsible for transmitting data through USB on the application’s device.</p>
<section id="module-events">
<h2><a class="toc-backref" href="#id6">Module events</a><a class="headerlink" href="#module-events" title="Permalink to this heading"></a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 28%" />
<col style="width: 14%" />
<col style="width: 9%" />
<col style="width: 21%" />
<col style="width: 27%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Source Module</p></th>
<th class="head"><p>Input Event</p></th>
<th class="head"><p>This Module</p></th>
<th class="head"><p>Output Event</p></th>
<th class="head"><p>Sink Module</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference internal" href="event_rel_modules.html#nrf-desktop-config-event-sources"><span class="std std-ref">Source modules for config_event</span></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">config_event</span></code></p></td>
<td rowspan="26"><p><code class="docutils literal notranslate"><span class="pre">usb_state</span></code></p></td>
<td rowspan="12"></td>
<td rowspan="12"></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="hid_forward.html#nrf-desktop-hid-forward"><span class="std std-ref">HID forward module</span></a></p></td>
<td rowspan="4"><p><code class="docutils literal notranslate"><span class="pre">hid_report_event</span></code></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="hid_state.html#nrf-desktop-hid-state"><span class="std std-ref">HID state module</span></a></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="hids.html#nrf-desktop-hids"><span class="std std-ref">HID Service module</span></a></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#nrf-desktop-usb-state"><span class="std std-ref">USB state module</span></a></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="event_rel_modules.html#nrf-desktop-module-state-event-sources"><span class="std std-ref">Source modules for module_state_event</span></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">module_state_event</span></code></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="ble_adv.html#nrf-desktop-ble-adv"><span class="std std-ref">Bluetooth LE advertising module</span></a></p></td>
<td rowspan="6"><p><code class="docutils literal notranslate"><span class="pre">wake_up_event</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="buttons.html#nrf-desktop-buttons"><span class="std std-ref">Buttons module</span></a></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="hid_forward.html#nrf-desktop-hid-forward"><span class="std std-ref">HID forward module</span></a></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="motion.html#nrf-desktop-motion"><span class="std std-ref">Motion module</span></a></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="power_manager.html#nrf-desktop-power-manager"><span class="std std-ref">Power manager module</span></a></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="wheel.html#nrf-desktop-wheel"><span class="std std-ref">Wheel module</span></a></p></td>
</tr>
<tr class="row-even"><td rowspan="14"></td>
<td rowspan="14"></td>
<td><p><code class="docutils literal notranslate"><span class="pre">config_event</span></code></p></td>
<td><p><a class="reference internal" href="event_rel_modules.html#nrf-desktop-config-event-sinks"><span class="std std-ref">Sink modules for config_event</span></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">hid_report_event</span></code></p></td>
<td><p><a class="reference internal" href="event_rel_modules.html#nrf-desktop-hid-report-event-sinks"><span class="std std-ref">Sink modules for hid_report_event</span></a></p></td>
</tr>
<tr class="row-even"><td rowspan="3"><p><code class="docutils literal notranslate"><span class="pre">hid_report_sent_event</span></code></p></td>
<td><p><a class="reference internal" href="hid_forward.html#nrf-desktop-hid-forward"><span class="std std-ref">HID forward module</span></a></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="hid_state.html#nrf-desktop-hid-state"><span class="std std-ref">HID state module</span></a></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="motion.html#nrf-desktop-motion"><span class="std std-ref">Motion module</span></a></p></td>
</tr>
<tr class="row-odd"><td rowspan="3"><p><code class="docutils literal notranslate"><span class="pre">hid_report_subscription_event</span></code></p></td>
<td><p><a class="reference internal" href="hid_forward.html#nrf-desktop-hid-forward"><span class="std std-ref">HID forward module</span></a></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="hid_state.html#nrf-desktop-hid-state"><span class="std std-ref">HID state module</span></a></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="motion.html#nrf-desktop-motion"><span class="std std-ref">Motion module</span></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">module_state_event</span></code></p></td>
<td><p><a class="reference internal" href="event_rel_modules.html#nrf-desktop-module-state-event-sinks"><span class="std std-ref">Sink modules for module_state_event</span></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">usb_hid_event</span></code></p></td>
<td><p><a class="reference internal" href="hid_state.html#nrf-desktop-hid-state"><span class="std std-ref">HID state module</span></a></p></td>
</tr>
<tr class="row-even"><td rowspan="4"><p><code class="docutils literal notranslate"><span class="pre">usb_state_event</span></code></p></td>
<td><p><a class="reference internal" href="battery_charger.html#nrf-desktop-battery-charger"><span class="std std-ref">Battery charger module</span></a></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="ble_conn_params.html#nrf-desktop-ble-conn-params"><span class="std std-ref">Bluetooth LE connection parameters module</span></a></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="motion.html#nrf-desktop-motion"><span class="std std-ref">Motion module</span></a></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="usb_state_pm.html#nrf-desktop-usb-state-pm"><span class="std std-ref">USB state power manager module</span></a></p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>See the <a class="reference internal" href="../README.html#nrf-desktop-architecture"><span class="std std-ref">Overview: Firmware architecture</span></a> for more information about the event-based communication in the nRF Desktop application and about how to read this table.</p>
</div>
</section>
<section id="configuration">
<h2><a class="toc-backref" href="#id7">Configuration</a><a class="headerlink" href="#configuration" title="Permalink to this heading"></a></h2>
<p>The module is enabled by selecting <a class="reference internal" href="../README.html#config-desktop-app-options"><span class="std std-ref">CONFIG_DESKTOP_USB_ENABLE</span></a> option.
The option selects <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_USB_DEVICE_STACK</span></code> and <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_USB_DEVICE_HID</span></code> Kconfig options.</p>
<p>The <a class="reference internal" href="../README.html#config-desktop-app-options"><span class="std std-ref">CONFIG_DESKTOP_USB_ENABLE</span></a> option is implied by the <a class="reference internal" href="../README.html#config-desktop-app-options"><span class="std std-ref">CONFIG_DESKTOP_ROLE_HID_DONGLE</span></a> option.
The module is enabled by default for the nRF Desktop dongles because the dongles forward the HID data to the host connected over USB.
See the <a class="reference internal" href="../README.html#nrf-desktop-hid-configuration"><span class="std std-ref">HID configuration</span></a> documentation for details.</p>
<p>Additionally, you can also configure the options described in the following sections.</p>
<section id="usb-device-identifiers">
<span id="nrf-desktop-usb-state-identifiers"></span><h3><a class="toc-backref" href="#id8">USB device identifiers</a><a class="headerlink" href="#usb-device-identifiers" title="Permalink to this heading"></a></h3>
<p>When the USB support is enabled for the device, the following options are by default set to common <a class="reference internal" href="../README.html#nrf-desktop-hid-device-identifiers"><span class="std std-ref">HID device identifiers</span></a> defined for the nRF Desktop application:</p>
<ul class="simple">
<li><p><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_USB_DEVICE_MANUFACTURER</span></code> - Manufacturer’s name.</p></li>
<li><p><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_USB_DEVICE_PRODUCT</span></code> - Product name.</p></li>
<li><p><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_USB_DEVICE_VID</span></code> - Vendor ID (VID) number.</p></li>
<li><p><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_USB_DEVICE_PID</span></code> - Product ID (PID) number.</p></li>
</ul>
</section>
<section id="low-latency-device-configuration">
<h3><a class="toc-backref" href="#id9">Low latency device configuration</a><a class="headerlink" href="#low-latency-device-configuration" title="Permalink to this heading"></a></h3>
<p>The module sets default value of <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_USB_HID_POLL_INTERVAL_MS</span></code> to <code class="docutils literal notranslate"><span class="pre">1</span></code>.
For low latency of HID reports, the device requests a polling rate of 1 ms.</p>
</section>
<section id="boot-protocol-configuration">
<h3><a class="toc-backref" href="#id10">Boot protocol configuration</a><a class="headerlink" href="#boot-protocol-configuration" title="Permalink to this heading"></a></h3>
<p>The module sets default values of <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_USB_HID_BOOT_PROTOCOL</span></code> and <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_USB_HID_PROTOCOL_CODE</span></code> Kconfig options to support boot reports defined in the nRF Desktop configuration.
The <a class="reference internal" href="../README.html#config-desktop-app-options"><span class="std std-ref">CONFIG_DESKTOP_HID_BOOT_INTERFACE_MOUSE</span></a> and <a class="reference internal" href="../README.html#config-desktop-app-options"><span class="std std-ref">CONFIG_DESKTOP_HID_BOOT_INTERFACE_KEYBOARD</span></a> are used to control support of HID boot reports in the nRF Desktop application.</p>
</section>
<section id="usb-device-instance-configuration">
<h3><a class="toc-backref" href="#id11">USB device instance configuration</a><a class="headerlink" href="#usb-device-instance-configuration" title="Permalink to this heading"></a></h3>
<p>The nRF Desktop device can provide multiple instances of a HID-class USB device.
The number of instances is controlled by <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_USB_HID_DEVICE_COUNT</span></code>.
By default, the option is set to:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> for HID peripherals (<a class="reference internal" href="../README.html#config-desktop-app-options"><span class="std std-ref">CONFIG_DESKTOP_ROLE_HID_PERIPHERAL</span></a>).</p></li>
<li><p><a class="reference internal" href="../README.html#config-desktop-app-options"><span class="std std-ref">CONFIG_DESKTOP_HID_DONGLE_BOND_COUNT</span></a> for HID dongles (<a class="reference internal" href="../README.html#config-desktop-app-options"><span class="std std-ref">CONFIG_DESKTOP_ROLE_HID_DONGLE</span></a>).</p></li>
</ul>
<p>See the subsections below for details.</p>
<section id="nrf-desktop-peripheral">
<h4>nRF Desktop Peripheral<a class="headerlink" href="#nrf-desktop-peripheral" title="Permalink to this heading"></a></h4>
<p>The nRF Desktop Peripheral devices by default use only a single HID-class USB instance.
In that case, this instance is used for all the HID reports.</p>
<p>Enable <a class="reference internal" href="../README.html#config-desktop-app-options"><span class="std std-ref">CONFIG_DESKTOP_USB_SELECTIVE_REPORT_SUBSCRIPTION</span></a> to use more than one HID-class USB instance on nRF Desktop Peripheral.
Make sure to set a greater value in the <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_USB_HID_DEVICE_COUNT</span></code> option and create an additional <code class="file docutils literal notranslate"><span class="pre">usb_state_def.h</span></code> header in the configuration.
The header assigns HID reports to the HID-class USB instances.
A given HID report can be handled only by a single HID-class USB instance.
For example, the file contents can look as follows:</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;hid_report_desc.h&quot;</span>

<span class="cm">/* This configuration file is included only once from usb_state module and holds</span>
<span class="cm"> * information about HID report subscriptions of USB HID instances.</span>
<span class="cm"> */</span>

<span class="cm">/* This structure enforces the header file is included only once in the build.</span>
<span class="cm"> * Violating this requirement triggers a multiple definition error at link time.</span>
<span class="cm"> */</span>
<span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="n">usb_state_def_include_once</span><span class="p">;</span>

<span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">usb_hid_report_bm</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">       </span><span class="n">BIT</span><span class="p">(</span><span class="n">REPORT_ID_MOUSE</span><span class="p">),</span>
<span class="w">       </span><span class="n">BIT</span><span class="p">(</span><span class="n">REPORT_ID_KEYBOARD_KEYS</span><span class="p">),</span>
<span class="p">};</span>
</pre></div>
</div>
</div></blockquote>
<p>The <code class="docutils literal notranslate"><span class="pre">usb_hid_report_bm</span></code> defines HID reports handled by a HID-class USB instance, in a bitmask format.
In this example, the HID mouse input report is handled by the first HID-class USB instance and the HID keyboard input report is handled by the second HID-class USB instance.</p>
</section>
<section id="nrf-desktop-central">
<h4>nRF Desktop Central<a class="headerlink" href="#nrf-desktop-central" title="Permalink to this heading"></a></h4>
<p>The nRF Desktop Central device can use either a single HID-class USB instance or a number of instances equal to that specified in the <a class="reference internal" href="../README.html#config-desktop-app-options"><span class="std std-ref">CONFIG_DESKTOP_HID_DONGLE_BOND_COUNT</span></a> option.
If only one instance is used, reports from all Peripherals connected to the Central are forwarded to the same instance.
In other cases, reports from each of the bonded peripherals are forwarded to a dedicated HID-class USB instance.
The same instance is used after reconnection.</p>
</section>
</section>
<section id="usb-wakeup-configuration">
<h3><a class="toc-backref" href="#id12">USB wakeup configuration</a><a class="headerlink" href="#usb-wakeup-configuration" title="Permalink to this heading"></a></h3>
<p>The nRF Desktop device can work as a source of wakeup events for the host device if connected through the USB.
To use the feature, enable the <a class="reference internal" href="../README.html#config-desktop-app-options"><span class="std std-ref">CONFIG_DESKTOP_USB_REMOTE_WAKEUP</span></a> option.
This option selects the <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_USB_DEVICE_REMOTE_WAKEUP</span></code> to enable required dependencies in the USB stack.</p>
<p>When host enters the suspended state, the USB will be suspended as well.
With this feature enabled, this state change is used to suspend the nRF Desktop device (see <a class="reference internal" href="power_manager.html#nrf-desktop-power-manager"><span class="std std-ref">Power manager module</span></a>).
When the nRF Desktop device wakes up from standby, the USB state module will issue a wakeup request on the USB.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The USB wakeup request is transmitted to the host only if the host enables this request before suspending the USB.</p>
</div>
</section>
</section>
<section id="implementation-details">
<h2><a class="toc-backref" href="#id13">Implementation details</a><a class="headerlink" href="#implementation-details" title="Permalink to this heading"></a></h2>
<p>The USB state module registers the <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_USB_HID_DEVICE_COUNT</span></code> instances of HID-class USB device and initializes the USB subsystem.</p>
<p>The necessary callbacks are connected to the module to ensure that the state of the USB connection is tracked.
From the application’s viewpoint, USB can be in the following states:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../README.html#c.usb_state.USB_STATE_DISCONNECTED" title="USB_STATE_DISCONNECTED"><code class="xref c c-enum docutils literal notranslate"><span class="pre">USB_STATE_DISCONNECTED</span></code></a> - USB cable is not connected.</p></li>
<li><p><a class="reference internal" href="../README.html#c.usb_state.USB_STATE_POWERED" title="USB_STATE_POWERED"><code class="xref c c-enum docutils literal notranslate"><span class="pre">USB_STATE_POWERED</span></code></a> - The device is powered from USB but is not configured for the communication.</p></li>
<li><p><a class="reference internal" href="../README.html#c.usb_state.USB_STATE_ACTIVE" title="USB_STATE_ACTIVE"><code class="xref c c-enum docutils literal notranslate"><span class="pre">USB_STATE_ACTIVE</span></code></a> - The device is ready to exchange data with the host.</p></li>
<li><p><a class="reference internal" href="../README.html#c.usb_state.USB_STATE_SUSPENDED" title="USB_STATE_SUSPENDED"><code class="xref c c-enum docutils literal notranslate"><span class="pre">USB_STATE_SUSPENDED</span></code></a> - The host has requested the device to enter the suspended state.</p></li>
</ul>
<p>These states are broadcast by the USB state module with a <a class="reference internal" href="../README.html#c.usb_state_event" title="usb_state_event"><code class="xref c c-struct docutils literal notranslate"><span class="pre">usb_state_event</span></code></a>.
When the device is connected to the host and configured for the communication, the module will broadcast the <a class="reference internal" href="../README.html#c.usb_state.USB_STATE_ACTIVE" title="USB_STATE_ACTIVE"><code class="xref c c-enum docutils literal notranslate"><span class="pre">USB_STATE_ACTIVE</span></code></a> state.
The module will also subscribe to all HID reports available in the application for the selected protocol.</p>
<p>When the device is disconnected from the host, the module will unsubscribe from receiving the HID reports.</p>
<p>When the HID report data is transmitted through <code class="xref c c-struct docutils literal notranslate"><span class="pre">hid_report_event</span></code>, the module will pass it to the associated endpoint.
Upon data delivery, <code class="xref c c-struct docutils literal notranslate"><span class="pre">hid_report_sent_event</span></code> is submitted by the module.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Only one report can be transmitted by the module to a single instance of HID-class USB device at any given time.
Different instances can transmit reports in parallel.</p>
</div>
<p>The USB state module is a transport for <a class="reference internal" href="config_channel.html#nrf-desktop-config-channel"><span class="std std-ref">Configuration channel</span></a> when the channel is enabled.</p>
<p>The module also handles an HID keyboard LED output report received through USB from the connected host.
The module sends the report using <code class="xref c c-struct docutils literal notranslate"><span class="pre">hid_report_event</span></code>, that is handled either by <a class="reference internal" href="hid_state.html#nrf-desktop-hid-state"><span class="std std-ref">HID state module</span></a> (for peripheral) or by the <a class="reference internal" href="hid_forward.html#nrf-desktop-hid-forward"><span class="std std-ref">HID forward module</span></a> (for dongle).</p>
</section>
</section>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="watchdog.html" class="btn btn-neutral float-right" title="Watchdog module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="usb_state_pm.html" class="btn btn-neutral" title="USB state power manager module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">

<table>
<tr>
<td>
    <p>
        &copy; Copyright 2019-2023, Nordic Semiconductor.
      Last updated on Mar 20, 2023.

    </p>
</td>
<td id="nordiclogo">
  <a href="https://www.nordicsemi.com/"><img src="../../../_static/images/nordic-logo.png" border="0"/></a>
</td>
</tr>
</table>
  </div> 


</footer>

<div id="scroll-container">
  <button type="button" id="scroll-btn" class="btn">
    <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="#fff"/></svg>
  </button>
</div>

<script>
  const scrollBtn = document.querySelector("#scroll-btn");

  document.addEventListener("scroll", () => {
    if (window.scrollY > 400) {
          scrollBtn.style.visibility = "visible";
      } else {
          scrollBtn.style.visibility = "hidden";
      }
  });

  scrollBtn.addEventListener("click", () => {
      window.scrollTo({ top: 0, behavior: "smooth" });
  });
</script>
        </div>
      </div>
    </section>
  </div>
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> nRF Connect SDK</span>
       <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      
      <div class="rst-other-version ncs">
        <a href="../../../../nrf/index.html">nRF Connect SDK</a>
      </div>
      
      <div class="rst-other-version nrfx">
        <a href="../../../../nrfx/index.html">nrfx</a>
      </div>
      
      <div class="rst-other-version nrfxlib">
        <a href="../../../../nrfxlib/README.html">nrfxlib</a>
      </div>
      
      <div class="rst-other-version zephyr">
        <a href="../../../../zephyr/index.html">Zephyr Project</a>
      </div>
      
      <div class="rst-other-version mcuboot">
        <a href="../../../../mcuboot/wrapper.html">MCUboot</a>
      </div>
      
      <div class="rst-other-version tfm">
        <a href="../../../../tfm/index.html">Trusted Firmware-M</a>
      </div>
      
      <div class="rst-other-version matter">
        <a href="../../../../matter/index.html">Matter</a>
      </div>
      
      <div class="rst-other-version kconfig">
        <a href="../../../../kconfig/index.html">Kconfig Reference</a>
      </div>
    </div>
  </div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>