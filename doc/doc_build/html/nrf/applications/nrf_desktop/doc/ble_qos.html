<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bluetooth LE Quality of Service module &mdash; nRF Connect SDK 2.3.99 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/nordic.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/togglebutton.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/nrf.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/tabs.css" type="text/css" /> 
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
        <script src="https://www.googletagmanager.com/gtag/js?id=G-ZPVZRKFQJR"></script>
        <script src="../../../_static/js/ga-tracker.js"></script>
        <script data-culture="EN" id="CookieConsent" type="text/javascript" src="https://policy.app.cookieinformation.com/uc.js"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../../_static/togglebutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/js/theme.js"></script>
<script
  type="text/javascript"
  src="../../../_static/js/ncs.js"
></script>
<script src="../../../_static/js/bootstrap.bundle.min.js"></script>

    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Bluetooth LE scanning module" href="ble_scan.html" />
    <link rel="prev" title="Bluetooth LE passkey module" href="ble_passkey.html" />
<link
  href="../../../_static/css/bootstrap.min.css"
  rel="stylesheet"
/>
<link
  rel="shortcut icon"
  href="../../../_static/images/favicon.ico"
/>

</head>

<body class="wy-body-for-nav">
<div class="announcement"></div>
<div class="d-print-none ncs-header">
  <div class="container-xl ncs-header-top">
    <div class="row h-100">
      <div class="d-none d-md-block col-2">
        <div class="bg-white py-4 px-3 ml-2 ncs-header-logo">
          <img
            class="ncs-header-logo"
            src="../../../_static/images/nordic-logo.png"
            alt=""
          />
        </div>
      </div>
      <div
        class="col-8 col-md-7 pl-md-4 d-flex align-self-center justify-content-center"
      >
        <form class="w-75" action="../../../search.html" method="get">
          <div class="form-group">
            <input
              type="text"
              name="q"
              class="ncs-search-input form-control"
              placeholder="Search all docs..."
            />
          </div>
        </form>
      </div>
      <div class="col-4 col-md-3 d-md-block p-3 text-end">
        <div class="dropdown">
          <button
            class="btn dropdown-toggle ncs-btn-versions"
            type="button"
            id="dropdownMenuButton1"
            data-bs-toggle="dropdown"
            aria-expanded="false"
          >
            <span class="d-none d-md-inline">nRF Connect SDK</span>
            <span id="ncsversion" class="d-inline"></span>
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton"></div>
        </div>
      </div>
    </div>
  </div>
  <div class="ncs-header-nav">
    <div class="container-xl">
      <div class="row">
        <div class="col col-12 d-flex justify-content-center">
          <nav class="navbar navbar-dark navbar-expand-lg p-0">
            <span class="navbar-brand d-block d-lg-none py-2 pl-1"
              >Documentation sets</span
            >
            <button
              class="navbar-toggler"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#navbarNavAltMarkup"
              aria-controls="navbarNavAltMarkup"
              aria-expanded="false"
              aria-label="Toggle navigation"
            >
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
              <ul class="navbar-nav">
                <li class="nav-item active py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../nrf/index.html"
                    >nRF Connect SDK</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../nrfx/index.html"
                    >nrfx</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../nrfxlib/README.html"
                    >nrfxlib</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../zephyr/index.html"
                    >Zephyr Project</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../mcuboot/wrapper.html"
                    >MCUboot</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../tfm/index.html"
                    >Trusted Firmware-M</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../matter/index.html"
                    >Matter</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../kconfig/index.html"
                    >Kconfig Reference</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
              </ul>
            </div>
          </nav>
        </div>
      </div>
    </div>
  </div>
</div>

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> nRF Connect SDK
          </a>
              <div class="version">
                2.3.99
              </div>
<div id="searchbox" role="search">
  <div class="searchformwrapper">
    <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
  </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev_model.html">Development model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../app_dev.html">Application development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ecosystem_integration.html">Ecosystems integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nrf91.html">Working with nRF91 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nrf70.html">Working with nRF70 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nrf53.html">Working with nRF53 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nrf52.html">Working with nRF52 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../protocols.html">Protocols</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../applications.html">Applications</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../connectivity_bridge/README.html">Connectivity bridge</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../asset_tracker_v2/README.html">nRF9160: Asset Tracker v2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../serial_lte_modem/README.html">nRF9160: Serial LTE modem</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../README.html">nRF Desktop</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../README.html#overview-firmware-architecture">Overview: Firmware architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="../README.html#requirements">Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="../README.html#user-interface">User interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../README.html#configuration">Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../README.html#building-and-running">Building and running</a></li>
<li class="toctree-l3"><a class="reference internal" href="../README.html#integrating-your-own-hardware">Integrating your own hardware</a></li>
<li class="toctree-l3"><a class="reference internal" href="../README.html#dependencies">Dependencies</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../README.html#application-internal-modules">Application internal modules</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="main.html">Basic module (main)</a></li>
<li class="toctree-l4"><a class="reference internal" href="battery_charger.html">Battery charger module</a></li>
<li class="toctree-l4"><a class="reference internal" href="battery_meas.html">Battery measurement module</a></li>
<li class="toctree-l4"><a class="reference internal" href="ble_adv.html">Bluetooth LE advertising module</a></li>
<li class="toctree-l4"><a class="reference internal" href="ble_bond.html">Bluetooth LE bond module</a></li>
<li class="toctree-l4"><a class="reference internal" href="ble_conn_params.html">Bluetooth LE connection parameters module</a></li>
<li class="toctree-l4"><a class="reference internal" href="ble_discovery.html">Bluetooth LE discovery module</a></li>
<li class="toctree-l4"><a class="reference internal" href="ble_latency.html">Bluetooth LE latency module</a></li>
<li class="toctree-l4"><a class="reference internal" href="ble_passkey.html">Bluetooth LE passkey module</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Bluetooth LE Quality of Service module</a></li>
<li class="toctree-l4"><a class="reference internal" href="ble_scan.html">Bluetooth LE scanning module</a></li>
<li class="toctree-l4"><a class="reference internal" href="ble_state_pm.html">Bluetooth state power manager module</a></li>
<li class="toctree-l4"><a class="reference internal" href="ble_state.html">Bluetooth LE state module</a></li>
<li class="toctree-l4"><a class="reference internal" href="board.html">Board module</a></li>
<li class="toctree-l4"><a class="reference internal" href="buttons.html">Buttons module</a></li>
<li class="toctree-l4"><a class="reference internal" href="buttons_sim.html">Button simulator module</a></li>
<li class="toctree-l4"><a class="reference internal" href="click_detector.html">Click detector module</a></li>
<li class="toctree-l4"><a class="reference internal" href="config_channel.html">Configuration channel</a></li>
<li class="toctree-l4"><a class="reference internal" href="cpu_meas.html">CPU measurement module</a></li>
<li class="toctree-l4"><a class="reference internal" href="dev_descr.html">Device description module</a></li>
<li class="toctree-l4"><a class="reference internal" href="dfu.html">Device Firmware Upgrade module</a></li>
<li class="toctree-l4"><a class="reference internal" href="failsafe.html">Failsafe module</a></li>
<li class="toctree-l4"><a class="reference internal" href="fast_pair_app.html">Fast Pair module</a></li>
<li class="toctree-l4"><a class="reference internal" href="fn_keys.html">Function key module</a></li>
<li class="toctree-l4"><a class="reference internal" href="bas.html">GATT Battery Service module</a></li>
<li class="toctree-l4"><a class="reference internal" href="hid_forward.html">HID forward module</a></li>
<li class="toctree-l4"><a class="reference internal" href="hid_state.html">HID state module</a></li>
<li class="toctree-l4"><a class="reference internal" href="hid_state_pm.html">HID state power manager module</a></li>
<li class="toctree-l4"><a class="reference internal" href="hids.html">HID Service module</a></li>
<li class="toctree-l4"><a class="reference internal" href="info.html">Info module</a></li>
<li class="toctree-l4"><a class="reference internal" href="led_state.html">LED state module</a></li>
<li class="toctree-l4"><a class="reference internal" href="led_stream.html">LED stream module</a></li>
<li class="toctree-l4"><a class="reference internal" href="leds.html">LEDs module</a></li>
<li class="toctree-l4"><a class="reference internal" href="motion.html">Motion module</a></li>
<li class="toctree-l4"><a class="reference internal" href="passkey.html">Passkey module</a></li>
<li class="toctree-l4"><a class="reference internal" href="power_manager.html">Power manager module</a></li>
<li class="toctree-l4"><a class="reference internal" href="nrf_profiler_sync.html">nRF Profiler synchronization module</a></li>
<li class="toctree-l4"><a class="reference internal" href="qos.html">Quality of Service module</a></li>
<li class="toctree-l4"><a class="reference internal" href="selector.html">Selector module</a></li>
<li class="toctree-l4"><a class="reference internal" href="smp.html">Simple Management Protocol module</a></li>
<li class="toctree-l4"><a class="reference internal" href="settings_loader.html">Settings loader module</a></li>
<li class="toctree-l4"><a class="reference internal" href="usb_state_pm.html">USB state power manager module</a></li>
<li class="toctree-l4"><a class="reference internal" href="usb_state.html">USB state module</a></li>
<li class="toctree-l4"><a class="reference internal" href="watchdog.html">Watchdog module</a></li>
<li class="toctree-l4"><a class="reference internal" href="wheel.html">Wheel module</a></li>
<li class="toctree-l4"><a class="reference internal" href="constlat.html">Constant latency hotfix module</a></li>
<li class="toctree-l4"><a class="reference internal" href="hfclk_lock.html">High frequency clock lock hotfix module</a></li>
<li class="toctree-l4"><a class="reference internal" href="event_rel_modules.html">Source and sink module lists</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../README.html#application-configuration-options">Application configuration options</a></li>
<li class="toctree-l3"><a class="reference internal" href="../README.html#api-documentation">API documentation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../nrf5340_audio/README.html">nRF5340 Audio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../machine_learning/README.html">nRF Machine Learning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../matter_weather_station/README.html">Thingy:53: Matter weather station</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../zigbee_weather_station/README.html">Thingy:53: Zigbee weather station</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../samples.html">Samples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../drivers.html">Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../libraries/index.html">Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../scripts.html">Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../release_notes.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../known_issues.html">Known issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../software_maturity.html">Software maturity levels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation.html">About this documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">nRF Connect SDK</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../../../applications.html">Applications</a></li>
          <li class="breadcrumb-item"><a href="../README.html">nRF Desktop</a></li>
      <li class="breadcrumb-item active">Bluetooth LE Quality of Service module</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/applications/nrf_desktop/doc/ble_qos.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="bluetooth-le-quality-of-service-module">
<span id="nrf-desktop-ble-qos"></span><h1>Bluetooth LE Quality of Service module<a class="headerlink" href="#bluetooth-le-quality-of-service-module" title="Permalink to this heading"></a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#module-events" id="id6">Module events</a></p></li>
<li><p><a class="reference internal" href="#configuration" id="id7">Configuration</a></p></li>
<li><p><a class="reference internal" href="#configuration-channel-options" id="id8">Configuration channel options</a></p></li>
<li><p><a class="reference internal" href="#implementation-details" id="id9">Implementation details</a></p>
<ul>
<li><p><a class="reference internal" href="#softdevice-controller-interaction" id="id10">SoftDevice Controller interaction</a></p></li>
<li><p><a class="reference internal" href="#additional-thread" id="id11">Additional thread</a></p></li>
</ul>
</li>
</ul>
</div>
<p>Use the Bluetooth® LE Quality of Service (QoS) module to achieve better connection quality and higher report rate by avoiding congested RF channels.
The module can be used by both nRF Desktop peripheral and nRF Desktop central with the SoftDevice Link Layer (<code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_BT_LL_SOFTDEVICE</span></code>).
However, only the Bluetooth central can update the Bluetooth LE channel map that is in use.</p>
<section id="module-events">
<h2><a class="toc-backref" href="#id6">Module events</a><a class="headerlink" href="#module-events" title="Permalink to this heading"></a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 31%" />
<col style="width: 16%" />
<col style="width: 8%" />
<col style="width: 16%" />
<col style="width: 29%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Source Module</p></th>
<th class="head"><p>Input Event</p></th>
<th class="head"><p>This Module</p></th>
<th class="head"><p>Output Event</p></th>
<th class="head"><p>Sink Module</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference internal" href="event_rel_modules.html#nrf-desktop-config-event-sources"><span class="std std-ref">Source modules for config_event</span></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">config_event</span></code></p></td>
<td rowspan="9"><p><code class="docutils literal notranslate"><span class="pre">ble_qos</span></code></p></td>
<td rowspan="6"></td>
<td rowspan="6"></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="hid_forward.html#nrf-desktop-hid-forward"><span class="std std-ref">HID forward module</span></a></p></td>
<td rowspan="4"><p><code class="docutils literal notranslate"><span class="pre">hid_report_event</span></code></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="hid_state.html#nrf-desktop-hid-state"><span class="std std-ref">HID state module</span></a></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="hids.html#nrf-desktop-hids"><span class="std std-ref">HID Service module</span></a></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="usb_state.html#nrf-desktop-usb-state"><span class="std std-ref">USB state module</span></a></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="event_rel_modules.html#nrf-desktop-module-state-event-sources"><span class="std std-ref">Source modules for module_state_event</span></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">module_state_event</span></code></p></td>
</tr>
<tr class="row-even"><td rowspan="3"></td>
<td rowspan="3"></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ble_qos_event</span></code></p></td>
<td><p><a class="reference internal" href="qos.html#nrf-desktop-qos"><span class="std std-ref">Quality of Service module</span></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">config_event</span></code></p></td>
<td><p><a class="reference internal" href="event_rel_modules.html#nrf-desktop-config-event-sinks"><span class="std std-ref">Sink modules for config_event</span></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">module_state_event</span></code></p></td>
<td><p><a class="reference internal" href="event_rel_modules.html#nrf-desktop-module-state-event-sinks"><span class="std std-ref">Sink modules for module_state_event</span></a></p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>See the <a class="reference internal" href="../README.html#nrf-desktop-architecture"><span class="std std-ref">Overview: Firmware architecture</span></a> for more information about the event-based communication in the nRF Desktop application and about how to read this table.</p>
</div>
</section>
<section id="configuration">
<h2><a class="toc-backref" href="#id7">Configuration</a><a class="headerlink" href="#configuration" title="Permalink to this heading"></a></h2>
<p>The module requires the basic Bluetooth configuration, as described in <a class="reference internal" href="../README.html#nrf-desktop-bluetooth-guide"><span class="std std-ref">Bluetooth in nRF Desktop</span></a>.</p>
<p>The QoS module uses the <code class="docutils literal notranslate"><span class="pre">chmap_filter</span></code> library, whose API is described in <code class="file docutils literal notranslate"><span class="pre">src/util/chmap_filter/include/chmap_filter.h</span></code>.
The library is linked if <a class="reference internal" href="../README.html#config-desktop-app-options"><span class="std std-ref">CONFIG_DESKTOP_BLE_QOS_ENABLE</span></a> Kconfig option is enabled.</p>
<p>Enable the module using the <a class="reference internal" href="../README.html#config-desktop-app-options"><span class="std std-ref">CONFIG_DESKTOP_BLE_QOS_ENABLE</span></a> Kconfig option.
The option selects <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_BT_HCI_VS_EVT_USER</span></code>, because the module uses vendor-specific HCI events.</p>
<p>You can use the <a class="reference internal" href="../README.html#config-desktop-app-options"><span class="std std-ref">CONFIG_DESKTOP_BLE_QOS_STATS_PRINTOUT_ENABLE</span></a> option to enable real-time QoS information printouts through a UART (e.g. a virtual COM port).
The chosen UART needs to be specified in Devicetree using <code class="docutils literal notranslate"><span class="pre">ncs,ble-qos-uart</span></code>.
This option also enables and configures the COM port (USB CDC ACM).
For this reason, the <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_USB_DEVICE_STACK</span></code> must be enabled.</p>
<p>The QoS module creates additional thread for processing the QoS algorithm.
You can define the following options:</p>
<ul class="simple">
<li><dl class="simple">
<dt><a class="reference internal" href="../README.html#config-desktop-app-options"><span class="std std-ref">CONFIG_DESKTOP_BLE_QOS_INTERVAL</span></a></dt><dd><p>This option specifies the amount of time of the processing interval for the QoS thread.
The interval is defined in milliseconds.
The thread periodically performs calculations and then sleeps during the interval.
Longer intervals give more time to accumulate the Cyclic Redundancy Check (CRC) stats.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><a class="reference internal" href="../README.html#config-desktop-app-options"><span class="std std-ref">CONFIG_DESKTOP_BLE_QOS_STACK_SIZE</span></a></dt><dd><p>This option defines the base stack size for the QoS thread.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><a class="reference internal" href="../README.html#config-desktop-app-options"><span class="std std-ref">CONFIG_DESKTOP_BLE_QOS_STATS_PRINT_STACK_SIZE</span></a></dt><dd><p>This option specifies the stack size increase if <a class="reference internal" href="../README.html#config-desktop-app-options"><span class="std std-ref">CONFIG_DESKTOP_BLE_QOS_STATS_PRINTOUT_ENABLE</span></a> is enabled.</p>
</dd>
</dl>
</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You can use the default thread stack sizes as long as you do not modify the module source code.</p>
</div>
</section>
<section id="configuration-channel-options">
<h2><a class="toc-backref" href="#id8">Configuration channel options</a><a class="headerlink" href="#configuration-channel-options" title="Permalink to this heading"></a></h2>
<p>You can use the <a class="reference internal" href="config_channel.html#nrf-desktop-config-channel"><span class="std std-ref">Configuration channel</span></a> to configure the module or read the configuration.
The module is a configuration channel listener and provides the following configuration options:</p>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">sample_count_min</span></code></dt><dd><p>Minimum number of samples needed for channel map processing.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">min_channel_count</span></code></dt><dd><p>Minimum Bluetooth LE channel count.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">weight_crc_ok</span></code></dt><dd><p>Weight of CRC OK.
Fixed point value with 1/100 scaling.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">weight_crc_error</span></code></dt><dd><p>Weight of CRC ERROR.
Fixed point value with 1/100 scaling.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">ble_block_threshold</span></code></dt><dd><p>Threshold relative to the average rating for blocking Bluetooth LE channels.
Fixed point value with 1/100 scaling.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">eval_max_count</span></code></dt><dd><p>Maximum number of blocked channels that can be evaluated.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">eval_duration</span></code></dt><dd><p>Duration of the channel evaluation (in seconds).</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">eval_keepout_duration</span></code></dt><dd><p>Duration during which a channel will be blocked before it is considered for re-evaluation (in seconds).</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">eval_success_threshold</span></code></dt><dd><p>Average rating threshold for approving a blocked Bluetooth LE channel that is under evaluation by the QoS module.
Fixed point value with 1/100 scaling.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">wifi_rating_inc</span></code></dt><dd><p>Wi-Fi strength rating multiplier.
Increase the value to block Wi-Fi faster.
Fixed point value with 1/100 scaling.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">wifi_present_threshold</span></code></dt><dd><p>Average rating threshold for considering a Wi-Fi present.
Fixed point with 1/100 scaling.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">wifi_active_threshold</span></code></dt><dd><p>Average rating threshold for considering a Wi-Fi active (blockable).
Fixed point value with 1/100 scaling.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">channel_map</span></code></dt><dd><p>5-byte Bluetooth LE channel map bitmask.
This option is read-only.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">wifi_blacklist</span></code></dt><dd><p>List of blacklisted Wi-Fi channels.
The QoS module represents the list as a bitmask.
In the <a class="reference internal" href="../../../scripts/hid_configurator/README.html#nrf-desktop-config-channel-script"><span class="std std-ref">HID configurator for nRF Desktop</span></a>, the Wi-Fi channels are provided in a comma-separated list, for example <code class="docutils literal notranslate"><span class="pre">wifi_blacklist</span> <span class="pre">1,3,5</span></code>.</p>
</dd>
</dl>
</li>
</ul>
</section>
<section id="implementation-details">
<h2><a class="toc-backref" href="#id9">Implementation details</a><a class="headerlink" href="#implementation-details" title="Permalink to this heading"></a></h2>
<p>The QoS module uses Zephyr’s <span class="xref std std-ref">zephyr:settings_api</span> subsystem to store the configuration in non-volatile memory.
The channel map is not stored.</p>
<section id="softdevice-controller-interaction">
<h3><a class="toc-backref" href="#id10">SoftDevice Controller interaction</a><a class="headerlink" href="#softdevice-controller-interaction" title="Permalink to this heading"></a></h3>
<p>The module uses CRC information from the SoftDevice Controller to adjust the channel map.
The CRC information is received through the vendor-specific Bluetooth HCI event (<code class="xref c c-enum docutils literal notranslate"><span class="pre">SDC_HCI_SUBEVENT_VS_QOS_CONN_EVENT_REPORT</span></code>).</p>
</section>
<section id="additional-thread">
<h3><a class="toc-backref" href="#id11">Additional thread</a><a class="headerlink" href="#additional-thread" title="Permalink to this heading"></a></h3>
<p>The module creates an additional low-priority thread.
The thread is used to periodically perform the following operations:</p>
<ul class="simple">
<li><p>Check and apply new configuration parameters received through the <a class="reference internal" href="config_channel.html#nrf-desktop-config-channel"><span class="std std-ref">Configuration channel</span></a>.</p></li>
<li><p>Check and apply new blacklist received through the <a class="reference internal" href="config_channel.html#nrf-desktop-config-channel"><span class="std std-ref">Configuration channel</span></a>.</p></li>
<li><p>Process channel map filter.</p></li>
<li><p>Get channel map suggested by the <code class="docutils literal notranslate"><span class="pre">chmap_filter</span></code> library.</p></li>
<li><p>Submit the suggested channel map as <code class="docutils literal notranslate"><span class="pre">ble_qos_event</span></code>.</p></li>
<li><p>If the device is a Bluetooth central, update the used Bluetooth LE channel map.</p></li>
</ul>
<p>If the <a class="reference internal" href="../README.html#config-desktop-app-options"><span class="std std-ref">CONFIG_DESKTOP_BLE_QOS_STATS_PRINTOUT_ENABLE</span></a> Kconfig option is set, the module prints the following information through the virtual COM port:</p>
<ul>
<li><dl>
<dt>HID report rate</dt><dd><p>The module counts the number of HID input reports received through Bluetooth LE and prints the report rate through the virtual COM port every 100 packets.
The report rate is printed with a timestamp.</p>
<p>Example output:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">[05399493]Rate:0455</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt>Bluetooth LE channel statistics</dt><dd><p>The information is printed by the low-priority thread.
The output (<code class="docutils literal notranslate"><span class="pre">BT_INFO</span></code>) consists of the Bluetooth LE channel information.
Every Bluetooth LE channel information contains the following elements:</p>
<ul class="simple">
<li><p>Last two digits of the channel frequency (2400 + x MHz)</p></li>
<li><p>Channel state</p></li>
<li><p>Channel rating</p></li>
</ul>
<p>If the channel map is updated, the <code class="docutils literal notranslate"><span class="pre">Channel</span> <span class="pre">map</span> <span class="pre">update</span></code> string is printed with a timestamp.</p>
<p>Example output:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">[05407128]Channel map update</span>
<span class="go">BT_INFO={4:2:0,6:2:0,8:2:0,10:2:0,12:2:0,14:2:0,16:2:0,18:2:0,20:2:0,22:2:0,24:2:0,28:2:0,30:2:0,32:2:0,34:2:0,36:2:0,38:2:0,40:2:0,42:1:30,44:1:26,46:1:30,48:1:30,50:1:33,52:1:21,54:1:31,56:1:29,58:1:30,60:1:29,62:1:35,64:1:27,66:1:31,68:1:28,70:1:32,72:1:27,74:1:26,76:1:33,78:1:31,}</span>
</pre></div>
</div>
</dd>
</dl>
</li>
</ul>
</section>
</section>
</section>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ble_scan.html" class="btn btn-neutral float-right" title="Bluetooth LE scanning module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="ble_passkey.html" class="btn btn-neutral" title="Bluetooth LE passkey module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">

<table>
<tr>
<td>
    <p>
        &copy; Copyright 2019-2023, Nordic Semiconductor.
      Last updated on Mar 20, 2023.

    </p>
</td>
<td id="nordiclogo">
  <a href="https://www.nordicsemi.com/"><img src="../../../_static/images/nordic-logo.png" border="0"/></a>
</td>
</tr>
</table>
  </div> 


</footer>

<div id="scroll-container">
  <button type="button" id="scroll-btn" class="btn">
    <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="#fff"/></svg>
  </button>
</div>

<script>
  const scrollBtn = document.querySelector("#scroll-btn");

  document.addEventListener("scroll", () => {
    if (window.scrollY > 400) {
          scrollBtn.style.visibility = "visible";
      } else {
          scrollBtn.style.visibility = "hidden";
      }
  });

  scrollBtn.addEventListener("click", () => {
      window.scrollTo({ top: 0, behavior: "smooth" });
  });
</script>
        </div>
      </div>
    </section>
  </div>
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> nRF Connect SDK</span>
       <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      
      <div class="rst-other-version ncs">
        <a href="../../../../nrf/index.html">nRF Connect SDK</a>
      </div>
      
      <div class="rst-other-version nrfx">
        <a href="../../../../nrfx/index.html">nrfx</a>
      </div>
      
      <div class="rst-other-version nrfxlib">
        <a href="../../../../nrfxlib/README.html">nrfxlib</a>
      </div>
      
      <div class="rst-other-version zephyr">
        <a href="../../../../zephyr/index.html">Zephyr Project</a>
      </div>
      
      <div class="rst-other-version mcuboot">
        <a href="../../../../mcuboot/wrapper.html">MCUboot</a>
      </div>
      
      <div class="rst-other-version tfm">
        <a href="../../../../tfm/index.html">Trusted Firmware-M</a>
      </div>
      
      <div class="rst-other-version matter">
        <a href="../../../../matter/index.html">Matter</a>
      </div>
      
      <div class="rst-other-version kconfig">
        <a href="../../../../kconfig/index.html">Kconfig Reference</a>
      </div>
    </div>
  </div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>