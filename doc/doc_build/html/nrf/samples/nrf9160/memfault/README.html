<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>nRF9160: Memfault &mdash; nRF Connect SDK 2.3.99 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/nordic.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/togglebutton.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/nrf.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/tabs.css" type="text/css" /> 
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
        <script src="https://www.googletagmanager.com/gtag/js?id=G-ZPVZRKFQJR"></script>
        <script src="../../../_static/js/ga-tracker.js"></script>
        <script data-culture="EN" id="CookieConsent" type="text/javascript" src="https://policy.app.cookieinformation.com/uc.js"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../../_static/togglebutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/js/theme.js"></script>
<script
  type="text/javascript"
  src="../../../_static/js/ncs.js"
></script>
<script src="../../../_static/js/bootstrap.bundle.min.js"></script>

    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="nRF9160: Modem callbacks" href="../modem_callbacks/README.html" />
    <link rel="prev" title="Preparing for production" href="../lwm2m_client/provisioning.html" />
<link
  href="../../../_static/css/bootstrap.min.css"
  rel="stylesheet"
/>
<link
  rel="shortcut icon"
  href="../../../_static/images/favicon.ico"
/>

</head>

<body class="wy-body-for-nav">
<div class="announcement"></div>
<div class="d-print-none ncs-header">
  <div class="container-xl ncs-header-top">
    <div class="row h-100">
      <div class="d-none d-md-block col-2">
        <div class="bg-white py-4 px-3 ml-2 ncs-header-logo">
          <img
            class="ncs-header-logo"
            src="../../../_static/images/nordic-logo.png"
            alt=""
          />
        </div>
      </div>
      <div
        class="col-8 col-md-7 pl-md-4 d-flex align-self-center justify-content-center"
      >
        <form class="w-75" action="../../../search.html" method="get">
          <div class="form-group">
            <input
              type="text"
              name="q"
              class="ncs-search-input form-control"
              placeholder="Search all docs..."
            />
          </div>
        </form>
      </div>
      <div class="col-4 col-md-3 d-md-block p-3 text-end">
        <div class="dropdown">
          <button
            class="btn dropdown-toggle ncs-btn-versions"
            type="button"
            id="dropdownMenuButton1"
            data-bs-toggle="dropdown"
            aria-expanded="false"
          >
            <span class="d-none d-md-inline">nRF Connect SDK</span>
            <span id="ncsversion" class="d-inline"></span>
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton"></div>
        </div>
      </div>
    </div>
  </div>
  <div class="ncs-header-nav">
    <div class="container-xl">
      <div class="row">
        <div class="col col-12 d-flex justify-content-center">
          <nav class="navbar navbar-dark navbar-expand-lg p-0">
            <span class="navbar-brand d-block d-lg-none py-2 pl-1"
              >Documentation sets</span
            >
            <button
              class="navbar-toggler"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#navbarNavAltMarkup"
              aria-controls="navbarNavAltMarkup"
              aria-expanded="false"
              aria-label="Toggle navigation"
            >
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
              <ul class="navbar-nav">
                <li class="nav-item active py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../nrf/index.html"
                    >nRF Connect SDK</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../nrfx/index.html"
                    >nrfx</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../nrfxlib/README.html"
                    >nrfxlib</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../zephyr/index.html"
                    >Zephyr Project</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../mcuboot/wrapper.html"
                    >MCUboot</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../tfm/index.html"
                    >Trusted Firmware-M</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../matter/index.html"
                    >Matter</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../kconfig/index.html"
                    >Kconfig Reference</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
              </ul>
            </div>
          </nav>
        </div>
      </div>
    </div>
  </div>
</div>

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> nRF Connect SDK
          </a>
              <div class="version">
                2.3.99
              </div>
<div id="searchbox" role="search">
  <div class="searchformwrapper">
    <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
  </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev_model.html">Development model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../app_dev.html">Application development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ecosystem_integration.html">Ecosystems integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nrf91.html">Working with nRF91 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nrf70.html">Working with nRF70 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nrf53.html">Working with nRF53 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nrf52.html">Working with nRF52 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../protocols.html">Protocols</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../applications.html">Applications</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../samples.html">Samples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../bl.html">Bluetooth samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../crypto.html">Cryptography samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../edge.html">Edge Impulse samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../gazell.html">Gazell samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../matter.html">Matter samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nfc.html">NFC samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nrf5340.html">nRF5340 samples</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../nrf9160.html">nRF9160 samples</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../at_client/README.html">nRF9160: AT Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../at_monitor/README.html">nRF9160: AT monitor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../aws_iot/README.html">nRF9160: AWS IoT</a></li>
<li class="toctree-l3"><a class="reference internal" href="../azure_fota/README.html">nRF9160: Azure FOTA</a></li>
<li class="toctree-l3"><a class="reference internal" href="../azure_iot_hub/README.html">nRF9160: Azure IoT Hub</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ciphersuites/README.html">nRF9160: TLS cipher suites</a></li>
<li class="toctree-l3"><a class="reference internal" href="../coap_client/README.html">nRF9160: nRF CoAP Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../download/README.html">nRF9160: Download client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../fmfu_smp_svr/README.html">nRF9160: Full modem firmware update using SMP Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="../gnss/README.html">nRF9160: GNSS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../https_client/README.html">nRF9160: HTTPS Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../location/README.html">nRF9160: Location</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lte_ble_gateway/README.html">nRF9160: LTE Sensor Gateway</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lwm2m_carrier/README.html">nRF9160: LwM2M carrier</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lwm2m_client/README.html">nRF9160: LwM2M Client</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">nRF9160: Memfault</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#requirements">Requirements</a></li>
<li class="toctree-l4"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#building-and-running">Building and running</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dependencies">Dependencies</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../modem_callbacks/README.html">nRF9160: Modem callbacks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../modem_shell/README.html">nRF9160: Modem Shell</a></li>
<li class="toctree-l3"><a class="reference internal" href="../modem_trace_backend/README.html">nRF9160: Modem trace backend</a></li>
<li class="toctree-l3"><a class="reference internal" href="../modem_trace_flash/README.html">nRF9160: Modem trace external flash backend</a></li>
<li class="toctree-l3"><a class="reference internal" href="../nidd/README.html">nRF9160: NIDD</a></li>
<li class="toctree-l3"><a class="reference internal" href="../nrf_cloud_mqtt_multi_service/README.html">nRF9160: nRF Cloud MQTT multi-service</a></li>
<li class="toctree-l3"><a class="reference internal" href="../nrf_cloud_rest_cell_location/README.html">nRF9160: nRF Cloud REST cellular location</a></li>
<li class="toctree-l3"><a class="reference internal" href="../nrf_cloud_rest_device_message/README.html">nRF9160: nRF Cloud REST Device Message</a></li>
<li class="toctree-l3"><a class="reference internal" href="../nrf_cloud_rest_fota/README.html">nRF9160: nRF Cloud REST FOTA</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pdn/README.html">nRF9160: PDN</a></li>
<li class="toctree-l3"><a class="reference internal" href="../slm_shell/README.html">nRF9160: SLM Shell</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sms/README.html">nRF9160: SMS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../udp/README.html">nRF9160: UDP</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../net/mqtt/README.html">MQTT</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http_update/application_update/README.html">nRF9160: HTTP application update</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http_update/full_modem_update/README.html">nRF9160: HTTP full modem update</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http_update/modem_delta_update/README.html">nRF9160: HTTP modem delta update</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../tfm.html">Trusted Firmware-M (TF-M) samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../thread.html">Thread samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../zigbee.html">Zigbee samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../wifi.html">Wi-Fi samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../other.html">Other samples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../drivers.html">Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../libraries/index.html">Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../scripts.html">Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../release_notes.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../known_issues.html">Known issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../software_maturity.html">Software maturity levels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation.html">About this documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">nRF Connect SDK</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../../../samples.html">Samples</a></li>
          <li class="breadcrumb-item"><a href="../../nrf9160.html">nRF9160 samples</a></li>
      <li class="breadcrumb-item active">nRF9160: Memfault</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/samples/nrf9160/memfault/README.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="nrf9160-memfault">
<span id="memfault-sample"></span><h1>nRF9160: Memfault<a class="headerlink" href="#nrf9160-memfault" title="Permalink to this heading"></a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#requirements" id="id6">Requirements</a></p></li>
<li><p><a class="reference internal" href="#overview" id="id7">Overview</a></p>
<ul>
<li><p><a class="reference internal" href="#metrics" id="id8">Metrics</a></p></li>
<li><p><a class="reference internal" href="#error-tracking-with-trace-events" id="id9">Error Tracking with trace events</a></p></li>
<li><p><a class="reference internal" href="#coredumps" id="id10">Coredumps</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#configuration" id="id11">Configuration</a></p>
<ul>
<li><p><a class="reference internal" href="#minimal-setup" id="id12">Minimal setup</a></p></li>
<li><p><a class="reference internal" href="#additional-configuration" id="id13">Additional configuration</a></p></li>
<li><p><a class="reference internal" href="#configuration-files" id="id14">Configuration files</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#building-and-running" id="id15">Building and running</a></p>
<ul>
<li><p><a class="reference internal" href="#testing" id="id16">Testing</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#dependencies" id="id17">Dependencies</a></p></li>
</ul>
</div>
<p>The Memfault sample shows how to use the <a class="reference external" href="https://docs.memfault.com/docs/embedded/introduction/">Memfault SDK</a> in an nRF Connect SDK application to collect coredumps and metrics.
The sample connects to an LTE network and sends the collected data to Memfault’s cloud using HTTPS.</p>
<p>To get started with Memfault integration in nRF Connect SDK, see <a class="reference internal" href="../../../external_comp/memfault.html#ug-memfault"><span class="std std-ref">Memfault integration</span></a>.</p>
<section id="requirements">
<h2><a class="toc-backref" href="#id6">Requirements</a><a class="headerlink" href="#requirements" title="Permalink to this heading"></a></h2>
<p>The sample supports the following development kits:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 28%" />
<col style="width: 8%" />
<col style="width: 42%" />
<col style="width: 23%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Hardware platforms</p></th>
<th class="head"><p>PCA</p></th>
<th class="head"><p>Board name</p></th>
<th class="head"><p>Build target</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference internal" href="../../../working_with_nrf/nrf91/thingy91.html#ug-thingy91"><span class="std std-ref">Thingy:91</span></a></p></td>
<td><p>PCA20035</p></td>
<td><p>thingy91_nrf9160</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">thingy91_nrf9160_ns</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../../../working_with_nrf/nrf91/nrf9160.html#ug-nrf9160"><span class="std std-ref">nRF9160 DK</span></a></p></td>
<td><p>PCA10090</p></td>
<td><p><span class="xref std std-ref">nrf9160dk_nrf9160</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">nrf9160dk_nrf9160_ns</span></code></p></td>
</tr>
</tbody>
</table>
<p>When built for an <code class="docutils literal notranslate"><span class="pre">_ns</span></code> build target, the sample is configured to compile and run as a non-secure application with <a class="reference internal" href="../../../app_dev/board_support/index.html#app-boards-spe-nspe-cpuapp-ns"><span class="std std-ref">Cortex-M Security Extensions enabled</span></a>.
Therefore, it automatically includes <a class="reference internal" href="../../../app_dev/tfm/index.html#ug-tfm"><span class="std std-ref">Trusted Firmware-M</span></a> that prepares the required peripherals and secure services to be available for the application.</p>
</section>
<section id="overview">
<h2><a class="toc-backref" href="#id7">Overview</a><a class="headerlink" href="#overview" title="Permalink to this heading"></a></h2>
<p>In this sample, Memfault SDK is used as a module in nRF Connect SDK to collect coredumps, reboot reasons, metrics and trace events from devices and send to the Memfault cloud.
See <a class="reference external" href="https://docs.memfault.com/docs/platform/memfault-terminology/">Memfault terminology</a> for more details on the various Memfault concepts.</p>
<section id="metrics">
<h3><a class="toc-backref" href="#id8">Metrics</a><a class="headerlink" href="#metrics" title="Permalink to this heading"></a></h3>
<p>The sample adds properties specific to the application, while the <a class="reference internal" href="../../../libraries/others/memfault_ncs.html#mod-memfault"><span class="std std-ref">Memfault SDK integration layer</span></a> in nRF Connect SDK adds the system property metrics.
See <a class="reference external" href="https://docs.memfault.com/docs/embedded/metrics-api">Memfault: Collecting Device Metrics</a> for details on working and implementation of metrics.
Some metrics are collected by the Memfault SDK directly.
There are also some metrics, which are specific to nRF Connect SDK that are enabled by default:</p>
<ul class="simple">
<li><p>LTE metrics:</p>
<ul>
<li><p>Enabled and disabled using <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_MEMFAULT_NCS_LTE_METRICS</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Ncs_LteTimeToConnect</span></code> - Time from the point when the device starts to search for an LTE network until the time when it gets registered with the network.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Ncs_LteConnectionLossCount</span></code> - The number of times that the device has lost the LTE network connection after the initial network registration.</p></li>
</ul>
</li>
<li><p>Stack usage metrics:</p>
<ul>
<li><p>Shows how many bytes of unused space is left in a stack.</p></li>
<li><p>Configurable using <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_MEMFAULT_NCS_STACK_METRICS</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Ncs_ConnectionPollUnusedStack</span></code>- Stack used by the cloud libraries for <a class="reference internal" href="../../../libraries/networking/nrf_cloud.html#lib-nrf-cloud"><span class="std std-ref">nRF Cloud</span></a>, <a class="reference internal" href="../../../libraries/networking/aws_iot.html#lib-aws-iot"><span class="std std-ref">AWS IoT</span></a> and <a class="reference internal" href="../../../libraries/networking/azure_iot_hub.html#lib-azure-iot-hub"><span class="std std-ref">Azure IoT Hub</span></a>.</p></li>
</ul>
</li>
</ul>
<p>In addition to showing the capturing of metrics provided by the Memfault SDK integration layer in nRF Connect SDK, the sample also shows how to capture an application-specific metric.
This metric is defined in <code class="file docutils literal notranslate"><span class="pre">samples/nrf9160/memfault/config/memfault_metrics_heartbeat_config.h</span></code>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Switch1ToggleCount</span></code> - The number of times <strong>Switch 1</strong> has been toggled on an nRF9160 DK.</p></li>
</ul>
</section>
<section id="error-tracking-with-trace-events">
<h3><a class="toc-backref" href="#id9">Error Tracking with trace events</a><a class="headerlink" href="#error-tracking-with-trace-events" title="Permalink to this heading"></a></h3>
<p>The sample implements a user-defined trace reason for demonstration purposes.
The trace reason is called <code class="docutils literal notranslate"><span class="pre">Switch2Toggled</span></code>, and is collected every time <strong>Switch 2</strong> is toggled on an nRF9160 DK.
In addition to detection of the event, the trace includes the current switch state.
See <a class="reference external" href="https://docs.memfault.com/docs/embedded/trace-events/">Memfault: Error Tracking with Trace Events</a> for information on how to configure and use trace events.</p>
</section>
<section id="coredumps">
<h3><a class="toc-backref" href="#id10">Coredumps</a><a class="headerlink" href="#coredumps" title="Permalink to this heading"></a></h3>
<p>Coredumps can be triggered either by using the Memfault shell command <code class="docutils literal notranslate"><span class="pre">mflt</span> <span class="pre">crash</span></code>, or by pressing a button:</p>
<ul class="simple">
<li><p><strong>Button 1</strong> triggers a stack overflow</p></li>
<li><p><strong>Button 2</strong> triggers a division by zero</p></li>
</ul>
<p>These faults cause crashes that are captured by Memfault.
After rebooting, the crash data can be sent to the Memfault cloud for further inspection and analysis.
See <a class="reference external" href="https://docs.memfault.com/">Memfault documentation</a> for more information on the debugging possibilities offered by the Memfault platform.</p>
<p>The sample enables Memfault shell by default.
The shell offers multiple test commands to test a wide range of functionality offered by Memfault SDK.
Run the command <code class="docutils literal notranslate"><span class="pre">mflt</span> <span class="pre">help</span></code> in the terminal for more information on the available commands.</p>
</section>
</section>
<section id="configuration">
<h2><a class="toc-backref" href="#id11">Configuration</a><a class="headerlink" href="#configuration" title="Permalink to this heading"></a></h2>
<p>The Memfault SDK allows the configuration of some of its options using Kconfig.
To configure the options in the SDK that are not available for configuration using Kconfig, use <code class="file docutils literal notranslate"><span class="pre">samples/nrf9160/memfault/config/memfault_platform_config.h</span></code>.
See <a class="reference external" href="https://docs.memfault.com/docs/embedded/introduction/">Memfault SDK</a> for more information.</p>
<p>See <a class="reference internal" href="../../../getting_started/modifying.html#configure-application"><span class="std std-ref">Configuring your application</span></a> for information about how to permanently or temporarily change the configuration.</p>
<section id="minimal-setup">
<h3><a class="toc-backref" href="#id12">Minimal setup</a><a class="headerlink" href="#minimal-setup" title="Permalink to this heading"></a></h3>
<p>To send data to the Memfault cloud, a project key must be configured using <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_MEMFAULT_NCS_PROJECT_KEY</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The Memfault SDK requires certificates required for the HTTPS transport.
The certificates are by default provisioned automatically by the nRF Connect SDK integration layer for Memfault SDK to sec tags 1001 - 1005.
If other certificates exist at these sec tags, HTTPS uploads will fail.</p>
</div>
</section>
<section id="additional-configuration">
<h3><a class="toc-backref" href="#id13">Additional configuration</a><a class="headerlink" href="#additional-configuration" title="Permalink to this heading"></a></h3>
<p>There are two sources for Kconfig options when using Memfault SDK in nRF Connect SDK:</p>
<ul class="simple">
<li><p>Kconfig options defined within the Memfault SDK.</p></li>
<li><p>Kconfig options defined in the nRF Connect SDK integration layer of the Memfault SDK. These configuration options are prefixed with <code class="docutils literal notranslate"><span class="pre">CONFIG_MEMFAULT_NCS</span></code>.</p></li>
</ul>
<p>Check and configure the following options in Memfault SDK that are used by the sample:</p>
<ul class="simple">
<li><p><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_MEMFAULT</span></code></p></li>
<li><p><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_MEMFAULT_LOGGING_ENABLE</span></code></p></li>
<li><p><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_MEMFAULT_LOG_LEVEL_DBG</span></code></p></li>
<li><p><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_MEMFAULT_ROOT_CERT_STORAGE_NRF9160_MODEM</span></code></p></li>
<li><p><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_MEMFAULT_SHELL</span></code></p></li>
<li><p><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_MEMFAULT_HTTP_ENABLE</span></code></p></li>
<li><p><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_MEMFAULT_HTTP_PERIODIC_UPLOAD</span></code></p></li>
<li><p><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_MEMFAULT_HTTP_PERIODIC_UPLOAD_INTERVAL_SECS</span></code></p></li>
<li><p><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_MEMFAULT_HTTP_PERIODIC_UPLOAD_USE_DEDICATED_WORKQUEUE</span></code></p></li>
<li><p><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_MEMFAULT_COREDUMP_COLLECT_BSS_REGIONS</span></code></p></li>
</ul>
<p>If <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_MEMFAULT_ROOT_CERT_STORAGE_NRF9160_MODEM</span></code> is enabled, TLS certificates used for HTTP uploads are provisioned to the nRF9160 modem when <code class="xref c c-func docutils literal notranslate"><span class="pre">memfault_zephyr_port_install_root_certs()</span></code> is called.</p>
<p>Check and configure the following options for Memfault that are specific to nRF Connect SDK:</p>
<ul class="simple">
<li><p><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_MEMFAULT_NCS_PROJECT_KEY</span></code></p></li>
<li><p><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_MEMFAULT_NCS_LTE_METRICS</span></code></p></li>
<li><p><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_MEMFAULT_NCS_STACK_METRICS</span></code></p></li>
<li><p><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_MEMFAULT_NCS_INTERNAL_FLASH_BACKED_COREDUMP</span></code></p></li>
</ul>
<p>If <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_MEMFAULT_NCS_INTERNAL_FLASH_BACKED_COREDUMP</span></code> is enabled, <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_PM_PARTITION_SIZE_MEMFAULT_STORAGE</span></code> can be used to set the flash partition size for the flash storage.</p>
</section>
<section id="configuration-files">
<h3><a class="toc-backref" href="#id14">Configuration files</a><a class="headerlink" href="#configuration-files" title="Permalink to this heading"></a></h3>
<p>If you just want to do a quick test with a sample, disable the <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_MEMFAULT_USER_CONFIG_ENABLE</span></code> option in the <code class="file docutils literal notranslate"><span class="pre">prj.conf</span></code> file to avoid adding the user configuration files.
Otherwise, follow the instructions below.</p>
<p>Memfault SDK requires three files in the include path during the build process.
Add a new folder into your project called <code class="file docutils literal notranslate"><span class="pre">config</span></code> and add the following three files:</p>
<ul class="simple">
<li><p><code class="file docutils literal notranslate"><span class="pre">memfault_platform_config.h</span></code> - Sets Memfault SDK configurations that are not covered by Kconfig options.</p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">memfault_metrics_heartbeat_config.def</span></code> - Defines application-specific metrics.</p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">memfault_trace_reason_user_config.def</span></code> - Defines application-specific trace reasons.</p></li>
</ul>
<p>For more information, you can see <a class="reference external" href="https://docs.memfault.com/docs/mcu/nrf-connect-sdk-guide">Memfault nRF Connect SDK integration guide</a>.
You can use the files in the <a class="reference internal" href="#memfault-sample"><span class="std std-ref">nRF9160: Memfault</span></a> sample as a reference.
To have these configuration files in the include path, add the following in the <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">zephyr_include_directories(config)</span>
</pre></div>
</div>
</section>
</section>
<section id="building-and-running">
<h2><a class="toc-backref" href="#id15">Building and running</a><a class="headerlink" href="#building-and-running" title="Permalink to this heading"></a></h2>
<p>This sample can be found under <code class="file docutils literal notranslate"><span class="pre">samples/nrf9160/memfault</span></code> in the nRF Connect SDK folder structure.</p>
<p>When built as firmware image for the <code class="docutils literal notranslate"><span class="pre">_ns</span></code> build target, the sample has Cortex-M Security Extensions (CMSE) enabled and separates the firmware between Non-Secure Processing Environment (NSPE) and Secure Processing Environment (SPE).
Because of this, it automatically includes the <a class="reference internal" href="../../../app_dev/tfm/index.html#ug-tfm"><span class="std std-ref">Trusted Firmware-M (TF-M)</span></a>.
To read more about CMSE, see <a class="reference internal" href="../../../app_dev/board_support/index.html#app-boards-spe-nspe"><span class="std std-ref">Processing environments</span></a>.</p>
<p>To build the sample with Visual Studio Code, follow the steps listed on the <a class="reference external" href="https://nrfconnect.github.io/vscode-nrf-connect/get_started/build_app_ncs.html">How to build an application</a> page in the nRF Connect for VS Code extension documentation.
See <a class="reference internal" href="../../../getting_started/programming.html#gs-programming"><span class="std std-ref">Building and programming an application</span></a> for other building and programming scenarios and <a class="reference internal" href="../../../getting_started/testing.html#gs-testing"><span class="std std-ref">Testing and debugging an application</span></a> for general information about testing and debugging in the nRF Connect SDK.</p>
<section id="testing">
<h3><a class="toc-backref" href="#id16">Testing</a><a class="headerlink" href="#testing" title="Permalink to this heading"></a></h3>
<p>Before testing, ensure that your device is configured with the project key of your Memfault project.
After programming the sample to your development kit, complete the following steps to test it:</p>
<ol class="arabic">
<li><p>Connect to the kit with a terminal emulator that supports VT100/ANSI escape characters (for example, PuTTY).
See <a class="reference internal" href="../../../getting_started/testing.html#putty"><span class="std std-ref">How to connect with PuTTY</span></a> for the required settings.</p></li>
<li><p>Observe that the sample starts.
Following is a sample output on the terminal:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">*** Booting Zephyr OS build v3.0.99-ncs1-4913-gf7b06162027d  ***</span>
<span class="go">&lt;inf&gt; mflt: Reset Reason, RESETREAS=0x0</span>
<span class="go">&lt;inf&gt; mflt: Reset Causes:</span>
<span class="go">&lt;inf&gt; mflt: Power on Reset</span>
<span class="go">&lt;inf&gt; mflt: GNU Build ID: a09094cdf9da13f20719f87016663ab529b71267</span>
<span class="go">&lt;inf&gt; memfault_sample: Memfault sample has started</span>
</pre></div>
</div>
</li>
<li><p>The sample connects to an available LTE network, which is indicated by the following message:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">&lt;inf&gt; memfault_sample: Connecting to LTE network, this may take several minutes...</span>
</pre></div>
</div>
</li>
<li><p>When the connection is established, the sample displays the captured LTE time-to-connect metric (<code class="docutils literal notranslate"><span class="pre">Ncs_LteTimeToConnect</span></code>) on the terminal:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">&lt;inf&gt; memfault_sample: Connected to LTE network. Time to connect: 3602 ms</span>
</pre></div>
</div>
</li>
<li><p>Subsequently, all captured Memfault data will be sent to the Memfault cloud:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">&lt;inf&gt; memfault_sample: Sending already captured data to Memfault</span>
<span class="go">&lt;dbg&gt; mflt: memfault_platform_log: Response Complete: Parse Status 0 HTTP Status 202!</span>
<span class="go">&lt;dbg&gt; mflt: memfault_platform_log: Body: Accepted</span>
<span class="go">&lt;dbg&gt; mflt: memfault_platform_log: Response Complete: Parse Status 0 HTTP Status 202!</span>
<span class="go">&lt;dbg&gt; mflt: memfault_platform_log: Body: Accepted</span>
<span class="go">&lt;dbg&gt; mflt: memfault_platform_log: No more data to send</span>
</pre></div>
</div>
</li>
<li><p>Upload the symbol file generated from your build to your Memfault account so that the information from your application can be parsed. The symbol file is located in the build folder: <code class="file docutils literal notranslate"><span class="pre">memfault/build/zephyr/zephyr.elf</span></code>:</p>
<ol class="loweralpha">
<li><p>In a web browser, navigate to <a class="reference external" href="https://memfault.com/">Memfault</a>.</p></li>
<li><p>Login to your account and select the project you created earlier.</p></li>
<li><p>Navigate to <span class="guilabel">Fleet</span> &gt; <span class="guilabel">Devices</span> in the left menu.</p>
<p>You can see your newly connected device and the software version in the list.</p>
</li>
<li><p>Click on the software version number for your device and then the <span class="guilabel">Upload</span> button to upload the symbol file.</p></li>
</ol>
</li>
<li><p>Back in the terminal, press &lt;TAB&gt; on your keyboard to confirm that the Memfault shell is working.
The available shell commands are displayed:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">uart:~$</span>
<span class="go">  clear              device             flash              help</span>
<span class="go">  history            kernel             log                mcuboot</span>
<span class="go">  mflt               mflt_nrf           nrf_clock_control  resize</span>
<span class="go">  shell</span>
</pre></div>
</div>
</li>
<li><p>Learn about the available Memfault shell commands by issuing the command <code class="docutils literal notranslate"><span class="pre">mflt</span> <span class="pre">help</span></code>.</p></li>
<li><p>Press <strong>Button 1</strong> or <strong>Button 2</strong> to trigger a stack overflow or a division by zero, respectively.</p></li>
<li><p>Explore the Memfault user interface to look at the errors and metrics that has been sent from your device.</p></li>
</ol>
</section>
</section>
<section id="dependencies">
<h2><a class="toc-backref" href="#id17">Dependencies</a><a class="headerlink" href="#dependencies" title="Permalink to this heading"></a></h2>
<p>The sample requires the Memfault SDK, which is part of nRF Connect SDK’s West manifest, and will be downloaded automatically when <code class="docutils literal notranslate"><span class="pre">west</span> <span class="pre">update</span></code> is run.</p>
<p>This sample uses the following nRF Connect SDK libraries and drivers:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../../libraries/others/dk_buttons_and_leds.html#dk-buttons-and-leds-readme"><span class="std std-ref">DK Buttons and LEDs</span></a></p></li>
<li><p><a class="reference internal" href="../../../libraries/modem/lte_lc.html#lte-lc-readme"><span class="std std-ref">LTE link controller</span></a></p></li>
</ul>
<p>It uses the following <a class="reference external" href="https://github.com/nrfconnect/sdk-nrfxlib">sdk-nrfxlib</a> library:</p>
<ul class="simple">
<li><p><span class="xref std std-ref">nrfxlib:nrf_modem</span></p></li>
</ul>
<p>In addition, it uses the following secure firmware component:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../../app_dev/tfm/index.html#ug-tfm"><span class="std std-ref">Trusted Firmware-M</span></a></p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../modem_callbacks/README.html" class="btn btn-neutral float-right" title="nRF9160: Modem callbacks" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../lwm2m_client/provisioning.html" class="btn btn-neutral" title="Preparing for production" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">

<table>
<tr>
<td>
    <p>
        &copy; Copyright 2019-2023, Nordic Semiconductor.
      Last updated on Mar 20, 2023.

    </p>
</td>
<td id="nordiclogo">
  <a href="https://www.nordicsemi.com/"><img src="../../../_static/images/nordic-logo.png" border="0"/></a>
</td>
</tr>
</table>
  </div> 


</footer>

<div id="scroll-container">
  <button type="button" id="scroll-btn" class="btn">
    <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="#fff"/></svg>
  </button>
</div>

<script>
  const scrollBtn = document.querySelector("#scroll-btn");

  document.addEventListener("scroll", () => {
    if (window.scrollY > 400) {
          scrollBtn.style.visibility = "visible";
      } else {
          scrollBtn.style.visibility = "hidden";
      }
  });

  scrollBtn.addEventListener("click", () => {
      window.scrollTo({ top: 0, behavior: "smooth" });
  });
</script>
        </div>
      </div>
    </section>
  </div>
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> nRF Connect SDK</span>
       <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      
      <div class="rst-other-version ncs">
        <a href="../../../../nrf/index.html">nRF Connect SDK</a>
      </div>
      
      <div class="rst-other-version nrfx">
        <a href="../../../../nrfx/index.html">nrfx</a>
      </div>
      
      <div class="rst-other-version nrfxlib">
        <a href="../../../../nrfxlib/README.html">nrfxlib</a>
      </div>
      
      <div class="rst-other-version zephyr">
        <a href="../../../../zephyr/index.html">Zephyr Project</a>
      </div>
      
      <div class="rst-other-version mcuboot">
        <a href="../../../../mcuboot/wrapper.html">MCUboot</a>
      </div>
      
      <div class="rst-other-version tfm">
        <a href="../../../../tfm/index.html">Trusted Firmware-M</a>
      </div>
      
      <div class="rst-other-version matter">
        <a href="../../../../matter/index.html">Matter</a>
      </div>
      
      <div class="rst-other-version kconfig">
        <a href="../../../../kconfig/index.html">Kconfig Reference</a>
      </div>
    </div>
  </div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>