<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>nRF9160: Azure IoT Hub &mdash; nRF Connect SDK 2.3.99 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/nordic.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/togglebutton.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/nrf.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/tabs.css" type="text/css" /> 
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
        <script src="https://www.googletagmanager.com/gtag/js?id=G-ZPVZRKFQJR"></script>
        <script src="../../../_static/js/ga-tracker.js"></script>
        <script data-culture="EN" id="CookieConsent" type="text/javascript" src="https://policy.app.cookieinformation.com/uc.js"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../../_static/togglebutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/js/theme.js"></script>
<script
  type="text/javascript"
  src="../../../_static/js/ncs.js"
></script>
<script src="../../../_static/js/bootstrap.bundle.min.js"></script>

    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="nRF9160: TLS cipher suites" href="../ciphersuites/README.html" />
    <link rel="prev" title="nRF9160: Azure FOTA" href="../azure_fota/README.html" />
<link
  href="../../../_static/css/bootstrap.min.css"
  rel="stylesheet"
/>
<link
  rel="shortcut icon"
  href="../../../_static/images/favicon.ico"
/>

</head>

<body class="wy-body-for-nav">
<div class="announcement"></div>
<div class="d-print-none ncs-header">
  <div class="container-xl ncs-header-top">
    <div class="row h-100">
      <div class="d-none d-md-block col-2">
        <div class="bg-white py-4 px-3 ml-2 ncs-header-logo">
          <img
            class="ncs-header-logo"
            src="../../../_static/images/nordic-logo.png"
            alt=""
          />
        </div>
      </div>
      <div
        class="col-8 col-md-7 pl-md-4 d-flex align-self-center justify-content-center"
      >
        <form class="w-75" action="../../../search.html" method="get">
          <div class="form-group">
            <input
              type="text"
              name="q"
              class="ncs-search-input form-control"
              placeholder="Search all docs..."
            />
          </div>
        </form>
      </div>
      <div class="col-4 col-md-3 d-md-block p-3 text-end">
        <div class="dropdown">
          <button
            class="btn dropdown-toggle ncs-btn-versions"
            type="button"
            id="dropdownMenuButton1"
            data-bs-toggle="dropdown"
            aria-expanded="false"
          >
            <span class="d-none d-md-inline">nRF Connect SDK</span>
            <span id="ncsversion" class="d-inline"></span>
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton"></div>
        </div>
      </div>
    </div>
  </div>
  <div class="ncs-header-nav">
    <div class="container-xl">
      <div class="row">
        <div class="col col-12 d-flex justify-content-center">
          <nav class="navbar navbar-dark navbar-expand-lg p-0">
            <span class="navbar-brand d-block d-lg-none py-2 pl-1"
              >Documentation sets</span
            >
            <button
              class="navbar-toggler"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#navbarNavAltMarkup"
              aria-controls="navbarNavAltMarkup"
              aria-expanded="false"
              aria-label="Toggle navigation"
            >
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
              <ul class="navbar-nav">
                <li class="nav-item active py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../nrf/index.html"
                    >nRF Connect SDK</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../nrfx/index.html"
                    >nrfx</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../nrfxlib/README.html"
                    >nrfxlib</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../zephyr/index.html"
                    >Zephyr Project</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../mcuboot/wrapper.html"
                    >MCUboot</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../tfm/index.html"
                    >Trusted Firmware-M</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../matter/index.html"
                    >Matter</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../kconfig/index.html"
                    >Kconfig Reference</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
              </ul>
            </div>
          </nav>
        </div>
      </div>
    </div>
  </div>
</div>

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> nRF Connect SDK
          </a>
              <div class="version">
                2.3.99
              </div>
<div id="searchbox" role="search">
  <div class="searchformwrapper">
    <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
  </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev_model.html">Development model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../app_dev.html">Application development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ecosystem_integration.html">Ecosystems integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nrf91.html">Working with nRF91 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nrf70.html">Working with nRF70 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nrf53.html">Working with nRF53 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nrf52.html">Working with nRF52 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../protocols.html">Protocols</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../applications.html">Applications</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../samples.html">Samples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../bl.html">Bluetooth samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../crypto.html">Cryptography samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../edge.html">Edge Impulse samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../gazell.html">Gazell samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../matter.html">Matter samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nfc.html">NFC samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nrf5340.html">nRF5340 samples</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../nrf9160.html">nRF9160 samples</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../at_client/README.html">nRF9160: AT Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../at_monitor/README.html">nRF9160: AT monitor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../aws_iot/README.html">nRF9160: AWS IoT</a></li>
<li class="toctree-l3"><a class="reference internal" href="../azure_fota/README.html">nRF9160: Azure FOTA</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">nRF9160: Azure IoT Hub</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#requirements">Requirements</a></li>
<li class="toctree-l4"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#building-and-running">Building and running</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dependencies">Dependencies</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../ciphersuites/README.html">nRF9160: TLS cipher suites</a></li>
<li class="toctree-l3"><a class="reference internal" href="../coap_client/README.html">nRF9160: nRF CoAP Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../download/README.html">nRF9160: Download client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../fmfu_smp_svr/README.html">nRF9160: Full modem firmware update using SMP Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="../gnss/README.html">nRF9160: GNSS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../https_client/README.html">nRF9160: HTTPS Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../location/README.html">nRF9160: Location</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lte_ble_gateway/README.html">nRF9160: LTE Sensor Gateway</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lwm2m_carrier/README.html">nRF9160: LwM2M carrier</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lwm2m_client/README.html">nRF9160: LwM2M Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../memfault/README.html">nRF9160: Memfault</a></li>
<li class="toctree-l3"><a class="reference internal" href="../modem_callbacks/README.html">nRF9160: Modem callbacks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../modem_shell/README.html">nRF9160: Modem Shell</a></li>
<li class="toctree-l3"><a class="reference internal" href="../modem_trace_backend/README.html">nRF9160: Modem trace backend</a></li>
<li class="toctree-l3"><a class="reference internal" href="../modem_trace_flash/README.html">nRF9160: Modem trace external flash backend</a></li>
<li class="toctree-l3"><a class="reference internal" href="../nidd/README.html">nRF9160: NIDD</a></li>
<li class="toctree-l3"><a class="reference internal" href="../nrf_cloud_mqtt_multi_service/README.html">nRF9160: nRF Cloud MQTT multi-service</a></li>
<li class="toctree-l3"><a class="reference internal" href="../nrf_cloud_rest_cell_location/README.html">nRF9160: nRF Cloud REST cellular location</a></li>
<li class="toctree-l3"><a class="reference internal" href="../nrf_cloud_rest_device_message/README.html">nRF9160: nRF Cloud REST Device Message</a></li>
<li class="toctree-l3"><a class="reference internal" href="../nrf_cloud_rest_fota/README.html">nRF9160: nRF Cloud REST FOTA</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pdn/README.html">nRF9160: PDN</a></li>
<li class="toctree-l3"><a class="reference internal" href="../slm_shell/README.html">nRF9160: SLM Shell</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sms/README.html">nRF9160: SMS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../udp/README.html">nRF9160: UDP</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../net/mqtt/README.html">MQTT</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http_update/application_update/README.html">nRF9160: HTTP application update</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http_update/full_modem_update/README.html">nRF9160: HTTP full modem update</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http_update/modem_delta_update/README.html">nRF9160: HTTP modem delta update</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../tfm.html">Trusted Firmware-M (TF-M) samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../thread.html">Thread samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../zigbee.html">Zigbee samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../wifi.html">Wi-Fi samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../other.html">Other samples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../drivers.html">Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../libraries/index.html">Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../scripts.html">Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../release_notes.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../known_issues.html">Known issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../software_maturity.html">Software maturity levels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation.html">About this documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">nRF Connect SDK</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../../../samples.html">Samples</a></li>
          <li class="breadcrumb-item"><a href="../../nrf9160.html">nRF9160 samples</a></li>
      <li class="breadcrumb-item active">nRF9160: Azure IoT Hub</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/samples/nrf9160/azure_iot_hub/README.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="nrf9160-azure-iot-hub">
<span id="azure-iot-hub"></span><h1>nRF9160: Azure IoT Hub<a class="headerlink" href="#nrf9160-azure-iot-hub" title="Permalink to this heading"></a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#requirements" id="id7">Requirements</a></p></li>
<li><p><a class="reference internal" href="#overview" id="id8">Overview</a></p></li>
<li><p><a class="reference internal" href="#configuration" id="id9">Configuration</a></p>
<ul>
<li><p><a class="reference internal" href="#setup" id="id10">Setup</a></p></li>
<li><p><a class="reference internal" href="#additional-configuration" id="id11">Additional configuration</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#building-and-running" id="id12">Building and running</a></p>
<ul>
<li><p><a class="reference internal" href="#testing" id="id13">Testing</a></p></li>
<li><p><a class="reference internal" href="#sample-output" id="id14">Sample output</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#dependencies" id="id15">Dependencies</a></p></li>
</ul>
</div>
<p>The Azure IoT Hub sample shows the communication of an nRF9160-based device with an <a class="reference external" href="https://docs.microsoft.com/en-us/azure/iot-hub/">Azure IoT Hub</a> instance.
This sample uses the <a class="reference internal" href="../../../libraries/networking/azure_iot_hub.html#lib-azure-iot-hub"><span class="std std-ref">Azure IoT Hub</span></a> library to communicate with the IoT hub.</p>
<section id="requirements">
<h2><a class="toc-backref" href="#id7">Requirements</a><a class="headerlink" href="#requirements" title="Permalink to this heading"></a></h2>
<p>The sample supports the following development kits:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 28%" />
<col style="width: 8%" />
<col style="width: 42%" />
<col style="width: 23%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Hardware platforms</p></th>
<th class="head"><p>PCA</p></th>
<th class="head"><p>Board name</p></th>
<th class="head"><p>Build target</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference internal" href="../../../working_with_nrf/nrf91/nrf9160.html#ug-nrf9160"><span class="std std-ref">nRF9160 DK</span></a></p></td>
<td><p>PCA10090</p></td>
<td><p><span class="xref std std-ref">nrf9160dk_nrf9160</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">nrf9160dk_nrf9160_ns</span></code></p></td>
</tr>
</tbody>
</table>
<p>When built for an <code class="docutils literal notranslate"><span class="pre">_ns</span></code> build target, the sample is configured to compile and run as a non-secure application with <a class="reference internal" href="../../../app_dev/board_support/index.html#app-boards-spe-nspe-cpuapp-ns"><span class="std std-ref">Cortex-M Security Extensions enabled</span></a>.
Therefore, it automatically includes <a class="reference internal" href="../../../app_dev/tfm/index.html#ug-tfm"><span class="std std-ref">Trusted Firmware-M</span></a> that prepares the required peripherals and secure services to be available for the application.</p>
</section>
<section id="overview">
<h2><a class="toc-backref" href="#id8">Overview</a><a class="headerlink" href="#overview" title="Permalink to this heading"></a></h2>
<p>The sample supports the direct connection of an IoT device that is already registered to an Azure IoT Hub instance.
Alternatively, it supports the provisioning of the device using <a class="reference external" href="https://docs.microsoft.com/en-us/azure/iot-dps/">Azure IoT Hub Device Provisioning Service (DPS)</a> to an IoT hub.
See the documentation on <a class="reference internal" href="../../../libraries/networking/azure_iot_hub.html#lib-azure-iot-hub"><span class="std std-ref">Azure IoT Hub</span></a> library for more information.</p>
<p>The sample periodically publishes telemetry messages (events) to the connected Azure IoT Hub instance.
By default, telemetry messages are sent every 20 seconds.
To configure the default interval, set the device twin property <code class="docutils literal notranslate"><span class="pre">desired.telemetryInterval</span></code>, which will be interpreted by the sample as seconds.
Here is an example of a telemetry message:</p>
<div class="highlight highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;temperature&quot;</span><span class="p">:</span> <span class="mf">25.2</span><span class="p">,</span>
  <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="mi">151325</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In a telemetry message, <code class="docutils literal notranslate"><span class="pre">temperature</span></code> is a value between <code class="docutils literal notranslate"><span class="pre">25.0</span></code> and <code class="docutils literal notranslate"><span class="pre">25.9</span></code>, and <code class="docutils literal notranslate"><span class="pre">timestamp</span></code> is the uptime of the device in milliseconds.</p>
<p>The sample has implemented the handling of <a class="reference external" href="https://docs.microsoft.com/en-us/azure/iot-hub/iot-hub-devguide-direct-methods">Azure IoT Hub direct method</a> with the name <code class="docutils literal notranslate"><span class="pre">led</span></code>.
If the device receives a direct method invocation with the name <code class="docutils literal notranslate"><span class="pre">led</span></code> and payload <code class="docutils literal notranslate"><span class="pre">1</span></code> or <code class="docutils literal notranslate"><span class="pre">0</span></code>, LED 1 on the device is turned on or off, depending on the payload.
On Thingy:91, the LED turns red if the payload is <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p>
</section>
<section id="configuration">
<h2><a class="toc-backref" href="#id9">Configuration</a><a class="headerlink" href="#configuration" title="Permalink to this heading"></a></h2>
<p>See <a class="reference internal" href="../../../getting_started/modifying.html#configure-application"><span class="std std-ref">Configuring your application</span></a> for information about how to permanently or temporarily change the configuration.</p>
<section id="setup">
<h3><a class="toc-backref" href="#id10">Setup</a><a class="headerlink" href="#setup" title="Permalink to this heading"></a></h3>
<p>For the sample to work as intended, you must set up and configure an Azure IoT Hub instance.
See <a class="reference internal" href="#configure-options-azure-iot"><span class="std std-ref">Additional configuration</span></a> for information on the configuration options that you can use to create an Azure IoT Hub instance.
Also, for a successful TLS connection to the Azure IoT Hub instance, the device needs to have certificates provisioned.
See <a class="reference internal" href="../../../libraries/networking/azure_iot_hub.html#prereq-connect-to-azure-iot-hub"><span class="std std-ref">Prerequisites for connecting to Azure IoT Hub</span></a> for information on provisioning the certificates.</p>
</section>
<section id="additional-configuration">
<span id="configure-options-azure-iot"></span><h3><a class="toc-backref" href="#id11">Additional configuration</a><a class="headerlink" href="#additional-configuration" title="Permalink to this heading"></a></h3>
<p>Check and configure the following library options that are used by the sample:</p>
<ul class="simple">
<li><p><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_AZURE_IOT_HUB_DEVICE_ID</span></code> - Sets the Azure IoT Hub device ID. Alternatively, the device ID can be provided at run time.</p></li>
<li><p><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_AZURE_IOT_HUB_HOSTNAME</span></code> - Sets the Azure IoT Hub host name. If DPS is used, the sample assumes that the IoT hub host name is unknown, and the configuration is ignored. The configuration can also be omitted and the hostname provided at run time.</p></li>
</ul>
<p>If DPS is used, use the Kconfig fragment found in the <code class="file docutils literal notranslate"><span class="pre">overlay-dps.conf</span></code> file and change the desired configurations there.
As an example, the following compiles with DPS for nRF9160DK:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">west build -p -b nrf9160dk_nrf9160_ns -- -DOVERLAY_CONFIG=overlay-dps.conf</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_AZURE_IOT_HUB_DPS</span></code> - Enables Azure IoT Hub DPS.</p></li>
<li><p><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_AZURE_IOT_HUB_DPS_REG_ID</span></code> - Sets the Azure IoT Hub DPS registration ID. It can be provided at run time. By default, the sample uses the device ID as the registration ID and sets it at run time.</p></li>
<li><p><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_AZURE_IOT_HUB_DPS_ID_SCOPE</span></code> - Sets the DPS ID scope of the Azure IoT Hub. This can be provided at run time.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The sample sets the option <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_MQTT_KEEPALIVE</span></code> to the maximum allowed value, 1767 seconds (29.45 minutes) as specified by Azure IoT Hub.
This is to limit the IP traffic between the device and the Azure IoT Hub message broker for supporting a low power sample.
In certain LTE networks, the NAT timeout can be considerably lower than 1767 seconds.
As a recommendation, and to prevent the likelihood of getting disconnected unexpectedly, set the option <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_MQTT_KEEPALIVE</span></code> to the lowest timeout limit (Maximum allowed MQTT keepalive and NAT timeout).</p>
</div>
</section>
</section>
<section id="building-and-running">
<h2><a class="toc-backref" href="#id12">Building and running</a><a class="headerlink" href="#building-and-running" title="Permalink to this heading"></a></h2>
<p>This sample can be found under <code class="file docutils literal notranslate"><span class="pre">samples/nrf9160/azure_iot_hub</span></code> in the nRF Connect SDK folder structure.</p>
<p>When built as firmware image for the <code class="docutils literal notranslate"><span class="pre">_ns</span></code> build target, the sample has Cortex-M Security Extensions (CMSE) enabled and separates the firmware between Non-Secure Processing Environment (NSPE) and Secure Processing Environment (SPE).
Because of this, it automatically includes the <a class="reference internal" href="../../../app_dev/tfm/index.html#ug-tfm"><span class="std std-ref">Trusted Firmware-M (TF-M)</span></a>.
To read more about CMSE, see <a class="reference internal" href="../../../app_dev/board_support/index.html#app-boards-spe-nspe"><span class="std std-ref">Processing environments</span></a>.</p>
<p>To build the sample with Visual Studio Code, follow the steps listed on the <a class="reference external" href="https://nrfconnect.github.io/vscode-nrf-connect/get_started/build_app_ncs.html">How to build an application</a> page in the nRF Connect for VS Code extension documentation.
See <a class="reference internal" href="../../../getting_started/programming.html#gs-programming"><span class="std std-ref">Building and programming an application</span></a> for other building and programming scenarios and <a class="reference internal" href="../../../getting_started/testing.html#gs-testing"><span class="std std-ref">Testing and debugging an application</span></a> for general information about testing and debugging in the nRF Connect SDK.</p>
<section id="testing">
<h3><a class="toc-backref" href="#id13">Testing</a><a class="headerlink" href="#testing" title="Permalink to this heading"></a></h3>
<p>Microsoft has created <a class="reference external" href="https://docs.microsoft.com/en-us/azure/iot-pnp/howto-use-iot-explorer">Azure IoT Explorer</a> to interact and test devices connected to an Azure IoT Hub instance.
Optionally, follow the instructions at <a class="reference external" href="https://docs.microsoft.com/en-us/azure/iot-pnp/howto-use-iot-explorer">Azure IoT Explorer</a> to install and configure the tool and use it as mentioned in the below instructions.</p>
<p>After programming the sample to your development kit, complete the following steps to test it:</p>
<ol class="arabic simple">
<li><p>Connect the kit to the computer using a USB cable.
The kit is assigned a COM port (Windows) or ttyACM device (Linux), which is visible in the Device Manager.</p></li>
<li><p>Connect to the kit with a terminal emulator (for example, PuTTY).
See <a class="reference internal" href="../../../getting_started/testing.html#putty"><span class="std std-ref">How to connect with PuTTY</span></a> for the required settings.</p></li>
<li><p>Reset the development kit.</p></li>
<li><p>Observe the log output and verify that it is similar to the <a class="reference internal" href="#sampoutput-azure-iot"><span class="std std-ref">Sample output</span></a>.</p></li>
<li><p>Use the <a class="reference external" href="https://docs.microsoft.com/en-us/azure/iot-pnp/howto-use-iot-explorer">Azure IoT Explorer</a>, or log in to the <a class="reference external" href="https://portal.azure.com/">Azure Portal</a>.</p></li>
<li><p>Select the connected IoT hub and then your device.</p></li>
<li><p>Change the device twin’s <em>desired</em> property <code class="docutils literal notranslate"><span class="pre">telemetryInterval</span></code> to a new value, for instance <code class="docutils literal notranslate"><span class="pre">60</span></code>, and save the updated device twin.
If it does not exist, you can add the <em>desired</em> property.</p></li>
<li><p>Observe that the device receives the updated <code class="docutils literal notranslate"><span class="pre">telemetryInterval</span></code> value, applies it, and starts sending new telemetry events every 10 seconds.</p></li>
<li><p>Verify that the <code class="docutils literal notranslate"><span class="pre">reported</span></code> object in the device twin now has a <code class="docutils literal notranslate"><span class="pre">telemetryInterval</span></code> property with the correct value reported back from the device.</p></li>
<li><p>In the <a class="reference external" href="https://docs.microsoft.com/en-us/azure/iot-pnp/howto-use-iot-explorer">Azure IoT Explorer</a> or device page in <a class="reference external" href="https://portal.azure.com/">Azure Portal</a>, navigate to the <span class="guilabel">Direct method</span> tab.</p></li>
<li><p>Enter <code class="docutils literal notranslate"><span class="pre">led</span></code> as the method name. In the <strong>payload</strong> field, enter the value <code class="docutils literal notranslate"><span class="pre">1</span></code> (or <code class="docutils literal notranslate"><span class="pre">0</span></code>) and click <span class="guilabel">Invoke method</span>.</p></li>
<li><p>Observe that <strong>LED 1</strong> on the development kit lights up (or switches off if <code class="docutils literal notranslate"><span class="pre">0</span></code> is entered as the payload).
If you are using <a class="reference external" href="https://docs.microsoft.com/en-us/azure/iot-pnp/howto-use-iot-explorer">Azure IoT Explorer</a>, you can observe a notification in the top right corner stating if the direct method was successfully invoked based on the report received from the device.</p></li>
<li><p>In the <a class="reference external" href="https://docs.microsoft.com/en-us/azure/iot-pnp/howto-use-iot-explorer">Azure IoT Explorer</a>, navigate to the <span class="guilabel">Telemetry</span> tab and click <span class="guilabel">start</span>.</p></li>
<li><p>Observe that the event messages from the device are displayed in the terminal within the specified telemetry interval.</p></li>
</ol>
</section>
<section id="sample-output">
<span id="sampoutput-azure-iot"></span><h3><a class="toc-backref" href="#id14">Sample output</a><a class="headerlink" href="#sample-output" title="Permalink to this heading"></a></h3>
<p>When the sample runs, the device boots, and the sample displays the following output in the terminal over UART:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">*** Booting Zephyr OS build v2.3.0-rc1-ncs1-1453-gf41496cd30d5  ***</span>
<span class="go">&lt;inf&gt; azure_iot_hub_sample: Azure IoT Hub sample started</span>
<span class="go">&lt;inf&gt; azure_iot_hub_sample: Connecting to LTE network</span>
<span class="go">&lt;inf&gt; azure_iot_hub_sample: Connected to LTE network</span>
<span class="go">&lt;inf&gt; azure_iot_hub_sample: AZURE_IOT_HUB_EVT_CONNECTING</span>
<span class="go">&lt;inf&gt; azure_iot_hub_sample: AZURE_IOT_HUB_EVT_CONNECTED</span>
<span class="go">&lt;inf&gt; azure_iot_hub_sample: AZURE_IOT_HUB_EVT_READY</span>
<span class="go">&lt;inf&gt; azure_iot_hub_sample: AZURE_IOT_HUB_EVT_TWIN_RECEIVED</span>
<span class="go">&lt;inf&gt; azure_iot_hub_sample: Sending event:</span>
<span class="go">&lt;inf&gt; azure_iot_hub_sample: {&quot;temperature&quot;:25.9,&quot;timestamp&quot;:16849}</span>
<span class="go">&lt;inf&gt; azure_iot_hub_sample: Event was successfully sent</span>
<span class="go">&lt;inf&gt; azure_iot_hub_sample: Next event will be sent in 60 seconds</span>
</pre></div>
</div>
<p>If a new telemetry interval is set in the device twin, the console output is like this:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">&lt;inf&gt; azure_iot_hub_sample: AZURE_IOT_HUB_EVT_TWIN_DESIRED_RECEIVED</span>
<span class="go">&lt;inf&gt; azure_iot_hub_sample: New telemetry interval has been applied: 60</span>
<span class="go">&lt;inf&gt; azure_iot_hub_sample: AZURE_IOT_HUB_EVT_TWIN_RESULT_SUCCESS, ID: 42740</span>
<span class="go">&lt;inf&gt; azure_iot_hub_sample: Sending event:</span>
<span class="go">&lt;inf&gt; azure_iot_hub_sample: {&quot;temperature&quot;:25.5,&quot;timestamp&quot;:47585}</span>
<span class="go">&lt;inf&gt; azure_iot_hub_sample: Event was successfully sent</span>
<span class="go">&lt;inf&gt; azure_iot_hub_sample: Next event will be sent in 60 seconds</span>
</pre></div>
</div>
</section>
</section>
<section id="dependencies">
<h2><a class="toc-backref" href="#id15">Dependencies</a><a class="headerlink" href="#dependencies" title="Permalink to this heading"></a></h2>
<p>This sample uses the following nRF Connect SDK libraries and drivers:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../../libraries/networking/azure_iot_hub.html#lib-azure-iot-hub"><span class="std std-ref">Azure IoT Hub</span></a></p></li>
<li><p><a class="reference internal" href="../../../libraries/modem/lte_lc.html#lte-lc-readme"><span class="std std-ref">LTE link controller</span></a></p></li>
</ul>
<p>It uses the following <a class="reference external" href="https://github.com/nrfconnect/sdk-nrfxlib">sdk-nrfxlib</a> library:</p>
<ul class="simple">
<li><p><span class="xref std std-ref">nrfxlib:nrf_modem</span></p></li>
</ul>
<p>In addition, it uses the following secure firmware component:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../../app_dev/tfm/index.html#ug-tfm"><span class="std std-ref">Trusted Firmware-M</span></a></p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../ciphersuites/README.html" class="btn btn-neutral float-right" title="nRF9160: TLS cipher suites" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../azure_fota/README.html" class="btn btn-neutral" title="nRF9160: Azure FOTA" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">

<table>
<tr>
<td>
    <p>
        &copy; Copyright 2019-2023, Nordic Semiconductor.
      Last updated on Mar 20, 2023.

    </p>
</td>
<td id="nordiclogo">
  <a href="https://www.nordicsemi.com/"><img src="../../../_static/images/nordic-logo.png" border="0"/></a>
</td>
</tr>
</table>
  </div> 


</footer>

<div id="scroll-container">
  <button type="button" id="scroll-btn" class="btn">
    <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="#fff"/></svg>
  </button>
</div>

<script>
  const scrollBtn = document.querySelector("#scroll-btn");

  document.addEventListener("scroll", () => {
    if (window.scrollY > 400) {
          scrollBtn.style.visibility = "visible";
      } else {
          scrollBtn.style.visibility = "hidden";
      }
  });

  scrollBtn.addEventListener("click", () => {
      window.scrollTo({ top: 0, behavior: "smooth" });
  });
</script>
        </div>
      </div>
    </section>
  </div>
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> nRF Connect SDK</span>
       <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      
      <div class="rst-other-version ncs">
        <a href="../../../../nrf/index.html">nRF Connect SDK</a>
      </div>
      
      <div class="rst-other-version nrfx">
        <a href="../../../../nrfx/index.html">nrfx</a>
      </div>
      
      <div class="rst-other-version nrfxlib">
        <a href="../../../../nrfxlib/README.html">nrfxlib</a>
      </div>
      
      <div class="rst-other-version zephyr">
        <a href="../../../../zephyr/index.html">Zephyr Project</a>
      </div>
      
      <div class="rst-other-version mcuboot">
        <a href="../../../../mcuboot/wrapper.html">MCUboot</a>
      </div>
      
      <div class="rst-other-version tfm">
        <a href="../../../../tfm/index.html">Trusted Firmware-M</a>
      </div>
      
      <div class="rst-other-version matter">
        <a href="../../../../matter/index.html">Matter</a>
      </div>
      
      <div class="rst-other-version kconfig">
        <a href="../../../../kconfig/index.html">Kconfig Reference</a>
      </div>
    </div>
  </div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>