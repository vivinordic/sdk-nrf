<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TF-M: PSA template &mdash; nRF Connect SDK 2.3.99 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/nordic.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/togglebutton.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/nrf.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/tabs.css" type="text/css" /> 
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
        <script src="https://www.googletagmanager.com/gtag/js?id=G-ZPVZRKFQJR"></script>
        <script src="../../../_static/js/ga-tracker.js"></script>
        <script data-culture="EN" id="CookieConsent" type="text/javascript" src="https://policy.app.cookieinformation.com/uc.js"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../../_static/togglebutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/js/theme.js"></script>
<script
  type="text/javascript"
  src="../../../_static/js/ncs.js"
></script>
<script src="../../../_static/js/bootstrap.bundle.min.js"></script>

    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="TF-M secure peripheral partition" href="../tfm_secure_peripheral/README.html" />
    <link rel="prev" title="TF-M Hello World" href="../tfm_hello_world/README.html" />
<link
  href="../../../_static/css/bootstrap.min.css"
  rel="stylesheet"
/>
<link
  rel="shortcut icon"
  href="../../../_static/images/favicon.ico"
/>

</head>

<body class="wy-body-for-nav">
<div class="announcement"></div>
<div class="d-print-none ncs-header">
  <div class="container-xl ncs-header-top">
    <div class="row h-100">
      <div class="d-none d-md-block col-2">
        <div class="bg-white py-4 px-3 ml-2 ncs-header-logo">
          <img
            class="ncs-header-logo"
            src="../../../_static/images/nordic-logo.png"
            alt=""
          />
        </div>
      </div>
      <div
        class="col-8 col-md-7 pl-md-4 d-flex align-self-center justify-content-center"
      >
        <form class="w-75" action="../../../search.html" method="get">
          <div class="form-group">
            <input
              type="text"
              name="q"
              class="ncs-search-input form-control"
              placeholder="Search all docs..."
            />
          </div>
        </form>
      </div>
      <div class="col-4 col-md-3 d-md-block p-3 text-end">
        <div class="dropdown">
          <button
            class="btn dropdown-toggle ncs-btn-versions"
            type="button"
            id="dropdownMenuButton1"
            data-bs-toggle="dropdown"
            aria-expanded="false"
          >
            <span class="d-none d-md-inline">nRF Connect SDK</span>
            <span id="ncsversion" class="d-inline"></span>
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton"></div>
        </div>
      </div>
    </div>
  </div>
  <div class="ncs-header-nav">
    <div class="container-xl">
      <div class="row">
        <div class="col col-12 d-flex justify-content-center">
          <nav class="navbar navbar-dark navbar-expand-lg p-0">
            <span class="navbar-brand d-block d-lg-none py-2 pl-1"
              >Documentation sets</span
            >
            <button
              class="navbar-toggler"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#navbarNavAltMarkup"
              aria-controls="navbarNavAltMarkup"
              aria-expanded="false"
              aria-label="Toggle navigation"
            >
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
              <ul class="navbar-nav">
                <li class="nav-item active py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../nrf/index.html"
                    >nRF Connect SDK</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../nrfx/index.html"
                    >nrfx</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../nrfxlib/README.html"
                    >nrfxlib</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../zephyr/index.html"
                    >Zephyr Project</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../mcuboot/wrapper.html"
                    >MCUboot</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../tfm/index.html"
                    >Trusted Firmware-M</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../matter/index.html"
                    >Matter</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../kconfig/index.html"
                    >Kconfig Reference</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
              </ul>
            </div>
          </nav>
        </div>
      </div>
    </div>
  </div>
</div>

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> nRF Connect SDK
          </a>
              <div class="version">
                2.3.99
              </div>
<div id="searchbox" role="search">
  <div class="searchformwrapper">
    <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
  </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev_model.html">Development model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../app_dev.html">Application development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ecosystem_integration.html">Ecosystems integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nrf91.html">Working with nRF91 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nrf70.html">Working with nRF70 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nrf53.html">Working with nRF53 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nrf52.html">Working with nRF52 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../protocols.html">Protocols</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../applications.html">Applications</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../samples.html">Samples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../bl.html">Bluetooth samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../crypto.html">Cryptography samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../edge.html">Edge Impulse samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../gazell.html">Gazell samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../matter.html">Matter samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nfc.html">NFC samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nrf5340.html">nRF5340 samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nrf9160.html">nRF9160 samples</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../tfm.html">Trusted Firmware-M (TF-M) samples</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../provisioning_image/README.html">Provisioning image</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tfm_hello_world/README.html">TF-M Hello World</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">TF-M: PSA template</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#requirements">Requirements</a></li>
<li class="toctree-l4"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#building-and-running">Building and running</a></li>
<li class="toctree-l4"><a class="reference internal" href="#firmware-update">Firmware update</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dependencies">Dependencies</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../tfm_secure_peripheral/README.html">TF-M secure peripheral partition</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tests/tfm/tfm_psa_test/README.html">TF-M: Platform security architecture test</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tests/tfm/tfm_regression_test/README.html">TF-M: Regression tests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../thread.html">Thread samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../zigbee.html">Zigbee samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../wifi.html">Wi-Fi samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../other.html">Other samples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../drivers.html">Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../libraries/index.html">Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../scripts.html">Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../release_notes.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../known_issues.html">Known issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../software_maturity.html">Software maturity levels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation.html">About this documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">nRF Connect SDK</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../../../samples.html">Samples</a></li>
          <li class="breadcrumb-item"><a href="../../tfm.html">Trusted Firmware-M (TF-M) samples</a></li>
      <li class="breadcrumb-item active">TF-M: PSA template</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/samples/tfm/tfm_psa_template/README.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="tf-m-psa-template">
<span id="tfm-psa-template"></span><h1>TF-M: PSA template<a class="headerlink" href="#tf-m-psa-template" title="Permalink to this heading"></a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#requirements" id="id6">Requirements</a></p></li>
<li><p><a class="reference internal" href="#overview" id="id7">Overview</a></p></li>
<li><p><a class="reference internal" href="#building-and-running" id="id8">Building and running</a></p>
<ul>
<li><p><a class="reference internal" href="#testing" id="id9">Testing</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#firmware-update" id="id10">Firmware update</a></p>
<ul>
<li><p><a class="reference internal" href="#application-and-tf-m-firmware-update" id="id11">Application and TF-M firmware update</a></p></li>
<li><p><a class="reference internal" href="#bootloader-firmware-update" id="id12">Bootloader firmware update</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#dependencies" id="id13">Dependencies</a></p></li>
</ul>
</div>
<p>This sample provides a template for Arm Platform Security Architecture (PSA) best practices on nRF devices.</p>
<section id="requirements">
<h2><a class="toc-backref" href="#id6">Requirements</a><a class="headerlink" href="#requirements" title="Permalink to this heading"></a></h2>
<p>The sample supports the following development kits:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 27%" />
<col style="width: 7%" />
<col style="width: 39%" />
<col style="width: 27%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Hardware platforms</p></th>
<th class="head"><p>PCA</p></th>
<th class="head"><p>Board name</p></th>
<th class="head"><p>Build target</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference internal" href="../../../working_with_nrf/nrf91/nrf9160.html#ug-nrf9160"><span class="std std-ref">nRF9160 DK</span></a></p></td>
<td><p>PCA10090</p></td>
<td><p><span class="xref std std-ref">nrf9160dk_nrf9160</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">nrf9160dk_nrf9160_ns</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../../../working_with_nrf/nrf53/nrf5340.html#ug-nrf5340"><span class="std std-ref">nRF5340 DK</span></a></p></td>
<td><p>PCA10095</p></td>
<td><p><span class="xref std std-ref">nrf5340dk_nrf5340</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">nrf5340dk_nrf5340_cpuapp_ns</span></code></p></td>
</tr>
</tbody>
</table>
<p>When built for an <code class="docutils literal notranslate"><span class="pre">_ns</span></code> build target, the sample is configured to compile and run as a non-secure application with <a class="reference internal" href="../../../app_dev/board_support/index.html#app-boards-spe-nspe-cpuapp-ns"><span class="std std-ref">Cortex-M Security Extensions enabled</span></a>.
Therefore, it automatically includes <a class="reference internal" href="../../../app_dev/tfm/index.html#ug-tfm"><span class="std std-ref">Trusted Firmware-M</span></a> that prepares the required peripherals and secure services to be available for the application.</p>
</section>
<section id="overview">
<h2><a class="toc-backref" href="#id7">Overview</a><a class="headerlink" href="#overview" title="Permalink to this heading"></a></h2>
<p>This sample uses Trusted Firmware-M, nRF Secure Immutable bootloader and MCUboot to demonstrate how to implement the best practices that comply with the Arm PSA requirements.
It includes provisioning the device with keys and being able to perform a device firmware update.
The sample prints information about the identity of the device and the firmware versions that are currently running.</p>
</section>
<section id="building-and-running">
<h2><a class="toc-backref" href="#id8">Building and running</a><a class="headerlink" href="#building-and-running" title="Permalink to this heading"></a></h2>
<p>This sample can be found under <code class="file docutils literal notranslate"><span class="pre">samples/tfm/tfm_psa_template</span></code> in the nRF Connect SDK folder structure.</p>
<p>When built as firmware image for the <code class="docutils literal notranslate"><span class="pre">_ns</span></code> build target, the sample has Cortex-M Security Extensions (CMSE) enabled and separates the firmware between Non-Secure Processing Environment (NSPE) and Secure Processing Environment (SPE).
Because of this, it automatically includes the <a class="reference internal" href="../../../app_dev/tfm/index.html#ug-tfm"><span class="std std-ref">Trusted Firmware-M (TF-M)</span></a>.
To read more about CMSE, see <a class="reference internal" href="../../../app_dev/board_support/index.html#app-boards-spe-nspe"><span class="std std-ref">Processing environments</span></a>.</p>
<p>To build the sample with Visual Studio Code, follow the steps listed on the <a class="reference external" href="https://nrfconnect.github.io/vscode-nrf-connect/get_started/build_app_ncs.html">How to build an application</a> page in the nRF Connect for VS Code extension documentation.
See <a class="reference internal" href="../../../getting_started/programming.html#gs-programming"><span class="std std-ref">Building and programming an application</span></a> for other building and programming scenarios and <a class="reference internal" href="../../../getting_started/testing.html#gs-testing"><span class="std std-ref">Testing and debugging an application</span></a> for general information about testing and debugging in the nRF Connect SDK.</p>
<p>The sample requires that the device is provisioned using the <a class="reference internal" href="../provisioning_image/README.html#provisioning-image"><span class="std std-ref">provisioning image</span></a> sample.
Build and flash the provisioning image sample to provision the device with the PSA root-of-trust security parameters.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">west build -b nrf5340dk_nrf5340_cpuapp nrf/samples/tfm/provisioning_image -d build_provisioning_image</span>
<span class="go">west flash --erase -d build_provisioning_image</span>
</pre></div>
</div>
<p>Build and flash the TF-M PSA template sample.
Do not flash with <code class="docutils literal notranslate"><span class="pre">--erase</span></code> as this will erase the PSA platform security parameters and they will be lost.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">west build -b nrf5340dk_nrf5340_cpuapp_ns nrf/samples/tfm/tfm_psa_template</span>
<span class="go">west flash</span>
</pre></div>
</div>
<section id="testing">
<h3><a class="toc-backref" href="#id9">Testing</a><a class="headerlink" href="#testing" title="Permalink to this heading"></a></h3>
<p>After programming the sample, the following output is displayed in the console:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">*** Booting Zephyr OS build v3.2.0-rc3-510-g7c71945d42f6  ***</span>
<span class="go">Attempting to boot slot 0.</span>
<span class="go">Attempting to boot from address 0x8200.</span>
<span class="go">Verifying signature against key 0.</span>
<span class="go">Hash: 0xde...4b</span>
<span class="go">Firmware signature verified.</span>
<span class="go">Firmware version 1</span>
<span class="go">*** Booting Zephyr OS build v3.2.0-rc3-510-g7c71945d42f6  ***</span>
<span class="go">I: Starting bootloader</span>
<span class="go">I: Swap type: none</span>
<span class="go">I: Swap type: none</span>
<span class="go">I: Bootloader chainload address offset: 0x28000</span>
<span class="go">*** Booting Zephyr OS build v3.2.0-rc3-510-g7c71945d42f6  ***</span>
<span class="go">build time: Nov  2 2022 16:26:33</span>

<span class="go">FW info S0:</span>
<span class="go">Magic: 0x281ee6de8fcebb4c00003502</span>
<span class="go">Total Size: 60</span>
<span class="go">Size: 0x00009658</span>
<span class="go">Version: 1</span>
<span class="go">address: 0x00008200</span>
<span class="go">boot address: 0x00008200</span>
<span class="go">Valid: 0x9102ffff (CONFIG_FW_INFO_VALID_VAL=0x9102ffff)</span>

<span class="go">FW info S1:</span>
<span class="go">Failed to retrieve fw_info for address 0x00018000</span>

<span class="go">Active slot: S0</span>

<span class="go">Requesting initial attestation token with 64 byte challenge</span>
<span class="go">Received initial attestation token of 360 bytes.</span>

<span class="go">0  1  2  3  4  5  6  7   8  9  A  B  C  D  E  F</span>
<span class="go">D2 84 43 A1 01 26 A0 59  01 1C AA 3A 00 01 24 FF  |  ..C..&amp;.Y...:..$.</span>
<span class="go">58 40 00 11 22 33 44 55  66 77 88 99 AA BB CC DD  |  X@..&quot;3DUfw......</span>
<span class="go">EE FF 00 11 22 33 44 55  66 77 88 99 AA BB CC DD  |  ....&quot;3DUfw......</span>
<span class="go">EE FF 00 11 22 33 44 55  66 77 88 99 AA BB CC DD  |  ....&quot;3DUfw......</span>
<span class="go">EE FF 00 11 22 33 44 55  66 77 88 99 AA BB CC DD  |  ....&quot;3DUfw......</span>
<span class="go">EE FF 3A 00 01 24 FB 58  20 26 0A 95 20 6B F8 17  |  ..:..$.X &amp;.. k..</span>
<span class="go">3C 65 E9 12 C1 7F 12 57  C2 26 85 56 0E 27 FE 37  |  &lt;e.....W.&amp;.V.&#39;.7</span>
<span class="go">90 B7 67 FD 07 86 D8 E5  3A 3A 00 01 25 00 58 21  |  ..g.....::..%.X!</span>
<span class="go">01 8B A0 C3 7E 96 62 29  C3 90 14 D9 E1 CF B6 6F  |  ....~.b).......o</span>
<span class="go">71 07 37 76 BF B8 E3 96  94 7D 09 1E 37 07 21 DB  |  q.7v.....}..7.!.</span>
<span class="go">84 3A 00 01 24 FA 58 20  AA AA AA AA AA AA AA AA  |  .:..$.X ........</span>
<span class="go">BB BB BB BB BB BB BB BB  CC CC CC CC CC CC CC CC  |  ................</span>
<span class="go">DD DD DD DD DD DD DD DD  3A 00 01 24 F8 20 3A 00  |  ........:..$. :.</span>
<span class="go">01 24 F9 19 30 00 3A 00  01 24 FE 01 3A 00 01 25  |  .$..0.:..$..:..%</span>
<span class="go">01 77 77 77 77 2E 74 72  75 73 74 65 64 66 69 72  |  .wwww.trustedfir</span>
<span class="go">6D 77 61 72 65 2E 6F 72  67 3A 00 01 24 F7 71 50  |  mware.org:..$.qP</span>
<span class="go">53 41 5F 49 4F 54 5F 50  52 4F 46 49 4C 45 5F 31  |  SA_IOT_PROFILE_1</span>
<span class="go">3A 00 01 24 FC 70 30 36  30 34 35 36 35 32 37 32  |  :..$.p0604565272</span>
<span class="go">38 32 39 31 30 30 58 40  BD 2F 65 4C 56 5A 9F 01  |  829100X@./eLVZ..</span>
<span class="go">F2 D4 9C FB F4 25 9D C5  11 D0 57 B6 23 F1 D9 99  |  .....%....W.#...</span>
<span class="go">2D A0 AC 39 F8 D8 39 A6  81 A7 E0 DC 8B BA A6 9F  |  -..9..9.........</span>
<span class="go">EB AE 50 55 C3 DD 1F 6A  FF E3 AB 98 5D CC 2F E9  |  ..PU...j....]./.</span>
<span class="go">54 77 40 BE D9 FF AE 7F                           |  Tw@.....</span>
</pre></div>
</div>
</section>
</section>
<section id="firmware-update">
<h2><a class="toc-backref" href="#id10">Firmware update</a><a class="headerlink" href="#firmware-update" title="Permalink to this heading"></a></h2>
<p>This sample supports firmware update of both the application and TF-M, and the second stage bootloader.</p>
<p>The firmware update process requires signature verification keys in order to sign the images used in the firmware update process.
The nRF Secure Immutable bootloader and MCUboot will use signing keys that should not be used in production.</p>
<p>Example on how to generate and use keys:</p>
<p>Generate security keys if needed:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">python3 bootloader/mcuboot/scripts/imgtool.py keygen -t ecdsa-p256 -k /home/user/ncs/_keys/mcuboot_priv.pem</span>
<span class="go">python3 bootloader/mcuboot/scripts/imgtool.py keygen -t ecdsa-p256 -k /home/user/ncs/_keys/nsib_priv.pem</span>
</pre></div>
</div>
<p>Update the <code class="docutils literal notranslate"><span class="pre">child_image/mcuboot/prj.conf</span></code> file to set the private signing key for MCUBoot:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">CONFIG_BOOT_SIGNATURE_KEY_FILE=&quot;/home/user/ncs/_keys/mcuboot_priv.pem&quot;</span>
<span class="go">CONFIG_BOOT_SIGNATURE_TYPE_RSA=n</span>
<span class="go">CONFIG_BOOT_SIGNATURE_TYPE_ECDSA_P256=y</span>
</pre></div>
</div>
<p>Update the <code class="docutils literal notranslate"><span class="pre">prj.conf</span></code> file to set the private signing key for NSIB:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">CONFIG_SB_SIGNING_KEY_FILE=&quot;/home/user/ncs/_keys/nsib_priv.pem&quot;</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="../../../app_dev/bootloaders_and_dfu/fw_update.html#ug-fw-update-keys"><span class="std std-ref">Signature keys</span></a> for more information on how to generate and use keys for a project.</p>
<p>The bootloader and the application can be updated using the <code class="file docutils literal notranslate"><span class="pre">mcumgr</span></code> command-line tool.
See <span class="xref std std-ref">smp_svr_sample</span> for installation and usage instructions.</p>
<section id="application-and-tf-m-firmware-update">
<h3><a class="toc-backref" href="#id11">Application and TF-M firmware update</a><a class="headerlink" href="#application-and-tf-m-firmware-update" title="Permalink to this heading"></a></h3>
<p>Use firmware update to update the application and TF-M firmware.
For the image to be updatable, the firmware image version <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_MCUBOOT_IMAGE_VERSION</span></code> has to be updated to a higher version.
See <a class="reference internal" href="../../../app_dev/bootloaders_and_dfu/fw_update.html#ug-fw-update-image-versions-mcuboot-downgrade"><span class="std std-ref">Software-based downgrade prevention</span></a> for information on downgrade protection in MCUboot.</p>
<p>To upload a new application image, build an application with an updated image version.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">west build -b nrf5340dk_nrf5340_cpuapp_ns nrf/samples/tfm/tfm_psa_template -d build_update \</span>
<span class="go">-DCONFIG_MCUBOOT_IMAGE_VERSION=\&quot;1.2.3\&quot;</span>
</pre></div>
</div>
<p>Then upload the new application image to the device.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">mcumgr --conntype serial --connstring dev=/dev/ttyACM2,baud=115200,mtu=512 image list</span>
<span class="go">mcumgr --conntype serial --connstring dev=/dev/ttyACM2,baud=115200,mtu=512 image upload \</span>
<span class="go">build_update/zephyr/app_update.bin</span>
</pre></div>
</div>
<p>Once the new application image is uploaded, the hash of the image is shown in the image list.
Flag the image to be tested on next reboot using its hash.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">mcumgr --conntype serial --connstring dev=/dev/ttyACM2,baud=115200,mtu=512 image list</span>
<span class="go">mcumgr --conntype serial --connstring dev=/dev/ttyACM2,baud=115200,mtu=512 image test &lt;hash&gt;</span>
</pre></div>
</div>
<p>Trigger the application update by initiating a reset.
The verification of the image will happen during the update process.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">mcumgr --conntype serial --connstring dev=/dev/ttyACM2,baud=115200,mtu=512 reset</span>
</pre></div>
</div>
</section>
<section id="bootloader-firmware-update">
<h3><a class="toc-backref" href="#id12">Bootloader firmware update</a><a class="headerlink" href="#bootloader-firmware-update" title="Permalink to this heading"></a></h3>
<p>To upload a new bootloader image, build a bootloader targeting the correct bootloader slot with an updated firmware image version.
The bootloader is placed in slot 0 by default, so enable building of the slot 1 bootloader.</p>
<blockquote>
<div><p>west build -b nrf5340dk_nrf5340_cpuapp_ns nrf/samples/tfm/tfm_psa_template -DCONFIG_BUILD_S1_VARIANT=y -Dmcuboot_CONFIG_FW_INFO_FIRMWARE_VERSION=2</p>
</div></blockquote>
<p>List the current firmware images and upload a bootloader image that targets the non-active bootloader slot.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">mcumgr --conntype serial --connstring dev=/dev/ttyACM2,baud=115200,mtu=512 image list</span>
<span class="go">mcumgr --conntype serial --connstring dev=/dev/ttyACM2,baud=115200,mtu=512 image upload \</span>
<span class="go">build/zephyr/signed_by_mcuboot_and_b0_s1_image_update.bin</span>
</pre></div>
</div>
<p>Once the new bootloader image is uploaded, the hash of the image is shown in the image list.
Flag the image to be tested on next reboot using its hash.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">mcumgr --conntype serial --connstring dev=/dev/ttyACM2,baud=115200,mtu=512 image list</span>
<span class="go">mcumgr --conntype serial --connstring dev=/dev/ttyACM2,baud=115200,mtu=512 image test &lt;hash&gt;</span>
</pre></div>
</div>
<p>Trigger the bootloader update by initiating a reset.
The verification of the image will happen during the update process.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">mcumgr --conntype serial --connstring dev=/dev/ttyACM2,baud=115200,mtu=512 reset</span>
</pre></div>
</div>
</section>
</section>
<section id="dependencies">
<h2><a class="toc-backref" href="#id13">Dependencies</a><a class="headerlink" href="#dependencies" title="Permalink to this heading"></a></h2>
<p>This sample uses the TF-M module that can be found in the following location in the nRF Connect SDK folder structure:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">modules/tee/tfm/</span></code></p></li>
</ul>
<p>This sample uses the following libraries:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../../libraries/tfm/tfm_ioctl_api.html#lib-tfm-ioctl-api"><span class="std std-ref">TF-M input/output control (IOCTL)</span></a></p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../tfm_secure_peripheral/README.html" class="btn btn-neutral float-right" title="TF-M secure peripheral partition" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../tfm_hello_world/README.html" class="btn btn-neutral" title="TF-M Hello World" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">

<table>
<tr>
<td>
    <p>
        &copy; Copyright 2019-2023, Nordic Semiconductor.
      Last updated on Mar 20, 2023.

    </p>
</td>
<td id="nordiclogo">
  <a href="https://www.nordicsemi.com/"><img src="../../../_static/images/nordic-logo.png" border="0"/></a>
</td>
</tr>
</table>
  </div> 


</footer>

<div id="scroll-container">
  <button type="button" id="scroll-btn" class="btn">
    <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="#fff"/></svg>
  </button>
</div>

<script>
  const scrollBtn = document.querySelector("#scroll-btn");

  document.addEventListener("scroll", () => {
    if (window.scrollY > 400) {
          scrollBtn.style.visibility = "visible";
      } else {
          scrollBtn.style.visibility = "hidden";
      }
  });

  scrollBtn.addEventListener("click", () => {
      window.scrollTo({ top: 0, behavior: "smooth" });
  });
</script>
        </div>
      </div>
    </section>
  </div>
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> nRF Connect SDK</span>
       <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      
      <div class="rst-other-version ncs">
        <a href="../../../../nrf/index.html">nRF Connect SDK</a>
      </div>
      
      <div class="rst-other-version nrfx">
        <a href="../../../../nrfx/index.html">nrfx</a>
      </div>
      
      <div class="rst-other-version nrfxlib">
        <a href="../../../../nrfxlib/README.html">nrfxlib</a>
      </div>
      
      <div class="rst-other-version zephyr">
        <a href="../../../../zephyr/index.html">Zephyr Project</a>
      </div>
      
      <div class="rst-other-version mcuboot">
        <a href="../../../../mcuboot/wrapper.html">MCUboot</a>
      </div>
      
      <div class="rst-other-version tfm">
        <a href="../../../../tfm/index.html">Trusted Firmware-M</a>
      </div>
      
      <div class="rst-other-version matter">
        <a href="../../../../matter/index.html">Matter</a>
      </div>
      
      <div class="rst-other-version kconfig">
        <a href="../../../../kconfig/index.html">Kconfig Reference</a>
      </div>
    </div>
  </div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>