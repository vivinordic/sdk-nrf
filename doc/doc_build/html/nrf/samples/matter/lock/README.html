<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Matter: Door lock &mdash; nRF Connect SDK 2.3.99 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/nordic.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/togglebutton.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/nrf.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/tabs.css" type="text/css" /> 
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
        <script src="https://www.googletagmanager.com/gtag/js?id=G-ZPVZRKFQJR"></script>
        <script src="../../../_static/js/ga-tracker.js"></script>
        <script data-culture="EN" id="CookieConsent" type="text/javascript" src="https://policy.app.cookieinformation.com/uc.js"></script>
        <script src="../../../_static/tabs.js"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../../_static/togglebutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/js/theme.js"></script>
<script
  type="text/javascript"
  src="../../../_static/js/ncs.js"
></script>
<script src="../../../_static/js/bootstrap.bundle.min.js"></script>

    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Matter: Template" href="../template/README.html" />
    <link rel="prev" title="Matter: Light switch" href="../light_switch/README.html" />
<link
  href="../../../_static/css/bootstrap.min.css"
  rel="stylesheet"
/>
<link
  rel="shortcut icon"
  href="../../../_static/images/favicon.ico"
/>

</head>

<body class="wy-body-for-nav">
<div class="announcement"></div>
<div class="d-print-none ncs-header">
  <div class="container-xl ncs-header-top">
    <div class="row h-100">
      <div class="d-none d-md-block col-2">
        <div class="bg-white py-4 px-3 ml-2 ncs-header-logo">
          <img
            class="ncs-header-logo"
            src="../../../_static/images/nordic-logo.png"
            alt=""
          />
        </div>
      </div>
      <div
        class="col-8 col-md-7 pl-md-4 d-flex align-self-center justify-content-center"
      >
        <form class="w-75" action="../../../search.html" method="get">
          <div class="form-group">
            <input
              type="text"
              name="q"
              class="ncs-search-input form-control"
              placeholder="Search all docs..."
            />
          </div>
        </form>
      </div>
      <div class="col-4 col-md-3 d-md-block p-3 text-end">
        <div class="dropdown">
          <button
            class="btn dropdown-toggle ncs-btn-versions"
            type="button"
            id="dropdownMenuButton1"
            data-bs-toggle="dropdown"
            aria-expanded="false"
          >
            <span class="d-none d-md-inline">nRF Connect SDK</span>
            <span id="ncsversion" class="d-inline"></span>
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton"></div>
        </div>
      </div>
    </div>
  </div>
  <div class="ncs-header-nav">
    <div class="container-xl">
      <div class="row">
        <div class="col col-12 d-flex justify-content-center">
          <nav class="navbar navbar-dark navbar-expand-lg p-0">
            <span class="navbar-brand d-block d-lg-none py-2 pl-1"
              >Documentation sets</span
            >
            <button
              class="navbar-toggler"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#navbarNavAltMarkup"
              aria-controls="navbarNavAltMarkup"
              aria-expanded="false"
              aria-label="Toggle navigation"
            >
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
              <ul class="navbar-nav">
                <li class="nav-item active py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../nrf/index.html"
                    >nRF Connect SDK</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../nrfx/index.html"
                    >nrfx</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../nrfxlib/README.html"
                    >nrfxlib</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../zephyr/index.html"
                    >Zephyr Project</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../mcuboot/wrapper.html"
                    >MCUboot</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../tfm/index.html"
                    >Trusted Firmware-M</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../matter/index.html"
                    >Matter</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../../kconfig/index.html"
                    >Kconfig Reference</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
              </ul>
            </div>
          </nav>
        </div>
      </div>
    </div>
  </div>
</div>

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> nRF Connect SDK
          </a>
              <div class="version">
                2.3.99
              </div>
<div id="searchbox" role="search">
  <div class="searchformwrapper">
    <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
  </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev_model.html">Development model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../app_dev.html">Application development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ecosystem_integration.html">Ecosystems integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nrf91.html">Working with nRF91 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nrf70.html">Working with nRF70 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nrf53.html">Working with nRF53 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nrf52.html">Working with nRF52 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../protocols.html">Protocols</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../applications.html">Applications</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../samples.html">Samples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../bl.html">Bluetooth samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../crypto.html">Cryptography samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../edge.html">Edge Impulse samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../gazell.html">Gazell samples</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../matter.html">Matter samples</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../light_bulb/README.html">Matter: Light bulb</a></li>
<li class="toctree-l3"><a class="reference internal" href="../light_switch/README.html">Matter: Light switch</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Matter: Door lock</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#requirements">Requirements</a></li>
<li class="toctree-l4"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#user-interface">User interface</a></li>
<li class="toctree-l4"><a class="reference internal" href="#building-and-running">Building and running</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dependencies">Dependencies</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../template/README.html">Matter: Template</a></li>
<li class="toctree-l3"><a class="reference internal" href="../window_covering/README.html">Matter: Window covering</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../nfc.html">NFC samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nrf5340.html">nRF5340 samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nrf9160.html">nRF9160 samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tfm.html">Trusted Firmware-M (TF-M) samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../thread.html">Thread samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../zigbee.html">Zigbee samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../wifi.html">Wi-Fi samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../other.html">Other samples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../drivers.html">Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../libraries/index.html">Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../scripts.html">Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../release_notes.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../known_issues.html">Known issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../software_maturity.html">Software maturity levels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation.html">About this documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">nRF Connect SDK</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../../../samples.html">Samples</a></li>
          <li class="breadcrumb-item"><a href="../../matter.html">Matter samples</a></li>
      <li class="breadcrumb-item active">Matter: Door lock</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/samples/matter/lock/README.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="matter-door-lock">
<span id="chip-lock-sample"></span><span id="matter-lock-sample"></span><h1>Matter: Door lock<a class="headerlink" href="#matter-door-lock" title="Permalink to this heading"></a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#requirements" id="id7">Requirements</a></p>
<ul>
<li><p><a class="reference internal" href="#ipv6-network-support" id="id8">IPv6 network support</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#overview" id="id9">Overview</a></p>
<ul>
<li><p><a class="reference internal" href="#remote-testing-in-a-network" id="id10">Remote testing in a network</a></p></li>
<li><p><a class="reference internal" href="#thread-and-wi-fi-switching" id="id11">Thread and Wi-Fi switching</a></p></li>
<li><p><a class="reference internal" href="#matter-bluetooth-le-with-nordic-uart-service" id="id12">Matter Bluetooth LE with Nordic UART Service</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#configuration" id="id13">Configuration</a></p>
<ul>
<li><p><a class="reference internal" href="#matter-door-lock-build-types" id="id14">Matter door lock build types</a></p></li>
<li><p><a class="reference internal" href="#device-firmware-upgrade-support" id="id15">Device Firmware Upgrade support</a></p></li>
<li><p><a class="reference internal" href="#fem-support" id="id16">FEM support</a></p></li>
<li><p><a class="reference internal" href="#enabling-matter-bluetooth-le-with-nordic-uart-service" id="id17">Enabling Matter Bluetooth LE with Nordic UART Service</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#user-interface" id="id18">User interface</a></p></li>
<li><p><a class="reference internal" href="#building-and-running" id="id19">Building and running</a></p>
<ul>
<li><p><a class="reference internal" href="#selecting-a-build-type" id="id20">Selecting a build type</a></p></li>
<li><p><a class="reference internal" href="#testing" id="id21">Testing</a></p></li>
<li><p><a class="reference internal" href="#enabling-remote-control" id="id22">Enabling remote control</a></p></li>
<li><p><a class="reference internal" href="#upgrading-the-device-firmware" id="id23">Upgrading the device firmware</a></p></li>
<li><p><a class="reference internal" href="#testing-switching-between-thread-and-wi-fi" id="id24">Testing switching between Thread and Wi-Fi</a></p></li>
<li><p><a class="reference internal" href="#testing-door-lock-using-bluetooth-le-with-nordic-uart-service" id="id25">Testing door lock using Bluetooth LE with Nordic UART Service</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#dependencies" id="id26">Dependencies</a></p></li>
</ul>
</div>
<p>This door lock sample demonstrates the usage of the <a class="reference internal" href="../../../protocols/matter/index.html#ug-matter"><span class="std std-ref">Matter</span></a> application layer to build a door lock device with one basic bolt.
You can use this sample as a reference for creating your application.</p>
<p>This device works as a Matter accessory device, meaning it can be paired and controlled remotely over a Matter network built on top of a low-power 802.15.4 Thread or Wi-Fi network.
Support for both Thread and Wi-Fi depends on the hardware platform.
The door lock sample can be configured to use only one transport protocol, for example Thread or Wi-Fi, or can use the <a class="reference internal" href="#matter-lock-sample-wifi-thread-switching"><span class="std std-ref">switchable Matter over Wi-Fi and Matter over Thread</span></a> architecture, where the application is able to load and run on boot an image with either the Thread or the Wi-Fi support.</p>
<p>Depending on the network you choose:</p>
<ul class="simple">
<li><p>In case of Thread, this device works as a Thread <a class="reference internal" href="../../../protocols/thread/overview/commissioning.html#thread-ot-device-types"><span class="std std-ref">Sleepy End Device</span></a>.</p></li>
<li><p>In case of Wi-Fi, this device works in the <a class="reference internal" href="../../../working_with_nrf/nrf70/developing/powersave.html#ug-nrf70-developing-powersave-dtim-unicast"><span class="std std-ref">Legacy Power Save mode</span></a>.
This means that the device sleeps most of the time and wakes up on each Delivery Traffic Indication Message (DTIM) interval to poll for pending messages.</p></li>
</ul>
<p>The same distinction applies in the <a class="reference internal" href="#matter-lock-sample-wifi-thread-switching"><span class="std std-ref">Thread and Wi-Fi switching</span></a> scenario, depending on the network you have switched to.</p>
<section id="requirements">
<h2><a class="toc-backref" href="#id7">Requirements</a><a class="headerlink" href="#requirements" title="Permalink to this heading"></a></h2>
<p>The sample supports the following development kits:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 31%" />
<col style="width: 7%" />
<col style="width: 40%" />
<col style="width: 23%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Hardware platforms</p></th>
<th class="head"><p>PCA</p></th>
<th class="head"><p>Board name</p></th>
<th class="head"><p>Build target</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference internal" href="../../../working_with_nrf/nrf70/gs.html#nrf7002dk-nrf5340"><span class="std std-ref">nRF7002 DK</span></a></p></td>
<td><p>PCA10143</p></td>
<td><p><a class="reference internal" href="../../../working_with_nrf/nrf70/gs.html#nrf7002dk-nrf5340"><span class="std std-ref">nrf7002dk_nrf5340</span></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">nrf7002dk_nrf5340_cpuapp</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../../../working_with_nrf/nrf53/nrf5340.html#ug-nrf5340"><span class="std std-ref">nRF5340 DK</span></a></p></td>
<td><p>PCA10095</p></td>
<td><p><span class="xref std std-ref">nrf5340dk_nrf5340</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">nrf5340dk_nrf5340_cpuapp</span></code></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../../../working_with_nrf/nrf52/developing.html#ug-nrf52"><span class="std std-ref">nRF52840 DK</span></a></p></td>
<td><p>PCA10056</p></td>
<td><p><span class="xref std std-ref">nrf52840dk_nrf52840</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">nrf52840dk_nrf52840</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../../../app_dev/working_with_fem/index.html#ug-radio-fem"><span class="std std-ref">nRF21540 DK</span></a></p></td>
<td><p>PCA10112</p></td>
<td><p><span class="xref std std-ref">nrf21540dk_nrf52840</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">nrf21540dk_nrf52840</span></code></p></td>
</tr>
</tbody>
</table>
<p>If you want to commission the lock device and <a class="reference internal" href="#matter-lock-sample-network-mode"><span class="std std-ref">control it remotely</span></a> through an IPv6 network, you also need a Matter controller device <a class="reference internal" href="../../../protocols/matter/getting_started/testing/index.html#ug-matter-configuring"><span class="std std-ref">configured on PC or mobile</span></a>.
This requires additional hardware depending on the setup you choose.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Matter requires the GN tool.
If you are updating from the nRF Connect SDK version earlier than v1.5.0, see the <a class="reference internal" href="../../../getting_started/installing.html#gs-installing-gn"><span class="std std-ref">GN installation instructions</span></a>.</p>
</div>
<p>If you want to enable and test <a class="reference internal" href="#matter-lock-sample-ble-nus"><span class="std std-ref">Matter Bluetooth LE with Nordic UART Service</span></a>, you also need a smartphone with either Android (Android 11 or newer) or iOS (iOS 16.1 or newer).</p>
<section id="ipv6-network-support">
<h3><a class="toc-backref" href="#id8">IPv6 network support</a><a class="headerlink" href="#ipv6-network-support" title="Permalink to this heading"></a></h3>
<p>The development kits for this sample offer the following IPv6 network support for Matter:</p>
<ul class="simple">
<li><p>Matter over Thread is supported for <code class="docutils literal notranslate"><span class="pre">nrf52840dk_nrf52840</span></code>, <code class="docutils literal notranslate"><span class="pre">nrf5340dk_nrf5340_cpuapp</span></code>, and <code class="docutils literal notranslate"><span class="pre">nrf21540dk_nrf52840</span></code>.</p></li>
<li><p>Matter over Wi-Fi is supported for <code class="docutils literal notranslate"><span class="pre">nrf5340dk_nrf5340_cpuapp</span></code> with the <code class="docutils literal notranslate"><span class="pre">nrf7002_ek</span></code> shield attached or for <code class="docutils literal notranslate"><span class="pre">nrf7002dk_nrf5340_cpuapp</span></code>.</p></li>
<li><p><a class="reference internal" href="#matter-lock-sample-wifi-thread-switching"><span class="std std-ref">Switching of Matter over Thread and Matter over Wi-Fi</span></a> is supported for <code class="docutils literal notranslate"><span class="pre">nrf5340dk_nrf5340_cpuapp</span></code> with the <code class="docutils literal notranslate"><span class="pre">nrf7002_ek</span></code> shield attached, using the <code class="docutils literal notranslate"><span class="pre">thread_wifi_switched</span></code> build type.</p></li>
</ul>
</section>
</section>
<section id="overview">
<h2><a class="toc-backref" href="#id9">Overview</a><a class="headerlink" href="#overview" title="Permalink to this heading"></a></h2>
<p>The sample uses buttons for changing the lock and device states, and LEDs to show the state of these changes.
You can test it in the following ways:</p>
<ul class="simple">
<li><p>Standalone, using a single DK that runs the door lock application.</p></li>
<li><p>Remotely over the Thread or the Wi-Fi protocol, which in either case requires more devices, including a Matter controller that you can configure either on a PC or a mobile device.</p></li>
</ul>
<p>You can enable both methods after <a class="reference internal" href="#matter-lock-sample-remote-control"><span class="std std-ref">building and running the sample</span></a>.</p>
<section id="remote-testing-in-a-network">
<span id="matter-lock-sample-network-mode"></span><h3><a class="toc-backref" href="#id10">Remote testing in a network</a><a class="headerlink" href="#remote-testing-in-a-network" title="Permalink to this heading"></a></h3>
<p>By default, the Matter accessory device has IPv6 networking disabled.
You must pair it with the Matter controller over Bluetooth® LE to get the configuration from the controller to use the device within a Thread or Wi-Fi network.
You have to make the device discoverable manually (for security reasons).
The controller must get the <a class="reference internal" href="#onboarding-information">Onboarding information</a> from the Matter accessory device and provision the device into the network.
For details, see the <a class="reference internal" href="#commissioning-the-device">Commissioning the device</a> section.</p>
</section>
<section id="thread-and-wi-fi-switching">
<span id="matter-lock-sample-wifi-thread-switching"></span><h3><a class="toc-backref" href="#id11">Thread and Wi-Fi switching</a><a class="headerlink" href="#thread-and-wi-fi-switching" title="Permalink to this heading"></a></h3>
<p>When built using the <code class="docutils literal notranslate"><span class="pre">thread_wifi_switched</span></code> build type and programmed to the nRF5340 DK with the nRF7002 EK shield attached, the door lock sample supports a feature that allows you to <a class="reference internal" href="../../../protocols/matter/overview/integration.html#ug-matter-overview-architecture-integration-designs-switchable"><span class="std std-ref">dynamically switch between Matter over Thread and Matter over Wi-Fi</span></a> on the device boot.
Due to internal flash size limitations, only one transport protocol can be used at a time.</p>
<p>The application is built in two variants: the first one is the application working with Matter over Thread and the second one is the application working with Matter over Wi-Fi.
You can configure which transport is selected on the device boot as the default one.
Both application variants are programmed into separate partitions of the external flash.
The application runs from the internal flash memory, using one of the variants from the external flash.
You can trigger the switch from one variant to another using the <strong>Button 3</strong> on the nRF5340 DK.
The device is rebooted into the MCUboot bootloader, which replaces the current variant by swapping the application variant in the internal flash.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Because the external flash is used for both the DFU and the switching feature, this implementation has higher memory size requirements and you need an external flash with at least 6 MB of memory.</p>
</div>
<p>See <a class="reference internal" href="#matter-door-lock-build-types">Matter door lock build types</a>, <a class="reference internal" href="#selecting-a-build-type">Selecting a build type</a>, and <a class="reference internal" href="#matter-lock-sample-switching-thread-wifi"><span class="std std-ref">Testing switching between Thread and Wi-Fi</span></a> for more information about how to configure and test this feature with this sample.
The Thread and Wi-Fi switching also supports <a class="reference internal" href="#matter-lock-sample-switching-thread-wifi-dfu"><span class="std std-ref">dedicated Device Firmware Upgrades</span></a>.</p>
</section>
<section id="matter-bluetooth-le-with-nordic-uart-service">
<span id="matter-lock-sample-ble-nus"></span><h3><a class="toc-backref" href="#id12">Matter Bluetooth LE with Nordic UART Service</a><a class="headerlink" href="#matter-bluetooth-le-with-nordic-uart-service" title="Permalink to this heading"></a></h3>
<p>The Matter implementation in the nRF Connect SDK lets you extend Bluetooth LE an additional Bluetooth LE service and use it in any Matter application, even when the device is not connected to a Matter network.
The Matter door lock sample provides a basic implementation of this feature, which integrates Bluetooth LE with with <a class="reference internal" href="../../../libraries/bluetooth_services/services/nus.html#nus-service-readme"><span class="std std-ref">Nordic UART Service (NUS)</span></a>.
Using NUS, you can declare commands specific to a Matter sample and use them to control the device remotely through Bluetooth LE.
The connection between the device and the Bluetooth controller is secured and requires providing a passcode to pair the devices.</p>
<p>In the door lock sample, you can use the following commands with the Bluetooth LE with NUS:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Lock</span></code> - To lock the door of the connected device.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Unlock</span></code> - To unlock the door of the connected device.</p></li>
</ul>
<p>If the device is already connected to the Matter network, the notification about changing the lock state will be send to the Bluetooth controller.</p>
<p>Currently, the door lock’s Bluetooth LE service extension with NUS is only available for the nRF52840 and the nRF5340 DKs in the <a class="reference internal" href="../../../protocols/matter/getting_started/testing/index.html#ug-matter-gs-testing"><span class="std std-ref">Matter over Thread</span></a> network variant.
However, you can use the Bluetooth LE service extension regardless of whether the device is connected to a Matter over Thread network or not.</p>
<p>See <a class="reference internal" href="#enabling-matter-bluetooth-le-with-nordic-uart-service">Enabling Matter Bluetooth LE with Nordic UART Service</a> and <a class="reference internal" href="#testing-door-lock-using-bluetooth-le-with-nordic-uart-service">Testing door lock using Bluetooth LE with Nordic UART Service</a> for more information about how to configure and test this feature with this sample.</p>
</section>
</section>
<section id="configuration">
<span id="matter-lock-sample-configuration"></span><h2><a class="toc-backref" href="#id13">Configuration</a><a class="headerlink" href="#configuration" title="Permalink to this heading"></a></h2>
<p>See <a class="reference internal" href="../../../getting_started/modifying.html#configure-application"><span class="std std-ref">Configuring your application</span></a> for information about how to permanently or temporarily change the configuration.</p>
<section id="matter-door-lock-build-types">
<span id="matter-lock-sample-configuration-build-types"></span><h3><a class="toc-backref" href="#id14">Matter door lock build types</a><a class="headerlink" href="#matter-door-lock-build-types" title="Permalink to this heading"></a></h3>
<p>The sample uses different configuration files depending on the supported features.
Configuration files are provided for different build types and they are located in the application root directory.</p>
<p>The <code class="file docutils literal notranslate"><span class="pre">prj.conf</span></code> file represents a <code class="docutils literal notranslate"><span class="pre">debug</span></code> build type.
Other build types are covered by dedicated files with the build type added as a suffix to the <code class="docutils literal notranslate"><span class="pre">prj</span></code> part, as per the following list.
For example, the <code class="docutils literal notranslate"><span class="pre">release</span></code> build type file name is <code class="file docutils literal notranslate"><span class="pre">prj_release.conf</span></code>.
If a board has other configuration files, for example associated with partition layout or child image configuration, these follow the same pattern.</p>
<p>When the <code class="docutils literal notranslate"><span class="pre">CONF_FILE</span></code> variable contains a single file and this file follows the naming pattern <code class="file docutils literal notranslate"><span class="pre">prj_&lt;buildtype&gt;.conf</span></code>, then the build type will be inferred to be <em>&lt;buildtype&gt;</em>.
The build type cannot be set explicitly.
The <em>&lt;buildtype&gt;</em> can be any string, but it is common to use <code class="docutils literal notranslate"><span class="pre">release</span></code> and <code class="docutils literal notranslate"><span class="pre">debug</span></code>.</p>
<p>For information about how to set variables, see <span class="xref std std-ref">zephyr:important-build-vars</span> in the Zephyr documentation.</p>
<p>The Partition Manager’s <a class="reference internal" href="../../../scripts/partition_manager/partition_manager.html#ug-pm-static"><span class="std std-ref">static configuration</span></a> can also be made dependent on the build type.
When the build type has been inferred, the file <code class="file docutils literal notranslate"><span class="pre">pm_static_&lt;buildtype&gt;.yml</span></code> will have precedence over <code class="file docutils literal notranslate"><span class="pre">pm_static.yml</span></code>.</p>
<p>The child image Kconfig configuration can also be made dependent on the build type.
The child image Kconfig overlay file is named <code class="file docutils literal notranslate"><span class="pre">child_image/&lt;child_image_name&gt;.conf</span></code> instead of <code class="file docutils literal notranslate"><span class="pre">prj.conf</span></code>, but otherwise follows the same pattern as the parent Kconfig.</p>
<p>Alternatively, the child image Kconfig configuration file can be introduced as <code class="file docutils literal notranslate"><span class="pre">child_image/&lt;child_image_name&gt;/prj.conf</span></code> and follow the same pattern as the parent Kconfig.
For example, <code class="file docutils literal notranslate"><span class="pre">child_image/mcuboot/prj_release.conf</span></code> can be used to define <code class="docutils literal notranslate"><span class="pre">release</span></code> build type for <code class="docutils literal notranslate"><span class="pre">mcuboot</span></code> child image.</p>
<p>Before you start testing the application, you can select one of the build types supported by the sample.
This sample supports the following build types, depending on the selected board:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">debug</span></code> – Debug version of the application - can be used to enable additional features for verifying the application behavior, such as logs or command-line shell.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">release</span></code> – Release version of the application - can be used to enable only the necessary application functionalities to optimize its performance.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">thread_wifi_switched</span></code> – Debug version of the application with the ability to <a class="reference internal" href="#matter-lock-sample-wifi-thread-switching"><span class="std std-ref">switch between Thread and Wi-Fi network support</span></a> in the field - can be used for the nRF5340 DK with the nRF7002 EK shield attached.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">no_dfu</span></code> – Debug version of the application without Device Firmware Upgrade feature support - can be used for the nRF52840 DK, nRF5340 DK, nRF7002 DK, and nRF21540 DK.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#selecting-a-build-type">Selecting a build type</a> is optional.
The <code class="docutils literal notranslate"><span class="pre">debug</span></code> build type is used by default if no build type is explicitly selected.</p>
</div>
</section>
<section id="device-firmware-upgrade-support">
<span id="matter-lock-sample-configuration-dfu"></span><h3><a class="toc-backref" href="#id15">Device Firmware Upgrade support</a><a class="headerlink" href="#device-firmware-upgrade-support" title="Permalink to this heading"></a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can enable over-the-air Device Firmware Upgrade only on hardware platforms that have external flash memory.
Currently only nRF52840 DK, nRF5340 DK and nRF7002 DK support Device Firmware Upgrade feature.</p>
</div>
<p>The sample supports over-the-air (OTA) device firmware upgrade (DFU) using one of the two following protocols:</p>
<ul class="simple">
<li><p>Matter OTA update protocol that uses the Matter operational network for querying and downloading a new firmware image.</p></li>
<li><p>Simple Management Protocol (SMP) over Bluetooth® LE.
In this case, the DFU can be done either using a smartphone application or a PC command line tool.
Note that this protocol is not part of the Matter specification.</p></li>
</ul>
<p>In both cases, <span class="xref std std-ref">MCUboot</span> secure bootloader is used to apply the new firmware image.</p>
<p>The DFU over Matter is enabled by default.
The following configuration arguments are available during the build process for configuring DFU:</p>
<ul class="simple">
<li><p>To configure the sample to support the DFU over Matter and SMP, use the <code class="docutils literal notranslate"><span class="pre">-DCONFIG_CHIP_DFU_OVER_BT_SMP=y</span></code> build flag.</p></li>
<li><p>To configure the sample to disable the DFU and the secure bootloader, use the <code class="docutils literal notranslate"><span class="pre">-DCONF_FILE=prj_no_dfu.conf</span></code> build flag.</p></li>
</ul>
<p>See <a class="reference internal" href="../../../getting_started/modifying.html#cmake-options"><span class="std std-ref">Providing CMake options</span></a> for instructions on how to add these options to your build.</p>
<p>When building on the command line, run the following command with <em>build_target</em> replaced with the build target name of the hardware platform you are using (see <a class="reference internal" href="#requirements">Requirements</a>), and <em>dfu_build_flag</em> replaced with the desired DFU build flag:</p>
<pre class="highlight literal-block">west build -b <em>build_target</em> -- <em>dfu_build_flag</em></pre>
<p>For example:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">west build -b nrf52840dk_nrf52840 -- -DCONFIG_CHIP_DFU_OVER_BT_SMP=y</span>
</pre></div>
</div>
</section>
<section id="fem-support">
<span id="matter-lock-sample-configuration-fem"></span><h3><a class="toc-backref" href="#id16">FEM support</a><a class="headerlink" href="#fem-support" title="Permalink to this heading"></a></h3>
<p>You can add support for the nRF21540 front-end module to this sample by using one of the following options, depending on your hardware:</p>
<ul>
<li><p>Build the sample for one board that contains the nRF21540 FEM, such as <span class="xref std std-ref">nrf21540dk_nrf52840</span>.</p></li>
<li><p>Manually create a devicetree overlay file that describes how FEM is connected to the nRF5 SoC in your device.
See <span class="xref std std-ref">zephyr:set-devicetree-overlays</span> for different ways of adding the overlay file.</p></li>
<li><p>Provide nRF21540 FEM capabilities by using a <span class="xref std std-ref">shield</span>, for example the <a class="reference internal" href="../../../app_dev/working_with_fem/index.html#ug-radio-fem-nrf21540-ek"><span class="std std-ref">nRF21540 EK</span></a> shield that is available in the nRF Connect SDK.
In this case, build the project for a board connected to the shield you are using with an appropriate variable included in the build command, for example <code class="docutils literal notranslate"><span class="pre">SHIELD=nrf21540_ek</span></code>.
This variable instructs the build system to append the appropriate devicetree overlay file.</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-blJGIENvbm5lY3QgZm9yIFZTIENvZGU=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-0-blJGIENvbm5lY3QgZm9yIFZTIENvZGU=" name="blJGIENvbm5lY3QgZm9yIFZTIENvZGU=" role="tab" tabindex="0">nRF Connect for VS Code</button><button aria-controls="panel-0-Q29tbWFuZCBsaW5l" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-Q29tbWFuZCBsaW5l" name="Q29tbWFuZCBsaW5l" role="tab" tabindex="-1">Command line</button></div><div aria-labelledby="tab-0-blJGIENvbm5lY3QgZm9yIFZTIENvZGU=" class="sphinx-tabs-panel group-tab" id="panel-0-blJGIENvbm5lY3QgZm9yIFZTIENvZGU=" name="blJGIENvbm5lY3QgZm9yIFZTIENvZGU=" role="tabpanel" tabindex="0"><p>To build the sample in the nRF Connect for VS Code IDE for an nRF52840 DK with the nRF21540 EK attached, add the shield variable in the build configuration’s <span class="guilabel">Extra CMake arguments</span> and rebuild the build configuration.
For example: <code class="docutils literal notranslate"><span class="pre">-DSHIELD=nrf21540_ek</span></code>.</p>
<p>See <a class="reference external" href="https://nrfconnect.github.io/vscode-nrf-connect/guides/build_config.html">nRF Connect for VS Code extension pack</a> documentation for more information.</p>
</div><div aria-labelledby="tab-0-Q29tbWFuZCBsaW5l" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-Q29tbWFuZCBsaW5l" name="Q29tbWFuZCBsaW5l" role="tabpanel" tabindex="0"><p>To build the sample from the command line for an nRF52840 DK with the nRF21540 EK attached, use the following command within the sample directory:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">west build -b nrf52840dk_nrf52840 -- -DSHIELD=nrf21540_ek</span>
</pre></div>
</div>
</div></div>
<p>See <a class="reference internal" href="../../../app_dev/working_with_fem/index.html#ug-radio-fem-nrf21540-ek-programming"><span class="std std-ref">Programming nRF21540 EK</span></a> for information about how to program when you are using a board with a network core, for example nRF5340 DK.</p>
</li>
</ul>
<p>Each of these options adds the description of the nRF21540 FEM to the devicetree.
See <a class="reference internal" href="../../../app_dev/working_with_fem/index.html#ug-radio-fem"><span class="std std-ref">Working with RF front-end modules</span></a> for more information about FEM in the nRF Connect SDK.</p>
<p>To add support for other front-end modules, add the respective devicetree file entries to the board devicetree file or the devicetree overlay file.</p>
</section>
<section id="enabling-matter-bluetooth-le-with-nordic-uart-service">
<span id="matter-lock-sample-configuration-nus"></span><h3><a class="toc-backref" href="#id17">Enabling Matter Bluetooth LE with Nordic UART Service</a><a class="headerlink" href="#enabling-matter-bluetooth-le-with-nordic-uart-service" title="Permalink to this heading"></a></h3>
<p>You can enable the <a class="reference internal" href="#matter-lock-sample-ble-nus"><span class="std std-ref">Matter Bluetooth LE with Nordic UART Service</span></a> feature by setting the <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_CHIP_NUS</span></code> Kconfig option to <code class="docutils literal notranslate"><span class="pre">y</span></code>.</p>
<p>The door lock’s Bluetooth LE service extension with NUS requires a secure connection with a smartphone, which is established using a security PIN code.
The PIN code is different depending on the build type:</p>
<ul>
<li><p>In the <code class="docutils literal notranslate"><span class="pre">debug</span></code> build type, the secure PIN code is generated randomly and printed in the log console in the following way:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">PROVIDE THE FOLLOWING CODE IN YOUR MOBILE APP: 165768</span>
</pre></div>
</div>
</li>
<li><p>In the <code class="docutils literal notranslate"><span class="pre">release</span></code> build type, the secure PIN is set to <code class="docutils literal notranslate"><span class="pre">123456</span></code> due to lack of a different way of showing it on nRF boards other than in the log console.</p></li>
</ul>
<p>See <a class="reference internal" href="#testing-door-lock-using-bluetooth-le-with-nordic-uart-service">Testing door lock using Bluetooth LE with Nordic UART Service</a> for more information about how to test this feature.</p>
</section>
</section>
<section id="user-interface">
<h2><a class="toc-backref" href="#id18">User interface</a><a class="headerlink" href="#user-interface" title="Permalink to this heading"></a></h2>
<dl class="simple">
<dt>LED 1:</dt><dd><p>Shows the overall state of the device and its connectivity.
The following states are possible:</p>
<ul class="simple">
<li><p>Short Flash On (50 ms on/950 ms off) - The device is in the unprovisioned (unpaired) state and is waiting for a commissioning application to connect.</p></li>
<li><p>Rapid Even Flashing (100 ms on/100 ms off) - The device is in the unprovisioned state and a commissioning application is connected over Bluetooth LE.</p></li>
<li><p>Solid On - The device is fully provisioned.</p></li>
</ul>
</dd>
</dl>
<dl>
<dt>LED 2:</dt><dd><p>Shows the state of the lock.
The following states are possible:</p>
<ul class="simple">
<li><p>Solid On - The bolt is extended and the door is locked.</p></li>
<li><p>Off - The bolt is retracted and the door is unlocked.</p></li>
<li><p>Rapid Even Flashing (50 ms on/50 ms off during 2 s) - The simulated bolt is in motion from one position to another.</p></li>
</ul>
<p>Additionally, the LED starts blinking evenly (500 ms on/500 ms off) when the Identify command of the Identify cluster is received on the endpoint <code class="docutils literal notranslate"><span class="pre">1</span></code>.
The command’s argument can be used to specify the duration of the effect.</p>
</dd>
</dl>
<dl class="simple">
<dt>Button 1:</dt><dd><p>Depending on how long you press the button:</p>
<ul class="simple">
<li><p>If pressed for less than three seconds, it initiates the SMP server (Security Manager Protocol).
After that, the Direct Firmware Update (DFU) over Bluetooth Low Energy can be started.
(See <a class="reference internal" href="#upgrading-the-device-firmware">Upgrading the device firmware</a>.)</p></li>
<li><p>If pressed for more than three seconds, it initiates the factory reset of the device.
Releasing the button within the 3-second window cancels the factory reset procedure.</p></li>
</ul>
</dd>
</dl>
<dl class="simple">
<dt>Button 2:</dt><dd><ul class="simple">
<li><p>On nRF52840 DK, nRF5340 DK, and nRF21540 DK: Changes the lock state to the opposite one.</p></li>
<li><p>On nRF7002 DK:</p>
<ul>
<li><p>If pressed for less than three seconds, it changes the lock state to the opposite one.</p></li>
<li><p>If pressed for more than three seconds, it starts the NFC tag emulation, enables Bluetooth LE advertising for the predefined period of time (15 minutes by default), and makes the device discoverable over Bluetooth LE.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>Button 3:</dt><dd><ul class="simple">
<li><p>On the nRF5340 DK when using the <code class="docutils literal notranslate"><span class="pre">thread_wifi_switched</span></code> build type: If pressed for more than ten seconds, it switches the running application from Thread or Wi-Fi to the other and factory resets the device.</p></li>
<li><p>On other platform or build type: Not available.</p></li>
</ul>
</dd>
</dl>
<dl class="simple">
<dt>Button 4:</dt><dd><ul class="simple">
<li><p>On nRF52840 DK, nRF5340 DK, and nRF21540 DK: Starts the NFC tag emulation, enables Bluetooth LE advertising for the predefined period of time (15 minutes by default), and makes the device discoverable over Bluetooth LE.
This button is used during the <a class="reference internal" href="#matter-lock-sample-remote-control-commissioning"><span class="std std-ref">commissioning procedure</span></a>.</p></li>
<li><p>On nRF7002 DK: Not available.</p></li>
</ul>
</dd>
</dl>
<dl class="simple">
<dt>SEGGER J-Link USB port:</dt><dd><p>Used for getting logs from the device or for communicating with it through the command-line interface.</p>
</dd>
</dl>
<dl class="simple">
<dt>NFC port with antenna attached:</dt><dd><p>Optionally used for obtaining the <a class="reference internal" href="#onboarding-information">Onboarding information</a> from the Matter accessory device to start the <a class="reference internal" href="#matter-lock-sample-remote-control"><span class="std std-ref">commissioning procedure</span></a>.</p>
</dd>
</dl>
</section>
<section id="building-and-running">
<h2><a class="toc-backref" href="#id19">Building and running</a><a class="headerlink" href="#building-and-running" title="Permalink to this heading"></a></h2>
<p>This sample can be found under <code class="file docutils literal notranslate"><span class="pre">samples/matter/lock</span></code> in the nRF Connect SDK folder structure.</p>
<p>To build the sample with Visual Studio Code, follow the steps listed on the <a class="reference external" href="https://nrfconnect.github.io/vscode-nrf-connect/get_started/build_app_ncs.html">How to build an application</a> page in the nRF Connect for VS Code extension documentation.
See <a class="reference internal" href="../../../getting_started/programming.html#gs-programming"><span class="std std-ref">Building and programming an application</span></a> for other building and programming scenarios and <a class="reference internal" href="../../../getting_started/testing.html#gs-testing"><span class="std std-ref">Testing and debugging an application</span></a> for general information about testing and debugging in the nRF Connect SDK.</p>
<p>See <a class="reference internal" href="#configuration">Configuration</a> for information about building the sample with the DFU support.</p>
<section id="selecting-a-build-type">
<h3><a class="toc-backref" href="#id20">Selecting a build type</a><a class="headerlink" href="#selecting-a-build-type" title="Permalink to this heading"></a></h3>
<p>Before you start testing the application, you can select one of the <a class="reference internal" href="#matter-door-lock-build-types">Matter door lock build types</a>, depending on your building method.</p>
<section id="selecting-a-build-type-in-vsc">
<h4>Selecting a build type in Visual Studio Code<a class="headerlink" href="#selecting-a-build-type-in-vsc" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>To select the build type in the nRF Connect for VS Code extension:</p>
<ol class="arabic simple">
<li><p>When <a class="reference external" href="https://nrfconnect.github.io/vscode-nrf-connect/get_started/build_app_ncs.html">building an application</a> as described in the nRF Connect for VS Code extension documentation, follow the steps for setting up the build configuration.</p></li>
<li><p>In the <strong>Add Build Configuration</strong> screen, select the desired <code class="file docutils literal notranslate"><span class="pre">.conf</span></code> file from the <span class="guilabel">Configuration</span> drop-down menu.</p></li>
<li><p>Fill in other configuration options, if applicable, and click <span class="guilabel">Build Configuration</span>.</p></li>
</ol>
</div></blockquote>
</section>
<section id="selecting-a-build-type-from-command-line">
<h4>Selecting a build type from command line<a class="headerlink" href="#selecting-a-build-type-from-command-line" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>To select the build type when building the application from command line, specify the build type by adding the following parameter to the <code class="docutils literal notranslate"><span class="pre">west</span> <span class="pre">build</span></code> command:</p>
<pre class="highlight literal-block">-- -DCONF_FILE=prj_<em>selected_build_type</em>.conf</pre>
</div></blockquote>
<p>For example, you can replace the <em>selected_build_type</em> variable to build the <code class="docutils literal notranslate"><span class="pre">release</span></code> firmware for <code class="docutils literal notranslate"><span class="pre">nrf52840dk_nrf52840</span></code> by running the following command in the project directory:</p>
<div class="highlight highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">west</span> <span class="n">build</span> <span class="o">-</span><span class="n">b</span> <span class="n">nrf52840dk_nrf52840</span> <span class="o">-</span><span class="n">d</span> <span class="n">build_nrf52840dk_nrf52840</span> <span class="o">--</span> <span class="o">-</span><span class="n">DCONF_FILE</span><span class="o">=</span><span class="n">prj_release</span><span class="o">.</span><span class="n">conf</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">build_nrf52840dk_nrf52840</span></code> parameter specifies the output directory for the build files.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the selected board does not support the selected build type, the build is interrupted.
For example, if the <code class="docutils literal notranslate"><span class="pre">shell</span></code> build type is not supported by the selected board, the following notification appears:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File not found: ./ncs/nrf/samples/matter/lock/configuration/nrf52840dk_nrf52840/prj_shell.conf</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="testing">
<h3><a class="toc-backref" href="#id21">Testing</a><a class="headerlink" href="#testing" title="Permalink to this heading"></a></h3>
<p>After building the sample and programming it to your development kit, complete the following steps to test its basic features:</p>
<ol class="arabic">
<li><p>Connect the kit to the computer using a USB cable.
The kit is assigned a COM port (Windows) or ttyACM device (Linux), which is visible in the Device Manager.</p></li>
<li><p>Connect to the kit with a terminal emulator that supports VT100/ANSI escape characters (for example, PuTTY).
See <a class="reference internal" href="../../../getting_started/testing.html#putty"><span class="std std-ref">How to connect with PuTTY</span></a> for the required settings.</p></li>
<li><p>Observe that <strong>LED 2</strong> is lit, which means that the door lock is closed.</p></li>
<li><p>Press <strong>Button 2</strong> to unlock the door.
<strong>LED 2</strong> is blinking while the lock is opening.
After approximately two seconds, <strong>LED 2</strong> turns off permanently.
The following messages appear on the console:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">I: Unlock Action has been initiated</span>
<span class="go">I: Unlock Action has been completed</span>
</pre></div>
</div>
</li>
<li><p>Press <strong>Button 2</strong> one more time to lock the door again.
<strong>LED 2</strong> starts blinking and remains turned on.
The following messages appear on the console:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">I: Lock Action has been initiated</span>
<span class="go">I: Lock Action has been completed</span>
</pre></div>
</div>
</li>
<li><p>Press <strong>Button 1</strong> to initiate factory reset of the device.</p></li>
</ol>
<p>The device reboots after all its settings are erased.</p>
</section>
<section id="enabling-remote-control">
<span id="matter-lock-sample-remote-control"></span><h3><a class="toc-backref" href="#id22">Enabling remote control</a><a class="headerlink" href="#enabling-remote-control" title="Permalink to this heading"></a></h3>
<p>Remote control allows you to control the Matter door lock device from a Thread or a Wi-Fi network.</p>
<p><a class="reference internal" href="#commissioning-the-device">Commissioning the device</a> allows you to set up a testing environment and remotely control the sample over a Matter-enabled Thread or Wi-Fi network.</p>
<section id="commissioning-the-device">
<span id="matter-lock-sample-remote-control-commissioning"></span><h4>Commissioning the device<a class="headerlink" href="#commissioning-the-device" title="Permalink to this heading"></a></h4>
<p>To commission the device, go to the <a class="reference internal" href="../../../protocols/matter/getting_started/testing/index.html#ug-matter-gs-testing"><span class="std std-ref">Testing Matter in the nRF Connect SDK</span></a> page and complete the steps for the Matter network environment and the Matter controller you want to use.
After choosing the configuration, the guide walks you through the following steps:</p>
<ul class="simple">
<li><p>Only if you are configuring Matter over Thread: Configure the Thread Border Router.</p></li>
<li><p>Build and install the Matter controller.</p></li>
<li><p>Commission the device.</p></li>
<li><p>Send Matter commands that cover scenarios described in the <a class="reference internal" href="#testing">Testing</a> section.</p></li>
</ul>
<p>If you are new to Matter, the recommended approach is to use <a class="reference internal" href="../../../protocols/matter/overview/network_topologies.html#ug-matter-configuring-controller"><span class="std std-ref">CHIP Tool for Linux or macOS</span></a>.</p>
<section id="onboarding-information">
<h5>Onboarding information<a class="headerlink" href="#onboarding-information" title="Permalink to this heading"></a></h5>
<p>When you start the commissioning procedure, the controller must get the onboarding information from the Matter accessory device.
The onboarding information representation depends on your commissioner setup.</p>
<p>For this sample, you can use one of the following <a class="reference internal" href="../../../protocols/matter/overview/commissioning.html#ug-matter-network-topologies-commissioning-onboarding-formats"><span class="std std-ref">onboarding information formats</span></a> to provide the commissioner with the data payload that includes the device discriminator and the setup PIN code:</p>
<blockquote>
<div><table class="docutils align-default" id="id6">
<caption><span class="caption-text">Door lock sample onboarding information</span><a class="headerlink" href="#id6" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>QR Code</p></th>
<th class="head"><p>QR Code Payload</p></th>
<th class="head"><p>Manual pairing code</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Scan the following QR code with the app for your ecosystem:</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../../../_images/matter_qr_code_door_lock.png"><img alt="QR code for commissioning the light bulb device" src="../../../_images/matter_qr_code_door_lock.png" style="width: 200px;" /></a>
</figure>
</td>
<td><p>MT:8IXS142C00KA0648G00</p></td>
<td><p>34970112332</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
</section>
</section>
</section>
<section id="upgrading-the-device-firmware">
<h3><a class="toc-backref" href="#id23">Upgrading the device firmware</a><a class="headerlink" href="#upgrading-the-device-firmware" title="Permalink to this heading"></a></h3>
<p>To upgrade the device firmware, complete the steps listed for the selected method in the <span class="xref std std-doc">matter:nrfconnect_examples_software_update</span> tutorial of the Matter documentation.</p>
</section>
<section id="testing-switching-between-thread-and-wi-fi">
<span id="matter-lock-sample-switching-thread-wifi"></span><h3><a class="toc-backref" href="#id24">Testing switching between Thread and Wi-Fi</a><a class="headerlink" href="#testing-switching-between-thread-and-wi-fi" title="Permalink to this heading"></a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can only test <a class="reference internal" href="#matter-lock-sample-wifi-thread-switching"><span class="std std-ref">Thread and Wi-Fi switching</span></a> on the nRF5340 DK with the nRF7002 EK shield attached, using the <code class="docutils literal notranslate"><span class="pre">thread_wifi_switched</span></code> build type.</p>
</div>
<p>To test this feature, complete the following steps:</p>
<ol class="arabic">
<li><p>Build the door lock application for Matter over Thread:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">west build -b nrf5340dk_nrf5340_cpuapp -- -DCONF_FILE=prj_thread_wifi_switched.conf -DSHIELD=nrf7002_ek -Dhci_rpmsg_SHIELD=nrf7002_ek_coex -DCONFIG_CHIP_WIFI=n</span>
</pre></div>
</div>
</li>
<li><p>Program the application to the kit using the following command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">west flash --erase</span>
</pre></div>
</div>
</li>
<li><p>Erase the entire content of the external flash using the following command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nrfjprog --qspieraseall</span>
</pre></div>
</div>
</li>
<li><p>Program the application to a partition of the external flash using the following command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">west build -t flash-external</span>
</pre></div>
</div>
</li>
<li><p>Build the door lock application for Matter over Wi-Fi:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">west build -b nrf5340dk_nrf5340_cpuapp -p always -- -DCONF_FILE=prj_thread_wifi_switched.conf -DSHIELD=nrf7002_ek -Dhci_rpmsg_SHIELD=nrf7002_ek_coex</span>
</pre></div>
</div>
</li>
<li><p>Program the application to another partition of the external flash using the following command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">west build -t flash-external</span>
</pre></div>
</div>
</li>
<li><p>Connect to the kit with a terminal emulator that supports VT100/ANSI escape characters (for example, PuTTY).
See <a class="reference internal" href="../../../getting_started/testing.html#putty"><span class="std std-ref">How to connect with PuTTY</span></a> for the required settings.</p></li>
<li><p>Press <strong>Button 3</strong> for more than ten seconds to trigger switching to the Matter over Wi-Fi variant of the application.</p></li>
<li><p>Observe logs showing the progress of the operation until the device shuts down.</p></li>
<li><p>Wait until the device boots again.</p></li>
<li><p>Find the following log message which indicates that the expected variant of the application is running:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">D: 823 [DL]WiFiManager has been initialized</span>
</pre></div>
</div>
</li>
</ol>
<section id="device-firmware-upgrade-over-matter-for-thread-wi-fi-switchable-application">
<span id="matter-lock-sample-switching-thread-wifi-dfu"></span><h4>Device Firmware Upgrade over Matter for Thread/Wi-Fi switchable application<a class="headerlink" href="#device-firmware-upgrade-over-matter-for-thread-wi-fi-switchable-application" title="Permalink to this heading"></a></h4>
<p>To upgrade the device firmware when using the <code class="docutils literal notranslate"><span class="pre">thread_wifi_switched</span></code> build type, complete the steps from the <em>Device Firmware Upgrade over Matter</em> section in the <span class="xref std std-doc">matter:nrfconnect_examples_software_update</span> tutorial of the Matter documentation.</p>
<p>Because the application supports switching between Thread and Wi-Fi, you need to make sure that the Matter OTA image file served by the OTA Provider includes two application variants: for Matter over Thread and for Matter over Wi-Fi, respectively.</p>
<p>To make sure that both application variants are included in the OTA image file, use the dedicated the <code class="file docutils literal notranslate"><span class="pre">combine_ota_images.py</span></code> script.
The script takes the Matter OTA image files generated for both variants and combines them in one file.
It also assumes that both input images were created with the same <em>vendor_id</em>, <em>product_id</em>, <em>version</em>, <em>version_string</em>, <em>min_version</em>, <em>max_version</em>, and <em>release_notes</em>.</p>
<p>Complete the following steps to generate the Matter OTA combined image file:</p>
<ol class="arabic">
<li><p>Build the door lock application for Matter over Thread by running the following command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">west build -b nrf5340dk_nrf5340_cpuapp -d build_thread -- -DCONF_FILE=prj_thread_wifi_switched.conf -DSHIELD=nrf7002_ek -Dhci_rpmsg_SHIELD=nrf7002_ek_coex -DCONFIG_CHIP_WIFI=n</span>
</pre></div>
</div>
<p>This command creates the <em>build_thread</em> directory, where the Matter over Thread application is stored.</p>
</li>
<li><p>Build the door lock application for Matter over Wi-Fi by running the following command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">west build -b nrf5340dk_nrf5340_cpuapp -d build_wifi -- -DCONF_FILE=prj_thread_wifi_switched.conf -DSHIELD=nrf7002_ek -Dhci_rpmsg_SHIELD=nrf7002_ek_coex</span>
</pre></div>
</div>
<p>This command creates the <em>build_wifi</em> directory, where the Matter over Wi-Fi application is stored.</p>
</li>
<li><p>Combine Matter OTA image files generated for both variants by running the <code class="docutils literal notranslate"><span class="pre">combine_ota_images.py</span></code> script in the sample directory by running the following command (with <code class="docutils literal notranslate"><span class="pre">&lt;output_directory&gt;</span></code> changed to the directory name of your choice):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">src/combine_ota_images.py build_thread/zephyr/matter.ota build_wifi/zephyr/matter.ota &lt;output_directory&gt;/combined_matter.ota</span>
</pre></div>
</div>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Keep the order in which the files are passed to the script, given that the Thread variant image file must be passed in front of the Wi-Fi variant image.</p>
</div>
</section>
</section>
<section id="testing-door-lock-using-bluetooth-le-with-nordic-uart-service">
<h3><a class="toc-backref" href="#id25">Testing door lock using Bluetooth LE with Nordic UART Service</a><a class="headerlink" href="#testing-door-lock-using-bluetooth-le-with-nordic-uart-service" title="Permalink to this heading"></a></h3>
<p>To test the <a class="reference internal" href="#matter-lock-sample-ble-nus"><span class="std std-ref">Matter Bluetooth LE with Nordic UART Service</span></a> feature, complete the following steps:</p>
<ol class="arabic">
<li><p>Install <a class="reference external" href="https://www.nordicsemi.com/Software-and-Tools/Development-Tools/nRF-Toolbox">nRF Toolbox</a> on your Android (Android 11 or newer) or iOS smartphone (iOS 16.1 or newer).</p></li>
<li><p>Build the door lock application for Matter over Thread with the <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_CHIP_NUS</span></code> set to <code class="docutils literal notranslate"><span class="pre">y</span></code>.
For example, if you build from command line for the <code class="docutils literal notranslate"><span class="pre">nrf52840dk_nrf52840</span></code>, use the following command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">west build -b nrf52840dk_nrf52840 -- -DCONFIG_CHIP_NUS=y</span>
</pre></div>
</div>
</li>
<li><p>Program the application to the kit using the following command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">west flash --erase</span>
</pre></div>
</div>
</li>
<li><p>If you built the sample with the <code class="docutils literal notranslate"><span class="pre">debug</span></code> build type, connect the board to an UART console to see the log entries from the device.</p></li>
<li><p>Open the nRF Toolbox application on your smartphone.</p></li>
<li><p>Select <span class="guilabel">Universal Asynchronous Receiver/Transmitter UART</span> from the list in the nRF Toolbox application.</p></li>
<li><p>Tap on <span class="guilabel">Connect</span>.
The application connects to the devices connected through UART.</p></li>
<li><p>Select <span class="guilabel">MatterLock_NUS</span> from the list of available devices.
The Bluetooth Pairing Request with an input field for passkey appears as a notification (Android) or on the screen (iOS).</p></li>
<li><p>Depending on the build type you are using:</p>
<ul class="simple">
<li><p>For the <code class="docutils literal notranslate"><span class="pre">release</span></code> build type: Enter the passkey <code class="docutils literal notranslate"><span class="pre">123456</span></code>.</p></li>
<li><p>For the <code class="docutils literal notranslate"><span class="pre">debug</span></code> build type, complete the following steps:</p>
<ol class="loweralpha simple">
<li><p>Search the device’s logs to find <code class="docutils literal notranslate"><span class="pre">PROVIDE</span> <span class="pre">THE</span> <span class="pre">FOLLOWING</span> <span class="pre">CODE</span> <span class="pre">IN</span> <span class="pre">YOUR</span> <span class="pre">MOBILE</span> <span class="pre">APP:</span></code> phrase.</p></li>
<li><p>Read the randomly generated passkey from the console logs.</p></li>
<li><p>Enter the passcode on your smartphone.</p></li>
</ol>
</li>
</ul>
</li>
<li><p>Wait for the Bluetooth LE connection to be established between the smartphone and the DK.</p></li>
<li><p>In the nRF Toolbox application, add the following macros:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Lock</span></code> as the Command value type <code class="docutils literal notranslate"><span class="pre">Text</span></code> and any image.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Unlock</span></code> as the Command value type <code class="docutils literal notranslate"><span class="pre">Text</span></code> and any image.</p></li>
</ul>
</li>
<li><p>Tap on the generated macros and observe the <strong>LED 2</strong> on the DK.</p></li>
</ol>
<p>The Bluetooth LE connection between a phone and the DK will be suspended when the commissioning to the Matter network is in progress or there is an active session of SMP DFU.</p>
</section>
</section>
<section id="dependencies">
<h2><a class="toc-backref" href="#id26">Dependencies</a><a class="headerlink" href="#dependencies" title="Permalink to this heading"></a></h2>
<p>This sample uses the Matter library that includes the nRF Connect SDK platform integration layer:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://buildwithmatter.com/">Matter</a></p></li>
</ul>
<p>In addition, the sample uses the following nRF Connect SDK components:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../../libraries/others/dk_buttons_and_leds.html#dk-buttons-and-leds-readme"><span class="std std-ref">DK Buttons and LEDs</span></a></p></li>
<li><p><a class="reference internal" href="../../../libraries/nfc/ndef/uri_msg.html#nfc-uri"><span class="std std-ref">URI messages and records</span></a></p></li>
<li><p><a class="reference internal" href="../../../libraries/nfc/t2t/index.html#lib-nfc-t2t"><span class="std std-ref">Type 2 Tag</span></a></p></li>
</ul>
<p>The sample depends on the following Zephyr libraries:</p>
<ul class="simple">
<li><p><span class="xref std std-ref">zephyr:logging_api</span></p></li>
<li><p><span class="xref std std-ref">zephyr:kernel_api</span></p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../template/README.html" class="btn btn-neutral float-right" title="Matter: Template" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../light_switch/README.html" class="btn btn-neutral" title="Matter: Light switch" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">

<table>
<tr>
<td>
    <p>
        &copy; Copyright 2019-2023, Nordic Semiconductor.
      Last updated on Mar 20, 2023.

    </p>
</td>
<td id="nordiclogo">
  <a href="https://www.nordicsemi.com/"><img src="../../../_static/images/nordic-logo.png" border="0"/></a>
</td>
</tr>
</table>
  </div> 


</footer>

<div id="scroll-container">
  <button type="button" id="scroll-btn" class="btn">
    <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="#fff"/></svg>
  </button>
</div>

<script>
  const scrollBtn = document.querySelector("#scroll-btn");

  document.addEventListener("scroll", () => {
    if (window.scrollY > 400) {
          scrollBtn.style.visibility = "visible";
      } else {
          scrollBtn.style.visibility = "hidden";
      }
  });

  scrollBtn.addEventListener("click", () => {
      window.scrollTo({ top: 0, behavior: "smooth" });
  });
</script>
        </div>
      </div>
    </section>
  </div>
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> nRF Connect SDK</span>
       <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      
      <div class="rst-other-version ncs">
        <a href="../../../../nrf/index.html">nRF Connect SDK</a>
      </div>
      
      <div class="rst-other-version nrfx">
        <a href="../../../../nrfx/index.html">nrfx</a>
      </div>
      
      <div class="rst-other-version nrfxlib">
        <a href="../../../../nrfxlib/README.html">nrfxlib</a>
      </div>
      
      <div class="rst-other-version zephyr">
        <a href="../../../../zephyr/index.html">Zephyr Project</a>
      </div>
      
      <div class="rst-other-version mcuboot">
        <a href="../../../../mcuboot/wrapper.html">MCUboot</a>
      </div>
      
      <div class="rst-other-version tfm">
        <a href="../../../../tfm/index.html">Trusted Firmware-M</a>
      </div>
      
      <div class="rst-other-version matter">
        <a href="../../../../matter/index.html">Matter</a>
      </div>
      
      <div class="rst-other-version kconfig">
        <a href="../../../../kconfig/index.html">Kconfig Reference</a>
      </div>
    </div>
  </div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>