<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Firmware updates &mdash; nRF Connect SDK 2.3.99 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/nordic.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/togglebutton.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/nrf.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/tabs.css" type="text/css" /> 
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="https://www.googletagmanager.com/gtag/js?id=G-ZPVZRKFQJR"></script>
        <script src="../../_static/js/ga-tracker.js"></script>
        <script data-culture="EN" id="CookieConsent" type="text/javascript" src="https://policy.app.cookieinformation.com/uc.js"></script>
        <script src="../../_static/tabs.js"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../_static/togglebutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/js/theme.js"></script>
<script
  type="text/javascript"
  src="../../_static/js/ncs.js"
></script>
<script src="../../_static/js/bootstrap.bundle.min.js"></script>

    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Logging in nRF Connect SDK" href="../logging/index.html" />
    <link rel="prev" title="Customizing the bootloader" href="bootloader_config.html" />
<link
  href="../../_static/css/bootstrap.min.css"
  rel="stylesheet"
/>
<link
  rel="shortcut icon"
  href="../../_static/images/favicon.ico"
/>

</head>

<body class="wy-body-for-nav">
<div class="announcement"></div>
<div class="d-print-none ncs-header">
  <div class="container-xl ncs-header-top">
    <div class="row h-100">
      <div class="d-none d-md-block col-2">
        <div class="bg-white py-4 px-3 ml-2 ncs-header-logo">
          <img
            class="ncs-header-logo"
            src="../../_static/images/nordic-logo.png"
            alt=""
          />
        </div>
      </div>
      <div
        class="col-8 col-md-7 pl-md-4 d-flex align-self-center justify-content-center"
      >
        <form class="w-75" action="../../search.html" method="get">
          <div class="form-group">
            <input
              type="text"
              name="q"
              class="ncs-search-input form-control"
              placeholder="Search all docs..."
            />
          </div>
        </form>
      </div>
      <div class="col-4 col-md-3 d-md-block p-3 text-end">
        <div class="dropdown">
          <button
            class="btn dropdown-toggle ncs-btn-versions"
            type="button"
            id="dropdownMenuButton1"
            data-bs-toggle="dropdown"
            aria-expanded="false"
          >
            <span class="d-none d-md-inline">nRF Connect SDK</span>
            <span id="ncsversion" class="d-inline"></span>
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton"></div>
        </div>
      </div>
    </div>
  </div>
  <div class="ncs-header-nav">
    <div class="container-xl">
      <div class="row">
        <div class="col col-12 d-flex justify-content-center">
          <nav class="navbar navbar-dark navbar-expand-lg p-0">
            <span class="navbar-brand d-block d-lg-none py-2 pl-1"
              >Documentation sets</span
            >
            <button
              class="navbar-toggler"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#navbarNavAltMarkup"
              aria-controls="navbarNavAltMarkup"
              aria-expanded="false"
              aria-label="Toggle navigation"
            >
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
              <ul class="navbar-nav">
                <li class="nav-item active py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../nrf/index.html"
                    >nRF Connect SDK</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../nrfx/index.html"
                    >nrfx</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../nrfxlib/README.html"
                    >nrfxlib</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../zephyr/index.html"
                    >Zephyr Project</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../mcuboot/wrapper.html"
                    >MCUboot</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../tfm/index.html"
                    >Trusted Firmware-M</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../matter/index.html"
                    >Matter</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../kconfig/index.html"
                    >Kconfig Reference</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
              </ul>
            </div>
          </nav>
        </div>
      </div>
    </div>
  </div>
</div>

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> nRF Connect SDK
          </a>
              <div class="version">
                2.3.99
              </div>
<div id="searchbox" role="search">
  <div class="searchformwrapper">
    <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
  </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev_model.html">Development model</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../app_dev.html">Application development</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../board_support/index.html">Board support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pin_control/index.html">Pin control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../build_and_config_system/index.html">Build and configuration system</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optimizing/index.html">Optimizing application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ap_protect/index.html">Enabling access port protection mechanism</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Bootloaders and Device Firmware Updates</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="bootloader.html">Secure bootloader chain</a></li>
<li class="toctree-l3"><a class="reference internal" href="bootloader_adding.html">Adding a bootloader chain</a></li>
<li class="toctree-l3"><a class="reference internal" href="bootloader_testing.html">Testing the bootloader chain</a></li>
<li class="toctree-l3"><a class="reference internal" href="bootloader_external_flash.html">Using external flash memory partitions</a></li>
<li class="toctree-l3"><a class="reference internal" href="bootloader_config.html">Customizing the bootloader</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Firmware updates</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#signature-keys">Signature keys</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuring-image-versions">Configuring image versions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../logging/index.html">Logging in nRF Connect SDK</a></li>
<li class="toctree-l2"><a class="reference internal" href="../multi_image/index.html">Multi-image builds</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing_unity_cmock/index.html">Testing with Unity and CMock</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tfm/index.html">Running applications with Trusted Firmware-M</a></li>
<li class="toctree-l2"><a class="reference internal" href="../working_with_fem/index.html">Working with RF front-end modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../wifi_coex/index.html">Adding Wi-Fi Coexistence support to short-range radio applications</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ecosystem_integration.html">Ecosystems integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nrf91.html">Working with nRF91 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nrf70.html">Working with nRF70 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nrf53.html">Working with nRF53 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nrf52.html">Working with nRF52 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../protocols.html">Protocols</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../applications.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../samples.html">Samples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../drivers.html">Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../libraries/index.html">Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scripts.html">Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../known_issues.html">Known issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../software_maturity.html">Software maturity levels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation.html">About this documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">nRF Connect SDK</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../../app_dev.html">Application development</a></li>
          <li class="breadcrumb-item"><a href="index.html">Bootloaders and Device Firmware Updates</a></li>
      <li class="breadcrumb-item active">Firmware updates</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/app_dev/bootloaders_and_dfu/fw_update.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="firmware-updates">
<span id="ug-fw-update"></span><h1>Firmware updates<a class="headerlink" href="#firmware-updates" title="Permalink to this heading"></a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#signature-keys" id="id6">Signature keys</a></p>
<ul>
<li><p><a class="reference internal" href="#generating-private-keys" id="id7">Generating private keys</a></p></li>
<li><p><a class="reference internal" href="#using-development-keys" id="id8">Using development keys</a></p></li>
<li><p><a class="reference internal" href="#revoking-private-keys" id="id9">Revoking private keys</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#configuring-image-versions" id="id10">Configuring image versions</a></p>
<ul>
<li><p><a class="reference internal" href="#using-nsib" id="id11">Using nRF Secure Immutable Bootloader</a></p></li>
<li><p><a class="reference internal" href="#using-mcuboot" id="id12">Using MCUboot</a></p></li>
</ul>
</li>
</ul>
</div>
<p>This user guide provides an overview of firmware updates with nRF Connect SDK.</p>
<section id="signature-keys">
<span id="ug-fw-update-keys"></span><h2><a class="toc-backref" href="#id6">Signature keys</a><a class="headerlink" href="#signature-keys" title="Permalink to this heading"></a></h2>
<p>You can find information on the key types supported in the nRF Connect SDK in the <a class="reference internal" href="../../samples/bootloader/README.html#bootloader-signature-keys"><span class="std std-ref">nRF Secure Immutable Bootloader</span></a> and <span class="xref std std-doc">mcuboot:imgtool</span> documentation.</p>
<section id="generating-private-keys">
<h3><a class="toc-backref" href="#id7">Generating private keys</a><a class="headerlink" href="#generating-private-keys" title="Permalink to this heading"></a></h3>
<p>The nRF Connect SDK supports the following most common ways to generate private/public key pairs:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#ug-fw-update-keys-openssl"><span class="std std-ref">Using OpenSSL to generate keys</span></a></p></li>
<li><p><a class="reference internal" href="#ug-fw-update-keys-imgtool"><span class="std std-ref">Using Imgtool to generate keys</span></a></p></li>
<li><p><a class="reference internal" href="#ug-fw-update-keys-python"><span class="std std-ref">Using Python to generate keys</span></a></p></li>
</ul>
<section id="using-openssl-to-generate-keys">
<span id="ug-fw-update-keys-openssl"></span><h4>Using OpenSSL to generate keys<a class="headerlink" href="#using-openssl-to-generate-keys" title="Permalink to this heading"></a></h4>
<p><a class="reference external" href="https://www.openssl.org/">OpenSSL</a> is installed by default with some packages and programs, such as Git.
It supports many different types of keys, but not all of them are supported by nRF Secure Immutable Bootloader and MCUboot.
To see a complete list of the key types supported by OpenSSL, call <code class="docutils literal notranslate"><span class="pre">openssl</span> <span class="pre">help</span></code> and <code class="docutils literal notranslate"><span class="pre">openssl</span> <span class="pre">&lt;key</span> <span class="pre">type&gt;</span> <span class="pre">-help</span></code> from a terminal.</p>
<p>For a complete list of the key types supported by each bootloader, see the table below:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Bootloader</p></th>
<th class="head"><p>Supported key types</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>nRF Secure Immutable Bootloader</p></td>
<td><p>ECDSA256</p></td>
</tr>
<tr class="row-odd"><td><p>MCUboot</p></td>
<td><p>RSA-2048, RSA-3072, ECDSA-P256, ED25519</p></td>
</tr>
</tbody>
</table>
<p>See below for examples of using OpenSSL to create some commonly used key types:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-RUNEU0E=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-0-RUNEU0E=" name="RUNEU0E=" role="tab" tabindex="0">ECDSA</button><button aria-controls="panel-0-UlNBLTIwNDg=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-UlNBLTIwNDg=" name="UlNBLTIwNDg=" role="tab" tabindex="-1">RSA-2048</button></div><div aria-labelledby="tab-0-RUNEU0E=" class="sphinx-tabs-panel group-tab" id="panel-0-RUNEU0E=" name="RUNEU0E=" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">openssl ecparam -name prime256v1 -genkey -noout -out priv.pem</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-0-UlNBLTIwNDg=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-UlNBLTIwNDg=" name="UlNBLTIwNDg=" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">openssl genrsa -out priv.pem 2048</span>
</pre></div>
</div>
</div></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">priv.pem</span></code>, <code class="docutils literal notranslate"><span class="pre">priv_*.pem</span></code>, and <code class="docutils literal notranslate"><span class="pre">pub_*.pem</span></code> are keys named arbitrarily and used as an example in this documentation.
You can name private and public keys used with Zephyr and the nRF Connect SDK as you prefer, as long as the files are in the <code class="docutils literal notranslate"><span class="pre">.pem</span></code> format.</p>
</div>
</section>
<section id="using-imgtool-to-generate-keys">
<span id="ug-fw-update-keys-imgtool"></span><h4>Using Imgtool to generate keys<a class="headerlink" href="#using-imgtool-to-generate-keys" title="Permalink to this heading"></a></h4>
<p><span class="xref std std-doc">mcuboot:imgtool</span> is a Python tool maintained by MCUboot that handles public/private key pairs.</p>
<p>It is also available as a PyPI package that you can install using <code class="docutils literal notranslate"><span class="pre">pip</span></code>.
However, when working within the nRF Connect SDK framework, it is recommended to use the script that is included in the fork of MCUboot used by the nRF Connect SDK.</p>
<p>See below for examples of imgtool used to create some commonly used key types:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-1-RUNEU0E=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-1-RUNEU0E=" name="RUNEU0E=" role="tab" tabindex="0">ECDSA</button><button aria-controls="panel-1-UlNBLTIwNDg=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-1-UlNBLTIwNDg=" name="UlNBLTIwNDg=" role="tab" tabindex="-1">RSA-2048</button></div><div aria-labelledby="tab-1-RUNEU0E=" class="sphinx-tabs-panel group-tab" id="panel-1-RUNEU0E=" name="RUNEU0E=" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">python3 bootloader/mcuboot/scripts/imgtool.py keygen -t ecdsa-p256 -k priv.pem</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-1-UlNBLTIwNDg=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-1-UlNBLTIwNDg=" name="UlNBLTIwNDg=" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">python3 bootloader/mcuboot/scripts/imgtool.py keygen -t rsa-2048 -k priv.pem</span>
</pre></div>
</div>
</div></div>
<p>For a full list of supported types, use the <code class="docutils literal notranslate"><span class="pre">--help</span></code> argument with the tool or any of its commands.</p>
</section>
<section id="using-python-to-generate-keys">
<span id="ug-fw-update-keys-python"></span><h4>Using Python to generate keys<a class="headerlink" href="#using-python-to-generate-keys" title="Permalink to this heading"></a></h4>
<p>The nRF Connect SDK includes an internal script to interact with private and public keys with the nRF Secure Immutable Bootloader.
This script is maintained by the nRF Connect SDK team and uses the <code class="docutils literal notranslate"><span class="pre">ecdsa</span></code> package available from PyPI.
It is only valid for use with ECDSA keys.</p>
<p>See below for an example of this internal Python script used to generate keys.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">python3 nrf/scripts/bootloader/keygen.py --private -o priv.pem</span>
</pre></div>
</div>
</section>
</section>
<section id="using-development-keys">
<span id="ug-fw-update-development-keys"></span><h3><a class="toc-backref" href="#id8">Using development keys</a><a class="headerlink" href="#using-development-keys" title="Permalink to this heading"></a></h3>
<p>When testing the bootloader chain, you can optionally generate and use custom signing keys.
If you do not provide your own keys through Kconfig options, the build system automatically creates debug keys, depending on the bootloaders compiled into the application.</p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>Keys that are automatically used or generated by bootloaders for image signature validation are intended for <em>development or debug use only</em>.</p>
<p>You should <em>never</em> send applications into production when they are not protected by secure keys.
You must always create and store these keys in a safe location, not only to protect the security of the application but also to ensure that the hardware can receive firmware updates throughout the project lifecycle.</p>
<p>While the default keys for MCUboot are tracked in its repository and are therefore publicly visible, the development/debug keys autogenerated by nRF Secure Immutable Bootloader change whenever the build directory is removed and rebuilt from scratch.
If you are not programming the nRF Secure Immutable Bootloader when this happens, relying on the default ECDSA key to sign an application or an upgradable second-stage bootloader image results in a failed boot chain validation.</p>
<p>You can avoid this issue by storing a custom private key outside of the build directory during development.</p>
</div>
</section>
<section id="revoking-private-keys">
<span id="ug-fw-update-key-revocation"></span><h3><a class="toc-backref" href="#id9">Revoking private keys</a><a class="headerlink" href="#revoking-private-keys" title="Permalink to this heading"></a></h3>
<p>The nRF Secure Immutable Bootloader allows you to revoke public verification keys used to validate the next image in the secure boot chain.
Key revocation can be a useful security measure for devices that have already been deployed to the field.
If a private key has been compromised or lost, you can invalidate its public key by uploading a new firmware image signed by another key known to the bootloader.</p>
<p>These keys are kept internally by the bootloader, so the list of available public keys cannot change once it is deployed.
See <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_SB_PUBLIC_KEY_FILES</span></code> for details on how this mechanism is implemented.</p>
<p>You can add this feature to your own project and check its functionality as follows:</p>
<ol class="arabic">
<li><p>Use the <a class="reference internal" href="#ug-fw-update-keys-python"><span class="std std-ref">bootloader Python script</span></a> to generate two or more private keys for the application and extract a public key for each one:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">python3 nrf/scripts/bootloader/keygen.py --public -i priv.pem -o pub.pem</span>
</pre></div>
</div>
</li>
<li><p>Compile the application and bootloader with the relevant configurations, using only absolute paths:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">CONFIG_SECURE_BOOT=y</span>
<span class="go">CONFIG_SB_SIGNING_KEY_FILE=&quot;/path/to/priv_a.pem&quot;</span>
<span class="go">CONFIG_SB_PUBLIC_KEY_FILES=&quot;/path/to/pub_b.pem,/path/to/pub_c.pem&quot;</span>
</pre></div>
</div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>The public key associated with the original private signing key must not be included in the public key list.</p>
</div>
</li>
<li><p>Program the application to the target development kit and <a class="reference internal" href="bootloader_testing.html#ug-bootloader-testing"><span class="std std-ref">check its console output</span></a>.
With the first firmware version, <code class="docutils literal notranslate"><span class="pre">priv_a.pem</span></code> and <code class="docutils literal notranslate"><span class="pre">pub_a.pem</span></code> are used for signing and validating the image.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">*** Booting Zephyr OS build ...  ***</span>
<span class="go">Attempting to boot slot 0.</span>
<span class="go">Attempting to boot from address 0x9000.</span>
<span class="go">Verifying signature against key 0.</span>
<span class="go">Hash: 0xda...4f</span>
<span class="go">Firmware signature verified.</span>
<span class="go">Firmware version 1</span>
<span class="go">*** Booting Zephyr OS build ...  ***</span>
<span class="go">...</span>
</pre></div>
</div>
</li>
<li><p>To revoke keys, rebuild the application modifying the configuration setting to use the private key associated with a key listed <em>after</em> the currently used key in the list.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">CONFIG_BUILD_S1_VARIANT=y</span>
<span class="go">CONFIG_SB_SIGNING_KEY_FILE=&quot;/path/to/priv_c.pem&quot;</span>
<span class="go">CONFIG_FW_INFO_FIRMWARE_VERSION=2</span>
</pre></div>
</div>
<p>In this example, when compiling with the <code class="docutils literal notranslate"><span class="pre">priv_c.pem</span></code> key, images signed with <code class="docutils literal notranslate"><span class="pre">priv_a.pem</span></code> or <code class="docutils literal notranslate"><span class="pre">priv_b.pem</span></code> no longer boot when uploaded into an image slot.
Additionally, a firmware version higher than the previous one has been set.</p>
</li>
<li><p>Deploy the firmware update.</p></li>
<li><p>Observe the bootloader checking the hashes of the public keys against the new image, then invalidating the earlier keys:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">*** Booting Zephyr OS build ...  ***</span>
<span class="go">Attempting to boot slot 1.</span>
<span class="go">Attempting to boot from address 0x84800.</span>
<span class="go">Verifying signature against key 0.</span>
<span class="go">Hash: 0xda...4f</span>
<span class="go">Public key didn&#39;t match, try next.</span>
<span class="go">Verifying signature against key 1.</span>
<span class="go">Hash: 0x5c...f5</span>
<span class="go">Public key didn&#39;t match, try next.</span>
<span class="go">Verifying signature against key 2.</span>
<span class="go">Hash: 0x19...73</span>
<span class="go">Invalidating key 0.</span>
<span class="go">Invalidating key 1.</span>
<span class="go">Firmware signature verified.</span>
<span class="go">Firmware version 2</span>
<span class="go">Setting monotonic counter (version: 2, slot: 1)</span>
<span class="go">*** Booting Zephyr OS build ...  ***</span>
<span class="go">...</span>
</pre></div>
</div>
</li>
</ol>
<p>You can test that the bootloader no longer boots images signed with the earlier keys by uploading an image signed with one of them.</p>
<ol class="arabic">
<li><p>To do this, recompile the application with the following options:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">CONFIG_SB_SIGNING_KEY_FILE=&quot;/path/to/priv_b.pem&quot;</span>
<span class="go">CONFIG_FW_INFO_FIRMWARE_VERSION=3</span>
</pre></div>
</div>
</li>
<li><p>To facilitate testing, you can use nrfjprog to program this image directly into a slot:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nrfjprog -f nRF52 -r --verify --program build/zephyr/signed_by_b0_s0_image.hex --sectorerase</span>
</pre></div>
</div>
</li>
<li><p>Observe the bootloader skipping the invalid image and booting the valid image in the other slot:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">*** Booting Zephyr OS build ...  ***</span>
<span class="go">Attempting to boot slot 0.</span>
<span class="go">Attempting to boot from address 0x9000.</span>
<span class="go">Key 0 has been invalidated, try next.</span>
<span class="go">Key 1 has been invalidated, try next.</span>
<span class="go">Verifying signature against key 2.</span>
<span class="go">Hash: 0x19...73</span>
<span class="go">Public key didn&#39;t match, try next.</span>
<span class="go">Failed to validate signature.</span>
<span class="go">Failed to validate, permanently invalidating!</span>
<span class="go">Attempting to boot slot 1.</span>
<span class="go">Attempting to boot from address 0x84800.</span>
<span class="go">Key 0 has been invalidated, try next.</span>
<span class="go">Key 1 has been invalidated, try next.</span>
<span class="go">Verifying signature against key 2.</span>
<span class="go">Hash: 0x19...73</span>
<span class="go">Invalidating key 0.</span>
<span class="go">Invalidating key 1.</span>
<span class="go">Firmware signature verified.</span>
<span class="go">Firmware version 2</span>
<span class="go">*** Booting Zephyr OS build ...  ***</span>
<span class="go">...</span>
</pre></div>
</div>
</li>
</ol>
<p>Recompile with <code class="docutils literal notranslate"><span class="pre">priv_c.pem</span></code> and the incremented firmware version to correctly boot the new image.</p>
</section>
</section>
<section id="configuring-image-versions">
<span id="ug-fw-update-image-versions"></span><h2><a class="toc-backref" href="#id10">Configuring image versions</a><a class="headerlink" href="#configuring-image-versions" title="Permalink to this heading"></a></h2>
<p>With the nRF Connect SDK, you must choose the method for versioning an image for use in firmware releases and updates depending on the type of bootloader that will be booting into the new firmware release.</p>
<section id="using-nsib">
<span id="ug-fw-update-image-versions-b0"></span><h3><a class="toc-backref" href="#id11">Using nRF Secure Immutable Bootloader</a><a class="headerlink" href="#using-nsib" title="Permalink to this heading"></a></h3>
<p>A non-volatile <em>monotonic counter</em> can be stored in the <em>Provision</em> area and is used to implement anti-rollback protection.</p>
<p>Counter updates are written to slots in the <em>Provision</em> area, with each new counter update occupying a new slot.
For this reason, the number of counter updates, and therefore firmware version updates, is limited.</p>
<p>Using a counter is optional and can be configured for the application using configuration options.
You can also configure the supported number of updates, but the number is limited by the size of the <em>Provision</em> area and how much of that area is taken up by other features, like public key hashes.
In addition, you can configure what firmware version of the image you want to boot.</p>
<p>For NSIB, the configuration options are <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_SB_MONOTONIC_COUNTER</span></code>, <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_SB_NUM_VER_COUNTER_SLOTS</span></code>, and <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_FW_INFO_FIRMWARE_VERSION</span></code>.</p>
<p>For MCUboot, the configuration options are <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_MCUBOOT_HARDWARE_DOWNGRADE_PREVENTION</span></code>, <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_MCUBOOT_HW_DOWNGRADE_PREVENTION_COUNTER_SLOTS</span></code>, and <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">MCUBOOT_HW_DOWNGRADE_PREVENTION_COUNTER_VALUE</span></code>.</p>
<p>To set options for child images, such as NSIB and MCUboot, see the <a class="reference internal" href="../multi_image/index.html#ug-multi-image-variables"><span class="std std-ref">Image-specific variables</span></a> section.</p>
<p>Special handling is needed when updating the S1 variant of an image.
See <a class="reference internal" href="bootloader_adding.html#ug-bootloader-adding-presigned-variants"><span class="std std-ref">Generating pre-signed variants</span></a> for details.</p>
</section>
<section id="using-mcuboot">
<span id="ug-fw-update-image-versions-mcuboot"></span><h3><a class="toc-backref" href="#id12">Using MCUboot</a><a class="headerlink" href="#using-mcuboot" title="Permalink to this heading"></a></h3>
<p>MCUboot supports two different implementations of downgrade protection:</p>
<ul class="simple">
<li><p>Software-based prevention, where the current version can be encoded into the currently active image.</p></li>
<li><p>Hardware-based prevention, where the current version can be encoded into a non-volatile storage partition outside of any image.</p></li>
</ul>
<section id="software-based-downgrade-prevention">
<span id="ug-fw-update-image-versions-mcuboot-downgrade"></span><h4>Software-based downgrade prevention<a class="headerlink" href="#software-based-downgrade-prevention" title="Permalink to this heading"></a></h4>
<p>The nRF Connect SDK supports MCUboot’s software-based downgrade prevention for application images, using semantic versioning.
This feature offers protection against any outdated firmware that is uploaded to a device.</p>
<p>You can enable this feature by setting the configuration options <code class="docutils literal notranslate"><span class="pre">CONFIG_MCUBOOT_DOWNGRADE_PREVENTION</span></code> and <code class="docutils literal notranslate"><span class="pre">CONFIG_BOOT_UPGRADE_ONLY</span></code> for the MCUboot image.</p>
<p>To assign a semantic version number to your application, pass the version string into the <code class="docutils literal notranslate"><span class="pre">CONFIG_MCUBOOT_IMAGE_VERSION</span></code> option for the application:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">CONFIG_MCUBOOT_IMAGE_VERSION=&quot;0.1.2+3&quot;</span>
</pre></div>
</div>
<p>See the <a class="reference external" href="https://semver.org/">Semantic versioning</a> webpage or <span class="xref std std-doc">mcuboot:imgtool</span> for details on version syntax.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Enabling <code class="docutils literal notranslate"><span class="pre">CONFIG_BOOT_UPGRADE_ONLY</span></code> prevents the fallback recovery of application images.
Consult its Kconfig description and the <span class="xref std std-doc">MCUboot Design documentation</span> for more information on how to use it.</p>
</div>
<p>You can compile your application with this feature as follows:</p>
<pre class="highlight literal-block">west build -b <em>board</em> <em>application</em> -- \
-DCONFIG_BOOTLOADER_MCUBOOT=y \
-DCONFIG_MCUBOOT_IMAGE_VERSION=\&quot;0.1.2\+3\&quot; \
-Dmcuboot_CONFIG_MCUBOOT_DOWNGRADE_PREVENTION=y \
-Dmcuboot_CONFIG_BOOT_UPGRADE_ONLY=y</pre>
<p>See <a class="reference internal" href="../../getting_started/modifying.html#configure-application"><span class="std std-ref">Configuring your application</span></a> for information on how to set the required configuration options temporarily or permanently.</p>
<p>After you upload a new image and reset the development kit, MCUboot attempts to boot the secondary image.
If this image has, in order of precedence, a <em>major</em>, <em>minor</em>, or <em>revision</em> value that is lower than the primary application image, it is considered invalid and the existing primary application boots instead.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The optional label or build number specified after the <code class="docutils literal notranslate"><span class="pre">+</span></code> character is ignored when evaluating the version.
An existing application image with version <code class="docutils literal notranslate"><span class="pre">0.1.2+3</span></code> can be overwritten by an uploaded image with <code class="docutils literal notranslate"><span class="pre">0.1.2+2</span></code>, but not by one with <code class="docutils literal notranslate"><span class="pre">0.1.1+2</span></code>.</p>
</div>
</section>
<section id="hardware-based-downgrade-prevention">
<h4>Hardware-based downgrade prevention<a class="headerlink" href="#hardware-based-downgrade-prevention" title="Permalink to this heading"></a></h4>
<p>Hardware-based downgrade prevention is implemented with a counter value stored in the <em>provision</em> partition of the non-volatile storage.</p>
<p>See the <a class="reference internal" href="../../samples/bootloader/README.html#bootloader-monotonic-counter"><span class="std std-ref">Monotonic counter</span></a> section for how to enable and configure this feature.</p>
</section>
<section id="mcuboot-output-build-files">
<span id="ug-fw-mcuboot-output"></span><h4>MCUboot output build files<a class="headerlink" href="#mcuboot-output-build-files" title="Permalink to this heading"></a></h4>
<p>Read the <a class="reference internal" href="../build_and_config_system/index.html#app-build-mcuboot-output"><span class="std std-ref">MCUboot output build files</span></a> page for the list of all the FOTA upgrade files that are automatically generated when using MCUboot.</p>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../logging/index.html" class="btn btn-neutral float-right" title="Logging in nRF Connect SDK" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="bootloader_config.html" class="btn btn-neutral" title="Customizing the bootloader" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">

<table>
<tr>
<td>
    <p>
        &copy; Copyright 2019-2023, Nordic Semiconductor.
      Last updated on Mar 20, 2023.

    </p>
</td>
<td id="nordiclogo">
  <a href="https://www.nordicsemi.com/"><img src="../../_static/images/nordic-logo.png" border="0"/></a>
</td>
</tr>
</table>
  </div> 


</footer>

<div id="scroll-container">
  <button type="button" id="scroll-btn" class="btn">
    <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="#fff"/></svg>
  </button>
</div>

<script>
  const scrollBtn = document.querySelector("#scroll-btn");

  document.addEventListener("scroll", () => {
    if (window.scrollY > 400) {
          scrollBtn.style.visibility = "visible";
      } else {
          scrollBtn.style.visibility = "hidden";
      }
  });

  scrollBtn.addEventListener("click", () => {
      window.scrollTo({ top: 0, behavior: "smooth" });
  });
</script>
        </div>
      </div>
    </section>
  </div>
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> nRF Connect SDK</span>
       <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      
      <div class="rst-other-version ncs">
        <a href="../../../nrf/index.html">nRF Connect SDK</a>
      </div>
      
      <div class="rst-other-version nrfx">
        <a href="../../../nrfx/index.html">nrfx</a>
      </div>
      
      <div class="rst-other-version nrfxlib">
        <a href="../../../nrfxlib/README.html">nrfxlib</a>
      </div>
      
      <div class="rst-other-version zephyr">
        <a href="../../../zephyr/index.html">Zephyr Project</a>
      </div>
      
      <div class="rst-other-version mcuboot">
        <a href="../../../mcuboot/wrapper.html">MCUboot</a>
      </div>
      
      <div class="rst-other-version tfm">
        <a href="../../../tfm/index.html">Trusted Firmware-M</a>
      </div>
      
      <div class="rst-other-version matter">
        <a href="../../../matter/index.html">Matter</a>
      </div>
      
      <div class="rst-other-version kconfig">
        <a href="../../../kconfig/index.html">Kconfig Reference</a>
      </div>
    </div>
  </div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>