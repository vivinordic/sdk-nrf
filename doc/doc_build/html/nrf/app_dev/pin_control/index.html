<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pin control &mdash; nRF Connect SDK 2.3.99 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/nordic.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/togglebutton.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/nrf.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/tabs.css" type="text/css" /> 
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="https://www.googletagmanager.com/gtag/js?id=G-ZPVZRKFQJR"></script>
        <script src="../../_static/js/ga-tracker.js"></script>
        <script data-culture="EN" id="CookieConsent" type="text/javascript" src="https://policy.app.cookieinformation.com/uc.js"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../_static/togglebutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/js/theme.js"></script>
<script
  type="text/javascript"
  src="../../_static/js/ncs.js"
></script>
<script src="../../_static/js/bootstrap.bundle.min.js"></script>

    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Build and configuration system" href="../build_and_config_system/index.html" />
    <link rel="prev" title="Board support" href="../board_support/index.html" />
<link
  href="../../_static/css/bootstrap.min.css"
  rel="stylesheet"
/>
<link
  rel="shortcut icon"
  href="../../_static/images/favicon.ico"
/>

</head>

<body class="wy-body-for-nav">
<div class="announcement"></div>
<div class="d-print-none ncs-header">
  <div class="container-xl ncs-header-top">
    <div class="row h-100">
      <div class="d-none d-md-block col-2">
        <div class="bg-white py-4 px-3 ml-2 ncs-header-logo">
          <img
            class="ncs-header-logo"
            src="../../_static/images/nordic-logo.png"
            alt=""
          />
        </div>
      </div>
      <div
        class="col-8 col-md-7 pl-md-4 d-flex align-self-center justify-content-center"
      >
        <form class="w-75" action="../../search.html" method="get">
          <div class="form-group">
            <input
              type="text"
              name="q"
              class="ncs-search-input form-control"
              placeholder="Search all docs..."
            />
          </div>
        </form>
      </div>
      <div class="col-4 col-md-3 d-md-block p-3 text-end">
        <div class="dropdown">
          <button
            class="btn dropdown-toggle ncs-btn-versions"
            type="button"
            id="dropdownMenuButton1"
            data-bs-toggle="dropdown"
            aria-expanded="false"
          >
            <span class="d-none d-md-inline">nRF Connect SDK</span>
            <span id="ncsversion" class="d-inline"></span>
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton"></div>
        </div>
      </div>
    </div>
  </div>
  <div class="ncs-header-nav">
    <div class="container-xl">
      <div class="row">
        <div class="col col-12 d-flex justify-content-center">
          <nav class="navbar navbar-dark navbar-expand-lg p-0">
            <span class="navbar-brand d-block d-lg-none py-2 pl-1"
              >Documentation sets</span
            >
            <button
              class="navbar-toggler"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#navbarNavAltMarkup"
              aria-controls="navbarNavAltMarkup"
              aria-expanded="false"
              aria-label="Toggle navigation"
            >
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
              <ul class="navbar-nav">
                <li class="nav-item active py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../nrf/index.html"
                    >nRF Connect SDK</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../nrfx/index.html"
                    >nrfx</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../nrfxlib/README.html"
                    >nrfxlib</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../zephyr/index.html"
                    >Zephyr Project</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../mcuboot/wrapper.html"
                    >MCUboot</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../tfm/index.html"
                    >Trusted Firmware-M</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../matter/index.html"
                    >Matter</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../kconfig/index.html"
                    >Kconfig Reference</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
              </ul>
            </div>
          </nav>
        </div>
      </div>
    </div>
  </div>
</div>

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> nRF Connect SDK
          </a>
              <div class="version">
                2.3.99
              </div>
<div id="searchbox" role="search">
  <div class="searchformwrapper">
    <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
  </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev_model.html">Development model</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../app_dev.html">Application development</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../board_support/index.html">Board support</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Pin control</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#pin-control-in-nrf">Pin control in nRF</a></li>
<li class="toctree-l3"><a class="reference internal" href="#migration-of-the-devicetree-files">Migration of the devicetree files</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#overlay-files">Overlay files</a></li>
<li class="toctree-l4"><a class="reference internal" href="#migration-script">Migration script</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../build_and_config_system/index.html">Build and configuration system</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optimizing/index.html">Optimizing application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ap_protect/index.html">Enabling access port protection mechanism</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bootloaders_and_dfu/index.html">Bootloaders and Device Firmware Updates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../logging/index.html">Logging in nRF Connect SDK</a></li>
<li class="toctree-l2"><a class="reference internal" href="../multi_image/index.html">Multi-image builds</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing_unity_cmock/index.html">Testing with Unity and CMock</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tfm/index.html">Running applications with Trusted Firmware-M</a></li>
<li class="toctree-l2"><a class="reference internal" href="../working_with_fem/index.html">Working with RF front-end modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../wifi_coex/index.html">Adding Wi-Fi Coexistence support to short-range radio applications</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ecosystem_integration.html">Ecosystems integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nrf91.html">Working with nRF91 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nrf70.html">Working with nRF70 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nrf53.html">Working with nRF53 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nrf52.html">Working with nRF52 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../protocols.html">Protocols</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../applications.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../samples.html">Samples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../drivers.html">Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../libraries/index.html">Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scripts.html">Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../known_issues.html">Known issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../software_maturity.html">Software maturity levels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation.html">About this documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">nRF Connect SDK</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../../app_dev.html">Application development</a></li>
      <li class="breadcrumb-item active">Pin control</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/app_dev/pin_control/index.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="pin-control">
<span id="ug-pinctrl"></span><h1>Pin control<a class="headerlink" href="#pin-control" title="Permalink to this heading"></a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#pin-control-in-nrf" id="id6">Pin control in nRF</a></p></li>
<li><p><a class="reference internal" href="#migration-of-the-devicetree-files" id="id7">Migration of the devicetree files</a></p>
<ul>
<li><p><a class="reference internal" href="#overlay-files" id="id8">Overlay files</a></p></li>
<li><p><a class="reference internal" href="#migration-script" id="id9">Migration script</a></p></li>
</ul>
</li>
</ul>
</div>
<p>Pin control, also referred to as <code class="docutils literal notranslate"><span class="pre">pinctrl</span></code>, is a Zephyr RTOS API introduced as an effort to standardize how SoC peripheral pins are configured.
This enables mapping peripheral signals to the required pins as well as configuring necessary pin properties.
For example, using pin control, you can route <code class="docutils literal notranslate"><span class="pre">UART0</span></code> <code class="docutils literal notranslate"><span class="pre">RX</span></code> signal to pin <code class="docutils literal notranslate"><span class="pre">P1.01</span></code> and configure the pin pull-up resistor.</p>
<p>Before pin control, the same functionality was available in a vendor specific way.
For the previous example, Nordic SoCs had to be configured in the following way:</p>
<div class="highlight-dts notranslate"><div class="highlight"><pre><span></span><span class="o">&amp;</span><span class="na">uart0</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">...</span>
<span class="w">    </span><span class="n">rx-pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">33</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">    </span><span class="n">rx-pull-up</span><span class="p">;</span>
<span class="w">    </span><span class="p">...</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Pin control works using a <em>state model</em>, where each <em>state</em> encodes the pin configurations for a state of the peripheral.
Following are the standard states:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">default</span></code> - Peripheral in working mode.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sleep</span></code> - Peripheral in sleep mode or low power mode.</p></li>
</ul>
<p>A similar approach is also used in other systems like Linux.
For more details including nRF specific bits, see the next section.</p>
<p>For more general information, see the <span class="xref std std-ref">Zephyr documentation on pin control</span>.</p>
<section id="pin-control-in-nrf">
<h2><a class="toc-backref" href="#id6">Pin control in nRF</a><a class="headerlink" href="#pin-control-in-nrf" title="Permalink to this heading"></a></h2>
<p>The nRF pin controller is represented in <span class="xref std std-ref">devicetree</span> with the <code class="docutils literal notranslate"><span class="pre">pinctrl</span></code> node label.
This node contains all pin configurations and you can modify it as shown in the following snippet:</p>
<div class="highlight-dts notranslate"><div class="highlight"><pre><span></span><span class="o">&amp;</span><span class="na">pinctrl</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="cm">/* Add your modifications here */</span>
<span class="p">};</span>
</pre></div>
</div>
<p>All device pin configurations must be placed in child nodes of the <code class="docutils literal notranslate"><span class="pre">pinctrl</span></code> node, as shown in the following example:</p>
<div class="highlight-dts notranslate"><div class="highlight"><pre><span></span><span class="o">&amp;</span><span class="na">pinctrl</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="cm">/* configuration for uart0 device, default state */</span>
<span class="w">   </span><span class="nl">uart0_default</span><span class="p">:</span><span class="w"> </span><span class="nf">uart0_default</span><span class="cm"> </span><span class="p">{</span>
<span class="w">     </span><span class="cm">/* group 1 (&#39;group1&#39; name is arbitrary) */</span>
<span class="w">     </span><span class="nf">group1</span><span class="cm"> </span><span class="p">{</span>
<span class="w">       </span><span class="cm">/* configure P0.1 as UART_TX and P0.2 as UART_RTS */</span>
<span class="w">       </span><span class="n">psels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="na">NRF_PSEL</span><span class="p">(</span><span class="na">UART_TX</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="o">&lt;</span><span class="na">NRF_PSEL</span><span class="p">(</span><span class="na">UART_RTS</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">     </span><span class="p">};</span>
<span class="w">     </span><span class="cm">/* group 2 */</span>
<span class="w">     </span><span class="nf">group2</span><span class="cm"> </span><span class="p">{</span>
<span class="w">       </span><span class="cm">/* configure P0.3 as UART_RX and P0.4 as UART_CTS */</span>
<span class="w">       </span><span class="n">psels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="na">NRF_PSEL</span><span class="p">(</span><span class="na">UART_RX</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="o">&lt;</span><span class="na">NRF_PSEL</span><span class="p">(</span><span class="na">UART_CTS</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">       </span><span class="cm">/* both P0.3 and P0.4 are configured with pull-up */</span>
<span class="w">       </span><span class="n">bias-pull-up</span><span class="p">;</span>
<span class="w">     </span><span class="p">};</span>
<span class="w">   </span><span class="p">};</span>
<span class="w">   </span><span class="cm">/* configuration for uart0 device, sleep state */</span>
<span class="w">   </span><span class="nl">uart0_sleep</span><span class="p">:</span><span class="w"> </span><span class="nf">uart0_sleep</span><span class="cm"> </span><span class="p">{</span>
<span class="w">     </span><span class="cm">/* group 1 (&#39;group1&#39; name is arbitrary) */</span>
<span class="w">     </span><span class="nf">group1</span><span class="cm"> </span><span class="p">{</span>
<span class="w">       </span><span class="cm">/* configure P0.1 as UART_TX, P0.2 as UART_RTS P0.3 as UART_RX and</span>
<span class="cm">        * P0.4 as UART_CTS</span>
<span class="cm">        */</span>
<span class="w">       </span><span class="n">psels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="na">NRF_PSEL</span><span class="p">(</span><span class="na">UART_TX</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="o">&lt;</span><span class="na">NRF_PSEL</span><span class="p">(</span><span class="na">UART_RTS</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">               </span><span class="o">&lt;</span><span class="na">NRF_PSEL</span><span class="p">(</span><span class="na">UART_RX</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="o">&lt;</span><span class="na">NRF_PSEL</span><span class="p">(</span><span class="na">UART_CTS</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">       </span><span class="cm">/* all pins are configured in low power mode */</span>
<span class="w">       </span><span class="n">low-power-enable</span><span class="p">;</span>
<span class="w">     </span><span class="p">};</span>
<span class="w">   </span><span class="p">};</span>
<span class="w"> </span><span class="p">};</span>
</pre></div>
</div>
<p>You can put the previous code in a <code class="file docutils literal notranslate"><span class="pre">board-pinctrl.dtsi</span></code> file in your board directory, or a devicetree overlay in your application.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">uart0_default</span></code> child node encodes the pin configurations for a particular state of a device; in this case, the <code class="docutils literal notranslate"><span class="pre">default</span></code> active state.
Similarly, <code class="docutils literal notranslate"><span class="pre">uart0_sleep</span></code> child node encodes the pin configurations for the <code class="docutils literal notranslate"><span class="pre">sleep</span></code> state.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">sleep</span></code> state is only required if <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_PM_DEVICE</span></code> is set to <code class="docutils literal notranslate"><span class="pre">y</span></code>.</p>
</div>
<p>As shown in the code snippet, the pin configurations are organized in groups within each child node.
Each group can specify a list of pin function selections in the <code class="docutils literal notranslate"><span class="pre">psels</span></code> property.
The <code class="docutils literal notranslate"><span class="pre">NRF_PSEL</span></code> macro is used to specify a pin function selection.
Available pin functions can be found in the <code class="file docutils literal notranslate"><span class="pre">include/dt-bindings/pinctrl/nrf-pinctrl.h</span></code> header file in the <a class="reference external" href="https://github.com/zephyrproject-rtos/zephyr">Zephyr repository</a>.</p>
<p>A group can also specify shared pin properties common to all the specified pins, such as the <code class="docutils literal notranslate"><span class="pre">bias-pull-up</span></code> property in group 2.
Here is a list of the supported standard pin properties:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">bias-disable</span></code> - Disable pull-up/down (default behavior, not required).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bias-pull-up</span></code> - Enable pull-up resistor.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bias-pull-down</span></code> - Enable pull-down resistor.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">low-power-enable</span></code> - Configure pin as an input with input buffer disconnected.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The bias options are mutually exclusive.</p>
</div>
<p>The following non-standard, nRF-specific properties are also supported:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">nordic,drive-mode</span></code> - Pin output drive mode. Available drive modes are pre-defined in <code class="file docutils literal notranslate"><span class="pre">include/dt-bindings/pinctrl/nrf-pinctrl.h</span></code>. Note that extra modes might not be available on certain devices. When not specified, pin defaults to standard mode for 0 and 1 (<code class="docutils literal notranslate"><span class="pre">NRF_DRIVE_S0S1</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nordic,invert</span></code> - Invert pin polarity  (set active state to low). This property is valid only for PWM channel output pins.</p></li>
</ul>
<p>To link this pin configuration with a device, use a pinctrl-N property where N is the state index starting from zero.
You can add the following code in the DTS file of your board:</p>
<div class="highlight-dts notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cm"> </span><span class="cpf">&quot;board-pinctrl.dtsi&quot;</span>

<span class="w"> </span><span class="o">&amp;</span><span class="na">uart0</span><span class="w"> </span><span class="p">{</span>
<span class="w">     </span><span class="p">...</span>
<span class="w">     </span><span class="cm">/* default state */</span>
<span class="w">     </span><span class="n">pinctrl-0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&amp;</span><span class="na">uart0_default</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">     </span><span class="cm">/* sleep state (only applicable if CONFIG_PM_DEVICE=y) */</span>
<span class="w">     </span><span class="n">pinctrl-1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&amp;</span><span class="na">uart0_sleep</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">     </span><span class="cm">/* state assigned to each pinctrl-N property by index */</span>
<span class="w">     </span><span class="n">pinctrl-names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;default&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;sleep&quot;</span><span class="p">;</span>
<span class="w">     </span><span class="p">...</span>
<span class="w"> </span><span class="p">};</span>
</pre></div>
</div>
</section>
<section id="migration-of-the-devicetree-files">
<h2><a class="toc-backref" href="#id7">Migration of the devicetree files</a><a class="headerlink" href="#migration-of-the-devicetree-files" title="Permalink to this heading"></a></h2>
<p>To migrate the devicetree files of any Nordic-based board, you must complete the following steps:</p>
<ol class="arabic simple">
<li><p>Create a <code class="file docutils literal notranslate"><span class="pre">board-pinctrl.dtsi</span></code> file, defining each peripheral state pin configuration.</p></li>
<li><p>Include this file in the <code class="file docutils literal notranslate"><span class="pre">board.dts</span></code> file.</p></li>
<li><p>Replace all <code class="docutils literal notranslate"><span class="pre">-pin</span></code> related properties with pin control states.</p></li>
<li><p>Enable pin control by setting <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_PINCTRL</span></code> to <code class="docutils literal notranslate"><span class="pre">y</span></code> in the <code class="file docutils literal notranslate"><span class="pre">board.conf</span></code> file.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The old method of implementing pin control using <code class="docutils literal notranslate"><span class="pre">-pin</span></code> properties is supported on custom boards if the configuration option <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_PINCTRL</span></code>  is set to <code class="docutils literal notranslate"><span class="pre">n</span></code>. However, this method will be deprecated and removed in the upcoming Zephyr releases.</p>
</div>
<p>The following example illustrates the migration of a board file:</p>
<div class="highlight-dts notranslate"><div class="highlight"><pre><span></span><span class="cm">/* old board.dts */</span>
<span class="o">&amp;</span><span class="na">uart0</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">...</span>
<span class="w">    </span><span class="n">tx-pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">5</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">    </span><span class="n">rx-pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">33</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">    </span><span class="n">rx-pull-up</span><span class="p">;</span>
<span class="w">    </span><span class="p">...</span>
<span class="p">};</span>
</pre></div>
</div>
<div class="highlight-dts notranslate"><div class="highlight"><pre><span></span><span class="cm">/* new board-pinctrl.dtsi file */</span>
<span class="o">&amp;</span><span class="na">pinctrl</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nl">uart0_default</span><span class="p">:</span><span class="w"> </span><span class="nf">uart0_default</span><span class="cm"> </span><span class="p">{</span>
<span class="w">        </span><span class="nf">group1</span><span class="cm"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">psels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="na">NRF_PSEL</span><span class="p">(</span><span class="na">UART_TX</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">        </span><span class="nf">group2</span><span class="cm"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">psels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="na">NRF_PSEL</span><span class="p">(</span><span class="na">UART_RX</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">            </span><span class="n">bias-pull-up</span><span class="p">;</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="nl">uart0_sleep</span><span class="p">:</span><span class="w"> </span><span class="nf">uart0_sleep</span><span class="cm"> </span><span class="p">{</span>
<span class="w">        </span><span class="nf">group1</span><span class="cm"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">psels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="na">NRF_PSEL</span><span class="p">(</span><span class="na">UART_TX</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">                    </span><span class="o">&lt;</span><span class="na">NRF_PSEL</span><span class="p">(</span><span class="na">UART_RX</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">            </span><span class="n">low-power-enable</span><span class="p">;</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">};</span>
</pre></div>
</div>
<div class="highlight-dts notranslate"><div class="highlight"><pre><span></span><span class="cm">/* adjusted board.dts */</span>
<span class="p">...</span>
<span class="o">#</span><span class="na">include</span><span class="w"> </span><span class="s">&quot;board-pinctrl.dtsi&quot;</span>
<span class="p">...</span>
<span class="o">&amp;</span><span class="na">uart0</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">...</span>
<span class="w">    </span><span class="n">pinctrl-0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&amp;</span><span class="na">uart0_default</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">    </span><span class="n">pinctrl-1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&amp;</span><span class="na">uart0_sleep</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">    </span><span class="n">pinctrl-names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;default&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;sleep&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">...</span>
<span class="p">};</span>
</pre></div>
</div>
<section id="overlay-files">
<h3><a class="toc-backref" href="#id8">Overlay files</a><a class="headerlink" href="#overlay-files" title="Permalink to this heading"></a></h3>
<p>For overlay files, the migration procedure is same as that of devicetree files.
In the case of overlays, the name of the state configuration nodes must have a different name, for example, <code class="docutils literal notranslate"><span class="pre">uart0_default_alt</span></code>.</p>
<p>All upstream boards define both <code class="docutils literal notranslate"><span class="pre">default</span></code> and <code class="docutils literal notranslate"><span class="pre">sleep</span></code> states.
Overlays also need to define both.
However, if a particular sample or application does not make use of device power management, you can configure the overlay file in the following way:</p>
<div class="highlight-dts notranslate"><div class="highlight"><pre><span></span><span class="o">&amp;</span><span class="na">pinctrl</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nl">uart0_default_alt</span><span class="p">:</span><span class="w"> </span><span class="nf">uart0_default_alt</span><span class="cm"> </span><span class="p">{</span>
<span class="w">        </span><span class="p">...</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">};</span>

<span class="o">&amp;</span><span class="nf">uart0</span><span class="cm"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">...</span>
<span class="w">    </span><span class="n">pinctrl-0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&amp;</span><span class="na">uart0_default_alt</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">    </span><span class="cp">/delete-property/</span><span class="cm"> </span><span class="cp">pinctrl-1</span><span class="p">;</span>
<span class="w">    </span><span class="n">pinctrl-names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;default&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">...</span>
<span class="p">};</span>
</pre></div>
</div>
</section>
<section id="migration-script">
<h3><a class="toc-backref" href="#id9">Migration script</a><a class="headerlink" href="#migration-script" title="Permalink to this heading"></a></h3>
<p>A utility script is provided to automatically migrate the devicetree files of any Nordic-based board to include pin control.
The script modifies the file initially by removing old pin-related properties and replacing them with pin control states.</p>
<p>The script is located in the <code class="file docutils literal notranslate"><span class="pre">zephyr/scripts/utils/</span></code> folder, and can be used in the following way:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">pinctrl_nrf_migrate</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">i</span> <span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">board</span><span class="o">.</span><span class="n">dts</span>
</pre></div>
</div>
<p>A <code class="file docutils literal notranslate"><span class="pre">board-pinctrl.dtsi</span></code> file containing the configuration for all pinctrl states is generated.
The script has a known limitation that all SPI nodes will be assumed to be a master device.</p>
<p>To know about the additional options that are available, see the <a class="reference external" href="https://github.com/zephyrproject-rtos/zephyr/blob/main/scripts/utils/pinctrl_nrf_migrate.py">Pinctrl Migration Utility Script documentation</a> for more details.</p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>This script uses a basic line based parser, therefore not all valid devicetree files will be converted correctly.
The adjusted or generated files must be manually reviewed.</p>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../build_and_config_system/index.html" class="btn btn-neutral float-right" title="Build and configuration system" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../board_support/index.html" class="btn btn-neutral" title="Board support" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">

<table>
<tr>
<td>
    <p>
        &copy; Copyright 2019-2023, Nordic Semiconductor.
      Last updated on Mar 20, 2023.

    </p>
</td>
<td id="nordiclogo">
  <a href="https://www.nordicsemi.com/"><img src="../../_static/images/nordic-logo.png" border="0"/></a>
</td>
</tr>
</table>
  </div> 


</footer>

<div id="scroll-container">
  <button type="button" id="scroll-btn" class="btn">
    <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="#fff"/></svg>
  </button>
</div>

<script>
  const scrollBtn = document.querySelector("#scroll-btn");

  document.addEventListener("scroll", () => {
    if (window.scrollY > 400) {
          scrollBtn.style.visibility = "visible";
      } else {
          scrollBtn.style.visibility = "hidden";
      }
  });

  scrollBtn.addEventListener("click", () => {
      window.scrollTo({ top: 0, behavior: "smooth" });
  });
</script>
        </div>
      </div>
    </section>
  </div>
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> nRF Connect SDK</span>
       <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      
      <div class="rst-other-version ncs">
        <a href="../../../nrf/index.html">nRF Connect SDK</a>
      </div>
      
      <div class="rst-other-version nrfx">
        <a href="../../../nrfx/index.html">nrfx</a>
      </div>
      
      <div class="rst-other-version nrfxlib">
        <a href="../../../nrfxlib/README.html">nrfxlib</a>
      </div>
      
      <div class="rst-other-version zephyr">
        <a href="../../../zephyr/index.html">Zephyr Project</a>
      </div>
      
      <div class="rst-other-version mcuboot">
        <a href="../../../mcuboot/wrapper.html">MCUboot</a>
      </div>
      
      <div class="rst-other-version tfm">
        <a href="../../../tfm/index.html">Trusted Firmware-M</a>
      </div>
      
      <div class="rst-other-version matter">
        <a href="../../../matter/index.html">Matter</a>
      </div>
      
      <div class="rst-other-version kconfig">
        <a href="../../../kconfig/index.html">Kconfig Reference</a>
      </div>
    </div>
  </div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>