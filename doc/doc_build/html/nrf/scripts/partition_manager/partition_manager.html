<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Partition Manager &mdash; nRF Connect SDK 2.3.99 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/nordic.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/togglebutton.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/nrf.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/tabs.css" type="text/css" /> 
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="https://www.googletagmanager.com/gtag/js?id=G-ZPVZRKFQJR"></script>
        <script src="../../_static/js/ga-tracker.js"></script>
        <script data-culture="EN" id="CookieConsent" type="text/javascript" src="https://policy.app.cookieinformation.com/uc.js"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../_static/togglebutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/js/theme.js"></script>
<script
  type="text/javascript"
  src="../../_static/js/ncs.js"
></script>
<script src="../../_static/js/bootstrap.bundle.min.js"></script>

    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Software Bill of Materials" href="../west_commands/sbom/README.html" />
    <link rel="prev" title="HID configurator for nRF Desktop" href="../hid_configurator/README.html" />
<link
  href="../../_static/css/bootstrap.min.css"
  rel="stylesheet"
/>
<link
  rel="shortcut icon"
  href="../../_static/images/favicon.ico"
/>

</head>

<body class="wy-body-for-nav">
<div class="announcement"></div>
<div class="d-print-none ncs-header">
  <div class="container-xl ncs-header-top">
    <div class="row h-100">
      <div class="d-none d-md-block col-2">
        <div class="bg-white py-4 px-3 ml-2 ncs-header-logo">
          <img
            class="ncs-header-logo"
            src="../../_static/images/nordic-logo.png"
            alt=""
          />
        </div>
      </div>
      <div
        class="col-8 col-md-7 pl-md-4 d-flex align-self-center justify-content-center"
      >
        <form class="w-75" action="../../search.html" method="get">
          <div class="form-group">
            <input
              type="text"
              name="q"
              class="ncs-search-input form-control"
              placeholder="Search all docs..."
            />
          </div>
        </form>
      </div>
      <div class="col-4 col-md-3 d-md-block p-3 text-end">
        <div class="dropdown">
          <button
            class="btn dropdown-toggle ncs-btn-versions"
            type="button"
            id="dropdownMenuButton1"
            data-bs-toggle="dropdown"
            aria-expanded="false"
          >
            <span class="d-none d-md-inline">nRF Connect SDK</span>
            <span id="ncsversion" class="d-inline"></span>
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton"></div>
        </div>
      </div>
    </div>
  </div>
  <div class="ncs-header-nav">
    <div class="container-xl">
      <div class="row">
        <div class="col col-12 d-flex justify-content-center">
          <nav class="navbar navbar-dark navbar-expand-lg p-0">
            <span class="navbar-brand d-block d-lg-none py-2 pl-1"
              >Documentation sets</span
            >
            <button
              class="navbar-toggler"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#navbarNavAltMarkup"
              aria-controls="navbarNavAltMarkup"
              aria-expanded="false"
              aria-label="Toggle navigation"
            >
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
              <ul class="navbar-nav">
                <li class="nav-item active py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../nrf/index.html"
                    >nRF Connect SDK</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../nrfx/index.html"
                    >nrfx</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../nrfxlib/README.html"
                    >nrfxlib</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../zephyr/index.html"
                    >Zephyr Project</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../mcuboot/wrapper.html"
                    >MCUboot</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../tfm/index.html"
                    >Trusted Firmware-M</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../matter/index.html"
                    >Matter</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="nav-item  py-1 px-3">
                  <a
                    class="nav-link"
                    href="../../../kconfig/index.html"
                    >Kconfig Reference</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
              </ul>
            </div>
          </nav>
        </div>
      </div>
    </div>
  </div>
</div>

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> nRF Connect SDK
          </a>
              <div class="version">
                2.3.99
              </div>
<div id="searchbox" role="search">
  <div class="searchformwrapper">
    <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
  </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev_model.html">Development model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../app_dev.html">Application development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ecosystem_integration.html">Ecosystems integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nrf91.html">Working with nRF91 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nrf70.html">Working with nRF70 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nrf53.html">Working with nRF53 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nrf52.html">Working with nRF52 Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../protocols.html">Protocols</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../applications.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../samples.html">Samples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../drivers.html">Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../libraries/index.html">Libraries</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../scripts.html">Scripts</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../shell/ble_console/README.html">Bluetooth LE Console</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nrf_provision/fast_pair/README.html">Fast Pair provision script</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hid_configurator/README.html">HID configurator for nRF Desktop</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Partition Manager</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#flash-partition-types">Flash partition types</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ram-partition-types">RAM partition types</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#configuration">Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#configuration-file-format">Configuration file format</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuration-file-preprocessing">Configuration file preprocessing</a></li>
<li class="toctree-l4"><a class="reference internal" href="#regions">Regions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#external-flash-memory-partitions">External flash memory partitions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#build-system">Build system</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#generated-output">Generated output</a></li>
<li class="toctree-l4"><a class="reference internal" href="#usage">Usage</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#static-configuration">Static configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#configuring-static-partitions">Configuring static partitions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../west_commands/sbom/README.html">Software Bill of Materials</a></li>
<li class="toctree-l2"><a class="reference internal" href="../memfault/README.html">MDS BLE gateway script</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../known_issues.html">Known issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../software_maturity.html">Software maturity levels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation.html">About this documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">nRF Connect SDK</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../../scripts.html">Scripts</a></li>
      <li class="breadcrumb-item active">Partition Manager</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/scripts/partition_manager/partition_manager.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="partition-manager">
<span id="id1"></span><h1>Partition Manager<a class="headerlink" href="#partition-manager" title="Permalink to this heading"></a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#overview" id="id18">Overview</a></p>
<ul>
<li><p><a class="reference internal" href="#flash-partition-types" id="id19">Flash partition types</a></p></li>
<li><p><a class="reference internal" href="#ram-partition-types" id="id20">RAM partition types</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#configuration" id="id21">Configuration</a></p>
<ul>
<li><p><a class="reference internal" href="#configuration-file-format" id="id22">Configuration file format</a></p></li>
<li><p><a class="reference internal" href="#configuration-file-preprocessing" id="id23">Configuration file preprocessing</a></p></li>
<li><p><a class="reference internal" href="#regions" id="id24">Regions</a></p></li>
<li><p><a class="reference internal" href="#external-flash-memory-partitions" id="id25">External flash memory partitions</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#build-system" id="id26">Build system</a></p>
<ul>
<li><p><a class="reference internal" href="#generated-output" id="id27">Generated output</a></p></li>
<li><p><a class="reference internal" href="#usage" id="id28">Usage</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#static-configuration" id="id29">Static configuration</a></p>
<ul>
<li><p><a class="reference internal" href="#configuring-static-partitions" id="id30">Configuring static partitions</a></p></li>
</ul>
</li>
</ul>
</div>
<p>The Partition Manager is a Python script that sets the start address and size of all the flash and RAM partitions in a multi-image build context.
When creating an application that requires child images, like a bootloader, you can configure the Partition Manager to control where each image should be placed in memory, and how the RAM should be shared.</p>
<p>See <a class="reference internal" href="../../app_dev/multi_image/index.html#ug-multi-image"><span class="std std-ref">Multi-image builds</span></a> for more information about multi-image builds.</p>
<p>The Partition Manager is activated for all multi-image builds, regardless of which build strategy is used for the child image.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When you build a multi-image application using the Partition Manager, the devicetree source flash partitions are ignored.</p>
</div>
<section id="overview">
<span id="pm-overview"></span><h2><a class="toc-backref" href="#id18">Overview</a><a class="headerlink" href="#overview" title="Permalink to this heading"></a></h2>
<p>The Partition Manager script reads the configuration files named <code class="file docutils literal notranslate"><span class="pre">pm.yml</span></code>, which define flash and RAM partitions.
A definition of a flash partition includes the name and the constraints on both size and placement in the flash memory.
A definition of a RAM partition includes the name and the constraints on its size.
The Partition Manager allocates a start address and, when set, a size to each partition in a way that complies with these constraints.</p>
<p>There are different types of <em>flash partitions</em> and <em>RAM partitions</em>, as described in the following section.</p>
<section id="flash-partition-types">
<h3><a class="toc-backref" href="#id19">Flash partition types</a><a class="headerlink" href="#flash-partition-types" title="Permalink to this heading"></a></h3>
<dl>
<dt>Image partitions</dt><dd><p>An image partition is the flash memory area reserved for an image to which the image binary is written.</p>
<p>When the Partition Manager is active, there is one <em>root image</em> and one or more <em>child images</em>.
The name of the root image is <code class="docutils literal notranslate"><span class="pre">app</span></code>.
It is always implicitly defined.
Child images are explicitly defined in <code class="file docutils literal notranslate"><span class="pre">pm.yml</span></code> files.
The size of the root image partition is dynamic, while the sizes of all child image partitions are statically defined.</p>
</dd>
<dt>Placeholder partitions</dt><dd><p>A placeholder partition does not contain an image, but reserves space for other uses.
For example, you might want to reserve space in the flash memory to hold an updated application image while it is being downloaded and before it is copied to the application image partition.</p>
</dd>
<dt>Container partitions</dt><dd><p>A container partition does not reserve space but is used to logically and (or) physically group other partitions.</p>
</dd>
</dl>
<p>The start addresses and sizes of image partitions are used in the preprocessing of the linker script for each image.</p>
</section>
<section id="ram-partition-types">
<h3><a class="toc-backref" href="#id20">RAM partition types</a><a class="headerlink" href="#ram-partition-types" title="Permalink to this heading"></a></h3>
<dl class="simple">
<dt>Default image RAM partition</dt><dd><p>The default image RAM partition consists of all the RAM that is not defined as a permanent image RAM partition or placeholder RAM partition.
It is the default RAM partition associated with an image and is set as the RAM region when linking the image.
If an image must reserve its RAM area permanently (that is, at the same time as other images are running), it must use a permanent image RAM partition, described below.</p>
</dd>
</dl>
<dl class="simple" id="pm-permanent-image-ram-partition">
<dt>Permanent image RAM partitions</dt><dd><p>A permanent image RAM partition reserves RAM for an image permanently.
It is typically used for images that will remain active after they have booted the next step in the boot chain.
If an image has configured a permanent image RAM partition, it is set as the RAM region when linking the image, instead of the default image RAM partition.</p>
</dd>
</dl>
<dl class="simple" id="pm-permanent-placeholder-ram-partition">
<dt>Permanent placeholder RAM partitions</dt><dd><p>A permanent placeholder RAM partition is used to permanently reserve RAM regions that are not associated with an image.</p>
</dd>
</dl>
</section>
</section>
<section id="configuration">
<span id="pm-configuration"></span><h2><a class="toc-backref" href="#id21">Configuration</a><a class="headerlink" href="#configuration" title="Permalink to this heading"></a></h2>
<p>Each child image must define its Partition Manager configuration in a file called <code class="file docutils literal notranslate"><span class="pre">pm.yml</span></code>.
This file must be stored in the same folder as the main <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file of the child image.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="file docutils literal notranslate"><span class="pre">pm.yml</span></code> is only used for child images.
The root application does not need to define a <code class="file docutils literal notranslate"><span class="pre">pm.yml</span></code> file, because its partition size and placement is implied by the size and placement of the child image partitions.
If a root application defines a <code class="file docutils literal notranslate"><span class="pre">pm.yml</span></code> file, it is silently ignored.</p>
</div>
<p>The Partition Manager configuration can be also provided by a <em>subsystem</em>, intended as a software component.
For example, the support for a file system.
Subsystem Partition Manager configurations cannot define image partitions.</p>
<p>See <code class="file docutils literal notranslate"><span class="pre">subsys/partition_manager/CMakeLists.txt</span></code> for details on how to add the subsystem-specific Partition Manager configuration files.
The following code shows how the <code class="docutils literal notranslate"><span class="pre">settings</span></code> subsystem configuration is added.</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">if</span><span class="w"> </span><span class="p">(</span><span class="s">CONFIG_SETTINGS_FCB</span><span class="w"> </span><span class="s">OR</span><span class="w"> </span><span class="s">CONFIG_SETTINGS_NVS</span><span class="p">)</span>
<span class="w">  </span><span class="nb">add_partition_manager_config</span><span class="p">(</span><span class="s">pm.yml.settings</span><span class="p">)</span>
<span class="nb">endif</span><span class="p">()</span>
</pre></div>
</div>
<p>When multiple application images, within the same domain, build the same subsystem code, there are some limitations if the code adds a Partition Manager configuration file using this methodology.
In particular, partition definitions are global per domain, and must be identical across all the calls to <code class="docutils literal notranslate"><span class="pre">add_partition_manager_config()</span></code>.
If the same partition is defined twice with different configurations within a domain, the Partition Manager will fail.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If Partition Manager configurations are only defined by subsystems, so that only one image is included in the build, you must set the option <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_PM_SINGLE_IMAGE</span></code> to execute the Partition Manager script.</p>
</div>
<section id="configuration-file-format">
<span id="pm-yaml-format"></span><h3><a class="toc-backref" href="#id22">Configuration file format</a><a class="headerlink" href="#configuration-file-format" title="Permalink to this heading"></a></h3>
<p>A <code class="file docutils literal notranslate"><span class="pre">pm.yml</span></code> file contains partition definitions.
Each partition is defined as follows:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">partition_name</span><span class="p">:</span>
<span class="w">   </span><span class="nt">partition_property</span><span class="p">:</span>
<span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">property_value</span>
</pre></div>
</div>
<p><em>partition_name</em> is the name of the partition (for example, <code class="docutils literal notranslate"><span class="pre">mcuboot</span></code>).</p>
<p>The following partition properties and property values are available:</p>
<dl id="partition-manager-placement">
<dt>placement: dict</dt><dd><p>This property specifies the placement of the partition relative to other partitions, to the start or end of the flash, or to the root image <code class="docutils literal notranslate"><span class="pre">app</span></code>.</p>
<p>A partition with the placement property set is either an image partition or a placeholder partition.
If the partition name is the same as the image name (as defined in a <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code>; see <a class="reference internal" href="../../app_dev/multi_image/index.html#ug-multi-image-defining"><span class="std std-ref">Defining and enabling a child image</span></a> for details), this partition is the image partition.
All other partitions are placeholder partitions.
Each <code class="file docutils literal notranslate"><span class="pre">pm.yml</span></code> file must define exactly one image partition.</p>
<p>The placement is formatted as a YAML dict.
The valid keywords are listed below:</p>
<blockquote>
<div><blockquote>
<div><dl class="simple">
<dt>before: list</dt><dd><p>Place the partition before the first existing partition in the list.</p>
</dd>
<dt>after: list</dt><dd><p>Place the partition after the first existing partition in the list.</p>
</dd>
</dl>
</div></blockquote>
<p>Valid values in the lists are <code class="docutils literal notranslate"><span class="pre">app</span></code>, <code class="docutils literal notranslate"><span class="pre">start</span></code>, <code class="docutils literal notranslate"><span class="pre">end</span></code>, or the name of any partition.
The value <code class="docutils literal notranslate"><span class="pre">start</span></code> refers to the start address of the flash device’s memory.
The value <code class="docutils literal notranslate"><span class="pre">end</span></code> refers to its end address.
It is not possible to place the partition after <code class="docutils literal notranslate"><span class="pre">end</span></code> or before <code class="docutils literal notranslate"><span class="pre">start</span></code>.</p>
<blockquote>
<div><dl class="simple">
<dt>align: dict</dt><dd><p>Ensure the alignment of the start or the end of the partition by specifying a dict with a <code class="docutils literal notranslate"><span class="pre">start</span></code> or <code class="docutils literal notranslate"><span class="pre">end</span></code> key respectively, where the value is the number of bytes to align to.
If necessary, empty partitions are inserted in front of or behind the partition to ensure that the alignment is correct.
Only one key can be specified.
Partitions that directly or indirectly (through <a class="reference internal" href="#partition-manager-spans"><span class="std std-ref">spans</span></a>) share size with the <code class="docutils literal notranslate"><span class="pre">app</span></code> partitions can only be aligned if they are placed directly after the <code class="docutils literal notranslate"><span class="pre">app</span></code> partition.</p>
</dd>
<dt>align_next: int</dt><dd><p>Ensure that the _next_ partition is aligned on this number of bytes.
This is equivalent to ensuring the alignment of the start of the next partition.
If the start of the next partition is already aligned, the largest alignment takes effect.
<code class="docutils literal notranslate"><span class="pre">align_next</span></code> fails if the alignment of the start of the next partition is not a divisor or multiple of the <code class="docutils literal notranslate"><span class="pre">align_next</span></code> value.
<code class="docutils literal notranslate"><span class="pre">align_next</span></code> also fails if the end of the next partition is aligned.</p>
</dd>
</dl>
</div></blockquote>
</div></blockquote>
</dd>
</dl>
<dl id="partition-manager-spans">
<dt>span: list OR span: string</dt><dd><p>This property is used to define container partitions.
Its value may be a list or string.</p>
<p>Since this property is used to define container partitions, it cannot be used together with the <code class="docutils literal notranslate"><span class="pre">placement</span></code> property.</p>
<p>If the value is a list, its elements are the names of the partitions that should be placed in the container:</p>
</dd>
</dl>
<p>The following example shows a partition that <em>spans</em>, or contains, <code class="docutils literal notranslate"><span class="pre">partition_1</span></code> through <code class="docutils literal notranslate"><span class="pre">partition_n</span></code>, in any order:</p>
<blockquote>
<div><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">container_partition_name</span><span class="p">:</span>
<span class="w">  </span><span class="nt">span</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">partition_1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">partition_2</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">...</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">partition_n</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>The list elements are interpreted as the set of potential partitions in the container, which the Partition Manager may place in the flash in any order.
For example, <code class="docutils literal notranslate"><span class="pre">partition_2</span></code> could be placed before <code class="docutils literal notranslate"><span class="pre">partition_1</span></code>.</p>
<p>If the value is a string, it is interpreted as a list with one item:</p>
</div></blockquote>
<p>The following 2 examples are equivalent:</p>
<blockquote>
<div><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">container_partition_name</span><span class="p">:</span>
<span class="w">  </span><span class="nt">span</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foo</span>

<span class="nt">container_partition_name</span><span class="p">:</span>
<span class="w">  </span><span class="nt">span</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">foo</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>Non-existent partitions are removed from the <code class="docutils literal notranslate"><span class="pre">span</span></code> list before processing.
Partitions with empty <code class="docutils literal notranslate"><span class="pre">span</span></code> lists are removed altogether, unless filled by the <a class="reference internal" href="#partition-manager-inside"><span class="std std-ref">inside property</span></a>.</p>
<p>If the Partition Manager is forced to place a partition that is not declared in the <code class="docutils literal notranslate"><span class="pre">span</span></code> list between two partitions that are in the list, the configuration is unsatisfiable and therefore invalid.
See <a class="reference internal" href="#partition-manager-span-ex1"><span class="std std-ref">Span property example 1</span></a> for an example of an invalid configuration.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can specify configurations with an ambiguous ordering.
Different versions of the Partition Manager script may produce different partition orders for such configurations, or fail to find a solution even if one is possible.
The Partition Manager always detects unsatisfiable configurations (no false positives), but it might fail on some valid inputs (false negatives).</p>
</div>
<p>Here are 3 examples of valid and invalid configurations:</p>
<ul id="partition-manager-span-ex1">
<li><p>In the following example, the mcuboot and tfm configurations result in this partition order: <code class="docutils literal notranslate"><span class="pre">mcuboot</span></code>, <code class="docutils literal notranslate"><span class="pre">tfm</span></code>, <code class="docutils literal notranslate"><span class="pre">app</span></code>.
Therefore, the foo partition configuration is invalid, because <code class="docutils literal notranslate"><span class="pre">tfm</span></code> must be placed between <code class="docutils literal notranslate"><span class="pre">mcuboot</span></code> and <code class="docutils literal notranslate"><span class="pre">app</span></code>, but is not in the span list.</p>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">Span property example 1 (invalid)</span><a class="headerlink" href="#id7" title="Permalink to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">mcuboot</span><span class="p">:</span>
<span class="w">   </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">      </span><span class="nt">before</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">tfm</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">app</span><span class="p p-Indicator">]</span>

<span class="nt">tfm</span><span class="p">:</span>
<span class="w">   </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">      </span><span class="nt">before</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">app</span><span class="p p-Indicator">]</span>

<span class="nt">foo</span><span class="p">:</span>
<span class="w">   </span><span class="nt">span</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">mcuboot</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">app</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
</div>
</li>
<li><p>In the following example, these mcuboot, tfm, and app configurations have two possible orders:</p>
<ul class="simple">
<li><p>Order 1: mcuboot, tfm, app</p></li>
<li><p>Order 2: mcuboot, app, tfm</p></li>
</ul>
<p>In the absence of additional configuration, the Partition Manager may choose either order.
However, since a span configuring the foo partition is present, the Partition Manager should choose order 2, since it is the only order that results in a valid configuration for the foo partition.</p>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text">Span property example 2 (valid)</span><a class="headerlink" href="#id8" title="Permalink to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">mcuboot</span><span class="p">:</span>
<span class="w">   </span><span class="nt">placement</span><span class="p">:</span>

<span class="nt">tfm</span><span class="p">:</span>
<span class="w">   </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">      </span><span class="nt">after</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">mcuboot</span><span class="p p-Indicator">]</span>

<span class="nt">app</span><span class="p">:</span>
<span class="w">   </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">      </span><span class="nt">after</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">mcuboot</span><span class="p p-Indicator">]</span>

<span class="nt">foo</span><span class="p">:</span>
<span class="w">   </span><span class="nt">span</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">mcuboot</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">app</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
</div>
</li>
<li><p>In the following example, these mcuboot, tfm, and app configurations have two possible orders:</p>
<ul class="simple">
<li><p>Order 1: mcuboot, tfm, app</p></li>
<li><p>Order 2: mcuboot, app, tfm</p></li>
</ul>
<p>However, the overall configuration is unsatisfiable: foo requires order 2, while bar requires order 1.</p>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text">Span property example 3 (invalid)</span><a class="headerlink" href="#id9" title="Permalink to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">mcuboot</span><span class="p">:</span>
<span class="w">   </span><span class="nt">placement</span><span class="p">:</span>

<span class="nt">tfm</span><span class="p">:</span>
<span class="w">   </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">      </span><span class="nt">after</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">mcuboot</span><span class="p p-Indicator">]</span>

<span class="nt">app</span><span class="p">:</span>
<span class="w">   </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">      </span><span class="nt">after</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">mcuboot</span><span class="p p-Indicator">]</span>

<span class="nt">foo</span><span class="p">:</span>
<span class="w">   </span><span class="nt">span</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">mcuboot</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">app</span><span class="p p-Indicator">]</span>

<span class="nt">bar</span><span class="p">:</span>
<span class="w">   </span><span class="nt">span</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">mcuboot</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">tfm</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
</div>
</li>
</ul>
</div></blockquote>
<dl id="partition-manager-inside">
<dt>inside: list</dt><dd><p>This property is the inverse of <code class="docutils literal notranslate"><span class="pre">span</span></code>.
The name of the partition that specifies this property is added to the <code class="docutils literal notranslate"><span class="pre">span</span></code> list of the first existing container partition in the list.
This property can be set for image or placeholder partitions.</p>
<div class="literal-block-wrapper docutils container" id="id10">
<div class="code-block-caption"><span class="caption-text">Example for the inside property</span><a class="headerlink" href="#id10" title="Permalink to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">mcuboot</span><span class="p">:</span>
<span class="w">   </span><span class="nt">inside</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">b0</span><span class="p p-Indicator">]</span>

<span class="nt">b0</span><span class="p">:</span>
<span class="w">   </span><span class="nt">span</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span><span class="w"> </span><span class="c1"># During processing, this span will contain mcuboot.</span>
</pre></div>
</div>
</div>
</dd>
<dt>size: hexadecimal value</dt><dd><p>This property defines the size of the partition.
You can provide a Kconfig option as the value, which allows the user to easily modify the size (see <a class="reference internal" href="#pm-yaml-preprocessing"><span class="std std-ref">Configuration file preprocessing</span></a> for an example).</p>
</dd>
<dt>share_size: list</dt><dd><p>This property defines the size of the current partition to be the same as the size of the first existing partition in the list.
This property can be set for image or placeholder partitions.
It cannot be used by container partitions.
The list can contain any kind of partition.
<code class="docutils literal notranslate"><span class="pre">share_size</span></code> takes precedence over <code class="docutils literal notranslate"><span class="pre">size</span></code> if one or more partitions in <code class="docutils literal notranslate"><span class="pre">share_size</span></code> exists.</p>
<p>If the target partition is the <code class="docutils literal notranslate"><span class="pre">app</span></code> or a partition that spans over the <code class="docutils literal notranslate"><span class="pre">app</span></code>, the size is effectively split between them, because the size of the <code class="docutils literal notranslate"><span class="pre">app</span></code> is dynamically decided.</p>
<p>If none of the partitions in the <code class="docutils literal notranslate"><span class="pre">share_size</span></code> list exists, and the partition does not define a <code class="docutils literal notranslate"><span class="pre">size</span></code> property, then the partition is removed.
If none of the partitions in the <code class="docutils literal notranslate"><span class="pre">share_size</span></code> list exists, and the partition <em>does</em> define a <code class="docutils literal notranslate"><span class="pre">size</span></code> property, then the <code class="docutils literal notranslate"><span class="pre">size</span></code> property is used to set the size.</p>
</dd>
<dt>region: string</dt><dd><p>Specify the region where a partition should be placed.
See <a class="reference internal" href="#pm-regions"><span class="std std-ref">Regions</span></a>.</p>
</dd>
</dl>
<dl class="simple" id="partition-manager-ram-configuration">
<dt>RAM partition configuration</dt><dd><p>RAM partitions are partitions located in the <code class="docutils literal notranslate"><span class="pre">sram_primary</span></code> region.
A RAM partition is specified by having the partition name end with <code class="docutils literal notranslate"><span class="pre">_sram</span></code>.
If a partition name is composed of an image name plus the <code class="docutils literal notranslate"><span class="pre">_sram</span></code> ending, it is used as a permanent image RAM partition for the image.</p>
</dd>
</dl>
<p>The following 2 examples are equivalent:</p>
<blockquote>
<div><div class="literal-block-wrapper docutils container" id="id11">
<div class="code-block-caption"><span class="caption-text">RAM partition configuration, without the <code class="docutils literal notranslate"><span class="pre">_sram</span></code> ending</span><a class="headerlink" href="#id11" title="Permalink to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">some_permament_sram_block_used_for_logging</span><span class="p">:</span>
<span class="w">   </span><span class="nt">size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0x1000</span>
<span class="w">   </span><span class="nt">region</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sram_primary</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id12">
<div class="code-block-caption"><span class="caption-text">RAM partition configuration, using the <code class="docutils literal notranslate"><span class="pre">_sram</span></code> ending</span><a class="headerlink" href="#id12" title="Permalink to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">some_permament_sram_block_used_for_logging_sram</span><span class="p">:</span>
<span class="w">   </span><span class="nt">size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0x1000</span>
</pre></div>
</div>
</div>
</div></blockquote>
<p>The following example specifies a permanent image RAM partition for MCUboot, that will be used by the MCUboot linker script.</p>
<blockquote>
<div><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">mcuboot_sram</span><span class="p">:</span>
<span class="w">    </span><span class="nt">size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0xa000</span>
</pre></div>
</div>
</div></blockquote>
<p>All occurrences of a partition name can be replaced by a dict with the key <code class="docutils literal notranslate"><span class="pre">one_of</span></code>.
This dict is resolved to the first existing partition in the <code class="docutils literal notranslate"><span class="pre">one_of</span></code> value.
The value of the <code class="docutils literal notranslate"><span class="pre">one_of</span></code> key must be a list of placeholder or image partitions, and it cannot be a span.</p>
<p>See the following 2 examples, they are equivalent:</p>
<blockquote>
<div><div class="literal-block-wrapper docutils container" id="id13">
<div class="code-block-caption"><span class="caption-text">Example of using a <code class="docutils literal notranslate"><span class="pre">one_of</span></code> dict</span><a class="headerlink" href="#id13" title="Permalink to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">some_span</span><span class="p">:</span>
<span class="w">   </span><span class="nt">span</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">something</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">one_of</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">does_not_exist_0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">does_not_exist_1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">exists1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">exists2</span><span class="p p-Indicator">]}]</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id14">
<div class="code-block-caption"><span class="caption-text">Example of not using a <code class="docutils literal notranslate"><span class="pre">one_of</span></code> dict</span><a class="headerlink" href="#id14" title="Permalink to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">some_span</span><span class="p">:</span>
<span class="w">   </span><span class="nt">span</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">something</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">exists1</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
</div>
</div></blockquote>
<p>An error is triggered if none of the partitions listed inside the <code class="docutils literal notranslate"><span class="pre">one_of</span></code> dict exists.</p>
<p>To use this functionality, the properties that must explicitly define the <code class="docutils literal notranslate"><span class="pre">one_of</span></code> keyword are the following:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">span</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">share_size</span></code></p></li>
</ul>
<p>The <a class="reference internal" href="#partition-manager-placement"><span class="std std-ref">placement property</span></a> contains the functionality of <code class="docutils literal notranslate"><span class="pre">one_of</span></code> by default.
As such, you must not use <code class="docutils literal notranslate"><span class="pre">one_of</span></code> with the <code class="docutils literal notranslate"><span class="pre">placement</span></code> property.
Doing so will trigger a build error.</p>
<p>The keywords <code class="docutils literal notranslate"><span class="pre">before</span></code> and <code class="docutils literal notranslate"><span class="pre">after</span></code> already check for the first existing partition in their list.
Therefore, you can pass a list of partitions into these keywords.</p>
</section>
<section id="configuration-file-preprocessing">
<span id="pm-yaml-preprocessing"></span><h3><a class="toc-backref" href="#id23">Configuration file preprocessing</a><a class="headerlink" href="#configuration-file-preprocessing" title="Permalink to this heading"></a></h3>
<p>Each <code class="file docutils literal notranslate"><span class="pre">pm.yml</span></code> file is preprocessed to resolve symbols from Kconfig and devicetree.</p>
<p>The following example is taken from the <code class="file docutils literal notranslate"><span class="pre">pm.yml</span></code> file for the <a class="reference internal" href="../../app_dev/bootloaders_and_dfu/bootloader.html#immutable-bootloader"><span class="std std-ref">First-stage immutable bootloader</span></a> provided with the nRF Connect SDK.
It includes <code class="file docutils literal notranslate"><span class="pre">autoconf.h</span></code> and <code class="file docutils literal notranslate"><span class="pre">devicetree_legacy_unfixed.h</span></code> (generated by Kconfig and devicetree respectively) to read application configurations and hardware properties.
In this example the application configuration is used to configure the size of the image and placeholder partitions.
The application configuration is also used to decide in which region the <code class="docutils literal notranslate"><span class="pre">otp</span></code> partition should be stored.
The information extracted from devicetree is the alignment value for some partitions.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &lt;autoconf.h&gt;</span>
<span class="c1">#include &lt;devicetree_legacy_unfixed.h&gt;</span>

<span class="nt">b0</span><span class="p">:</span>
<span class="w">  </span><span class="nt">size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CONFIG_PM_PARTITION_SIZE_B0_IMAGE</span>
<span class="w">  </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">    </span><span class="nt">after</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">start</span>

<span class="nt">b0_container</span><span class="p">:</span>
<span class="w">  </span><span class="nt">span</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">b0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">provision</span><span class="p p-Indicator">]</span>

<span class="nt">s0_pad</span><span class="p">:</span>
<span class="w">  </span><span class="nt">share_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mcuboot_pad</span>
<span class="w">  </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">    </span><span class="nt">after</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">b0</span>
<span class="w">    </span><span class="nt">align</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">start</span><span class="p">:</span><span class="w"> </span><span class="nv">CONFIG_FPROTECT_BLOCK_SIZE</span><span class="p p-Indicator">}</span>

<span class="nt">app_image</span><span class="p">:</span>
<span class="w">  </span><span class="nt">span</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">tfm</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">app</span><span class="p p-Indicator">]</span>

<span class="nt">s0_image</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># S0 spans over the image booted by B0</span>
<span class="w">  </span><span class="nt">span</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">one_of</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">mcuboot</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">app_image</span><span class="p p-Indicator">]}</span>

<span class="nt">s0</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># Phony container to allow hex overriding</span>
<span class="w">  </span><span class="nt">span</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">s0_pad</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">s0_image</span><span class="p p-Indicator">]</span>

<span class="nt">s1_pad</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># This partition will only exist if mcuboot_pad exists.</span>
<span class="w">  </span><span class="nt">share_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mcuboot_pad</span>
<span class="w">  </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">    </span><span class="nt">after</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">s0</span>
<span class="w">    </span><span class="nt">align</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">start</span><span class="p">:</span><span class="w"> </span><span class="nv">DT_FLASH_ERASE_BLOCK_SIZE</span><span class="p p-Indicator">}</span>

<span class="nt">s1_image</span><span class="p">:</span>
<span class="w">  </span><span class="nt">share_size</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">one_of</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">mcuboot</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">s0_image</span><span class="p p-Indicator">]}</span>
<span class="w">  </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">    </span><span class="nt">after</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">s1_pad</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">s0</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">align</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">end</span><span class="p">:</span><span class="w"> </span><span class="nv">CONFIG_FPROTECT_BLOCK_SIZE</span><span class="p p-Indicator">}</span>

<span class="nt">s1</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># Partition which contains the whole S1 partition.</span>
<span class="w">  </span><span class="nt">span</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">s1_pad</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">s1_image</span><span class="p p-Indicator">]</span>

<span class="nt">provision</span><span class="p">:</span>
<span class="w">  </span><span class="nt">size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CONFIG_PM_PARTITION_SIZE_PROVISION</span>
<span class="c1">#if defined(CONFIG_SOC_NRF9160) || defined(CONFIG_SOC_NRF5340_CPUAPP)</span>
<span class="w">  </span><span class="nt">region</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">otp</span>
<span class="c1">#else</span>
<span class="w">  </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">    </span><span class="nt">after</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">b0</span>
<span class="w">    </span><span class="nt">align</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">start</span><span class="p">:</span><span class="w"> </span><span class="nv">DT_FLASH_ERASE_BLOCK_SIZE</span><span class="p p-Indicator">}</span>
<span class="c1">#endif</span>
</pre></div>
</div>
</section>
<section id="regions">
<span id="pm-regions"></span><h3><a class="toc-backref" href="#id24">Regions</a><a class="headerlink" href="#regions" title="Permalink to this heading"></a></h3>
<p>The Partition Manager places partitions in different <em>regions</em>.
For example, you can use regions for internal flash memory and external flash memory.</p>
<p>To define in which region a partition should be placed, use the <code class="docutils literal notranslate"><span class="pre">region</span></code> property in the configuration of the partition.
If no region is specified, the predefined internal flash region is used.</p>
<section id="defining-a-region">
<h4>Defining a region<a class="headerlink" href="#defining-a-region" title="Permalink to this heading"></a></h4>
<p>Each region is defined by a name, a start address, a size, a placement strategy, and, if applicable, a device name.
A region only specifies a device name if there is a device driver associated with the region, for example, a driver for an external SPI flash.</p>
<p>There are three types of placement strategies, which affect how partitions are placed in regions:</p>
<dl class="simple">
<dt>start_to_end</dt><dd><p>Place partitions sequentially from start to end.
Partitions stored in a region with this placement strategy cannot affect their placement through the <code class="docutils literal notranslate"><span class="pre">placement</span></code> property.
The unused part of the region is assigned to a partition with the same name as the region.</p>
</dd>
<dt>end_to_start</dt><dd><p>Place partitions sequentially from end to start.
Partitions stored in a region with this placement strategy cannot affect their placement through the <code class="docutils literal notranslate"><span class="pre">placement</span></code> property.
The unused part of the region is exposed through a partition with the same name as the region.</p>
</dd>
<dt>complex</dt><dd><p>Place partitions according to their <code class="docutils literal notranslate"><span class="pre">placement</span></code> configuration.
The unused part of the region is exposed through a partition named <code class="docutils literal notranslate"><span class="pre">app</span></code>.</p>
</dd>
</dl>
<p>Regions are defined in <code class="file docutils literal notranslate"><span class="pre">partition_manager.cmake</span></code>.
For example, see the following definitions for default regions:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">add_region</span><span class="p">(</span><span class="w">                           </span><span class="c"># Define region without device name</span>
<span class="w">  </span><span class="s">NAME</span><span class="w"> </span><span class="s">otp</span><span class="w">                            </span><span class="c"># Name</span>
<span class="w">  </span><span class="s">SIZE</span><span class="w"> </span><span class="s">756</span><span class="w">                            </span><span class="c"># Size</span>
<span class="w">  </span><span class="s">BASE</span><span class="w"> </span><span class="s">0xff8108</span><span class="w">                       </span><span class="c"># Base address</span>
<span class="w">  </span><span class="s">PLACEMENT</span><span class="w"> </span><span class="s">start_to_end</span><span class="w">              </span><span class="c"># Placement strategy</span>
<span class="w">  </span><span class="p">)</span>

<span class="nb">add_region</span><span class="p">(</span><span class="w">                           </span><span class="c"># Define region with device name</span>
<span class="w">  </span><span class="s">NAME</span><span class="w"> </span><span class="s">flash_primary</span><span class="w">                  </span><span class="c"># Name</span>
<span class="w">  </span><span class="s">SIZE</span><span class="w"> </span><span class="o">${</span><span class="nv">flash_size</span><span class="o">}</span><span class="w">                  </span><span class="c"># Size</span>
<span class="w">  </span><span class="s">BASE</span><span class="w"> </span><span class="o">${</span><span class="nv">CONFIG_FLASH_BASE_ADDRESS</span><span class="o">}</span><span class="w">   </span><span class="c"># Base address</span>
<span class="w">  </span><span class="s">PLACEMENT</span><span class="w"> </span><span class="s">complex</span><span class="w">                   </span><span class="c"># Placement strategy</span>
<span class="w">  </span><span class="s">DEVICE</span><span class="w"> </span><span class="s">flash_controller</span><span class="w">             </span><span class="c"># DTS node label of flash controller</span>
<span class="w">  </span><span class="s">DEFAULT_DRIVER_KCONFIG</span><span class="w">              </span><span class="c"># Kconfig option that should be set for</span>
<span class="w">                                      </span><span class="c"># the driver to be compiled in</span>
<span class="w">  </span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="external-flash-memory-partitions">
<span id="pm-external-flash"></span><h3><a class="toc-backref" href="#id25">External flash memory partitions</a><a class="headerlink" href="#external-flash-memory-partitions" title="Permalink to this heading"></a></h3>
<p>The Partition Manager supports partitions in the external flash memory through the use of <a class="reference internal" href="#pm-regions"><span class="std std-ref">Regions</span></a>.
Any placeholder partition can specify that it should be stored in the external flash memory region.
External flash memory regions always use the <em>start_to_end</em> placement strategy.</p>
<p>To store partitions in the external flash memory, you can either choose a value for the <code class="docutils literal notranslate"><span class="pre">nordic,pm-ext-flash</span></code> property in the devicetree, or directly use an external flash DTS node label as <code class="docutils literal notranslate"><span class="pre">DEVICE</span></code>.
See the following example of an overlay file that sets this value:</p>
<div class="literal-block-wrapper docutils container" id="id15">
<div class="code-block-caption"><span class="caption-text">nrf52840dk_nrf52840.overlay</span><a class="headerlink" href="#id15" title="Permalink to this code"></a></div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="w"> </span><span class="p">{</span>
<span class="w">	</span><span class="n">chosen</span><span class="w"> </span><span class="p">{</span>
<span class="w">		</span><span class="n">nordic</span><span class="p">,</span><span class="n">pm</span><span class="o">-</span><span class="n">ext</span><span class="o">-</span><span class="n">flash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">mx25r64</span><span class="p">;</span>
<span class="w">	</span><span class="p">};</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<p>After the <code class="docutils literal notranslate"><span class="pre">nordic,pm-ext-flash</span></code> value is set, you can place partitions in the external flash memory as follows:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Name of partition</span>
<span class="nt">external_plz</span><span class="p">:</span>
<span class="w">  </span><span class="nt">region</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">external_flash</span>
<span class="w">  </span><span class="nt">size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CONFIG_EXTERNAL_PLZ_SIZE</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Use the <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_PM_PARTITION_REGION_LITTLEFS_EXTERNAL</span></code>, <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_PM_PARTITION_REGION_SETTINGS_STORAGE_EXTERNAL</span></code>, and <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_PM_PARTITION_REGION_NVS_STORAGE_EXTERNAL</span></code> to specify that the relevant partition must be located in external flash memory.
You must add a <code class="docutils literal notranslate"><span class="pre">chosen</span></code> entry for <code class="docutils literal notranslate"><span class="pre">nordic,pm-ext-flash</span></code> in your devicetree to make this option available.
See <code class="file docutils literal notranslate"><span class="pre">tests/subsys/partition_manager</span></code> for example configurations.</p></li>
<li><p>If the external flash device is not using the <span class="xref std std-ref">QSPI NOR</span> driver, you must enable <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_PM_OVERRIDE_EXTERNAL_DRIVER_CHECK</span></code> to override the Partition Manager’s external flash driver check, and the required driver must also be enabled for all applications that need it.</p></li>
</ul>
</div>
<p>See <a class="reference internal" href="../../app_dev/bootloaders_and_dfu/bootloader_external_flash.html#ug-bootloader-external-flash"><span class="std std-ref">Using external flash memory partitions</span></a> for more details on using external flash memory with MCUboot.</p>
<p id="pm-build-system">A partition can be accessible at runtime only if the flash device where it resides has its driver enabled at compile time.
Partition manager ignores partitions that are located in a region without its driver enabled.
To let partition manager know which Kconfig option ensures the existence of the driver, the option <code class="docutils literal notranslate"><span class="pre">DEFAULT_DRIVER_KCONFIG</span></code> is used.</p>
<p>For partitions in the internal flash memory, <code class="docutils literal notranslate"><span class="pre">DEFAULT_DRIVER_KCONFIG</span></code> within <code class="file docutils literal notranslate"><span class="pre">partition_manager.cmake</span></code> is set automatically to <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_SOC_FLASH_NRF</span></code>, so that all the partitions placed in the internal flash are always available at runtime.
For external regions, <code class="docutils literal notranslate"><span class="pre">DEFAULT_DRIVER_KCONFIG</span></code> within <code class="file docutils literal notranslate"><span class="pre">partition_manager.cmake</span></code> must be set to <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_PM_EXTERNAL_FLASH_HAS_DRIVER</span></code>.
Out-of-tree drivers can select this value to attest that they provide support for the external flash.
This is a hidden option and can be selected only by an external driver or a Kconfig option.</p>
<p>This option is automatically set when <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_NRF_QSPI_NOR</span></code> or <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_SPI_NOR</span></code> are enabled.
If the application provides the driver in an unusual way, this option can be overridden by setting <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_PM_OVERRIDE_EXTERNAL_DRIVER_CHECK</span></code> in the application configuration.</p>
<p>As partition manager does not know if partitions are used at runtime, consider the following:</p>
<blockquote>
<div><ul class="simple">
<li><p>Enabling Kconfig options that affect <code class="docutils literal notranslate"><span class="pre">DEFAULT_DRIVER_KCONFIG</span></code> will add a partition map entry for the partition depending on it, whether it is used at runtime or not.</p></li>
<li><p>Not enabling the Kconfig options that affect <code class="docutils literal notranslate"><span class="pre">DEFAULT_DRIVER_KCONFIG</span></code> will not add partition map entry for partition depending on it, whether it is used at runtime or not.</p></li>
<li><p>Enabling Kconfig options that affects <code class="docutils literal notranslate"><span class="pre">DEFAULT_DRIVER_KCONFIG</span></code> can cause linker errors when the option has no effect on including a driver into compilation.
In this case, partition manager adds a partition map entry that has a pointer to the flash device it is supposed to be placed on, but due to misconfiguration the driver is actually not compiled in.
This situation can also be caused by setting the <code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_PM_OVERRIDE_EXTERNAL_DRIVER_CHECK</span></code>, as partition manager will just assume that the driver is provided by the application.</p></li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When using an application configured with an MCUboot child image, both images use the same partition manager configuration, which means that the app and MCUboot have exactly the same partition maps.
The accessibility at runtime of flash partitions depends on the configurations of both the application and MCUboot and the values they give to the <code class="docutils literal notranslate"><span class="pre">DEFAULT_DRIVER_KCONFIG</span></code> option of the partition manager region specification.</p>
</div>
</section>
</section>
<section id="build-system">
<h2><a class="toc-backref" href="#id26">Build system</a><a class="headerlink" href="#build-system" title="Permalink to this heading"></a></h2>
<p>The build system finds the child images that have been enabled and their configurations.</p>
<p>For each image, the Partition Manager’s CMake code infers the paths to the following files and folders from the name and from other global properties:</p>
<ul class="simple">
<li><p>The <code class="file docutils literal notranslate"><span class="pre">pm.yml</span></code> file</p></li>
<li><p>The compiled HEX file</p></li>
<li><p>The generated include folder</p></li>
</ul>
<p>After CMake finishes configuring the child images, the Partition Manager script is executed in configure time (<code class="docutils literal notranslate"><span class="pre">execute_process</span></code>) with the lists of names and paths as arguments.
The configurations generated by the Partition Manager script are imported as CMake variables (see <a class="reference internal" href="#pm-cmake-usage"><span class="std std-ref">CMake</span></a>).</p>
<p>The Partition Manager script outputs a <code class="file docutils literal notranslate"><span class="pre">partitions.yml</span></code> file.
This file contains the internal state of the Partition Manager at the end of processing.
This means it contains the merged contents of all <code class="file docutils literal notranslate"><span class="pre">pm.yml</span></code> files, the sizes and addresses of all partitions, and other information generated by the Partition Manager.</p>
<section id="generated-output">
<span id="pm-generated-output-and-usage"></span><h3><a class="toc-backref" href="#id27">Generated output</a><a class="headerlink" href="#generated-output" title="Permalink to this heading"></a></h3>
<p>After the main Partition Manager script has finished, another script runs.
This script takes the <code class="file docutils literal notranslate"><span class="pre">partitions.yml</span></code> file as input and creates the following output files:</p>
<ul class="simple">
<li><p>A C header file <code class="file docutils literal notranslate"><span class="pre">pm_config.h</span></code> for each child image and for the root application</p></li>
<li><p>A key-value file <code class="file docutils literal notranslate"><span class="pre">pm.config</span></code></p></li>
</ul>
<p>The header files are used in the C code, while the key-value file is imported into the CMake namespace.
Both kinds of files contain, among other information, the start address and size of all partitions.</p>
</section>
<section id="usage">
<h3><a class="toc-backref" href="#id28">Usage</a><a class="headerlink" href="#usage" title="Permalink to this heading"></a></h3>
<p>The output that the Partition Manager generates can be used in various areas of your code.</p>
<section id="c-code">
<h4>C code<a class="headerlink" href="#c-code" title="Permalink to this heading"></a></h4>
<p>When the Partition Manager is enabled, all source files are compiled with the define <code class="docutils literal notranslate"><span class="pre">USE_PARTITION_MANAGER</span></code> set to 1.
If you use this define in your code, the preprocessor can choose what code to include depending on whether the Partition Manager is being used.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#if USE_PARTITION_MANAGER</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;pm_config.h&gt;</span>
<span class="cp">#define NON_SECURE_APP_ADDRESS PM_APP_ADDRESS</span>
<span class="cp">#else</span>
<span class="p">...</span>
</pre></div>
</div>
</section>
<section id="hex-files">
<h4>HEX files<a class="headerlink" href="#hex-files" title="Permalink to this heading"></a></h4>
<p>The Partition Manager may implicitly or explicitly assign a HEX file to a partition.</p>
<p>Image partitions are implicitly assigned the compiled HEX file, that is, the HEX file that is generated when building the corresponding image.
Container partitions are implicitly assigned the result of merging the HEX files that are assigned to the underlying partitions.
Placeholder partitions are not implicitly assigned a HEX file.</p>
<p>To explicitly assign a HEX file to a partition, set the global properties <em>partition_name</em>_PM_HEX_FILE and <em>partition_name</em>_PM_TARGET in CMake, where <em>partition_name</em> is the name of the partition.
<em>partition_name</em>_PM_TARGET specifies the build target that generates the HEX file specified in <em>partition_name</em>_PM_HEX_FILE.</p>
<p>See the following example, which assigns a cryptographically signed HEX file built by the <code class="docutils literal notranslate"><span class="pre">sign_target</span></code> build target to the root application:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">set_property</span><span class="p">(</span>
<span class="w">  </span><span class="s">GLOBAL</span><span class="w"> </span><span class="s">PROPERTY</span>
<span class="w">  </span><span class="s">app_PM_HEX_FILE</span><span class="w"> </span><span class="c"># Must match &quot;*_PM_HEX_FILE&quot;</span>
<span class="w">  </span><span class="o">${</span><span class="nv">PROJECT_BINARY_DIR</span><span class="o">}</span><span class="s">/signed.hex</span>
<span class="p">)</span>

<span class="nb">set_property</span><span class="p">(</span>
<span class="w">  </span><span class="s">GLOBAL</span><span class="w"> </span><span class="s">PROPERTY</span>
<span class="w">  </span><span class="s">app_PM_TARGET</span><span class="w"> </span><span class="c"># Must match &quot;*_PM_TARGET&quot;</span>
<span class="w">  </span><span class="s">sign_target</span>
<span class="p">)</span>
</pre></div>
</div>
<p>As output, the Partition Manager creates a HEX file called <code class="file docutils literal notranslate"><span class="pre">merged.hex</span></code>, which is programmed to the development kit when calling <code class="docutils literal notranslate"><span class="pre">ninja</span> <span class="pre">flash</span></code>.
When creating <code class="file docutils literal notranslate"><span class="pre">merged.hex</span></code>, all assigned HEX files are included in the merge operation.
If the HEX files overlap, the conflict is resolved as follows:</p>
<ul class="simple">
<li><p>HEX files assigned to container partitions overwrite HEX files assigned to their underlying partitions.</p></li>
<li><p>HEX files assigned to larger partitions overwrite HEX files assigned to smaller partitions.</p></li>
<li><p>Explicitly assigned HEX files overwrite implicitly assigned HEX files.</p></li>
</ul>
<p>This means that you can overwrite a partition’s HEX file by wrapping that partition in another partition and assigning a HEX file to the new partition.</p>
</section>
<section id="partition-manager-report">
<span id="pm-generated-output-and-usage-pm-report"></span><h4>Partition Manager report<a class="headerlink" href="#partition-manager-report" title="Permalink to this heading"></a></h4>
<p>When using the Partition Manager, run <code class="docutils literal notranslate"><span class="pre">ninja</span> <span class="pre">partition_manager_report</span></code> to see the addresses and sizes of all the configured partitions.</p>
</section>
<section id="cmake">
<span id="pm-cmake-usage"></span><h4>CMake<a class="headerlink" href="#cmake" title="Permalink to this heading"></a></h4>
<p>The CMake variables from the Partition Manager are typically used through <a class="reference external" href="https://cmake.org/cmake/help/latest/manual/cmake-generator-expressions.7.html">generator expressions</a>, because these variables are only made available late in the CMake configure stage.
To read a Partition Manager variable through a generator expression, the variable must be assigned as a target property.
The Partition Manager stores all variables as target properties on the <code class="docutils literal notranslate"><span class="pre">partition_manager</span></code> target, which means they can be used in generator expressions in the following way:</p>
<div class="literal-block-wrapper docutils container" id="id16">
<div class="code-block-caption"><span class="caption-text">Reading Partition Manager variables in generator expressions</span><a class="headerlink" href="#id16" title="Permalink to this code"></a></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>--slot-size $&lt;TARGET_PROPERTY:partition_manager,PM_MCUBOOT_PARTITIONS_PRIMARY_SIZE&gt;
</pre></div>
</div>
</div>
</section>
<section id="partition-placement-reports">
<span id="pm-partition-reports"></span><h4>Partition placement reports<a class="headerlink" href="#partition-placement-reports" title="Permalink to this heading"></a></h4>
<p>You can generate an ASCII-art map report to get an overview of how the partition manager creates flash memory partitions.
This is especially useful when using multiple bootloaders.</p>
<p>To generate the report, use the <code class="docutils literal notranslate"><span class="pre">ninja</span> <span class="pre">partition_manager_report</span></code> or <code class="docutils literal notranslate"><span class="pre">west</span> <span class="pre">build</span> <span class="pre">-t</span> <span class="pre">partition_manager_report</span></code> commands.</p>
<p>For example, if you generate a partition placement report on the build of <code class="file docutils literal notranslate"><span class="pre">zephyr/samples/hello_world</span></code> with the nRF52840 development kit using nRF Secure Immutable Bootloader and MCUboot, you would get as an output an ASCII partition map that looks like the following:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go"> (0x100000 - 1024.0kB):</span>
<span class="go">+------------------------------------------+</span>
<span class="go">+---0x0: b0 (0x9000)-----------------------+</span>
<span class="go">| 0x0: b0_image (0x8000)                   |</span>
<span class="go">| 0x8000: provision (0x1000)               |</span>
<span class="go">+---0x9000: s0 (0xc200)--------------------+</span>
<span class="go">| 0x9000: s0_pad (0x200)                   |</span>
<span class="go">+---0x9200: s0_image (0xc000)--------------+</span>
<span class="go">| 0x9200: mcuboot (0xc000)                 |</span>
<span class="go">| 0x15200: EMPTY_0 (0xe00)                 |</span>
<span class="go">+---0x16000: s1 (0xc200)-------------------+</span>
<span class="go">| 0x16000: s1_pad (0x200)                  |</span>
<span class="go">| 0x16200: EMPTY_1 (0xe00)                 |</span>
<span class="go">| 0x17000: s1_image (0xc000)               |</span>
<span class="go">+---0x23000: mcuboot_primary (0x6e000)-----+</span>
<span class="go">| 0x23000: mcuboot_pad (0x200)             |</span>
<span class="go">+---0x23200: mcuboot_primary_app (0x6de00)-+</span>
<span class="go">+---0x23200: app_image (0x6de00)-----------+</span>
<span class="go">| 0x23200: app (0x6de00)                   |</span>
<span class="go">| 0x91000: mcuboot_secondary (0x6e000)     |</span>
<span class="go">| 0xff000: EMPTY_2 (0x1000)                |</span>
<span class="go">+------------------------------------------+</span>
</pre></div>
</div>
<p>The sizes of each partition are determined by the associated <code class="file docutils literal notranslate"><span class="pre">pm.yml</span></code> file, such as <code class="file docutils literal notranslate"><span class="pre">nrf/samples/bootloader/pm.yml</span></code> for nRF Secure Immutable Bootloader and <code class="file docutils literal notranslate"><span class="pre">bootloader/mcuboot/boot/zephyr/pm.yml</span></code> for MCUboot.</p>
</section>
</section>
</section>
<section id="static-configuration">
<span id="ug-pm-static"></span><h2><a class="toc-backref" href="#id29">Static configuration</a><a class="headerlink" href="#static-configuration" title="Permalink to this heading"></a></h2>
<p>By default, the Partition Manager dynamically places the partitions in memory.
However, if you have a deployed product that consists of multiple images, where only a subset of the included images can be upgraded through a firmware update mechanism, the upgradable images must be statically configured.
For example, if a device includes a non-upgradable first-stage bootloader and an upgradable application, the application image to be upgraded must be linked to the same address as the one that is deployed.</p>
<p>For this purpose, the Partition Manager provides static configuration to define static partitions.
The area used by the static partitions is called the <em>static area</em>.
The static area comes in addition to the <em>dynamic area</em>, which consists of the <code class="docutils literal notranslate"><span class="pre">app</span></code> partition and all memory adjacent to the <code class="docutils literal notranslate"><span class="pre">app</span></code> partition that is not occupied by a static partition.
Note that there is only one dynamic area.
When the Partition Manager is executed, it operates only on the dynamic area, assuming that all other memory is reserved.</p>
<p>Within the dynamic area, you can define new partitions or configure existing partitions even if you are using static partitions.
The dynamic area is resized as required when updating the static configuration.</p>
<section id="configuring-static-partitions">
<span id="ug-pm-static-providing"></span><h3><a class="toc-backref" href="#id30">Configuring static partitions</a><a class="headerlink" href="#configuring-static-partitions" title="Permalink to this heading"></a></h3>
<p>Static partitions are defined through a YAML-formatted configuration file in the root application’s source directory.
This file is similar to the regular <code class="file docutils literal notranslate"><span class="pre">pm.yml</span></code> configuration files, except that it also defines the start address for all partitions.</p>
<p>You can set <code class="docutils literal notranslate"><span class="pre">PM_STATIC_YML_FILE</span></code> to contain exactly the static configuration you want to use.</p>
<p>If you do not set <code class="docutils literal notranslate"><span class="pre">PM_STATIC_YML_FILE</span></code>, the build system will use the following order to look for files in your application source directory to use as a static configuration layout:</p>
<ul class="simple">
<li><p>If build type is used, <a class="reference internal" href="../../getting_started/modifying.html#gs-modifying-build-types"><span class="std std-ref">Configuring build types</span></a>, the following order applies:</p>
<ol class="arabic simple">
<li><p>If the file <code class="file docutils literal notranslate"><span class="pre">pm_static_&lt;board&gt;_&lt;revision&gt;_&lt;buildtype&gt;.yml</span></code> exists, it will be used.</p></li>
<li><p>Otherwise, if the file <code class="file docutils literal notranslate"><span class="pre">pm_static_&lt;board&gt;_&lt;buildtype&gt;.yml</span></code> exists, it will be used.</p></li>
<li><p>Otherwise, if the file <code class="file docutils literal notranslate"><span class="pre">pm_static_&lt;buildtype&gt;.yml</span></code> exists, it will be used.</p></li>
<li><p>Otherwise, if the file <code class="file docutils literal notranslate"><span class="pre">pm_static.yml</span></code> exists, it will be used.</p></li>
</ol>
</li>
<li><p>If build type is not used, then the same order as above applies, except that <em>&lt;buildtype&gt;</em> is not part of the file name:</p>
<ol class="arabic simple">
<li><p>If the file <code class="file docutils literal notranslate"><span class="pre">pm_static_&lt;board&gt;_&lt;revision&gt;.yml</span></code> exists, it will be used.</p></li>
<li><p>Otherwise, if the file <code class="file docutils literal notranslate"><span class="pre">pm_static_&lt;board&gt;.yml</span></code> exists, it will be used.</p></li>
<li><p>Otherwise, if the file <code class="file docutils literal notranslate"><span class="pre">pm_static.yml</span></code> exists, it will be used.</p></li>
</ol>
</li>
</ul>
<p>For <a class="reference internal" href="../../app_dev/multi_image/index.html#ug-multi-image"><span class="std std-ref">Multi-image builds</span></a> where the image targets a different domain, <a class="reference internal" href="../../app_dev/multi_image/index.html#ug-multi-image-build-scripts"><span class="std std-ref">Updating the build scripts</span></a> uses the same search algorithm, but a domain specific configuration file is also searched.
For example, <code class="file docutils literal notranslate"><span class="pre">pm_static_&lt;board&gt;_&lt;buildtype&gt;_&lt;domain&gt;.yml</span></code> or <code class="file docutils literal notranslate"><span class="pre">pm_static_&lt;board&gt;_&lt;domain&gt;.yml</span></code>.</p>
<p>Use a static partition layout to ensure consistency between builds, as the settings storage will be at the same location after the DFU.</p>
<p>The current partition configuration for a build can be found in <code class="file docutils literal notranslate"><span class="pre">$</span><em><span class="pre">BUILD_DIR</span></em><span class="pre">/partitions.yml</span></code>.
To apply the current configuration as a static configuration, copy this file to <code class="file docutils literal notranslate"><span class="pre">$</span><em><span class="pre">APPLICATION_CONFIG_DIR</span></em><span class="pre">/pm_static.yml</span></code>.</p>
<p>It is also possible to build a <code class="file docutils literal notranslate"><span class="pre">pm_static.yml</span></code> from scratch by following the description in <a class="reference internal" href="#ug-pm-static-add"><span class="std std-ref">Adding a static partition</span></a></p>
<p>When modifying static configurations, keep in mind the following:</p>
<ul class="simple">
<li><p>There can only be one unoccupied gap per region.</p></li>
<li><p>All statically defined partitions in regions with <code class="docutils literal notranslate"><span class="pre">end_to_start</span></code> or <code class="docutils literal notranslate"><span class="pre">start_to_end</span></code> placement strategy must be packed at the end or the start of the region, respectively.</p></li>
</ul>
<p>The default <code class="docutils literal notranslate"><span class="pre">flash_primary</span></code> region uses the <code class="docutils literal notranslate"><span class="pre">complex</span></code> placement strategy, so these limitations do not apply there.</p>
<p>You can add or remove partitions as described in the following sections.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the static configuration contains an entry for the <code class="docutils literal notranslate"><span class="pre">app</span></code> partition, this entry is ignored.</p>
</div>
<section id="adding-a-dynamic-partition">
<span id="ug-pm-static-add-dynamic"></span><h4>Adding a dynamic partition<a class="headerlink" href="#adding-a-dynamic-partition" title="Permalink to this heading"></a></h4>
<p>New dynamic partitions that are listed in a <code class="file docutils literal notranslate"><span class="pre">pm.yml</span></code> file are automatically added.
However, if a partition is defined both as a static partition and as a dynamic partition, the dynamic definition is ignored.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When resolving the relative placement of dynamic partitions, any placement properties referencing static partitions are ignored.</p>
</div>
</section>
<section id="adding-a-static-partition">
<span id="ug-pm-static-add"></span><h4>Adding a static partition<a class="headerlink" href="#adding-a-static-partition" title="Permalink to this heading"></a></h4>
<p>To add a static partition, add an entry for it in <code class="file docutils literal notranslate"><span class="pre">pm_static.yml</span></code>.
This entry must define the properties <code class="docutils literal notranslate"><span class="pre">address</span></code>, <code class="docutils literal notranslate"><span class="pre">size</span></code>, and - if applicable - <code class="docutils literal notranslate"><span class="pre">span</span></code>.
The region defaults to <code class="docutils literal notranslate"><span class="pre">flash_primary</span></code> if no <code class="docutils literal notranslate"><span class="pre">region</span></code> property is specified.</p>
<div class="literal-block-wrapper docutils container" id="id17">
<div class="code-block-caption"><span class="caption-text">Example of static configuration of a partition with span</span><a class="headerlink" href="#id17" title="Permalink to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">partition_name</span><span class="p">:</span>
<span class="w">   </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0xab00</span>
<span class="w">   </span><span class="nt">size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0x1000</span>
<span class="w">   </span><span class="nt">span</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">example</span><span class="p p-Indicator">]</span><span class="w">  </span><span class="c1"># Only if this partition had the span property set originally.</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Child images that are built with the build strategy <em>partition_name</em>_BUILD_STRATEGY_SKIP_BUILD or <em>partition_name</em>_BUILD_STRATEGY_USE_HEX_FILE must define a static partition to ensure correct placement of the dynamic partitions.</p>
</div>
</section>
<section id="removing-a-static-partition">
<span id="ug-pm-static-remove"></span><h4>Removing a static partition<a class="headerlink" href="#removing-a-static-partition" title="Permalink to this heading"></a></h4>
<p>To remove a static partition, delete its entry in <code class="file docutils literal notranslate"><span class="pre">pm_static.yml</span></code>.</p>
<p>Only partitions adjacent to the <code class="docutils literal notranslate"><span class="pre">app</span></code> partition or other removed partitions can be removed.</p>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../west_commands/sbom/README.html" class="btn btn-neutral float-right" title="Software Bill of Materials" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../hid_configurator/README.html" class="btn btn-neutral" title="HID configurator for nRF Desktop" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">

<table>
<tr>
<td>
    <p>
        &copy; Copyright 2019-2023, Nordic Semiconductor.
      Last updated on Mar 20, 2023.

    </p>
</td>
<td id="nordiclogo">
  <a href="https://www.nordicsemi.com/"><img src="../../_static/images/nordic-logo.png" border="0"/></a>
</td>
</tr>
</table>
  </div> 


</footer>

<div id="scroll-container">
  <button type="button" id="scroll-btn" class="btn">
    <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="#fff"/></svg>
  </button>
</div>

<script>
  const scrollBtn = document.querySelector("#scroll-btn");

  document.addEventListener("scroll", () => {
    if (window.scrollY > 400) {
          scrollBtn.style.visibility = "visible";
      } else {
          scrollBtn.style.visibility = "hidden";
      }
  });

  scrollBtn.addEventListener("click", () => {
      window.scrollTo({ top: 0, behavior: "smooth" });
  });
</script>
        </div>
      </div>
    </section>
  </div>
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> nRF Connect SDK</span>
       <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      
      <div class="rst-other-version ncs">
        <a href="../../../nrf/index.html">nRF Connect SDK</a>
      </div>
      
      <div class="rst-other-version nrfx">
        <a href="../../../nrfx/index.html">nrfx</a>
      </div>
      
      <div class="rst-other-version nrfxlib">
        <a href="../../../nrfxlib/README.html">nrfxlib</a>
      </div>
      
      <div class="rst-other-version zephyr">
        <a href="../../../zephyr/index.html">Zephyr Project</a>
      </div>
      
      <div class="rst-other-version mcuboot">
        <a href="../../../mcuboot/wrapper.html">MCUboot</a>
      </div>
      
      <div class="rst-other-version tfm">
        <a href="../../../tfm/index.html">Trusted Firmware-M</a>
      </div>
      
      <div class="rst-other-version matter">
        <a href="../../../matter/index.html">Matter</a>
      </div>
      
      <div class="rst-other-version kconfig">
        <a href="../../../kconfig/index.html">Kconfig Reference</a>
      </div>
    </div>
  </div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>